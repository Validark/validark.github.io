<!DOCTYPE html>
<html lang="en-us">

<head>
	<meta charset="utf-8">
	<meta name="viewport" content="width=device-width, initial-scale=0.35">
	<meta name="description" content="An article on how to how to extract every other set bit. In other words, how to mask even set bits or how to mask odd set bits. Every other 1 in a bitstring is isolated.">
	<title>How to extract every other set bit from a bitstring</title>
	<link rel="preload" href="./fonts/Press_Start_2P/PressStart2P-Regular.ttf" as="font" type="font/ttf">
	<link rel="preload" href="./fonts/Ysabeau_Office/static/YsabeauOffice-Regular.ttf" as="font" type="font/ttf">
	<link rel="stylesheet" href="https://necolas.github.io/normalize.css/8.0.1/normalize.css">
	<link rel="stylesheet" href="./styles.css">

	<link rel="apple-touch-icon" sizes="180x180" href="./DynSDT/apple-touch-icon.png">
	<link rel="icon" type="image/png" sizes="32x32" href="./DynSDT/favicon-32x32.png">
	<link rel="icon" type="image/png" sizes="16x16" href="./DynSDT/favicon-16x16.png">
	<link rel="manifest" href="./DynSDT/site.webmanifest">
</head>

<body>
	<article>
		<style>
			text {
				font-family: "JetBrains Mono", monospace;
				font-size: 11pt;
			}

			text.nums {
				letter-spacing: 3.75pt;
			}

			tspan._1 {
				fill: #d14;
			}

			svg#intro-pic text,
			svg#prefix-xor-svg text {
				font-size: 16pt;
			}

			text.num2, text.xor {
				font-family: "JetBrains Mono", monospace;
				font-size: 9pt;
			}

			text.xor {
				font-size: 8pt;
			}
		</style>
		<center style="display: flex;">
			<a aria-label="Validark's GitHub profile" target="_blank" rel="noopener noreferrer" href="https://github.com/Validark"><img
					width="133.33333333"
					height="133.33333333"
					alt="Validark's logo which has a V:/ in the center"
					style="margin-top: 16pt; border-radius:50%; width: 100pt; height: 100pt; margin-right: 24pt; margin-top: -13pt;"
					src="https://avatars.githubusercontent.com/u/15217173?v=4" /></a>
			<h1><a style="text-decoration: none;" href="./index.html">V:/dev</a>
				<!-- <a style="text-decoration: none;">/mask_even_odd_bits</a> -->
			</h1>
		</center>

		<h2 id="title" style="text-align: center;">How to extract every other set bit from a bitstring</h2>
		<!-- <svg id="title" style="margin-top: 1.5em" id="title" viewBox="0 0 635 45">
			<text class="post" x="0" y="20">How to extract every other set bit</text>
			<text class="post" x="245" y="40" style="font-size: 65%">(June 30 2023)</text>
		</svg> -->
		<h4 style="text-align: center;">(June 30 2023)</h4>

		<p>Sometimes, one wants to extract every other set bit from a bitmap. We may want to isolate
			the even bits or the odd bits. This article presents implementations for both.</p>

		<svg id="intro-pic" version="1.1" width="100%" viewBox="0 -2 925 48"
			xmlns="http://www.w3.org/2000/svg">
			<text x="4" y="20">&nbsp;given:</text>
			<text x="100" y="20">00<tspan class="_1">1</tspan>0<tspan class="_1">1</tspan>000000<tspan class="_1">1</tspan>0000<tspan class="_1">1</tspan>00000000<tspan class="_1">1</tspan>000<tspan class="_1">1</tspan>000000<tspan class="_1">1</tspan>000000<tspan class="_1">1</tspan>000000<tspan class="_1">1</tspan>000000<tspan class="_1">1</tspan>000000</text>

			<text x="4" y="40">output:</text>
			<text x="100" y="40">0000<tspan class="_1">1</tspan>00000000000<tspan class="_1">1</tspan>000000000000<tspan class="_1">1</tspan>0000000000000<tspan class="_1">1</tspan>0000000000000<tspan class="_1">1</tspan>000000</text>
		</svg>

		<a href="#pdep" class="glyphicon"><h3 id="pdep">Method 1: pdep</h3></a>

		<!-- <a href="#pdep" class="glyphicon glyphicon-link"><svg id="pdep" class="header" viewBox="0 0 635 20">
			<text class="post" x="0" y="15" style="font-size: smaller">Method 1: pdep</text>
			<text class="post glyphy" x="191.5" y="15" style="font-size: smaller; text-decoration: none;">#</text>
		</svg></a> -->

		<p>On x86-64 machines, we have the <code>pdep</code> instruction which can do this in one go.</p>

		<p><code>pdep</code> works by iterating over each
			bit from right to left in the second operand,
			and performs one of two tasks at each step. If
			the bit is 0, 0 is written to the output. If
			the bit is 1, it takes a bit from the first
			operand and writes that to the output. In
			effect, each one bit in the second operand is
			replaced by a subsequent bit in the first
			operand.</p>


		<svg version="1.1" width="100%"
			viewBox="0 6 959 192"
			xmlns="http://www.w3.org/2000/svg">
			<!-- <rect x="1" y="1" width="980" height="198"
				stroke="black" fill="transparent"
				stroke-width="2" /> -->

			<text x="4" y="24">output:</text>
			<text class="nums" x="76"
				y="24">0000<tspan class="_1">1</tspan>00000000000<tspan class="_1">1</tspan>000000000000<tspan class="_1">1</tspan>0000000000000<tspan class="_1">1</tspan>0000000000000<tspan class="_1">1</tspan>000000</text>
			<text x="4" y="50">&nbsp;&nbsp;op 2:</text>
			<text class="nums" x="76"
				y="50">00<tspan class="_1">1</tspan>0<tspan class="_1">1</tspan>000000<tspan class="_1">1</tspan>0000<tspan class="_1">1</tspan>00000000<tspan class="_1">1</tspan>000<tspan class="_1">1</tspan>000000<tspan class="_1">1</tspan>000000<tspan class="_1">1</tspan>000000<tspan class="_1">1</tspan>000000<tspan class="_1">1</tspan>000000</text>

			<line id="line1" x1="866" x2="949" y1="52" y2="178"
				stroke="#d14" stroke-width="2" />
			<line id="line2" x1="769.75" x2="935.25" y1="52" y2="178"
				stroke="black" stroke-width="2" />
			<line id="line3" x1="673.5" x2="921.5" y1="52" y2="178"
				stroke="#d14" stroke-width="2" />
			<line id="line4" x1="577.25" x2="907.75" y1="52" y2="178"
				stroke="black" stroke-width="2" />
			<line id="line5" x1="481" x2="894" y1="52" y2="178"
				stroke="#d14" stroke-width="2" />
			<line id="line6" x1="426" x2="880.25" y1="52" y2="178"
				stroke="black" stroke-width="2" />
			<line id="line7" x1="302.25" x2="866.5" y1="52" y2="178"
				stroke="#d14" stroke-width="2" />
			<line id="line8" x1="233.5" x2="852.75" y1="52" y2="178"
				stroke="black" stroke-width="2" />
			<line id="line9" x1="137.25" x2="839" y1="52" y2="178"
				stroke="#d14" stroke-width="2" />
			<line id="line10" x1="109.75" x2="825.25" y1="52" y2="178"
				stroke="black" stroke-width="2" />

				<style>
				#line1 {
					/*stroke-dashoffset: 48;
					stroke-dasharray: 200;*/
					animation: line1 5s ease 1s infinite forwards normal;
					/**/
				}

				@keyframes line1 {
					0% {
						opacity: 100%;
					}

					2.5% {
						/* stroke-dashoffset: 200; */
						opacity: 0%;
					}

					5% {
						opacity: 0%;
						/* stroke-dashoffset: 200; */
					}

					12.5% {
						/*stroke-dashoffset: 48;*/
						opacity: 100%;
					}

					100% {
						/*stroke-dashoffset: 48;*/
						opacity: 100%;
					}
				}

				#line2 {
					/*stroke-dashoffset: 91;
					stroke-dasharray: 300;*/
					animation: line2 5s ease 1s infinite forwards normal;
					/**/
				}

				@keyframes line2 {
					0% {
						opacity: 100%;
					}

					2.5% {
						/*stroke-dashoffset: 300;*/
						opacity: 0%;
					}

					12.5% {
						/*stroke-dashoffset: 300;*/
						opacity: 0%;
					}

					20% {
						/*stroke-dashoffset: 91;*/
						opacity: 100%;
					}

					100% {
						/*stroke-dashoffset: 91;*/
						opacity: 100%;
					}
				}

				#line3 {
					/*stroke-dashoffset: 22;
					stroke-dasharray: 300;*/

					animation: line3 5s ease 1s infinite forwards normal;
					/**/
				}

				@keyframes line3 {
					0% {
						opacity: 100%;
					}
					2.5% {
						/*stroke-dashoffset: 300;*/
						opacity: 0%;
					}

					20% {
						/*stroke-dashoffset: 300;*/
						opacity: 0%;
					}

					27.5% {
						/*stroke-dashoffset: 22;*/
						opacity: 100%;
					}

					100% {
						/*stroke-dashoffset: 22;*/
						opacity: 100%;
					}
				}

				#line4 {
					/*stroke-dashoffset: 467;
					stroke-dasharray: 821;*/

					animation: line4 5s ease 1s infinite forwards normal;
					/**/
				}

				@keyframes line4 {
					0% {
						opacity: 100%;
					}
					2.5% {
						/*stroke-dashoffset: 821;*/
						opacity: 0%;
					}

					27.5% {
						/*stroke-dashoffset: 821;*/
						opacity: 0%;
					}

					35% {
						/*stroke-dashoffset: 467;*/
						opacity: 100%;
					}

					100% {
						/*stroke-dashoffset: 467;*/
						opacity: 100%;
					}
				}

				#line5 {
					/*stroke-dashoffset: 388;
					stroke-dasharray: 821;*/

					animation: line5 5s ease 1s infinite forwards normal;
					/**/
				}

				@keyframes line5 {
					0% {
						opacity: 100%;
					}
					2.5% {
						/*stroke-dashoffset: 821;*/
						opacity: 0%;
					}

					35% {
						/*stroke-dashoffset: 821;*/
						opacity: 0%;
					}

					42.5% {
						/*stroke-dashoffset: 388;*/
						opacity: 100%;
					}

					100% {
						/*stroke-dashoffset: 388;*/
						opacity: 100%;
					}
				}

				#line6 {
					/*stroke-dashoffset: 348;
					stroke-dasharray: 821;*/

					animation: line6 5s ease 1s infinite forwards normal;
					/**/
				}

				@keyframes line6 {
					0% {
						opacity: 100%;
					}
					2.5% {
						/*stroke-dashoffset: 821;*/
						opacity: 0%;
					}

					42.5% {
						/*stroke-dashoffset: 821;*/
						opacity: 0%;
					}

					50% {
						/*stroke-dashoffset: 348;*/
						opacity: 100%;
					}

					100% {
						/*stroke-dashoffset: 348;*/
						opacity: 100%;
					}
				}

				#line7 {
					/*stroke-dashoffset: 242;
					stroke-dasharray: 821;*/

					animation: line7 5s ease 1s infinite forwards normal;
					/**/
				}

				@keyframes line7 {
					0% {
						opacity: 100%;
					}
					2.5% {
						/*stroke-dashoffset: 821;*/
						opacity: 0%;
					}

					50% {
						/*stroke-dashoffset: 821;*/
						opacity: 0%;
					}

					57.5% {
						/*stroke-dashoffset: 242;*/
						opacity: 100%;
					}

					100% {
						/*stroke-dashoffset: 242;*/
						opacity: 100%;
					}
				}

				#line8 {
					/*stroke-dashoffset: 188;
					stroke-dasharray: 821;*/

					animation: line8 5s ease 1s infinite forwards normal;
					/**/
				}

				@keyframes line8 {
					0% {
						opacity: 100%;
					}
					2.5% {
						/*stroke-dashoffset: 821;*/
						opacity: 0%;
					}

					57.5% {
						/*stroke-dashoffset: 821;*/
						opacity: 0%;
					}

					65% {
						/*stroke-dashoffset: 188;*/
						opacity: 100%;
					}

					100% {
						/*stroke-dashoffset: 188;*/
						opacity: 100%;
					}
				}

				#line9 {
					/*stroke-dashoffset: 107;
					stroke-dasharray: 821;*/

					animation: line9 5s ease 1s infinite forwards normal;
					/**/
				}

				@keyframes line9 {
					0% {
						opacity: 100%;
					}
					2.5% {
						/*stroke-dashoffset: 821;*/
						opacity: 0%;
					}

					65% {
						/*stroke-dashoffset: 821;*/
						opacity: 0%;
					}

					72.5% {
						/*stroke-dashoffset: 107;*/
						opacity: 100%;
					}

					100% {
						/*stroke-dashoffset: 107;*/
						opacity: 100%;
					}
				}

				#line10 {
					/*stroke-dashoffset: 93;
					stroke-dasharray: 821;*/

					animation: line10 5s ease 1s infinite forwards normal;
					/**/
				}

				@keyframes line10 {
					0% {
						opacity: 100%;
					}
					2.5% {
						/*stroke-dashoffset: 821;*/
						opacity: 0%;
					}

					72.5% {
						/*stroke-dashoffset: 821;*/
						opacity: 0%;
					}

					80% {
						/*stroke-dashoffset: 93;*/
						opacity: 100%;
					}

					100% {
						/*stroke-dashoffset: 93;*/
						opacity: 100%;
					}
				}
			</style>



			<text x="4" y="190">&nbsp;&nbsp;op 1:</text>
			<text class="nums" x="76" y="190">0<tspan class="_1">1</tspan>0<tspan class="_1">1</tspan>0<tspan class="_1">1</tspan>0<tspan class="_1">1</tspan>0<tspan class="_1">1</tspan>0<tspan class="_1">1</tspan>0<tspan class="_1">1</tspan>0<tspan class="_1">1</tspan>0<tspan class="_1">1</tspan>0<tspan class="_1">1</tspan>0<tspan class="_1">1</tspan>0<tspan class="_1">1</tspan>0<tspan class="_1">1</tspan>0<tspan class="_1">1</tspan>0<tspan class="_1">1</tspan>0<tspan class="_1">1</tspan>0<tspan class="_1">1</tspan>0<tspan class="_1">1</tspan>0<tspan class="_1">1</tspan>0<tspan class="_1">1</tspan>0<tspan class="_1">1</tspan>0<tspan class="_1">1</tspan>0<tspan class="_1">1</tspan>0<tspan class="_1">1</tspan>0<tspan class="_1">1</tspan>0<tspan class="_1">1</tspan>0<tspan class="_1">1</tspan>0<tspan class="_1">1</tspan>0<tspan class="_1">1</tspan>0<tspan class="_1">1</tspan>0<tspan class="_1">1</tspan>0<tspan class="_1">1</tspan></text>

		</svg>


		<p>Here is the code in <a target="_blank" rel="noopener noreferrer"style="text-decoration: none;" href="https://ziglang.org/">Zig</a>. Note that after <a target="_blank" rel="noopener noreferrer"style="text-decoration: none; font-weight: 500;" href="https://github.com/ziglang/zig/issues/14995">#14995</a> is resolved there will be built-in support for this operation.</p>



<pre>
<code><span class="code-keyword">fn</span> <span class="code-fn">pdep</span>(src: <span class="code-type">u64</span>, mask: <span class="code-type">u64</span>) <span class="code-type">u64</span> {
    <span class="code-keyword">return</span> <span class="code-keyword">asm</span> (<span class="code-str">"pdep %[mask], %[src], %[ret]"</span>
        : [ret] <span class="code-str">"=r"</span> (-> <span class="code-type">u64</span>),
        : [src] <span class="code-str">"r"</span> (src),
          [mask] <span class="code-str">"r"</span> (mask),
    );
}

<span class="code-keyword">fn</span> <span class="code-fn">maskOddSetBits</span>(bitstring: <span class="code-type">u64</span>) <span class="code-type">u64</span> {
    <span class="code-keyword">return</span> pdep(<span class="code-num">0x5555555555555555</span>, bitstring);
}

<span class="code-keyword">fn</span> <span class="code-fn">maskEvenSetBits</span>(bitstring: <span class="code-type">u64</span>) <span class="code-type">u64</span> {
    <span class="code-keyword">return</span> pdep(<span class="code-num">0xaaaaaaaaaaaaaaaa</span>, bitstring);
}</code>
</pre>


<p>The <code>pdep</code> instruction is very efficient on recent x86-64 hardware. It has a latency of 3
	cycles and you can start a new one each cycle even if there are others in-flight. Unfortunately, it's <a target="_blank" rel="noopener noreferrer" href="https://uops.info/table.html?search=pdep&cb_lat=on&cb_tp=on&cb_uops=on&cb_ports=on&cb_ZEN2=on&cb_ZEN3=on&cb_ZEN4=on&cb_measurements=on&cb_doc=on&cb_bmi=on">quite inefficient on AMD architectures earlier than Zen 3</a>, and won't work on non-x86-64 architectures (although this instruction might be added to RISC-V one day). Luckily, there is another way:</p>

<a href="#prefix-xor" class="glyphicon"><h3 id="prefix-xor">Method 2: prefix-xor</h3></a>

<p>The prefix-xor operation takes a bitstring and sets each bit to the XOR of all the bits to its right (and itself).</p>

<svg id="xor-monstronsity" version="1.1" width="100%" viewBox="235 0 478 792" xmlns="http://www.w3.org/2000/svg">
			<!-- <rect x="1" y="1" width="980" height="790"
				stroke="black" fill="transparent"
				stroke-width="2" /> -->

			<text class="xor" x="236" y="11">⨁</text><text class="num2" x="250" y="13">00<tspan class="_1">1</tspan>0<tspan class="_1">1</tspan>000000<tspan class="_1">1</tspan>0000<tspan class="_1">1</tspan>00000000<tspan class="_1">1</tspan>000<tspan class="_1">1</tspan>000000<tspan class="_1">1</tspan>000000<tspan class="_1">1</tspan>000000<tspan class="_1">1</tspan>000000<tspan class="_1">1</tspan>000000</text>
			<text class="xor" x="236" y="23">⨁</text><text class="num2" x="250" y="25">0<tspan class="_1">1</tspan>0<tspan class="_1">1</tspan>000000<tspan class="_1">1</tspan>0000<tspan class="_1">1</tspan>00000000<tspan class="_1">1</tspan>000<tspan class="_1">1</tspan>000000<tspan class="_1">1</tspan>000000<tspan class="_1">1</tspan>000000<tspan class="_1">1</tspan>000000<tspan class="_1">1</tspan>000000&lt;</text>
			<text class="xor" x="236" y="35">⨁</text><text class="num2" x="250" y="37"><tspan class="_1">1</tspan>0<tspan class="_1">1</tspan>000000<tspan class="_1">1</tspan>0000<tspan class="_1">1</tspan>00000000<tspan class="_1">1</tspan>000<tspan class="_1">1</tspan>000000<tspan class="_1">1</tspan>000000<tspan class="_1">1</tspan>000000<tspan class="_1">1</tspan>000000<tspan class="_1">1</tspan>000000&lt;&lt;</text>
			<text class="xor" x="236" y="47">⨁</text><text class="num2" x="250" y="49">0<tspan class="_1">1</tspan>000000<tspan class="_1">1</tspan>0000<tspan class="_1">1</tspan>00000000<tspan class="_1">1</tspan>000<tspan class="_1">1</tspan>000000<tspan class="_1">1</tspan>000000<tspan class="_1">1</tspan>000000<tspan class="_1">1</tspan>000000<tspan class="_1">1</tspan>000000&lt;&lt;&lt;</text>
			<text class="xor" x="236" y="59">⨁</text><text class="num2" x="250" y="61"><tspan class="_1">1</tspan>000000<tspan class="_1">1</tspan>0000<tspan class="_1">1</tspan>00000000<tspan class="_1">1</tspan>000<tspan class="_1">1</tspan>000000<tspan class="_1">1</tspan>000000<tspan class="_1">1</tspan>000000<tspan class="_1">1</tspan>000000<tspan class="_1">1</tspan>000000&lt;&lt;&lt;&lt;</text>
			<text class="xor" x="236" y="71">⨁</text><text class="num2" x="250" y="73">000000<tspan class="_1">1</tspan>0000<tspan class="_1">1</tspan>00000000<tspan class="_1">1</tspan>000<tspan class="_1">1</tspan>000000<tspan class="_1">1</tspan>000000<tspan class="_1">1</tspan>000000<tspan class="_1">1</tspan>000000<tspan class="_1">1</tspan>000000&lt;&lt;&lt;&lt;&lt;</text>
			<text class="xor" x="236" y="83">⨁</text><text class="num2" x="250" y="85">00000<tspan class="_1">1</tspan>0000<tspan class="_1">1</tspan>00000000<tspan class="_1">1</tspan>000<tspan class="_1">1</tspan>000000<tspan class="_1">1</tspan>000000<tspan class="_1">1</tspan>000000<tspan class="_1">1</tspan>000000<tspan class="_1">1</tspan>000000&lt;&lt;&lt;&lt;&lt;&lt;</text>
			<text class="xor" x="236" y="95">⨁</text><text class="num2" x="250" y="97">0000<tspan class="_1">1</tspan>0000<tspan class="_1">1</tspan>00000000<tspan class="_1">1</tspan>000<tspan class="_1">1</tspan>000000<tspan class="_1">1</tspan>000000<tspan class="_1">1</tspan>000000<tspan class="_1">1</tspan>000000<tspan class="_1">1</tspan>000000&lt;&lt;&lt;&lt;&lt;&lt;&lt;</text>
			<text class="xor" x="236" y="107">⨁</text><text class="num2" x="250" y="109">000<tspan class="_1">1</tspan>0000<tspan class="_1">1</tspan>00000000<tspan class="_1">1</tspan>000<tspan class="_1">1</tspan>000000<tspan class="_1">1</tspan>000000<tspan class="_1">1</tspan>000000<tspan class="_1">1</tspan>000000<tspan class="_1">1</tspan>000000&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;</text>
			<text class="xor" x="236" y="119">⨁</text><text class="num2" x="250" y="121">00<tspan class="_1">1</tspan>0000<tspan class="_1">1</tspan>00000000<tspan class="_1">1</tspan>000<tspan class="_1">1</tspan>000000<tspan class="_1">1</tspan>000000<tspan class="_1">1</tspan>000000<tspan class="_1">1</tspan>000000<tspan class="_1">1</tspan>000000&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;</text>
			<text class="xor" x="236" y="131">⨁</text><text class="num2" x="250" y="133">0<tspan class="_1">1</tspan>0000<tspan class="_1">1</tspan>00000000<tspan class="_1">1</tspan>000<tspan class="_1">1</tspan>000000<tspan class="_1">1</tspan>000000<tspan class="_1">1</tspan>000000<tspan class="_1">1</tspan>000000<tspan class="_1">1</tspan>000000&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;</text>
			<text class="xor" x="236" y="143">⨁</text><text class="num2" x="250" y="145"><tspan class="_1">1</tspan>0000<tspan class="_1">1</tspan>00000000<tspan class="_1">1</tspan>000<tspan class="_1">1</tspan>000000<tspan class="_1">1</tspan>000000<tspan class="_1">1</tspan>000000<tspan class="_1">1</tspan>000000<tspan class="_1">1</tspan>000000&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;</text>
			<text class="xor" x="236" y="155">⨁</text><text class="num2" x="250" y="157">0000<tspan class="_1">1</tspan>00000000<tspan class="_1">1</tspan>000<tspan class="_1">1</tspan>000000<tspan class="_1">1</tspan>000000<tspan class="_1">1</tspan>000000<tspan class="_1">1</tspan>000000<tspan class="_1">1</tspan>000000&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;</text>
			<text class="xor" x="236" y="167">⨁</text><text class="num2" x="250" y="169">000<tspan class="_1">1</tspan>00000000<tspan class="_1">1</tspan>000<tspan class="_1">1</tspan>000000<tspan class="_1">1</tspan>000000<tspan class="_1">1</tspan>000000<tspan class="_1">1</tspan>000000<tspan class="_1">1</tspan>000000&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;</text>
			<text class="xor" x="236" y="179">⨁</text><text class="num2" x="250" y="181">00<tspan class="_1">1</tspan>00000000<tspan class="_1">1</tspan>000<tspan class="_1">1</tspan>000000<tspan class="_1">1</tspan>000000<tspan class="_1">1</tspan>000000<tspan class="_1">1</tspan>000000<tspan class="_1">1</tspan>000000&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;</text>
			<text class="xor" x="236" y="191">⨁</text><text class="num2" x="250" y="193">0<tspan class="_1">1</tspan>00000000<tspan class="_1">1</tspan>000<tspan class="_1">1</tspan>000000<tspan class="_1">1</tspan>000000<tspan class="_1">1</tspan>000000<tspan class="_1">1</tspan>000000<tspan class="_1">1</tspan>000000&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;</text>
			<text class="xor" x="236" y="203">⨁</text><text class="num2" x="250" y="205"><tspan class="_1">1</tspan>00000000<tspan class="_1">1</tspan>000<tspan class="_1">1</tspan>000000<tspan class="_1">1</tspan>000000<tspan class="_1">1</tspan>000000<tspan class="_1">1</tspan>000000<tspan class="_1">1</tspan>000000&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;</text>
			<text class="xor" x="236" y="215">⨁</text><text class="num2" x="250" y="217">00000000<tspan class="_1">1</tspan>000<tspan class="_1">1</tspan>000000<tspan class="_1">1</tspan>000000<tspan class="_1">1</tspan>000000<tspan class="_1">1</tspan>000000<tspan class="_1">1</tspan>000000&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;</text>
			<text class="xor" x="236" y="227">⨁</text><text class="num2" x="250" y="229">0000000<tspan class="_1">1</tspan>000<tspan class="_1">1</tspan>000000<tspan class="_1">1</tspan>000000<tspan class="_1">1</tspan>000000<tspan class="_1">1</tspan>000000<tspan class="_1">1</tspan>000000&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;</text>
			<text class="xor" x="236" y="239">⨁</text><text class="num2" x="250" y="241">000000<tspan class="_1">1</tspan>000<tspan class="_1">1</tspan>000000<tspan class="_1">1</tspan>000000<tspan class="_1">1</tspan>000000<tspan class="_1">1</tspan>000000<tspan class="_1">1</tspan>000000&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;</text>
			<text class="xor" x="236" y="251">⨁</text><text class="num2" x="250" y="253">00000<tspan class="_1">1</tspan>000<tspan class="_1">1</tspan>000000<tspan class="_1">1</tspan>000000<tspan class="_1">1</tspan>000000<tspan class="_1">1</tspan>000000<tspan class="_1">1</tspan>000000&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;</text>
			<text class="xor" x="236" y="263">⨁</text><text class="num2" x="250" y="265">0000<tspan class="_1">1</tspan>000<tspan class="_1">1</tspan>000000<tspan class="_1">1</tspan>000000<tspan class="_1">1</tspan>000000<tspan class="_1">1</tspan>000000<tspan class="_1">1</tspan>000000&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;</text>
			<text class="xor" x="236" y="275">⨁</text><text class="num2" x="250" y="277">000<tspan class="_1">1</tspan>000<tspan class="_1">1</tspan>000000<tspan class="_1">1</tspan>000000<tspan class="_1">1</tspan>000000<tspan class="_1">1</tspan>000000<tspan class="_1">1</tspan>000000&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;</text>
			<text class="xor" x="236" y="287">⨁</text><text class="num2" x="250" y="289">00<tspan class="_1">1</tspan>000<tspan class="_1">1</tspan>000000<tspan class="_1">1</tspan>000000<tspan class="_1">1</tspan>000000<tspan class="_1">1</tspan>000000<tspan class="_1">1</tspan>000000&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;</text>
			<text class="xor" x="236" y="299">⨁</text><text class="num2" x="250" y="301">0<tspan class="_1">1</tspan>000<tspan class="_1">1</tspan>000000<tspan class="_1">1</tspan>000000<tspan class="_1">1</tspan>000000<tspan class="_1">1</tspan>000000<tspan class="_1">1</tspan>000000&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;</text>
			<text class="xor" x="236" y="311">⨁</text><text class="num2" x="250" y="313"><tspan class="_1">1</tspan>000<tspan class="_1">1</tspan>000000<tspan class="_1">1</tspan>000000<tspan class="_1">1</tspan>000000<tspan class="_1">1</tspan>000000<tspan class="_1">1</tspan>000000&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;</text>
			<text class="xor" x="236" y="323">⨁</text><text class="num2" x="250" y="325">000<tspan class="_1">1</tspan>000000<tspan class="_1">1</tspan>000000<tspan class="_1">1</tspan>000000<tspan class="_1">1</tspan>000000<tspan class="_1">1</tspan>000000&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;</text>
			<text class="xor" x="236" y="335">⨁</text><text class="num2" x="250" y="337">00<tspan class="_1">1</tspan>000000<tspan class="_1">1</tspan>000000<tspan class="_1">1</tspan>000000<tspan class="_1">1</tspan>000000<tspan class="_1">1</tspan>000000&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;</text>
			<text class="xor" x="236" y="347">⨁</text><text class="num2" x="250" y="349">0<tspan class="_1">1</tspan>000000<tspan class="_1">1</tspan>000000<tspan class="_1">1</tspan>000000<tspan class="_1">1</tspan>000000<tspan class="_1">1</tspan>000000&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;</text>
			<text class="xor" x="236" y="359">⨁</text><text class="num2" x="250" y="361"><tspan class="_1">1</tspan>000000<tspan class="_1">1</tspan>000000<tspan class="_1">1</tspan>000000<tspan class="_1">1</tspan>000000<tspan class="_1">1</tspan>000000&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;</text>
			<text class="xor" x="236" y="371">⨁</text><text class="num2" x="250" y="373">000000<tspan class="_1">1</tspan>000000<tspan class="_1">1</tspan>000000<tspan class="_1">1</tspan>000000<tspan class="_1">1</tspan>000000&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;</text>
			<text class="xor" x="236" y="383">⨁</text><text class="num2" x="250" y="385">00000<tspan class="_1">1</tspan>000000<tspan class="_1">1</tspan>000000<tspan class="_1">1</tspan>000000<tspan class="_1">1</tspan>000000&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;</text>
			<text class="xor" x="236" y="395">⨁</text><text class="num2" x="250" y="397">0000<tspan class="_1">1</tspan>000000<tspan class="_1">1</tspan>000000<tspan class="_1">1</tspan>000000<tspan class="_1">1</tspan>000000&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;</text>
			<text class="xor" x="236" y="407">⨁</text><text class="num2" x="250" y="409">000<tspan class="_1">1</tspan>000000<tspan class="_1">1</tspan>000000<tspan class="_1">1</tspan>000000<tspan class="_1">1</tspan>000000&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;</text>
			<text class="xor" x="236" y="419">⨁</text><text class="num2" x="250" y="421">00<tspan class="_1">1</tspan>000000<tspan class="_1">1</tspan>000000<tspan class="_1">1</tspan>000000<tspan class="_1">1</tspan>000000&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;</text>
			<text class="xor" x="236" y="431">⨁</text><text class="num2" x="250" y="433">0<tspan class="_1">1</tspan>000000<tspan class="_1">1</tspan>000000<tspan class="_1">1</tspan>000000<tspan class="_1">1</tspan>000000&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;</text>
			<text class="xor" x="236" y="443">⨁</text><text class="num2" x="250" y="445"><tspan class="_1">1</tspan>000000<tspan class="_1">1</tspan>000000<tspan class="_1">1</tspan>000000<tspan class="_1">1</tspan>000000&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;</text>
			<text class="xor" x="236" y="455">⨁</text><text class="num2" x="250" y="457">000000<tspan class="_1">1</tspan>000000<tspan class="_1">1</tspan>000000<tspan class="_1">1</tspan>000000&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;</text>
			<text class="xor" x="236" y="467">⨁</text><text class="num2" x="250" y="469">00000<tspan class="_1">1</tspan>000000<tspan class="_1">1</tspan>000000<tspan class="_1">1</tspan>000000&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;</text>
			<text class="xor" x="236" y="479">⨁</text><text class="num2" x="250" y="481">0000<tspan class="_1">1</tspan>000000<tspan class="_1">1</tspan>000000<tspan class="_1">1</tspan>000000&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;</text>
			<text class="xor" x="236" y="491">⨁</text><text class="num2" x="250" y="493">000<tspan class="_1">1</tspan>000000<tspan class="_1">1</tspan>000000<tspan class="_1">1</tspan>000000&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;</text>
			<text class="xor" x="236" y="503">⨁</text><text class="num2" x="250" y="505">00<tspan class="_1">1</tspan>000000<tspan class="_1">1</tspan>000000<tspan class="_1">1</tspan>000000&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;</text>
			<text class="xor" x="236" y="515">⨁</text><text class="num2" x="250" y="517">0<tspan class="_1">1</tspan>000000<tspan class="_1">1</tspan>000000<tspan class="_1">1</tspan>000000&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;</text>
			<text class="xor" x="236" y="527">⨁</text><text class="num2" x="250" y="529"><tspan class="_1">1</tspan>000000<tspan class="_1">1</tspan>000000<tspan class="_1">1</tspan>000000&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;</text>
			<text class="xor" x="236" y="539">⨁</text><text class="num2" x="250" y="541">000000<tspan class="_1">1</tspan>000000<tspan class="_1">1</tspan>000000&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;</text>
			<text class="xor" x="236" y="551">⨁</text><text class="num2" x="250" y="553">00000<tspan class="_1">1</tspan>000000<tspan class="_1">1</tspan>000000&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;</text>
			<text class="xor" x="236" y="563">⨁</text><text class="num2" x="250" y="565">0000<tspan class="_1">1</tspan>000000<tspan class="_1">1</tspan>000000&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;</text>
			<text class="xor" x="236" y="575">⨁</text><text class="num2" x="250" y="577">000<tspan class="_1">1</tspan>000000<tspan class="_1">1</tspan>000000&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;</text>
			<text class="xor" x="236" y="587">⨁</text><text class="num2" x="250" y="589">00<tspan class="_1">1</tspan>000000<tspan class="_1">1</tspan>000000&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;</text>
			<text class="xor" x="236" y="599">⨁</text><text class="num2" x="250" y="601">0<tspan class="_1">1</tspan>000000<tspan class="_1">1</tspan>000000&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;</text>
			<text class="xor" x="236" y="611">⨁</text><text class="num2" x="250" y="613"><tspan class="_1">1</tspan>000000<tspan class="_1">1</tspan>000000&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;</text>
			<text class="xor" x="236" y="623">⨁</text><text class="num2" x="250" y="625">000000<tspan class="_1">1</tspan>000000&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;</text>
			<text class="xor" x="236" y="635">⨁</text><text class="num2" x="250" y="637">00000<tspan class="_1">1</tspan>000000&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;</text>
			<text class="xor" x="236" y="647">⨁</text><text class="num2" x="250" y="649">0000<tspan class="_1">1</tspan>000000&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;</text>
			<text class="xor" x="236" y="659">⨁</text><text class="num2" x="250" y="661">000<tspan class="_1">1</tspan>000000&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;</text>
			<text class="xor" x="236" y="671">⨁</text><text class="num2" x="250" y="673">00<tspan class="_1">1</tspan>000000&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;</text>
			<text class="xor" x="236" y="683">⨁</text><text class="num2" x="250" y="685">0<tspan class="_1">1</tspan>000000&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;</text>
			<text class="xor" x="236" y="695">⨁</text><text class="num2" x="250" y="697"><tspan class="_1">1</tspan>000000&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;</text>
			<text class="xor" x="236" y="707">⨁</text><text class="num2" x="250" y="709">000000&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;</text>
			<text class="xor" x="236" y="719">⨁</text><text class="num2" x="250" y="721">00000&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;</text>
			<text class="xor" x="236" y="731">⨁</text><text class="num2" x="250" y="733">0000&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;</text>
			<text class="xor" x="236" y="743">⨁</text><text class="num2" x="250" y="745">000&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;</text>
			<text class="xor" x="236" y="755">⨁</text><text class="num2" x="250" y="757">00&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;</text>
			<text class="xor" x="236" y="767">⨁</text><text class="num2" x="250" y="769">0&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;</text>

			<line x1="236" x2="710" y1="772" y2="772" stroke="black" stroke-width="2" />
			<text class="num2" x="250" y="784">000<tspan class="_1">1</tspan><tspan class="_1">1</tspan>0000000<tspan class="_1">1</tspan><tspan class="_1">1</tspan><tspan class="_1">1</tspan><tspan class="_1">1</tspan><tspan class="_1">1</tspan>000000000<tspan class="_1">1</tspan><tspan class="_1">1</tspan><tspan class="_1">1</tspan><tspan class="_1">1</tspan>0000000<tspan class="_1">1</tspan><tspan class="_1">1</tspan><tspan class="_1">1</tspan><tspan class="_1">1</tspan><tspan class="_1">1</tspan><tspan class="_1">1</tspan><tspan class="_1">1</tspan>0000000<tspan class="_1">1</tspan><tspan class="_1">1</tspan><tspan class="_1">1</tspan><tspan class="_1">1</tspan><tspan class="_1">1</tspan><tspan class="_1">1</tspan><tspan class="_1">1</tspan>000000</text>
</svg>

<p>This has the net effect of setting each bit to a 1 if there were an odd number of bits to the right (including itself), and a 0 if there were an even number of bits to the right (including itself).</p>

<svg id="prefix-xor-svg" version="1.1" viewBox="0 0 972 46" width="100%"
xmlns="http://www.w3.org/2000/svg">
<!-- <rect x="1" y="1" width="980" height="48"
	stroke="black" fill="transparent"
	stroke-width="2" /> -->
<text x="4" y="20">&nbsp;bitstring:</text>
<style>
text#bitstr_to_prefix_xor:hover {
	cursor: pointer;
}
</style>
<text id="bitstr_to_prefix_xor" x="150" y="20"><tspan>0</tspan><tspan>0</tspan><tspan class="_1">1</tspan><tspan>0</tspan><tspan class="_1">1</tspan><tspan>0</tspan><tspan>0</tspan><tspan>0</tspan><tspan>0</tspan><tspan>0</tspan><tspan>0</tspan><tspan class="_1">1</tspan><tspan>0</tspan><tspan>0</tspan><tspan>0</tspan><tspan>0</tspan><tspan class="_1">1</tspan><tspan>0</tspan><tspan>0</tspan><tspan>0</tspan><tspan>0</tspan><tspan>0</tspan><tspan>0</tspan><tspan>0</tspan><tspan>0</tspan><tspan class="_1">1</tspan><tspan>0</tspan><tspan>0</tspan><tspan>0</tspan><tspan class="_1">1</tspan><tspan>0</tspan><tspan>0</tspan><tspan>0</tspan><tspan>0</tspan><tspan>0</tspan><tspan>0</tspan><tspan class="_1">1</tspan><tspan>0</tspan><tspan>0</tspan><tspan>0</tspan><tspan>0</tspan><tspan>0</tspan><tspan>0</tspan><tspan class="_1">1</tspan><tspan>0</tspan><tspan>0</tspan><tspan>0</tspan><tspan>0</tspan><tspan>0</tspan><tspan>0</tspan><tspan class="_1">1</tspan><tspan>0</tspan><tspan>0</tspan><tspan>0</tspan><tspan>0</tspan><tspan>0</tspan><tspan>0</tspan><tspan class="_1">1</tspan><tspan>0</tspan><tspan>0</tspan><tspan>0</tspan><tspan>0</tspan><tspan>0</tspan><tspan>0</tspan></text>

<text x="4" y="40">prefix-xor:</text>
<text id="prefix-xor-bitstring" x="150" y="40">000<tspan class="_1">1</tspan><tspan class="_1">1</tspan>0000000<tspan class="_1">1</tspan><tspan class="_1">1</tspan><tspan class="_1">1</tspan><tspan class="_1">1</tspan><tspan class="_1">1</tspan>000000000<tspan class="_1">1</tspan><tspan class="_1">1</tspan><tspan class="_1">1</tspan><tspan class="_1">1</tspan>0000000<tspan class="_1">1</tspan><tspan class="_1">1</tspan><tspan class="_1">1</tspan><tspan class="_1">1</tspan><tspan class="_1">1</tspan><tspan class="_1">1</tspan><tspan class="_1">1</tspan>0000000<tspan class="_1">1</tspan><tspan class="_1">1</tspan><tspan class="_1">1</tspan><tspan class="_1">1</tspan><tspan class="_1">1</tspan><tspan class="_1">1</tspan><tspan class="_1">1</tspan>000000</text>
</svg>
<script>
{
	const bitstr_to_prefix_xor = document.getElementById("bitstr_to_prefix_xor");
	const prefix_xor_bitstring = document.getElementById("prefix-xor-bitstring")
	const tab = ['0', '<tspan class="_1">1</tspan>'];
	const supanoodle_children = [...bitstr_to_prefix_xor.childNodes.values()];

	function onBitClick(e) {
		const fe = !+this.textContent;
		const fe_n = +fe;
		this.textContent = fe_n;
		this.setAttribute("class", `_${fe_n}`);
		const new_str = new Array(64);
		let xor = 0;
		for (let i = 64; --i >= 0; ) {
			xor ^= +supanoodle_children[i].textContent;
			new_str[i] = tab[xor];
		}
		prefix_xor_bitstring.innerHTML = new_str.join("")
	}

	for (const node of bitstr_to_prefix_xor.childNodes) {
		node.addEventListener("click", onBitClick)
	}
}
</script>

<p>Armed with this operation, we simply do a bitwise AND of the bitstring together with its prefix-xor to get a mask of every other set bit.</p>

<pre>
<code><span class="code-keyword">fn</span> <span class="code-fn">maskOddSetBits</span>(bitstring: <span class="code-type">u64</span>) <span class="code-type">u64</span> {
    <span class="code-keyword">return</span> bitstring & prefixXOR(bitstring);
}

<span class="code-keyword">fn</span> <span class="code-fn">maskEvenSetBits</span>(bitstring: <span class="code-type">u64</span>) <span class="code-type">u64</span> {
    <span class="code-keyword">return</span> bitstring & ~prefixXOR(bitstring);
}</code>
</pre>

<p>The <code>prefixXOR</code> function is naïvely implemented as follows:</p>

<pre>
<code><span class="code-keyword">fn</span> <span class="code-fn">prefixXOR</span>(bitstring: <span class="code-type">u64</span>) <span class="code-type">u64</span> {
    <span class="code-keyword">var</span> x = bitstring;
    <span class="code-keyword">inline</span> <span class="code-keyword">for</span> (<span class="code-num">1</span>..<span class="code-num">64</span>) |i| { <span class="code-comment">// i ∈ [1, 63]</span>
        x ^= bitstring &lt;&lt; i;
    }
    <span class="code-keyword">return</span> x;
}</code>
</pre>

<p>However, we can save on operations by taking advantage of how XOR's stack:</p>

<pre>
<code><span class="code-keyword">fn</span> <span class="code-fn">prefixXOR</span>(bitstring: <span class="code-type">u64</span>) <span class="code-type">u64</span> {
    <span class="code-keyword">var</span> x = bitstring;
    x ^= x &lt;&lt; <span class="code-num">1</span>;
    x ^= x &lt;&lt; <span class="code-num">2</span>;
    x ^= x &lt;&lt; <span class="code-num">4</span>;
    x ^= x &lt;&lt; <span class="code-num">8</span>;
    x ^= x &lt;&lt; <span class="code-num">16</span>;
    x ^= x &lt;&lt; <span class="code-num">32</span>;
    <span class="code-keyword">return</span> x;
}</code>
</pre>

<!-- <p style="font-size: smaller !important; margin-top: -1em; margin-bottom: -1em;">(Note we can flip the <code>&lt;&lt;</code> to <code>&gt;&gt;</code> so long as we XOR with <code>bitstring</code> at the end. One optimization we can do for <code>maskEvenSetBits</code> is omit the aforementioned XOR and bitwise AND the final value of <code>x</code> with <code>bitstring</code> to get the evenly set bits with 2 fewer operations.)</p> -->

<p>Geoff Langdale explained an even more efficient way to compute the prefix-xor <a target="_blank" rel="noopener noreferrer" href="https://branchfree.org/2019/03/06/code-fragment-finding-quote-pairs-with-carry-less-multiply-pclmulqdq/">here</a>. The trick is to perform a <a target="_blank" rel="noopener noreferrer" href="https://en.wikipedia.org/wiki/Carry-less_product">carryless multiply</a> by a bitstring of all 1's. If you think about it, this trick results in the <a href="#xor-monstronsity">XOR diagram above</a>. This is a great trick because a lot more CPU's support fast carryless multiplies since it is used in cryptography. x86-64 supports it via <code>clmul</code> instructions, ARM has <code>pmull</code>, and SPARC has <code>xmulx</code>. It's even <a target="_blank" rel="noopener noreferrer" href="https://uops.info/table.html?search=clmul&cb_lat=on&cb_tp=on&cb_uops=on&cb_ports=on&cb_ZENp=on&cb_ZEN2=on&cb_ZEN3=on&cb_measurements=on&cb_doc=on&cb_avx=on&cb_others=on">fast on early Zen architectures</a> (~4 cycle latency)!</p>

<p>Once Zig gets a <code><span class="code-builtin">@mulCarryless</span></code> builtin (<a target="_blank" rel="noopener noreferrer"style="text-decoration: none; font-weight: 500;" href="https://github.com/ziglang/zig/issues/9631">#9631</a>), we can implement this function like so:</p>

<pre>
<code><span class="code-keyword">fn</span> <span class="code-fn">prefixXOR</span>(bitmask: <span class="code-type">u64</span>) <span class="code-type">u64</span> {
    <span class="code-keyword">const</span> ones: <span class="code-type">u64</span> = <span class="code-builtin">@bitCast</span>(<span class="code-builtin">@as</span>(<span class="code-type">i64</span>, <span class="code-num">-1</span>));
    <span class="code-keyword">return</span> <span class="code-builtin">@mulCarryless</span>(bitmask, ones);
}</code>
</pre>

<p>If you would like a temporary Zig implementation that uses inline assembly, I have one <a target="_blank" rel="noopener noreferrer" href="https://github.com/Validark/DynSDT/blob/4d31c8be4f3ef48834394c22695fd1b01a83a53c/zig/src/main.zig#L135-L177">here</a>. (Unfortunately it uses <code>vpclmulqdq</code> rather than <code>pclmulqdq</code> because it is derived from crypto code in the Zig standard library and I currently don't know how to modify inline assembly properly.)</p>

<p>Happy hacking!<br>&horbar;&#x202F;Validark</p>

</article>

<!-- <script src="https://utteranc.es/client.js"
        repo="validark/validark.github.io"
        issue-term="title"
        label="comments section"
        theme="github-light"
        crossorigin="anonymous"
        async>
</script> -->

</body>


</html>
