<!DOCTYPE html>
<html lang="en-us">

<head>
	<meta charset="utf-8">
	<meta name="viewport" content="width=device-width, initial-scale=0.35">
	<meta name="description" content="An article on how to how to extract every other set bit. In other words, how to mask even set bits or how to mask odd set bits. Every other 1 in a bitstring is isolated.">
	<title>How to extract every other set bit from a bitstring</title>
	<link rel="preload" href="./fonts/Press_Start_2P/PressStart2P-Regular.ttf" as="font" type="font/ttf">
	<link rel="preload" href="./fonts/Ysabeau_Office/static/YsabeauOffice-Regular.ttf" as="font" type="font/ttf">
	<link rel="stylesheet" href="https://necolas.github.io/normalize.css/8.0.1/normalize.css">
	<link rel="stylesheet" href="./styles.css">

	<link rel="apple-touch-icon" sizes="180x180" href="./DynSDT/apple-touch-icon.png">
	<link rel="icon" type="image/png" sizes="32x32" href="./DynSDT/favicon-32x32.png">
	<link rel="icon" type="image/png" sizes="16x16" href="./DynSDT/favicon-16x16.png">
	<link rel="manifest" href="./DynSDT/site.webmanifest">
</head>

<body>
	<article>
		<style>
			text {
				font-family: "JetBrains Mono", monospace;
				font-size: 11pt;
			}

			text.nums {
				letter-spacing: 3.75pt;
			}

			tspan._1 {
				fill: #d14;
			}

			svg#intro-pic text,
			svg#prefix-xor-svg text {
				font-size: 16pt;
			}

			text.num2, text.xor {
				font-family: "JetBrains Mono", monospace;
				font-size: 9pt;
			}

			text.xor {
				font-size: 8pt;
			}
		</style>
		<center style="display: flex;">
			<a aria-label="Validark's GitHub profile" target="_blank" rel="noopener noreferrer" href="https://github.com/Validark"><img
					width="133.33333333"
					height="133.33333333"
					alt="Validark's logo which has a V:/ in the center"
					style="margin-top: 16pt; border-radius:50%; width: 100pt; height: 100pt; margin-right: 24pt; margin-top: -13pt;"
					src="https://avatars.githubusercontent.com/u/15217173?v=4" /></a>
			<h1><a style="text-decoration: none;" href="./index.html">V:/dev</a>
				<!-- <a style="text-decoration: none;">/mask_even_odd_bits</a> -->
			</h1>
		</center>

		<h2 id="title" style="text-align: center;">How to extract every other set bit from a bitstring</h2>
		<!-- <svg id="title" style="margin-top: 1.5em" id="title" viewBox="0 0 635 45">
			<text class="post" x="0" y="20">How to extract every other set bit</text>
			<text class="post" x="245" y="40" style="font-size: 65%">(June 30 2023)</text>
		</svg> -->
		<h4 style="text-align: center;">(June 30 2023)</h4>

		<p>Sometimes, one wants to extract every other set bit from a bitmap. We may want to isolate
			the even bits or the odd bits. This article presents implementations for both.</p>

		<svg id="intro-pic" version="1.1" width="100%" viewBox="0 -2 925 48"
			xmlns="http://www.w3.org/2000/svg">
			<text x="4" y="20">&nbsp;given:</text>
			<text x="100" y="20">00<tspan class="_1">1</tspan>0<tspan class="_1">1</tspan>000000<tspan class="_1">1</tspan>0000<tspan class="_1">1</tspan>00000000<tspan class="_1">1</tspan>000<tspan class="_1">1</tspan>000000<tspan class="_1">1</tspan>000000<tspan class="_1">1</tspan>000000<tspan class="_1">1</tspan>000000<tspan class="_1">1</tspan>000000</text>

			<text x="4" y="40">output:</text>
			<text x="100" y="40">0000<tspan class="_1">1</tspan>00000000000<tspan class="_1">1</tspan>000000000000<tspan class="_1">1</tspan>0000000000000<tspan class="_1">1</tspan>0000000000000<tspan class="_1">1</tspan>000000</text>
		</svg>

		<a href="#pdep" class="glyphicon"><h3 id="pdep">Method 1: pdep</h3></a>

		<!-- <a href="#pdep" class="glyphicon glyphicon-link"><svg id="pdep" class="header" viewBox="0 0 635 20">
			<text class="post" x="0" y="15" style="font-size: smaller">Method 1: pdep</text>
			<text class="post glyphy" x="191.5" y="15" style="font-size: smaller; text-decoration: none;">#</text>
		</svg></a> -->

		<p>On x86-64 machines, we have the <code>pdep</code> instruction which can do this in one go.</p>

		<p><code>pdep</code> works by iterating over each
			bit from right to left in the second operand,
			and performs one of two tasks at each step. If
			the bit is 0, 0 is written to the output. If
			the bit is 1, it takes a bit from the first
			operand and writes that to the output. In
			effect, each one bit in the second operand is
			replaced by a subsequent bit in the first
			operand.</p>


		<svg version="1.1" width="100%"
			viewBox="0 6 959 192"
			xmlns="http://www.w3.org/2000/svg">
			<!-- <rect x="1" y="1" width="980" height="198"
				stroke="black" fill="transparent"
				stroke-width="2" /> -->

			<text x="4" y="24">output:</text>
			<text class="nums" x="76"
				y="24">0000<tspan class="_1">1</tspan>00000000000<tspan class="_1">1</tspan>000000000000<tspan class="_1">1</tspan>0000000000000<tspan class="_1">1</tspan>0000000000000<tspan class="_1">1</tspan>000000</text>
			<text x="4" y="50">&nbsp;&nbsp;op 2:</text>
			<text class="nums" x="76"
				y="50">00<tspan class="_1">1</tspan>0<tspan class="_1">1</tspan>000000<tspan class="_1">1</tspan>0000<tspan class="_1">1</tspan>00000000<tspan class="_1">1</tspan>000<tspan class="_1">1</tspan>000000<tspan class="_1">1</tspan>000000<tspan class="_1">1</tspan>000000<tspan class="_1">1</tspan>000000<tspan class="_1">1</tspan>000000</text>

			<line id="line1" x1="866" x2="949" y1="52" y2="178"
				stroke="#d14" stroke-width="2" />
			<line id="line2" x1="769.75" x2="935.25" y1="52" y2="178"
				stroke="black" stroke-width="2" />
			<line id="line3" x1="673.5" x2="921.5" y1="52" y2="178"
				stroke="#d14" stroke-width="2" />
			<line id="line4" x1="577.25" x2="907.75" y1="52" y2="178"
				stroke="black" stroke-width="2" />
			<line id="line5" x1="481" x2="894" y1="52" y2="178"
				stroke="#d14" stroke-width="2" />
			<line id="line6" x1="426" x2="880.25" y1="52" y2="178"
				stroke="black" stroke-width="2" />
			<line id="line7" x1="302.25" x2="866.5" y1="52" y2="178"
				stroke="#d14" stroke-width="2" />
			<line id="line8" x1="233.5" x2="852.75" y1="52" y2="178"
				stroke="black" stroke-width="2" />
			<line id="line9" x1="137.25" x2="839" y1="52" y2="178"
				stroke="#d14" stroke-width="2" />
			<line id="line10" x1="109.75" x2="825.25" y1="52" y2="178"
				stroke="black" stroke-width="2" />

				<style>
				#line1 {
					/*stroke-dashoffset: 48;
					stroke-dasharray: 200;*/
					animation: line1 5s ease 1s infinite forwards normal;
					/**/
				}

				@keyframes line1 {
					0% {
						opacity: 100%;
					}

					2.5% {
						/* stroke-dashoffset: 200; */
						opacity: 0%;
					}

					5% {
						opacity: 0%;
						/* stroke-dashoffset: 200; */
					}

					12.5% {
						/*stroke-dashoffset: 48;*/
						opacity: 100%;
					}

					100% {
						/*stroke-dashoffset: 48;*/
						opacity: 100%;
					}
				}

				#line2 {
					/*stroke-dashoffset: 91;
					stroke-dasharray: 300;*/
					animation: line2 5s ease 1s infinite forwards normal;
					/**/
				}

				@keyframes line2 {
					0% {
						opacity: 100%;
					}

					2.5% {
						/*stroke-dashoffset: 300;*/
						opacity: 0%;
					}

					12.5% {
						/*stroke-dashoffset: 300;*/
						opacity: 0%;
					}

					20% {
						/*stroke-dashoffset: 91;*/
						opacity: 100%;
					}

					100% {
						/*stroke-dashoffset: 91;*/
						opacity: 100%;
					}
				}

				#line3 {
					/*stroke-dashoffset: 22;
					stroke-dasharray: 300;*/

					animation: line3 5s ease 1s infinite forwards normal;
					/**/
				}

				@keyframes line3 {
					0% {
						opacity: 100%;
					}
					2.5% {
						/*stroke-dashoffset: 300;*/
						opacity: 0%;
					}

					20% {
						/*stroke-dashoffset: 300;*/
						opacity: 0%;
					}

					27.5% {
						/*stroke-dashoffset: 22;*/
						opacity: 100%;
					}

					100% {
						/*stroke-dashoffset: 22;*/
						opacity: 100%;
					}
				}

				#line4 {
					/*stroke-dashoffset: 467;
					stroke-dasharray: 821;*/

					animation: line4 5s ease 1s infinite forwards normal;
					/**/
				}

				@keyframes line4 {
					0% {
						opacity: 100%;
					}
					2.5% {
						/*stroke-dashoffset: 821;*/
						opacity: 0%;
					}

					27.5% {
						/*stroke-dashoffset: 821;*/
						opacity: 0%;
					}

					35% {
						/*stroke-dashoffset: 467;*/
						opacity: 100%;
					}

					100% {
						/*stroke-dashoffset: 467;*/
						opacity: 100%;
					}
				}

				#line5 {
					/*stroke-dashoffset: 388;
					stroke-dasharray: 821;*/

					animation: line5 5s ease 1s infinite forwards normal;
					/**/
				}

				@keyframes line5 {
					0% {
						opacity: 100%;
					}
					2.5% {
						/*stroke-dashoffset: 821;*/
						opacity: 0%;
					}

					35% {
						/*stroke-dashoffset: 821;*/
						opacity: 0%;
					}

					42.5% {
						/*stroke-dashoffset: 388;*/
						opacity: 100%;
					}

					100% {
						/*stroke-dashoffset: 388;*/
						opacity: 100%;
					}
				}

				#line6 {
					/*stroke-dashoffset: 348;
					stroke-dasharray: 821;*/

					animation: line6 5s ease 1s infinite forwards normal;
					/**/
				}

				@keyframes line6 {
					0% {
						opacity: 100%;
					}
					2.5% {
						/*stroke-dashoffset: 821;*/
						opacity: 0%;
					}

					42.5% {
						/*stroke-dashoffset: 821;*/
						opacity: 0%;
					}

					50% {
						/*stroke-dashoffset: 348;*/
						opacity: 100%;
					}

					100% {
						/*stroke-dashoffset: 348;*/
						opacity: 100%;
					}
				}

				#line7 {
					/*stroke-dashoffset: 242;
					stroke-dasharray: 821;*/

					animation: line7 5s ease 1s infinite forwards normal;
					/**/
				}

				@keyframes line7 {
					0% {
						opacity: 100%;
					}
					2.5% {
						/*stroke-dashoffset: 821;*/
						opacity: 0%;
					}

					50% {
						/*stroke-dashoffset: 821;*/
						opacity: 0%;
					}

					57.5% {
						/*stroke-dashoffset: 242;*/
						opacity: 100%;
					}

					100% {
						/*stroke-dashoffset: 242;*/
						opacity: 100%;
					}
				}

				#line8 {
					/*stroke-dashoffset: 188;
					stroke-dasharray: 821;*/

					animation: line8 5s ease 1s infinite forwards normal;
					/**/
				}

				@keyframes line8 {
					0% {
						opacity: 100%;
					}
					2.5% {
						/*stroke-dashoffset: 821;*/
						opacity: 0%;
					}

					57.5% {
						/*stroke-dashoffset: 821;*/
						opacity: 0%;
					}

					65% {
						/*stroke-dashoffset: 188;*/
						opacity: 100%;
					}

					100% {
						/*stroke-dashoffset: 188;*/
						opacity: 100%;
					}
				}

				#line9 {
					/*stroke-dashoffset: 107;
					stroke-dasharray: 821;*/

					animation: line9 5s ease 1s infinite forwards normal;
					/**/
				}

				@keyframes line9 {
					0% {
						opacity: 100%;
					}
					2.5% {
						/*stroke-dashoffset: 821;*/
						opacity: 0%;
					}

					65% {
						/*stroke-dashoffset: 821;*/
						opacity: 0%;
					}

					72.5% {
						/*stroke-dashoffset: 107;*/
						opacity: 100%;
					}

					100% {
						/*stroke-dashoffset: 107;*/
						opacity: 100%;
					}
				}

				#line10 {
					/*stroke-dashoffset: 93;
					stroke-dasharray: 821;*/

					animation: line10 5s ease 1s infinite forwards normal;
					/**/
				}

				@keyframes line10 {
					0% {
						opacity: 100%;
					}
					2.5% {
						/*stroke-dashoffset: 821;*/
						opacity: 0%;
					}

					72.5% {
						/*stroke-dashoffset: 821;*/
						opacity: 0%;
					}

					80% {
						/*stroke-dashoffset: 93;*/
						opacity: 100%;
					}

					100% {
						/*stroke-dashoffset: 93;*/
						opacity: 100%;
					}
				}
			</style>



			<text x="4" y="190">&nbsp;&nbsp;op 1:</text>
			<text class="nums" x="76" y="190">0<tspan class="_1">1</tspan>0<tspan class="_1">1</tspan>0<tspan class="_1">1</tspan>0<tspan class="_1">1</tspan>0<tspan class="_1">1</tspan>0<tspan class="_1">1</tspan>0<tspan class="_1">1</tspan>0<tspan class="_1">1</tspan>0<tspan class="_1">1</tspan>0<tspan class="_1">1</tspan>0<tspan class="_1">1</tspan>0<tspan class="_1">1</tspan>0<tspan class="_1">1</tspan>0<tspan class="_1">1</tspan>0<tspan class="_1">1</tspan>0<tspan class="_1">1</tspan>0<tspan class="_1">1</tspan>0<tspan class="_1">1</tspan>0<tspan class="_1">1</tspan>0<tspan class="_1">1</tspan>0<tspan class="_1">1</tspan>0<tspan class="_1">1</tspan>0<tspan class="_1">1</tspan>0<tspan class="_1">1</tspan>0<tspan class="_1">1</tspan>0<tspan class="_1">1</tspan>0<tspan class="_1">1</tspan>0<tspan class="_1">1</tspan>0<tspan class="_1">1</tspan>0<tspan class="_1">1</tspan>0<tspan class="_1">1</tspan>0<tspan class="_1">1</tspan></text>

		</svg>


		<p>Here is the code in <a target="_blank" rel="noopener noreferrer"style="text-decoration: none;" href="https://ziglang.org/">Zig</a>. Note that after <a target="_blank" rel="noopener noreferrer"style="text-decoration: none; font-weight: 500;" href="https://github.com/ziglang/zig/issues/14995">#14995</a> is resolved there will be built-in support for this operation.</p>



<pre>
<code><span class="code-keyword">fn</span> <span class="code-fn">pdep</span>(src: <span class="code-type">u64</span>, mask: <span class="code-type">u64</span>) <span class="code-type">u64</span> {
    <span class="code-keyword">return</span> asm (<span class="code-str">"pdep %[mask], %[src], %[ret]"</span>
        : [ret] <span class="code-str">"=r"</span> (-> <span class="code-type">u64</span>),
        : [src] <span class="code-str">"r"</span> (src),
          [mask] <span class="code-str">"r"</span> (mask),
    );
}

<span class="code-keyword">fn</span> <span class="code-fn">maskOddSetBits</span>(bitstring: <span class="code-type">u64</span>) <span class="code-type">u64</span> {
    <span class="code-keyword">return</span> pdep(<span class="code-num">0x5555555555555555</span>, bitstring);
}

<span class="code-keyword">fn</span> <span class="code-fn">maskEvenSetBits</span>(bitstring: <span class="code-type">u64</span>) <span class="code-type">u64</span> {
    <span class="code-keyword">return</span> pdep(<span class="code-num">0xaaaaaaaaaaaaaaaa</span>, bitstring);
}</code>
</pre>


<p>The <code>pdep</code> instruction is very efficient on recent x86-64 hardware. It has a latency of 3
	cycles and you can start a new one each cycle even if there are others in-flight. Unfortunately, it's <a target="_blank" rel="noopener noreferrer" href="https://uops.info/table.html?search=pdep&cb_lat=on&cb_tp=on&cb_uops=on&cb_ports=on&cb_ZEN2=on&cb_ZEN3=on&cb_ZEN4=on&cb_measurements=on&cb_doc=on&cb_bmi=on">quite inefficient on AMD architectures earlier than Zen 3</a>, and won't work on non-x86-64 architectures (although this instruction might be added to RISC-V one day). Luckily, there is another way:</p>

<a href="#prefix-xor" class="glyphicon"><h3 id="prefix-xor">Method 2: prefix-xor</h3></a>

<p>The prefix-xor operation takes a bitstring and sets each bit to the XOR of all the bits to its right (and itself).</p>

<svg id="xor-monstronsity" version="1.1" width="100%" viewBox="235 0 478 792" xmlns="http://www.w3.org/2000/svg">
			<!-- <rect x="1" y="1" width="980" height="790"
				stroke="black" fill="transparent"
				stroke-width="2" /> -->

			<text class="xor" x="236" y="11">⨁</text><text class="num2" x="250" y="13">00<tspan class="_1">1</tspan>0<tspan class="_1">1</tspan>000000<tspan class="_1">1</tspan>0000<tspan class="_1">1</tspan>00000000<tspan class="_1">1</tspan>000<tspan class="_1">1</tspan>000000<tspan class="_1">1</tspan>000000<tspan class="_1">1</tspan>000000<tspan class="_1">1</tspan>000000<tspan class="_1">1</tspan>000000</text>
			<text class="xor" x="236" y="23">⨁</text><text class="num2" x="250" y="25">0<tspan class="_1">1</tspan>0<tspan class="_1">1</tspan>000000<tspan class="_1">1</tspan>0000<tspan class="_1">1</tspan>00000000<tspan class="_1">1</tspan>000<tspan class="_1">1</tspan>000000<tspan class="_1">1</tspan>000000<tspan class="_1">1</tspan>000000<tspan class="_1">1</tspan>000000<tspan class="_1">1</tspan>000000&lt;</text>
			<text class="xor" x="236" y="35">⨁</text><text class="num2" x="250" y="37"><tspan class="_1">1</tspan>0<tspan class="_1">1</tspan>000000<tspan class="_1">1</tspan>0000<tspan class="_1">1</tspan>00000000<tspan class="_1">1</tspan>000<tspan class="_1">1</tspan>000000<tspan class="_1">1</tspan>000000<tspan class="_1">1</tspan>000000<tspan class="_1">1</tspan>000000<tspan class="_1">1</tspan>000000&lt;&lt;</text>
			<text class="xor" x="236" y="47">⨁</text><text class="num2" x="250" y="49">0<tspan class="_1">1</tspan>000000<tspan class="_1">1</tspan>0000<tspan class="_1">1</tspan>00000000<tspan class="_1">1</tspan>000<tspan class="_1">1</tspan>000000<tspan class="_1">1</tspan>000000<tspan class="_1">1</tspan>000000<tspan class="_1">1</tspan>000000<tspan class="_1">1</tspan>000000&lt;&lt;&lt;</text>
			<text class="xor" x="236" y="59">⨁</text><text class="num2" x="250" y="61"><tspan class="_1">1</tspan>000000<tspan class="_1">1</tspan>0000<tspan class="_1">1</tspan>00000000<tspan class="_1">1</tspan>000<tspan class="_1">1</tspan>000000<tspan class="_1">1</tspan>000000<tspan class="_1">1</tspan>000000<tspan class="_1">1</tspan>000000<tspan class="_1">1</tspan>000000&lt;&lt;&lt;&lt;</text>
			<text class="xor" x="236" y="71">⨁</text><text class="num2" x="250" y="73">000000<tspan class="_1">1</tspan>0000<tspan class="_1">1</tspan>00000000<tspan class="_1">1</tspan>000<tspan class="_1">1</tspan>000000<tspan class="_1">1</tspan>000000<tspan class="_1">1</tspan>000000<tspan class="_1">1</tspan>000000<tspan class="_1">1</tspan>000000&lt;&lt;&lt;&lt;&lt;</text>
			<text class="xor" x="236" y="83">⨁</text><text class="num2" x="250" y="85">00000<tspan class="_1">1</tspan>0000<tspan class="_1">1</tspan>00000000<tspan class="_1">1</tspan>000<tspan class="_1">1</tspan>000000<tspan class="_1">1</tspan>000000<tspan class="_1">1</tspan>000000<tspan class="_1">1</tspan>000000<tspan class="_1">1</tspan>000000&lt;&lt;&lt;&lt;&lt;&lt;</text>
			<text class="xor" x="236" y="95">⨁</text><text class="num2" x="250" y="97">0000<tspan class="_1">1</tspan>0000<tspan class="_1">1</tspan>00000000<tspan class="_1">1</tspan>000<tspan class="_1">1</tspan>000000<tspan class="_1">1</tspan>000000<tspan class="_1">1</tspan>000000<tspan class="_1">1</tspan>000000<tspan class="_1">1</tspan>000000&lt;&lt;&lt;&lt;&lt;&lt;&lt;</text>
			<text class="xor" x="236" y="107">⨁</text><text class="num2" x="250" y="109">000<tspan class="_1">1</tspan>0000<tspan class="_1">1</tspan>00000000<tspan class="_1">1</tspan>000<tspan class="_1">1</tspan>000000<tspan class="_1">1</tspan>000000<tspan class="_1">1</tspan>000000<tspan class="_1">1</tspan>000000<tspan class="_1">1</tspan>000000&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;</text>
			<text class="xor" x="236" y="119">⨁</text><text class="num2" x="250" y="121">00<tspan class="_1">1</tspan>0000<tspan class="_1">1</tspan>00000000<tspan class="_1">1</tspan>000<tspan class="_1">1</tspan>000000<tspan class="_1">1</tspan>000000<tspan class="_1">1</tspan>000000<tspan class="_1">1</tspan>000000<tspan class="_1">1</tspan>000000&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;</text>
			<text class="xor" x="236" y="131">⨁</text><text class="num2" x="250" y="133">0<tspan class="_1">1</tspan>0000<tspan class="_1">1</tspan>00000000<tspan class="_1">1</tspan>000<tspan class="_1">1</tspan>000000<tspan class="_1">1</tspan>000000<tspan class="_1">1</tspan>000000<tspan class="_1">1</tspan>000000<tspan class="_1">1</tspan>000000&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;</text>
			<text class="xor" x="236" y="143">⨁</text><text class="num2" x="250" y="145"><tspan class="_1">1</tspan>0000<tspan class="_1">1</tspan>00000000<tspan class="_1">1</tspan>000<tspan class="_1">1</tspan>000000<tspan class="_1">1</tspan>000000<tspan class="_1">1</tspan>000000<tspan class="_1">1</tspan>000000<tspan class="_1">1</tspan>000000&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;</text>
			<text class="xor" x="236" y="155">⨁</text><text class="num2" x="250" y="157">0000<tspan class="_1">1</tspan>00000000<tspan class="_1">1</tspan>000<tspan class="_1">1</tspan>000000<tspan class="_1">1</tspan>000000<tspan class="_1">1</tspan>000000<tspan class="_1">1</tspan>000000<tspan class="_1">1</tspan>000000&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;</text>
			<text class="xor" x="236" y="167">⨁</text><text class="num2" x="250" y="169">000<tspan class="_1">1</tspan>00000000<tspan class="_1">1</tspan>000<tspan class="_1">1</tspan>000000<tspan class="_1">1</tspan>000000<tspan class="_1">1</tspan>000000<tspan class="_1">1</tspan>000000<tspan class="_1">1</tspan>000000&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;</text>
			<text class="xor" x="236" y="179">⨁</text><text class="num2" x="250" y="181">00<tspan class="_1">1</tspan>00000000<tspan class="_1">1</tspan>000<tspan class="_1">1</tspan>000000<tspan class="_1">1</tspan>000000<tspan class="_1">1</tspan>000000<tspan class="_1">1</tspan>000000<tspan class="_1">1</tspan>000000&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;</text>
			<text class="xor" x="236" y="191">⨁</text><text class="num2" x="250" y="193">0<tspan class="_1">1</tspan>00000000<tspan class="_1">1</tspan>000<tspan class="_1">1</tspan>000000<tspan class="_1">1</tspan>000000<tspan class="_1">1</tspan>000000<tspan class="_1">1</tspan>000000<tspan class="_1">1</tspan>000000&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;</text>
			<text class="xor" x="236" y="203">⨁</text><text class="num2" x="250" y="205"><tspan class="_1">1</tspan>00000000<tspan class="_1">1</tspan>000<tspan class="_1">1</tspan>000000<tspan class="_1">1</tspan>000000<tspan class="_1">1</tspan>000000<tspan class="_1">1</tspan>000000<tspan class="_1">1</tspan>000000&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;</text>
			<text class="xor" x="236" y="215">⨁</text><text class="num2" x="250" y="217">00000000<tspan class="_1">1</tspan>000<tspan class="_1">1</tspan>000000<tspan class="_1">1</tspan>000000<tspan class="_1">1</tspan>000000<tspan class="_1">1</tspan>000000<tspan class="_1">1</tspan>000000&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;</text>
			<text class="xor" x="236" y="227">⨁</text><text class="num2" x="250" y="229">0000000<tspan class="_1">1</tspan>000<tspan class="_1">1</tspan>000000<tspan class="_1">1</tspan>000000<tspan class="_1">1</tspan>000000<tspan class="_1">1</tspan>000000<tspan class="_1">1</tspan>000000&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;</text>
			<text class="xor" x="236" y="239">⨁</text><text class="num2" x="250" y="241">000000<tspan class="_1">1</tspan>000<tspan class="_1">1</tspan>000000<tspan class="_1">1</tspan>000000<tspan class="_1">1</tspan>000000<tspan class="_1">1</tspan>000000<tspan class="_1">1</tspan>000000&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;</text>
			<text class="xor" x="236" y="251">⨁</text><text class="num2" x="250" y="253">00000<tspan class="_1">1</tspan>000<tspan class="_1">1</tspan>000000<tspan class="_1">1</tspan>000000<tspan class="_1">1</tspan>000000<tspan class="_1">1</tspan>000000<tspan class="_1">1</tspan>000000&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;</text>
			<text class="xor" x="236" y="263">⨁</text><text class="num2" x="250" y="265">0000<tspan class="_1">1</tspan>000<tspan class="_1">1</tspan>000000<tspan class="_1">1</tspan>000000<tspan class="_1">1</tspan>000000<tspan class="_1">1</tspan>000000<tspan class="_1">1</tspan>000000&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;</text>
			<text class="xor" x="236" y="275">⨁</text><text class="num2" x="250" y="277">000<tspan class="_1">1</tspan>000<tspan class="_1">1</tspan>000000<tspan class="_1">1</tspan>000000<tspan class="_1">1</tspan>000000<tspan class="_1">1</tspan>000000<tspan class="_1">1</tspan>000000&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;</text>
			<text class="xor" x="236" y="287">⨁</text><text class="num2" x="250" y="289">00<tspan class="_1">1</tspan>000<tspan class="_1">1</tspan>000000<tspan class="_1">1</tspan>000000<tspan class="_1">1</tspan>000000<tspan class="_1">1</tspan>000000<tspan class="_1">1</tspan>000000&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;</text>
			<text class="xor" x="236" y="299">⨁</text><text class="num2" x="250" y="301">0<tspan class="_1">1</tspan>000<tspan class="_1">1</tspan>000000<tspan class="_1">1</tspan>000000<tspan class="_1">1</tspan>000000<tspan class="_1">1</tspan>000000<tspan class="_1">1</tspan>000000&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;</text>
			<text class="xor" x="236" y="311">⨁</text><text class="num2" x="250" y="313"><tspan class="_1">1</tspan>000<tspan class="_1">1</tspan>000000<tspan class="_1">1</tspan>000000<tspan class="_1">1</tspan>000000<tspan class="_1">1</tspan>000000<tspan class="_1">1</tspan>000000&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;</text>
			<text class="xor" x="236" y="323">⨁</text><text class="num2" x="250" y="325">000<tspan class="_1">1</tspan>000000<tspan class="_1">1</tspan>000000<tspan class="_1">1</tspan>000000<tspan class="_1">1</tspan>000000<tspan class="_1">1</tspan>000000&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;</text>
			<text class="xor" x="236" y="335">⨁</text><text class="num2" x="250" y="337">00<tspan class="_1">1</tspan>000000<tspan class="_1">1</tspan>000000<tspan class="_1">1</tspan>000000<tspan class="_1">1</tspan>000000<tspan class="_1">1</tspan>000000&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;</text>
			<text class="xor" x="236" y="347">⨁</text><text class="num2" x="250" y="349">0<tspan class="_1">1</tspan>000000<tspan class="_1">1</tspan>000000<tspan class="_1">1</tspan>000000<tspan class="_1">1</tspan>000000<tspan class="_1">1</tspan>000000&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;</text>
			<text class="xor" x="236" y="359">⨁</text><text class="num2" x="250" y="361"><tspan class="_1">1</tspan>000000<tspan class="_1">1</tspan>000000<tspan class="_1">1</tspan>000000<tspan class="_1">1</tspan>000000<tspan class="_1">1</tspan>000000&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;</text>
			<text class="xor" x="236" y="371">⨁</text><text class="num2" x="250" y="373">000000<tspan class="_1">1</tspan>000000<tspan class="_1">1</tspan>000000<tspan class="_1">1</tspan>000000<tspan class="_1">1</tspan>000000&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;</text>
			<text class="xor" x="236" y="383">⨁</text><text class="num2" x="250" y="385">00000<tspan class="_1">1</tspan>000000<tspan class="_1">1</tspan>000000<tspan class="_1">1</tspan>000000<tspan class="_1">1</tspan>000000&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;</text>
			<text class="xor" x="236" y="395">⨁</text><text class="num2" x="250" y="397">0000<tspan class="_1">1</tspan>000000<tspan class="_1">1</tspan>000000<tspan class="_1">1</tspan>000000<tspan class="_1">1</tspan>000000&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;</text>
			<text class="xor" x="236" y="407">⨁</text><text class="num2" x="250" y="409">000<tspan class="_1">1</tspan>000000<tspan class="_1">1</tspan>000000<tspan class="_1">1</tspan>000000<tspan class="_1">1</tspan>000000&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;</text>
			<text class="xor" x="236" y="419">⨁</text><text class="num2" x="250" y="421">00<tspan class="_1">1</tspan>000000<tspan class="_1">1</tspan>000000<tspan class="_1">1</tspan>000000<tspan class="_1">1</tspan>000000&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;</text>
			<text class="xor" x="236" y="431">⨁</text><text class="num2" x="250" y="433">0<tspan class="_1">1</tspan>000000<tspan class="_1">1</tspan>000000<tspan class="_1">1</tspan>000000<tspan class="_1">1</tspan>000000&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;</text>
			<text class="xor" x="236" y="443">⨁</text><text class="num2" x="250" y="445"><tspan class="_1">1</tspan>000000<tspan class="_1">1</tspan>000000<tspan class="_1">1</tspan>000000<tspan class="_1">1</tspan>000000&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;</text>
			<text class="xor" x="236" y="455">⨁</text><text class="num2" x="250" y="457">000000<tspan class="_1">1</tspan>000000<tspan class="_1">1</tspan>000000<tspan class="_1">1</tspan>000000&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;</text>
			<text class="xor" x="236" y="467">⨁</text><text class="num2" x="250" y="469">00000<tspan class="_1">1</tspan>000000<tspan class="_1">1</tspan>000000<tspan class="_1">1</tspan>000000&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;</text>
			<text class="xor" x="236" y="479">⨁</text><text class="num2" x="250" y="481">0000<tspan class="_1">1</tspan>000000<tspan class="_1">1</tspan>000000<tspan class="_1">1</tspan>000000&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;</text>
			<text class="xor" x="236" y="491">⨁</text><text class="num2" x="250" y="493">000<tspan class="_1">1</tspan>000000<tspan class="_1">1</tspan>000000<tspan class="_1">1</tspan>000000&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;</text>
			<text class="xor" x="236" y="503">⨁</text><text class="num2" x="250" y="505">00<tspan class="_1">1</tspan>000000<tspan class="_1">1</tspan>000000<tspan class="_1">1</tspan>000000&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;</text>
			<text class="xor" x="236" y="515">⨁</text><text class="num2" x="250" y="517">0<tspan class="_1">1</tspan>000000<tspan class="_1">1</tspan>000000<tspan class="_1">1</tspan>000000&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;</text>
			<text class="xor" x="236" y="527">⨁</text><text class="num2" x="250" y="529"><tspan class="_1">1</tspan>000000<tspan class="_1">1</tspan>000000<tspan class="_1">1</tspan>000000&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;</text>
			<text class="xor" x="236" y="539">⨁</text><text class="num2" x="250" y="541">000000<tspan class="_1">1</tspan>000000<tspan class="_1">1</tspan>000000&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;</text>
			<text class="xor" x="236" y="551">⨁</text><text class="num2" x="250" y="553">00000<tspan class="_1">1</tspan>000000<tspan class="_1">1</tspan>000000&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;</text>
			<text class="xor" x="236" y="563">⨁</text><text class="num2" x="250" y="565">0000<tspan class="_1">1</tspan>000000<tspan class="_1">1</tspan>000000&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;</text>
			<text class="xor" x="236" y="575">⨁</text><text class="num2" x="250" y="577">000<tspan class="_1">1</tspan>000000<tspan class="_1">1</tspan>000000&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;</text>
			<text class="xor" x="236" y="587">⨁</text><text class="num2" x="250" y="589">00<tspan class="_1">1</tspan>000000<tspan class="_1">1</tspan>000000&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;</text>
			<text class="xor" x="236" y="599">⨁</text><text class="num2" x="250" y="601">0<tspan class="_1">1</tspan>000000<tspan class="_1">1</tspan>000000&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;</text>
			<text class="xor" x="236" y="611">⨁</text><text class="num2" x="250" y="613"><tspan class="_1">1</tspan>000000<tspan class="_1">1</tspan>000000&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;</text>
			<text class="xor" x="236" y="623">⨁</text><text class="num2" x="250" y="625">000000<tspan class="_1">1</tspan>000000&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;</text>
			<text class="xor" x="236" y="635">⨁</text><text class="num2" x="250" y="637">00000<tspan class="_1">1</tspan>000000&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;</text>
			<text class="xor" x="236" y="647">⨁</text><text class="num2" x="250" y="649">0000<tspan class="_1">1</tspan>000000&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;</text>
			<text class="xor" x="236" y="659">⨁</text><text class="num2" x="250" y="661">000<tspan class="_1">1</tspan>000000&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;</text>
			<text class="xor" x="236" y="671">⨁</text><text class="num2" x="250" y="673">00<tspan class="_1">1</tspan>000000&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;</text>
			<text class="xor" x="236" y="683">⨁</text><text class="num2" x="250" y="685">0<tspan class="_1">1</tspan>000000&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;</text>
			<text class="xor" x="236" y="695">⨁</text><text class="num2" x="250" y="697"><tspan class="_1">1</tspan>000000&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;</text>
			<text class="xor" x="236" y="707">⨁</text><text class="num2" x="250" y="709">000000&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;</text>
			<text class="xor" x="236" y="719">⨁</text><text class="num2" x="250" y="721">00000&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;</text>
			<text class="xor" x="236" y="731">⨁</text><text class="num2" x="250" y="733">0000&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;</text>
			<text class="xor" x="236" y="743">⨁</text><text class="num2" x="250" y="745">000&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;</text>
			<text class="xor" x="236" y="755">⨁</text><text class="num2" x="250" y="757">00&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;</text>
			<text class="xor" x="236" y="767">⨁</text><text class="num2" x="250" y="769">0&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;</text>

			<line x1="236" x2="710" y1="772" y2="772" stroke="black" stroke-width="2" />
			<text class="num2" x="250" y="784">000<tspan class="_1">1</tspan><tspan class="_1">1</tspan>0000000<tspan class="_1">1</tspan><tspan class="_1">1</tspan><tspan class="_1">1</tspan><tspan class="_1">1</tspan><tspan class="_1">1</tspan>000000000<tspan class="_1">1</tspan><tspan class="_1">1</tspan><tspan class="_1">1</tspan><tspan class="_1">1</tspan>0000000<tspan class="_1">1</tspan><tspan class="_1">1</tspan><tspan class="_1">1</tspan><tspan class="_1">1</tspan><tspan class="_1">1</tspan><tspan class="_1">1</tspan><tspan class="_1">1</tspan>0000000<tspan class="_1">1</tspan><tspan class="_1">1</tspan><tspan class="_1">1</tspan><tspan class="_1">1</tspan><tspan class="_1">1</tspan><tspan class="_1">1</tspan><tspan class="_1">1</tspan>000000</text>
</svg>

<p>This has the net effect of setting each bit to a 1 if there were an odd number of bits to the right (including itself), and a 0 if there were an even number of bits to the right (including itself).</p>

<svg id="prefix-xor-svg" version="1.1" viewBox="0 0 972 46" width="100%"
xmlns="http://www.w3.org/2000/svg">
<!-- <rect x="1" y="1" width="980" height="48"
	stroke="black" fill="transparent"
	stroke-width="2" /> -->
<text x="4" y="20">&nbsp;bitstring:</text>
<text x="150" y="20">00<tspan class="_1">1</tspan>0<tspan class="_1">1</tspan>000000<tspan class="_1">1</tspan>0000<tspan class="_1">1</tspan>00000000<tspan class="_1">1</tspan>000<tspan class="_1">1</tspan>000000<tspan class="_1">1</tspan>000000<tspan class="_1">1</tspan>000000<tspan class="_1">1</tspan>000000<tspan class="_1">1</tspan>000000</text>

<text x="4" y="40">prefix-xor:</text>
<text x="150" y="40">000<tspan class="_1">1</tspan><tspan class="_1">1</tspan>0000000<tspan class="_1">1</tspan><tspan class="_1">1</tspan><tspan class="_1">1</tspan><tspan class="_1">1</tspan><tspan class="_1">1</tspan>000000000<tspan class="_1">1</tspan><tspan class="_1">1</tspan><tspan class="_1">1</tspan><tspan class="_1">1</tspan>0000000<tspan class="_1">1</tspan><tspan class="_1">1</tspan><tspan class="_1">1</tspan><tspan class="_1">1</tspan><tspan class="_1">1</tspan><tspan class="_1">1</tspan><tspan class="_1">1</tspan>0000000<tspan class="_1">1</tspan><tspan class="_1">1</tspan><tspan class="_1">1</tspan><tspan class="_1">1</tspan><tspan class="_1">1</tspan><tspan class="_1">1</tspan><tspan class="_1">1</tspan>000000</text>
</svg>

<p>Armed with this operation, we simply do a bitwise AND of the bitstring together with its prefix-xor to get a mask of every other set bit.</p>

<pre>
<code><span class="code-keyword">fn</span> <span class="code-fn">maskOddSetBits</span>(bitstring: <span class="code-type">u64</span>) <span class="code-type">u64</span> {
    <span class="code-keyword">return</span> bitstring & prefixXOR(bitstring);
}

<span class="code-keyword">fn</span> <span class="code-fn">maskEvenSetBits</span>(bitstring: <span class="code-type">u64</span>) <span class="code-type">u64</span> {
    <span class="code-keyword">return</span> bitstring & ~prefixXOR(bitstring);
}</code>
</pre>

<p>The <code>prefixXOR</code> function is naïvely implemented as follows:</p>

<pre>
<code><span class="code-keyword">fn</span> <span class="code-fn">prefixXOR</span>(bitstring: <span class="code-type">u64</span>) <span class="code-type">u64</span> {
    <span class="code-keyword">var</span> x = bitstring;
    <span class="code-keyword">inline</span> <span class="code-keyword">for</span> (<span class="code-num">0</span>..<span class="code-num">64</span>) |i| { <span class="code-comment">// i ∈ [0, 63]</span>
        x ^= bitstring << i;
    }
    <span class="code-keyword">return</span> x;
}</code>
</pre>

<p>However, we can save on operations by taking advantage of how XOR's stack:</p>

<pre>
<code><span class="code-keyword">fn</span> <span class="code-fn">prefixXOR</span>(bitstring: <span class="code-type">u64</span>) <span class="code-type">u64</span> {
    <span class="code-keyword">var</span> x = bitstring;
    x ^= x << <span class="code-num">1</span>;
    x ^= x << <span class="code-num">2</span>;
    x ^= x << <span class="code-num">4</span>;
    x ^= x << <span class="code-num">8</span>;
    x ^= x << <span class="code-num">16</span>;
    x ^= x << <span class="code-num">32</span>;
    <span class="code-keyword">return</span> x;
}</code>
</pre>

<!-- <p style="font-size: smaller !important; margin-top: -1em; margin-bottom: -1em;">(Note we can flip the <code>&lt;&lt;</code> to <code>&gt;&gt;</code> so long as we XOR with <code>bitstring</code> at the end. One optimization we can do for <code>maskEvenSetBits</code> is omit the aforementioned XOR and bitwise AND the final value of <code>x</code> with <code>bitstring</code> to get the evenly set bits with 2 fewer operations.)</p> -->

<p>Geoff Langdale explained an even more efficient way to compute the prefix-xor <a target="_blank" rel="noopener noreferrer" href="https://branchfree.org/2019/03/06/code-fragment-finding-quote-pairs-with-carry-less-multiply-pclmulqdq/">here</a>. The trick is to perform a <a target="_blank" rel="noopener noreferrer" href="https://en.wikipedia.org/wiki/Carry-less_product">carryless multiply</a> by a bitstring of all 1's. If you think about it, this trick results in the <a href="#xor-monstronsity">XOR diagram above</a>. This is a great trick because a lot more CPU's support fast carryless multiplies since it is used in cryptography. x86-64 supports it via <code>clmul</code> instructions, ARM has <code>pmull</code>, and SPARC has <code>xmulx</code>. It's even <a target="_blank" rel="noopener noreferrer" href="https://uops.info/table.html?search=clmul&cb_lat=on&cb_tp=on&cb_uops=on&cb_ports=on&cb_ZENp=on&cb_ZEN2=on&cb_ZEN3=on&cb_measurements=on&cb_doc=on&cb_avx=on&cb_others=on">fast on early Zen architectures</a> (~4 cycle latency)!</p>

<p>Once Zig gets a <code><span class="code-builtin">@mulCarryless</span></code> builtin (<a target="_blank" rel="noopener noreferrer"style="text-decoration: none; font-weight: 500;" href="https://github.com/ziglang/zig/issues/9631">#9631</a>), we can implement this function like so:</p>

<pre>
<code><span class="code-keyword">fn</span> <span class="code-fn">prefixXOR</span>(bitmask: <span class="code-type">u64</span>) <span class="code-type">u64</span> {
    <span class="code-keyword">const</span> ones: <span class="code-type">u64</span> = <span class="code-builtin">@bitCast</span>(<span class="code-builtin">@as</span>(<span class="code-type">i64</span>, <span class="code-num">-1</span>));
    <span class="code-keyword">return</span> <span class="code-builtin">@mulCarryless</span>(bitmask, ones);
}</code>
</pre>

<p>If you would like a temporary Zig implementation that uses inline assembly, I have one <a target="_blank" rel="noopener noreferrer" href="https://github.com/Validark/DynSDT/blob/4d31c8be4f3ef48834394c22695fd1b01a83a53c/zig/src/main.zig#L135-L177">here</a>. (Unfortunately it uses <code>vpclmulqdq</code> rather than <code>pclmulqdq</code> because it is derived from crypto code in the Zig standard library and I currently don't know how to modify inline assembly properly.)</p>


<a href="#suffix-xor" class="glyphicon"><h3 id="suffix-xor">Method 3: suffix-xor</h3></a>

<p>Another potential optimization is eliminating the bitwise negation in <code>maskEvenSetBits</code> by finding the suffix-xor instead.</p>

<pre>
<code><span class="code-keyword">fn</span> <span class="code-fn">suffixXOR</span>(bitstring: <span class="code-type">u64</span>) <span class="code-type">u64</span> {
    <span class="code-keyword">var</span> x = bitstring;
    x ^= x >> <span class="code-num">1</span>;
    x ^= x >> <span class="code-num">2</span>;
    x ^= x >> <span class="code-num">4</span>;
    x ^= x >> <span class="code-num">8</span>;
    x ^= x >> <span class="code-num">16</span>;
    x ^= x >> <span class="code-num">32</span>;
    <span class="code-keyword">return</span> x;
}

<span class="code-keyword">fn</span> <span class="code-fn">maskEvenSetBits</span>(bitstring: <span class="code-type">u64</span>) <span class="code-type">u64</span> {
    <span class="code-keyword">return</span> bitstring & suffixXOR(bitstring);
}</code>
</pre>

<p><code>suffixXOR(bitstring)</code> turns out to be equivalent to <code>bitstring ^ prefixXOR(bitstring)</code>, so we can use the carryless multiply trick again. Because <code>prefixXOR(bitstring)</code> is equal to <code>bitstring ^ (bitstring << <span class="code-num">1</span>) ^ (bitstring << <span class="code-num">2</span>) ^ (bitstring << <span class="code-num">3</span>) ^ etc...</code>, we can find the suffix-xor by simply removing the first XOR. To do this in a carryless multiply by all ones, we simply zero out the lowest bit (<code><span class="code-num">-1</span> ^ <span class="code-num">1</span> => <span class="code-num">-2</span></code>). In the <a href="#xor-monstronsity">above XOR diagram</a>, it effectively removes the top number.</p>

<pre>
<code><span class="code-keyword">fn</span> <span class="code-fn">suffixXOR</span>(bitmask: <span class="code-type">u64</span>) <span class="code-type">u64</span> {
    <span class="code-keyword">const</span> mask: <span class="code-type">u64</span> = <span class="code-builtin">@bitCast</span>(<span class="code-builtin">@as</span>(<span class="code-type">i64</span>, <span class="code-num">-2</span>));
    <span class="code-keyword">return</span> <span class="code-builtin">@mulCarryless</span>(bitmask, mask);
}</code>
</pre>

<p>Computing the suffix-xor via a carryless multiply <a target="_blank" rel="noopener noreferrer" href="https://godbolt.org/#z:OYLghAFBqd5QCxAYwPYBMCmBRdBLAF1QCcAaPECAMzwBtMA7AQwFtMQByARg9KtQYEAysib0QXACx8BBAKoBnTAAUAHpwAMvAFYTStJg1AAvPMFJL6yAngGVG6AMKpaAVxYM9DgDJ4GmADl3ACNMYhAATi5SAAdUBUJbBmc3Dz04hJsBX38gllDwqItMKyyGIQImYgIU909oy0xrJIqqghzAkLDIhsrq2rTeto68gp6ASgtUV2Jkdg40BgUCAGpl9BWAUgBmABEVgAE8FjjqiE2AJgv1y4vxnYAhTY0AQUXlleDXOhsGLb3DsdTgRzlcvj8/Ld7tsnq9ni8qH8YsRMDRVAANADyACUIMFCCwmAoANYgFaGACeBApMUw40OABUaZhMVQ8QSicT6ZsAOywl4rQUrNAnGxsNYEdAAOiwX2AUqJSjO6ylhIICCleAUylQAHcwqyGbrUBADvjhHhjCy2QcmbTWeyCISSeNXdD%2BfChcKBB8EESAPrMGwAN0w/tExGIFPoCgU/pYrloNhitAp/32ZsIQkt1tNdtz5udXO520cO32ADZJOSGBsFLrCMgECs8d8k34pcgYq4FbMENy%2BZ6vUKAPQjlYMhBhTBrBDTWgbUIrBioNauJsrdV%2BYArBvq8krZGoOaxkhrmLA7fk4OqT6uVYr1bIWgJ2hSofDlZS1QADgr/qrdMdmwCVpQZKpgEwAhvz/KUqEwJgCBmTAhCggAJIlWwhBhO27OCEKQlEFFIL8YmfV96UMdAP0/IUVXA4hIOg38K3wxDkNQggMIULD2xwrse3g9iiJIhUbzuUgaK9BUqibQDy2A0CpQYpiZL7Ks2MIlD0Mw8E%2BNwwSCOQ4ivyYTAFEmKShRKJQgO2ECqDEJRJNeL1eV2R54RovAqBbI5klQUVjkwCB6TPMAwD9OMgzwUNwyqKMYzjV9k1TAd%2BVolZgyqFZb3LT4ORJTzXNovxaD8Gd%2BGIFsNClKVTXNbMrQdFU1Q1bxUGAC4AElBDzZkHULTk3VdLYeUcPBeTLErMsFPKAFZsHyvLSx2RxvSC8UIC4f4y1LFY8HdKzBRRQi/lUYqBSFdyvJmlYxxWdBVyYYUEujcyFBWFK8BTNNgjTMRaBWLgwA4YiaIeph0CYGICEwDYqGIQKVlMYAR3K4IR3WEdkCjWHUBHYAooQf04lTbK31Rmj3lWFaM0w1wuAuH8SMzGoiRBTZ5oeC4ud2Vwq15B5DgZqsSKGl0SI0MbdldS6vRplY03yg4GaZlnDnNRwOdNBQU0Q7aK1ZhmNY0VQqCoEbLpo06Zj%2BVWeNtAa2QlrlWYIYhXAYUQ4YgetG2bXjfgM3sm3S46vxYgDqwU%2BzyQUFgWwjtz5rLVOsrIl9EwAR3QbOVgAEjNjQNBIy55q5h4Lvm3Yy4uCvuYpPm64bh5pgIPnk6FMlK/bvmtiucsLquFsAFpFIOAA1JoiGICALhIgXJFdFyrtmlYe%2B56v9luYeLj8zCp5nkh58XqtJk1whteWCBVDdVf15Th4m5rgeLj3g/Hen6wT4XlYl4vmza%2BIIKT3wjpZOEd1pJMFkggeSexFJEkTucKBtEuZp3WjEV8QNy693vHzKUXBs4t0rtvQh6ASGNwIVwaiqDPybzbvg1%2Btxyy6luGPCe39Z6n3/ufCBa9ZoMO3m/NhI9TSHy4b/M%2By9WZax1nfFeXcn4vx3lcUR%2B9xFf2PnPP%2BADZFXx1qAxRdCVj8IjjZGcscQJexREwJsTBgj0AftdHkHluYaD5nLGEXlXG3QRH8BQrgLZ4AxDiR0RYySUmpLSekTt7Qu0KlyMaGUhQilhsFJSspXDykVGEEErVEIai1DqfUxBDTGgalmHMDo4kFkSVbbxkCBGKyioGRCsUwwRkSh9eMiZUrKwBGzJquZamDXqSWPalZqxUTWHuDcQcOwCVDv2ZJEcHqTmnLOeci4ZwrjXBuLcRhdyEGbC9I8J4FBnkCReEgvwdxMBvHeB8qAnxZzfBHGC/54EeTjvRCCUFPmaQ4jpHielg5LKElpEyUpM4URrLQgRmU/mMQBSxIFKJOLcQWfxPCkLjKiQeaoCSHyYHqRjgg35kplL/OgqSuSkh0XaS4rpNs4LcVGREqZcy/DMoWLsg5JymBnGChuo0l43lfKmj8M4TaIUwrVQiq0mKcUunvVjL09sv1w4mOytVOmBUnScnlqVBg5V/ArCqjVOqlSLTNTZAU9UUoOpdV6iCUZCTDUuhGmNCaU0lG5S2ItZau01obXSVtHaa1Q2HWNZ%2BW2xBzqBpAq7WNMs/Fegek9A8qqkpfT6T9VMnwAa0CBiDMGwr7rjihjDOGCMkaJ1RujPAmNsa4xpEQQmxNSYuApBTKUVM7qK31Q7CAjNmb6PZjfSuvMa5LyFiLHiS9xb1KljLLxKTBSKwGfTRd6sJ3AN1vrEEXAjYLtHabc2ls3RJuBtbO68b7aH3zGMz1btDgey9j7EK/sCDzLBYsvCsDtWIqFJ86O/L47IP9eg9BGdyI5zzoXYupcB6t23pQ5%2BzdUN4I7jXf1DC%2B7MMHnsD%2BEBx5xyPj/HR0jjEgfoYGqu/dd7sM0aaSR1HeEyMvpOkECieWPxFVQoj78WMjso9w3R5992GLASYsxJi1L0og0gpOJiU4YMPNg7D3NCO7EIcQ7TjGa7kIwyo8h%2BGGO6bfqwlj5GQLiakZx2jAmhFMbUaJiR2ieF6O4wevjFb16VxUSIjzWiqPeak75mTznaLyboysPlVj/4MFsfYxxQqaI3XcZ4o6cJfFNMwKoYEFq/hFmwKGcoUEHiEFBTVj224yQAM46s%2B9UE7YGuWMQK8lwKwrAAH7IlRCErEuJzSde3Ll8V%2BXxWvEK8VxEX1OTlcYJxarBAFAXEdONowjXz7NaFjbNrCaOv1aOT1tcwTQmjbq11owk33IcEmLQTg81eCeA4FoUgqBOAAC0zBrGmLMSxFxtg8FIAQTQj3JiknmvNKUkg/yI40FwHkGg/wVgiPoTgkg3uQ6%2B5wXgCgQClwhx9x7pA4CwBgIgFAgUYh0DCOQSgaSGfhGMB%2BhgxJSBYGDHgOYk88CYF1JiWk72wc0CTGEIneI8f4mYFGTgYO5dVApJiYI2gZ6K94CKNgghMSmopHjrJwBtYlqJ9wXgWBCRGHEGT7neAUTNFDObz7hWmj3nmGDvwcNnt24xsQFXzgsB4/qywLXkwqAGGAAoAXQuReMC1zIQQIgxDsCkEn%2BQSg1B490AvAwO3Ub6GbUTyAkxUDpJ9JwUemIVjYhKAhJQAAxDmvBUChkjHgLAJfQrFFKEkewtYBieAuDyUgPgKqjG6FwbYsR4iJAEEP9Ic%2BygjC6IUXvM8Wh9BqC4OoIAR8b%2BaAIVo1RV/5CnzP5YbRF9DFPxPtfkRJiXJmHMCQT2Xu47t99jgKN/sc%2BJC2LgIQGeJcKDuMLwKTloCvFOFDN0D3qSNsD%2BFKD%2BJIJIFENsPNFwPNBoBED%2BBcNEL7jjqQGHgjoQn%2BFwFwLgTyIgSjhoNsNIO9p9t/oTsTuDpDpMJTjTizvQGQBQBANwd0Ozp7JztzpgLzvzoLsLqLonhLnDMQNLsELLn4CronsrlGGrhrtYInjrowAQPrqmEbpgHKKbrQObmDlboYMALbp9vgI7iGOZHjm7sgB7ont7iUHjv7oHhgPMJ9qHuHnwFHjHpIfHmLrwPwMnqIOIOnuEZnioOoHbroAQZYSAIXhjN3mXhXksFXjXnXvQESJgM3h8KPH0ExOSLAlWKPGaq4LeKPCwAJOWDDCmGGCwGDm3mEF1l3vAE/vXkfp4BAA4IvpINEOPrkA/qDrPpkEkIvqPhkPPgwGfmMCDofmUCfjvqkJ4EMcsVvsMPfufuEOMVfv0LvmkKPoce0LsYsdsE/oDq/lwO/hwK9qQIwa3pwL/juP/oAfgLPAPGARAewZMDAVgOED3oQbwGHpgcgdPj%2BD%2BMjhcBWFwHgREBWEbM8fjhwCwSTv8aQKSKgVKNsNsDyCDhoAjjyDyNgfNJjr7tsJ/kwQTmwWTivL7hcDSS8eifSVAZMO3gkHYJIEAA">is not worthwhile for our purposes on x86-64 and ARM64</a> since it requires loading <code><span class="code-num">-2</span></code> from the binary, thereby increasing the binary size, taking up precious cache space, and even requiring an additional instruction on ARM. Additionally, x86-64 and ARM64 support <code>andn</code> and <code>bic</code> respectively, so our <code>~</code> operation is not actually taking an extra instruction on these platforms anyway.</p>

<p>The implementation using shifts fares no better; on x86-64 <a target="_blank" rel="noopener noreferrer" href="https://godbolt.org/#z:OYLghAFBqd5QCxAYwPYBMCmBRdBLAF1QCcAaPECAMzwBtMA7AQwFtMQByARg9KtQYEAysib0QXACx8BBAKoBnTAAUAHpwAMvAFYTStJg1AAvPMFJL6yAngGVG6AMKpaAVxYM9DgDJ4GmADl3ACNMYhAAJgjSAAdUBUJbBmc3Dz04hJsBX38gllDwqItMKyyGIQImYgIU908uYtKkiqqCHMCQsMjohUrq2rSG3tb2vILugEoLVFdiZHYOKgYAahjiTBpVAA0AeQAlCGDCXuI/UGXXADZJCYvr5YBSAHYAIQeNAEFl7%2BWANyrlqpHgBmAAiyyOBBOZwewLenx%2BgMeAFZsLDwUDYY4scsuLD4V8fpjUeikVicRF8e9Cd9iWiwWTgdimctJFSEUSUfSMSDmY5lgAOdk0skkhmYpk4riXYWIumkiV85bAylw6mI9YEWYrVTC56g6nUpbLBSuKibXYHSHQowgO43e2PV7qn7/YiM8HWginIyyzkPMU82H07C4v20rkKkEh5aqglyyPi6PB1nh0XcxkxoVqjkRgMZiUx6Vp%2BVJ4MplVpzXawF6p4Gz7UzCqOLVZbGlhMBQAa2wv0YQkwBBex0Ox29ZztVwd06d8Z%2B1eIKy9PuAjwil2WAD81hs8Nt9mOoROjBM6w2Pk2WyQCO2Vp2e32B0OR1CIkebedp7dZ89599F2XcdV3XTdTXNfdLQ/E9gDPHNL3rDgploThkV4TwOC0UhUE4AAtMwTRmOZMHXYEeFIAhNCQqZuxAZENH0ThJHQqjsM4XgFBABjKMwpDSDgWAYEQFBUBYGI6DCchKDQMSJPCYwNC4DQGKwX48HmAA1PBMAAdx2GJGE4ciaFoAgwk4w5WKOZhiAATyM3hrKqWydmCbRMGsBzSBkthBB2BhaHs3jSCwYJXGARwxFoTjuF4LBOyMcRgvwdZrDwfsYqw5sPNcMyvL8MyUOC2g8GCYhnOcLBWInFgHKmKgDGABQtN0/TDNimRBBEMR2CkTr5CUNRWN0aIDFtUxzBK4JOMgKZUBiMoYoAWh2ZY9hKTAu0wAAxLsCF4VB%2B2IU4sBmiApksDyynsBgnBcOovFu0ZOnCBoMkSAQBnqWJ4g%2BhhnvyLohg2tKBBafp7sGRoruaPo2j8DpAdeiw4a%2BvRhmqAHxi4C6iPmCRkNQljgpwjhlgm5YNAAOiUqmNGWCBcEIEhSJx3geK0CYpgQTasHCc7SFo%2BjGI4ZjSFq5EBTpyRJGlSQNGBJ4BWRSQAE5SAwrDSY4riKKoqYBOEmTxPoMgKAgY25JABSlJUzA1M07S9IMjDjLoMziAs4IrL8ZyvKcuzXPczyOp8xgCH8wLWNC8LItoaKvPiwxgCSrCUphjLWOy5BcoWciCpKVipvKuzKoWLCarqvhGuap22td3h%2BC60RxD6puBpUdRgt0BoxpMMx9FKs65oWpJltW9b6C23bemWJa%2BmAIdliYKpkAQa4lpKhhXCBJaWGQGJXHRJgYhiegAH0WHIw6whOzBh%2Bh0HPAgBw0YaHwEbGIGfsyJI35/v6WNv6XSfuDGokNvogLKGAoByMMbgNSJAuGsCCbTFmPjHGIs0Ia1YqTcmBFqa03pozfARB3QPAiGRCY7N9bc15l0AWRUxa1VllTVWyJJbAmRKrS4EQpDIgaJrA67ELC6w5tRQWdEGJFWBMTLWIjxFcxFhEORwiOA0N4koo6CQ7CSCAA%3D">it's actually worse</a> because two <code>mov</code> instructions can be eliminated by computing <code>x << <span class="code-num">1</span></code> and <code>x << <span class="code-num">2</span></code> with <code>lea</code> instructions instead.</p>

<p>Incidentally, the suffix-xor algorithm is used to decode <a target="_blank" rel="noopener noreferrer" href="https://en.wikipedia.org/wiki/Gray_code#Converting_to_and_from_Gray_code">Gray codes</a> too. Depending on the machine and use case, <a target="_blank" rel="noopener noreferrer" href="https://godbolt.org/#z:OYLghAFBqd5QCxAYwPYBMCmBRdBLAF1QCcAaPECAMzwBtMA7AQwFtMQByARg9KtQYEAysib0QXACx8BBAKoBnTAAUAHpwAMvAFYTStJg1AAvPMFJL6yAngGVG6AMKpaAVxYMQAJlIOAMngMmABy7gBGmMQgAJzSAA6oCoS2DM5uHt6kCUk2AgFBoSwRUbEWmFa5DEIETMQEae6ePpaY1inVtQT5IeGRMdIKNXUNGc1DXYE9RX2xAJQWqK7EyOwcaAyDANSD6JsApADMACKbAAJ4LAl1EHteXju3XrOHAEJ7GgCC61thrnQ2DH2xzOFyuBBud1%2B/0Cj2eBzen3eHyogLixEwNFUAA0APIAJQgYUILCYCgA1iBNoYAJ4EalxTCzM4AFXpmBxVEJxNJZKZewA7AiPpsRZs0JcbGxtgR0AA6LC/YCy0lKa47WUkggIWV4BTKVAAd0iHOZBtQEFOROEeGM7M5p1ZDI5XIIJPJsw9cKFSNFYoEWwQpIA%2BswbAA3TBB0TEYjU%2BgKBRBliuWg2OK0alAk6WwhCG12i2OgtWt28vkHRyHE4ANkkVIYuwUBsIyAQm0Jf1TgVlyDirmVywQfMFPt9ooA9OPNsyEJFMNsEItaLsIpsGKhtq5W5stYFgJtm1qqZs0agVgmSJu4mC91Sw6pNr8CGvUM/kLRk7RZaOx5tZaoAA5qyDWss0ObBpTlZlamATACH/IDZSoTAmAIJZMCEOCAAlSQ7aEGB7PskJQtD0QUUg/zid9PyZQx0B/X9RXVaDiFg%2BDAOrYjUPQzCCBwhQ8K7Aje37ZDuLIijlXvJ5SAY31lVqVtQKrcDINlFi2IUwday40iMOw3CoSEwjRJI9DyL/JhMAUeY5NFcolDAg4IKoMQlFkz5fQFI5XiRBi8CodtzlSVAJQuTAICZS8wDAQNE1DPAIyjWpY3jRNPzTDNhyFRjNjDWpNgfKtH25clfM8xjAloSZNn4Yh2w0WVZQtK081tZ11U1bU/FQYAvAASUEQs2WdEseU9D19n5Rw8AFSsKtykUioAVmwYqiorQ5HD9MKpQgLggUrCtNjwL07JFdFSMBVRyuFUVvL8hbNknTZ0A3JgxRSuNrIUTYMrwdNMzCTMxFoTYuDADhyIYl6mHQJg4gITBdioYhQs2UxgHHaqwnHHZx2QWNEdQcdgDihAgwSDN8q/TGGO%2BZ8NuzXDXC4LwAIonN6lJcE9mWl4vD5o5XFrAUXjOFnawosb3QojQpqOD1bt9BnNkzYrThZtmObOK1HB5i1cNOAA1VoiGIfbqwo1wAPmM4FHTVDDYEm25dUKgqAms7ESey6lkBTWBIdEbORl3lOYIYhXAYUQkYgJsWzbQSARMgdW2y86/w4kC6xU5yqQUFh20zrzlsrMu8qoj8UwAR3QGvNgAEg0VQNA0CjbmWvmXhu5ajg7rwu/56khYHoeXkWAghZL0VKW7yehf2O4qxuu52wAWlUk2zZICAfE2EXJA9Dy7sWzY5/53uTkeVevCCo3TesXf98Pu2uf1wYIFUT0T7P0uXhHn3JeXhb73yDo/c2e9ra1jfnrA21If6Z1sj7U%2BY4tJKVzscVSpIi43CerlPm5dtpxE/GDTu89XBTz7rKLgNcx7dyvjQ9A9Dh5CyYTPEUF8J6UMXo8KsBpHgby3hA5%2B0Cj7INQblLhV9gECLXs7C0IiLYvxgZzOBn9v7Hw4fdVhQDHhyLvgo7eT9lFiNgYQD%2B4IEFaPwaKCRmcHLzjzhBaO6ImCtiYGEegv97r8h8vzDQQslbwj8n4x6yJAQKFcB7PA2J8QulLJSGkdIGRMmDk6UOpVeRTRyqKcUiNwpqQVK4JUKpIjgk6qhbUup9RGmICaM0LVcz5mdOk4sWSJq3Xpv6Z8cUQyoUSpGaMqUfpJhTJldWwIuZtQLG00aHTyxHRrHWOi2xDzbmTt2ESachw5Mzi9Gcc4FxLhXPOdcm5ty7iMAeQgbYPqnnPAoS8UTrwkABPuJg95HyUJfG%2BauX5M4IWAspLB%2BdmIwTgkC3SPEDICSMinbZYk9IWVlFXGi9Z6K2N/OC1ikKOLQvRLxfimzhJESReZSSnzVAyUBUwRSCAQU%2BTBTKdSEL4J0u0pIAl%2Bk%2BKGU7AislZkJKWWshI3KjinIuTcpgHxIoHohJQb6AKQVAjOF2hFKK9UYp9ISklYZ30ExjK7IDDOWK8oFSZiVV0PJlaVQYNVIItVLwQEas1aZLTOSVK1LKHqfVBrgjmZk617oJpTRmnNbRK01rAg2tGiC%2BTJTzn2odLaJ1vaSNFH7Yg11bVyrCYqicU43rHn1WlP64yAYZkfCDWgYMIZQ1lc9KccMEZIxRmjIumNsZ4FxvjQm9IiCk3JpTFw1Iaayjpk9VWlrA4QFZuzNRFiDbd0Fn3Q%2BYsJYuylla0sdt5beWCbkkUqtJnMxdtrRd3NP6zuMZArgVsD6205g7AwAaWY6xbh7L2%2BxVrgy6b7OC/tN3DQyQk8aEco4x1QhFBOBANnwq2URelpqM0iiBTnSVBdcHaMIYQyu1Fa71ybi3NuLCe6jyXuPQB/dKMUKoT5M1vouELz0cvY4oCICb3zre0RB8YFir/tI3hdwOM3qUVAvjR9L2WK/ogxjY5u7UeAaJh%2BO9TGSfMVeqxcnUObHsWa9BDLMFMogjg4u8m5VlzwyQlMZDB50bYbQsjjCuDMNo7oo47CLPnx/dw%2BjwD%2BGCM48ItTEnX4CbPkJ1jXgDFgMUaFlRUndZLo0Tpv%2BOiAHCZi0FsTCWzHSfgWlxi%2BndMSucQfBgbiPFeJlQxB6ASgnpoeigzAqgwS1UBITJg1IjitAwBFK0gxiB7kpK/STeyANXRPOiTEuICSDcjnuPkv6FvDaMF0/NHwkStfayiMUxBuu9bQFgLwLohsjY0%2BNsWDEs2ROibN%2BJq2lsbaOBweYtBODLV4J4DgWhSCoE4AALTMNsRYywnFeAODwUgBBNBvfmBSZaXhZQaAAtEfk2sDiQ%2BrBj/QnBJDfbh/9zgvAFAgHbrD37b3SBwFgDARAKBQpxDoJEcglB8ks6iMYSO0cyR8H%2BJEMnhIidEmYLGTg0PRe1GpDiMI2gzYS94OKNgggcT2upET4pwB9a1rJ9wXgWASRGHEFT0g%2BB0RtAjHrv7rXWiUNWNDwISMPum5xgd2MzgsBE8WywRX8wqAGGAAoY2eBMAGhxAyH70P%2BCCBEGIdgUgZCCEUCodQpvdA%2BAMEYEAmN9A9rJ5AeYqACn%2Bk4OvHEmw8TlBQkoAAYjzTY68hhsUKkBHO68HWuAfOvFgIkqzGAYBGYgBP/tD%2BG1gAvkUygVBSPYBsIxPBcF8A2bohRih6GyMkAQC%2BN%2BJC3wwVfvQohL5aG0AQHRhguEaHoU/lQL8TAKEfm/4wd8n/GIf6Yx/5hPKWCsCQ73PtCdTcAcOAMYQcecGAyR2xcBCBLxbgodZheBKctBj5Zw4Y%2Bgp8KQDgAJZQAJJBJBoguADhlouBloNBogAIvAl8XcR9fdlocDqwNB%2BRlpYhogDgcdUcgJpAfs/sQDSdycYc4d5hacGcOd6AyAKAIAxC%2BhudIM%2BcaBUxBdKAwgRdAhpdFdSApdYxZd5drANDldGACA1cMxNdMBFQddaA9dodDdDBgATc/tzczZBlrdeBbdkB7cNCndygic3dpdPdVg/sfc/c%2BBA9g9Q9w9I8NCY9hBRBxBE9oiU81AiddBqDbCc8zA88whJ8i8S8Ngy8K8q96BSRMB68tgm82UqR6VawO9Agu9G9e8%2BwqwEZ0xIxX1rICBeBUAx88AJ94Bv9q8z9PAIAHBX9l90AP918l9N9KhRjpiUgJi%2BgT8Bi78X8r8MgliZ9z939Jg19FiLBVj0hF99jOgFiv8Fhf8E8ACOAvtSAeDOjOAwD9wICoCIAYDzYl4ECkChD5g0CsAogp8aDeBfdJAuBZQDhogvBJANAyDqwsdCCiCrY7jicOB%2BCKdvjSAKRJB%2BRZR%2BQDhJBsDlocdIT%2BQNAuAOYXcDggDeCSdBCqdj4XcvAqT7iUTaSUD5gh8kg7BJAgA">it may be worth it</a> to implement <code>suffixXOR</code> as mentioned previously:</p>

<pre>
<code><span class="code-keyword">fn</span> <span class="code-fn">suffixXOR</span>(bitstring: <span class="code-type">u64</span>) <span class="code-type">u64</span> {
    <span class="code-keyword">return</span> prefixXOR(bitstring) ^ bitstring;
}</code>
</pre>

<p>Happy hacking!<br>&horbar;&#x202F;Validark</p>

</article>

<!-- <script src="https://utteranc.es/client.js"
        repo="validark/validark.github.io"
        issue-term="title"
        label="comments section"
        theme="github-light"
        crossorigin="anonymous"
        async>
</script> -->

</body>


</html>
