<!doctype html>
<html lang="en">
    <head>
        <meta charset="utf-8">
        <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">

        <title>reveal.js</title>

        <link rel="stylesheet" href="dist/reset.css">
        <link rel="stylesheet" href="dist/reveal.css">
        <!-- <link rel="stylesheet" href="dist/theme/white.css"> -->
        <link rel="stylesheet" href="dist/theme/dracula.css">
        <link rel="stylesheet" href="JetBrains_Mono.css">
        <link rel="stylesheet" href="plugin/highlight/highlightjs-zig/style/zig.style.css">

        <style>
            @font-face {
                font-family: 'Press Start 2P';
                src: url('fonts/Press_Start_2P/PressStart2P-Regular.ttf') format('truetype');
                font-weight: 400;
                font-style: normal;
                font-display: block;
            }
        </style>

        <!-- <link rel="stylesheet" href="dist/theme/matrix.css"> -->

        <!-- Theme used for syntax highlighted code -->
        <link rel="stylesheet" href="plugin/highlight/dracula.css">
        <style>
            h4,h5,h6,p,div,section {
                /* font-family: 'JetBrains Mono', monospace !important; */
                font-family: 'Ysabeau Office', serif !important;
            }

            .hljs-ln-n {
                font-family: 'JetBrains Mono', monospace !important;
            }

            @font-face {
                font-family: 'Ysabeau Office';
                src: url('./fonts/Ysabeau_Office/static/YsabeauOffice-Regular.ttf') format('truetype');
                font-weight: 400;
                font-style: normal;
                font-display: block;
            }

            @font-face {
                font-family: 'Ysabeau Office';
                src: url('./fonts/Ysabeau_Office/static/YsabeauOffice-Medium.ttf') format('truetype');
                font-weight: 500;
                font-style: normal;
                font-display: block;
            }

            h1,h2,h3 {
                font-family: 'Press Start 2P' !important;
            }

            div.slide-background-content {
                color: red !important;
            }

            /* section > ul > ul {
                list-style-type: "➢  " !important;
            } */

            ul ul ul ul li {
                /* list-style-type: disc; */
                list-style-type: "❖  ";
                /* ➢ */

            }

            ul ul ul ul li::marker {
                text-shadow: none !important;
            }

            .hljs-ln-line {
                line-height: 1.25;
            }

            pre {
                box-shadow: none !important;
            }

            code, .hljs-params, .hljs-identifier {
                color: white !important;
                font-style: normal;
                font-weight: normal;
            }

            .hljs-title {
                font-style: normal;
                font-weight: normal;
                color: #f1fa8c;
            }

            .hljs-operator, .hljs-optional {
                color: white !important;
            }
            .hljs-string {
                color: #ffb86c;
            }
            .hljs-type {
                color: #50fa7b;
                font-weight: normal;
                font-style: italic;
            }
            .hljs-built_in, .hljs-function-call {
                /* font-weight: bold; */
                color: #f1fa8c;
            }

            .hljs-meta-event {
                color: white;
                font-weight: normal;
            }
            .hljs-ln-line.hljs-ln-numbers { /* padding-right: 24px; */ text-align: left; }

            section#shuffle-vector .hljs {
                background: linear-gradient(#292A35, #1f2039);
            }

            section#prefix-shuffle .hljs {
                background: linear-gradient(#292A35, #191b3b);
            }

            .reveal pre code {
                font-family: 'JetBrains Mono', monospace; font-size: 11pt;
            }


            .fragment.fade-in-then-out:not(.visible) {
                font-size: 0;
            }


            .reveal section.text-only.present h2:not(#subtitle),
            .reveal section.text-only.present .fragment.visible:not(.fade-in-then-out),
            .reveal section.text-only.present .fragment.fade-in-then-out.visible.current-fragment {
                animation: fragment-visible 0.2s ease-out 0s 1 forwards normal;
            }

            .reveal section.text-only li { width: 1300px; }

            .reveal section.text-only.present .fragment.fade-in-then-out.visible:not(.current-fragment) {
                animation: fragment-invisible 0.2s ease-out 0s 1 forwards normal;
            }

            @keyframes fragment-visible {
                0%   { opacity: 0; font-size: 80%; }
                20%  { opacity: 0; transform: translateY(1em); }
                100% { opacity: 1; transform: translateY(0); }
            }


            @keyframes fragment-invisible {
                0%   { opacity: 1; transform: translateY(0); font-size: 100%; }
                100% { opacity: 0; transform: translateY(1em); font-size: 0%; }
            }



            section.text-only > div > ul > li {
                list-style-type: none;
                padding-top: 0;
                margin-top: 1.5em;
            }

            section > div > ul > ul > li {
                list-style-type: "❖  ";
            }

            section > div > ul > ul > li::marker {
                text-shadow: none !important;
            }

            .reveal a {
                color: inherit;
                text-shadow: 0 0 0.033em #fff, 0 0 0.08em #fff, 0 0 0.1em #00ffff9f, 0 0 0.2em #00ffff9f, 0 0 0.3em #00ffff9f, 0 0 1em #00ffff9f, 0 0 1.5em #00ffff9f;
            }

            .reveal a:hover {
                color: inherit;
                text-decoration: none;
                text-shadow: 0 0 0.033em #fff, 0 0 0.08em #fff, 0 0 0.1em orange, 0 0 0.2em orange, 0 0 0.3em orange, 0 0 1em orange, 0 0 1.5em orange;
            }

            section {
                font-size: 23px;
            }
        </style>

<script>
    const global_animations = [];


    function bitify(str) {
        return str.replace(/[ .0]+|[ 1]+/g, c => `<span class="bit-${c.includes('1') ? '1' : '0'}">${c}</span>`);
    }

    function bitify2(str) {
        return str.replace(/[ 0/]+|[ 1]+|[ .]+|[a-zA-Z]/g, c => `<span class="${c.includes(".") ? 'dotty ' : ""}bit-${c.includes('1') ? '1' : c.match("[0.]") ? '0' : 'unknown'}">${c.replaceAll('0/', '<span class="squished">0/</span> ')}</span>`);
    }
</script>
    </head>
    <body>
        <div class="reveal">
            <div class="slides">
                <!-- <section id="intro" data-background-image="../images/abstract-techno-background-with-connecting-dots-lines-circuit-board-texture.jpg" data-background-opacity="1" data-background-transition="fade" data-auto-animate>
                    <div class="animated-title">
                        <div class="text-top">
                          <div>
                            <span><h1 style="font-size: 36pt !important;">Accelerating</h1></span>
                            <span><h1 style="font-size: 36pt !important;">the Zig Parser</h1></span>
                            <span><h1 style="font-size: 36pt !important;">pt II</h1></span>
                          </div>
                        </div>
                        <div class="text-bottom">
                          <div><h2 style="font-size: 36pt !important;">with Niles Salter @Validark</h2></div>
                        </div>
                      </div>

                      <style>
                        @keyframes showTopText {
                            0% { transform: translate3d(0, 100%, 0); }
                            /* 20%, 40% { transform: translate3d(0, 65%, 0); } */
                            20%, 80% { transform: translate3d(0, 40%, 0); }
                            100% { transform: translate3d(0, 10%, 0); }
                        }
                        @keyframes showBottomText {
                            0% { transform: translate3d(0, -100%, 0); }
                            100% { transform: translate3d(0, 0, 0); }
                        }
                        section#intro .animated-title {
                            color: #222;
                            font-family: "Press Start 2P" !important;
                            height: 90vmin;
                            left: 50%;
                            position: absolute;
                            top: 50%;
                            transform: translate(-50%, -10%);
                            width: 90vmin;
                        }
                        .animated-title > div {
                            height: 50%;
                            overflow: hidden;
                            position: absolute;
                            width: 100%;
                        }
                        .animated-title > div div {
                            font-size: 5vmin;
                            padding: 2vmin 0;
                            position: absolute;
                        }
                        .animated-title > div div span {
                            display: block;
                        }
                        .animated-title > div.text-top {
                        /* border-bottom: 1vmin solid #000; */
                            top: 0;
                        }
                        .animated-title > div.text-top div {
                            animation: showTopText 8s;
                            animation-delay: 2s;
                            animation-fill-mode: forwards;
                            bottom: 0;
                            transform: translate(0, 100%);
                        }
                        .animated-title > div.text-bottom {
                            bottom: 0;
                        }
                        .animated-title > div.text-bottom div {
                            animation: showBottomText 2s;
                            animation-delay: 5.25s;
                            animation-fill-mode: forwards;
                            top: 0;
                            transform: translate(0, -100%);
                        }
                        div#intro-image-attribution {
                            opacity: 0;
                            animation: alive 2s ease-out 10s 1 forwards normal;
                        }
                      </style>
                    <div id="intro-image-attribution" style="position: absolute; margin: 54% calc(50% - 200px) auto; width: 400px; text-align: center;"><p style="font-size: 16pt;"><a href="https://www.freepik.com/free-photo/abstract-techno-background-with-connecting-dots-lines-circuit-board-texture_1137565.htm">Image by kjpargeter</a> on Freepik</p>
                    </div>
                </section> -->
                    <!-- <h1 style="font-size: 48pt;">Accelerating the Zig Parser II</h1>
                    <p style="font-family: 'Press Start 2P' !important;">with Niles Salter / @Validark</p> -->

                <section id="prelim_slide" data-background-color="white" data-background-transition="none">
                    <h1>Starting soon!</h1>
                </section>


                <section id="intro" data-background-color="black" data-background-transition="fade">
                    <div class="orange-sign" data-color="cyan">
                        <h1 style="margin: 0; font-size: 50pt" data-js-flicker="0"><span id="II">ACCELERATING THE ZIG PARSER</span><span id="with">with Niles Salter / @Validark</span></h1>
                    </div>

                    <style id="opening_animation"></style>
                    <script>
                        const OPENING_ANIMATION_HTML = `#II {
                              letter-spacing: -50pt;
                              opacity: 0;
                              -webkit-animation: II 14s cubic-bezier(0.69, 0.02, 0.53, 1) 2s 1 forwards normal, II-fade-out 1.5s cubic-bezier(0.69, 0.02, 0.53, 1) 18s 1 forwards normal;
                                      animation: II 14s cubic-bezier(0.69, 0.02, 0.53, 1) 2s 1 forwards normal, II-fade-out 1.5s cubic-bezier(0.69, 0.02, 0.53, 1) 18s 1 forwards normal;
                            }

                            #intro > div::before {
                                opacity: 0;
                                animation: alive 5s cubic-bezier(0.69, 0.02, 0.53, 1) 8s 1 forwards normal
                            }

                            #II-2 {
                              letter-spacing: -50pt;
                              opacity: 0;
                              -webkit-animation: II-2 1.5s ease-out 10s 1 forwards normal;
                                      animation: II-2 1.5s ease-out 10s 1 forwards normal;
                            }

                            #with {
                              letter-spacing: -50pt;
                              opacity: 0;
                              -webkit-animation: with 1.5s cubic-bezier(0.69, 0.02, 0.53, 1) 18s 1 forwards normal;
                                      animation: with 1.5s cubic-bezier(0.69, 0.02, 0.53, 1) 18s 1 forwards normal;
                            }

                            [class$=-sign] {
                            border: 6px solid #fff;
                            padding: 32px;
                            border-radius: 16px;
                            text-align: center;
                            position: relative;
                            margin-top: -100px;
                            padding: 0;
                            padding-right: 24px;
                            padding-left: 24px;
                            padding-bottom: 12px;
                            padding-top: 12px;
                            -webkit-animation: sign-animation 15s cubic-bezier(0.69, 0.02, 0.53, 1) 0s 1 forwards normal;
                                    animation: sign-animation 15s cubic-bezier(0.69, 0.02, 0.53, 1) 0s 1 forwards normal;
                            }
                            [class$=-sign]::before {
                            content: "";
                            position: absolute;
                            top: 120%;
                            left: 0;
                            height: 100%;
                            width: 100%;
                            transform: perspective(10em) rotateX(40deg) scale(1, 0.6);
                            filter: blur(4em);
                            }
                            [class$=-sign][class^=orange]::before {
                            background-color: var(--neon-orange-color);
                            }
                            [class$=-sign][class^=orange] {
                            box-shadow: 0 0 0.033em #fff, 0 0 0.08em #fff, 0 0 0.1em var(--neon-orange-color), 0 0 0.2em var(--neon-orange-color), 0 0 0.3em var(--neon-orange-color), 0 0 1em var(--neon-orange-color), 0 0 1.5em var(--neon-orange-color), inset 0 0 0.1em var(--neon-orange-color), inset 0 0 0.2em var(--neon-orange-color), inset 0 0 0.3em var(--neon-orange-color), inset 0 0 1em var(--neon-orange-color), inset 0 0 1.5em var(--neon-orange-color);
                            }
                            [class$=-sign][class^=orange] [data-js-flicker] {
                            color: #fff;
                            text-shadow: 0 0 0.033em #fff, 0 0 0.08em #fff, 0 0 0.1em var(--neon-orange-color), 0 0 0.2em var(--neon-orange-color), 0 0 0.3em var(--neon-orange-color), 0 0 1em var(--neon-orange-color), 0 0 1.5em var(--neon-orange-color);
                            }
                            [class$=-sign][class^=cyan]::before {
                            background-color: var(--neon-cyan-color);
                            }
                            [class$=-sign][class^=cyan] {
                            box-shadow: 0 0 0.033em #fff, 0 0 0.08em #fff, 0 0 0.1em var(--neon-cyan-color), 0 0 0.2em var(--neon-cyan-color), 0 0 0.3em var(--neon-cyan-color), 0 0 1em var(--neon-cyan-color), 0 0 1.5em var(--neon-cyan-color), inset 0 0 0.1em var(--neon-cyan-color), inset 0 0 0.2em var(--neon-cyan-color), inset 0 0 0.3em var(--neon-cyan-color), inset 0 0 1em var(--neon-cyan-color), inset 0 0 1.5em var(--neon-cyan-color);
                            }
                            [class$=-sign][class^=cyan] [data-js-flicker] {
                            color: #fff;
                            text-shadow: 0 0 0.033em #fff, 0 0 0.08em #fff, 0 0 0.1em var(--neon-cyan-color), 0 0 0.2em var(--neon-cyan-color), 0 0 0.3em var(--neon-cyan-color), 0 0 1em var(--neon-cyan-color), 0 0 1.5em var(--neon-cyan-color);
                            }
                        `;
                    </script>

                    <style>@import url("https://unpkg.com/augmented-ui@2/augmented-ui.min.css");
                        :root {
                          --main-color1: #050b16;
                          --main-color2: #0c182d;
                          --neon-purple-color: purple;
                          --neon-zig-color: #f7a41d;
                          --neon-green-color: rgb(0, 255, 0);
                          --neon-white-color: rgb(161, 161, 161);
                          --neon-cyan-color: cyan;
                          --neon-blue-color: rgb(48, 189, 255);
                          --neon-orange-color: #ff0000;
                        }

                        body {
                          background-color: var(--main-color1);
                          height: 100vh;
                          display: grid;
                          place-items: center;
                        }

                        .controls-arrow {
                            opacity: 0;
                            animation: alive 2s ease-out 20s 1 forwards normal;
                        }

                        [data-js-flicker] span {
                          font-size: inherit;
                          z-index: -1;
                        }

                        @-webkit-keyframes sign-animation {
                          0% {
                            transform: perspective(0em) rotateX(10deg) scale(0.02, 0.5) rotateZ(80deg);
                            opacity: 0;
                          }
                          30% {
                            opacity: 1;
                          }
                          100% {
                            transform: none;
                            opacity: 1;
                          }
                        }

                        @keyframes sign-animation {
                          0% {
                            transform: perspective(0em) rotateX(10deg) scale(0.02, 0.5) rotateZ(80deg);
                            opacity: 0;
                          }
                          30% {
                            opacity: 1;
                          }
                          100% {
                            transform: none;
                            opacity: 1;
                          }
                        }

                        @-webkit-keyframes II {
                          0% {
                            opacity: 0;
                            letter-spacing: -50pt;
                          }
                          40% {
                            opacity: 1;
                          }
                          100% {
                            opacity: 1;
                            letter-spacing: 0;
                          }
                        }

                        @keyframes II {
                          0% {
                            opacity: 0;
                            letter-spacing: -50pt;
                          }
                          40% {
                            opacity: 1;
                          }
                          100% {
                            opacity: 1;
                            letter-spacing: 0;
                          }
                        }
                        @-webkit-keyframes II-fade-out {
                          0% {
                            opacity: 1;
                            letter-spacing: 0;
                          }
                          100% {
                            opacity: 0;
                            letter-spacing: -50pt;
                          }
                        }
                        @keyframes II-fade-out {
                          0% {
                            opacity: 1;
                            letter-spacing: 0;
                          }
                          100% {
                            opacity: 0;
                            letter-spacing: -50pt;
                          }
                        }

                        @keyframes with {
                          0% {
                            opacity: 0;
                            letter-spacing: -50pt;
                          }
                          30% {
                            opacity: 1;
                          }
                          100% {
                            opacity: 1;
                            letter-spacing: -2pt;
                          }
                        }

                        @-webkit-keyframes II-2 {
                          0% {
                            opacity: 0;
                            letter-spacing: -50pt;
                          }
                          100% {
                            opacity: 1;
                            letter-spacing: 0;
                          }
                        }

                        @keyframes II-2 {
                          0% {
                            opacity: 0;
                            letter-spacing: -50pt;
                          }
                          100% {
                            opacity: 1;
                            letter-spacing: 0;
                          }
                        }</style>
                </section>

                <!-- linear-gradient(#690000, #690050) -->
                <section class="text-only" id="recap" data-auto-animate data-background-gradient="linear-gradient(#004, #400)" data-background-transition="none">
                    <h1 id="title" style="font-size: 36pt; color: #fff">But first.. a recap of part I</h1>
                    <h2 id="subtitle" style="font-size: 26pt; text-indent: 128px; color: #fff">& things to know</h2>

                    <style>
                        section#recap[data-fragment="-1"][present-went-forward] h1#title {
                            opacity: 0; letter-spacing: -36pt;
                            animation: title-expand 1s cubic-bezier(0.5, 0.02, 0.53, 1) 0s 1 forwards normal;
                        }

                        section#recap h1#title {
                            opacity: 1; letter-spacing: -0.5pt;
                            text-shadow: 0 0 0.033em #fff, 0 0 0.08em #fff, 0 0 0.1em orange, 0 0 0.2em orange, 0 0 0.3em orange, 0 0 1em orange, 0 0 1.5em orange;
                        }

                        @keyframes neon-shadow {
                            0% { text-shadow: none; }
                            100% { text-shadow: 0 0 0.033em #fff, 0 0 0.08em #fff, 0 0 0.1em orange, 0 0 0.2em orange, 0 0 0.3em orange, 0 0 1em orange, 0 0 1.5em orange; }
                        }

                        @keyframes title-expand {
                            0%   { opacity: 0; letter-spacing: -36pt; }
                            100% { opacity: 1; letter-spacing: -0.5pt; }
                        }

                        section#recap[data-fragment="-1"][present-went-forward] h2#subtitle {
                            opacity: 0; letter-spacing: -26pt;
                            text-shadow: none;
                            animation: subtitle-expand 1.5s cubic-bezier(0.5, 0.02, 0.53, 1) 0s 1 forwards normal;
                        }

                        section#recap h2#subtitle {
                            opacity: 1; letter-spacing: -0.5pt;
                            text-shadow: 0 0 0.033em #fff, 0 0 0.08em #fff, 0 0 0.1em orange, 0 0 0.2em orange, 0 0 0.3em orange, 0 0 1em orange, 0 0 1.5em orange !important;
                        }

                        @keyframes subtitle-expand {
                            0%   { opacity: 0; letter-spacing: -26pt; }
                            100% { opacity: 1; letter-spacing: -0.5pt; }
                        }
                    </style>

<!-- <div class="container">
    <div class="wrap-top">
      <div id="quote"></div>
      <div id="author-source" class="clearfix">
        <div id="author"></div>
        <div id="source"></div>
      </div>
    </div>
  </div> -->

  <style>
    /* * {
  margin: 0;
  padding: 0;
  box-sizing: border-box;
}

.clearfix:after {
  visibility: hidden;
  display: block;
  font-size: 0;
  content: " ";
  clear: both;
  height: 0;
}

.clearfix {
  display: inline-block;
}

/* start commented backslash hack \*/
/* * html .clearfix {
  height: 1%;
}

.clearfix {
  display: block;
} */

/* close commented backslash hack */

/* section#shuffle-vector .hljs {
    background-color: red;
} */

/* #5d008d; */

section#shuffle-vector .hljs,
section#prefix-shuffle .hljs {
  background:
    linear-gradient(183deg, rgba(83, 35, 141, 0.5) 1%, rgba(83, 35, 141, 0) 60%),
    linear-gradient(260deg, rgba(83, 35, 141, 0)  11%, rgba(255, 0, 25, 0.2)  10%, rgba(11, 35, 47, 0.2) 45%),
    linear-gradient(260deg, rgba(141, 35, 139, 0) 13%, rgba(141, 35, 46, 0.2) 10%, rgba(11, 35, 47, 0.2) 45%),
    linear-gradient(260deg, rgba(224, 33, 52, 0)  15%, rgba(141, 35, 46, 0.2) 10%, rgba(11, 35, 47, 0.2) 45%), repeating-linear-gradient(179deg, rgba(255, 255, 255, 0.1), rgba(255, 255, 255, 0.1) 3px, rgba(0, 0, 0, 0.1) 3px, rgba(0, 0, 0, 0.1) 3px);

  /* background:
    linear-gradient(rgb(41,42,53), rgb(31,32,57));
            background:
    linear-gradient(#292A35, #191b3b);
            linear-gradient(#292A35, #040945) */
  background-color: rgba(11, 35, 47, 1);
  background-repeat: no-repeat;
  background-attachment: fixed;
}


.slide-background-content {
  /* background: linear-gradient(183deg, rgba(83, 35, 141, 0.5) 1%, rgba(83, 35, 141, 0) 60%), linear-gradient(250deg, rgba(83, 35, 141, 0) 21%, rgba(255, 0, 25, 0.2) 20%, rgba(11, 35, 47, 0.2) 50%), linear-gradient(250deg, rgba(141, 35, 139, 0) 23%, rgba(141, 35, 46, 0.2) 20%, rgba(11, 35, 47, 0.2) 50%), linear-gradient(250deg, rgba(224, 33, 52, 0) 25%, rgba(141, 35, 46, 0.2) 20%, rgba(11, 35, 47, 0.2) 50%), repeating-linear-gradient(179deg, rgba(255, 255, 255, 0.1), rgba(255, 255, 255, 0.1) 3px, rgba(0, 0, 0, 0.1) 3px, rgba(0, 0, 0, 0.1) 6px); */

  /* background: linear-gradient(rgb(41,42,53), rgb(31,32,57));
            background: linear-gradient(#292A35, #191b3b);
            linear-gradient(#292A35, #040945) */

/* background-color: rgba(11, 35, 47, 1); */
  /* background-color: #f7a41d; */
  background: repeating-linear-gradient(179deg, rgba(255, 255, 255, 0.1), rgba(255, 255, 255, 0.1) 3px, rgba(0, 0, 0, 0.1) 3px, rgba(0, 0, 0, 0.1) 6px);
      /* linear-gradient(183deg, rgba(83, 35, 141, 0.5) 1%,rgba(83, 35, 141, 0) 60%), */
    /* linear-gradient(60deg, rgba(83, 35, 141, 0.4) 0%, rgba(133, 0, 0, 0.4) 50%, rgba(11, 35, 47, 0.4) 100%), */
    /* linear-gradient(250deg, rgba(141, 35, 139, 0) 23%, rgba(141, 35, 46, 0.2) 20%, rgba(11, 35, 47, 0.2) 50%), */
    /* linear-gradient(250deg, rgba(224, 33, 52, 0) 25%, rgba(141, 35, 46, 0.2) 20%, rgba(11, 35, 47, 0.2) 50%), */
  background-repeat: no-repeat;
  background-attachment: fixed;
}

div.backgrounds :first-child.slide-background.present > .slide-background-content {
    animation: slide-background-content 35s ease-out 0s 1 forwards normal;
}

@keyframes slide-background-content {
    0% { opacity: 0; }
    100% { opacity: 1;  }
}

/* ::-moz-selection {
  color: #ff1493;
  background: #9932cc;
}

::selection {
  color: #ff1493;
  background: #9932cc;
}

.container {
  max-width: 650px;
  margin: 0 auto;
  padding: 0 40px;
  font-family: "VT323";
  font-size: 1.3em;
  line-height: 1.3;
}

div, p {
  color: #fff;
  text-shadow: -1px 1px 8px #ffc, 1px -1px 8px #fff;
  text-decoration: none;
  outline: 0 none;
}

.wrap-top {
  position: relative;
  margin-top: 20%;
  padding-bottom: 100px;
  height: 150px;
}
@media all and (max-width: 620px) {
  .wrap-top {
    height: 275px;
  }
}
@media all and (max-width: 350px) {
  .wrap-top {
    height: auto;
  }
}
.wrap-top #quote {
  width: 100%;
  padding-bottom: 30px;
  position: relative;
}
.wrap-top #quote:before {
  content: '"';
  font-size: 5em;
  position: absolute;
  left: -50px;
  top: -35px;
}
.wrap-top #author-source {
  float: right;
}
.wrap-top #author-source #author,
.wrap-top #author-source #source {
  font-size: 0.85em;
}
.wrap-top #author-source #author {
  float: left;
  padding-right: 5px;
}
.wrap-top #author-source #author:before {
  content: "- ";
}
.wrap-top #author-source #author:after {
  content: ",";
}
.wrap-top #author-source #source {
  font-style: italic;
  float: left;
}

.wrap-mid {
  padding: 25px 0 100px 0;
}
.wrap-mid .tweet {
  cursor: pointer;
  transition: all 0.1s ease-in-out;
}
.wrap-mid .tweet:hover {
  text-shadow: 0 0 13px #fff;
  cursor: hand;
}
.wrap-mid button {
  border-radius: 3px;
  outline: 0;
  padding: 5px 10px;
  box-shadow: 0 0 25px #fff;
  transition: all 0.5s;
}
.wrap-mid button:hover {
  box-shadow: 0 0 30px #fff;
}
.wrap-mid #new-quote {
  float: right;
}

.wrap-btm {
  padding: 20% 0 10% 0;
  margin: 0 auto;
  text-align: center;
  font-family: Open Sans, Helvetica, sans-serif;
}
.wrap-btm p, .wrap-btm a {
  text-transform: uppercase;
  font-size: 0.6em;
  text-shadow: none;
  color: #ccc;
  opacity: 0.4;
}
.wrap-btm a {
  color: #ccc;
  font-size: 1.05em;
  opacity: 1;
} */
  </style>

                    <ul style="font-size: 16pt">
                        <li class="fragment">We discussed how computers can get faster</li>
                        <ul>
                            <li class="fragment">identified fundamental problems that computers must face in the physical universe</li>
                            <li class="fragment">derived optimization strategies that should be useful across (good) hardware, across time</li>
                            <ul>
                                <li class="fragment">reduce cache misses</li>
                                <ul>
                                    <li class="fragment">sometimes makes O(n log n) scale better than O(n)</li>
                                    <ul>
                                        <li class="fragment">Performance engineering case study: heap construction <br><a target="_blank" rel="noopener noreferrer" href="https://dl.acm.org/doi/pdf/10.1145/351827.384257">https://dl.acm.org/doi/pdf/10.1145/351827.384257</a></li>
                                    </ul>
                                    <!-- <li class="fragment">work with your hardware prefetcher</li> -->
                                </ul>
                                <li class="fragment">reduce branch misprediction</li>
                                <li class="fragment">eliminate unnecessary instructions, fewer is usually better</li>
                                <li class="fragment">improve data-level parallelism</li>
                                    <ul>
                                        <li class="fragment">SIMD/SWAR - Single instruction, multiple data & SIMD within a register</li>
                                    </ul>
                                <li class="fragment">do work in the pass where it is cheapest to do it</li>
                            </ul>
                        </ul>
                    </ul>
                </section>

                <section class="text-only" id="zig-compiler-intro" data-auto-animate data-background-gradient="linear-gradient(#400, #000)" data-background-transition="none">
                    <h2 style="color: #fff">The Zig compiler basics</h2>
                    <ul style="margin-top: 1em">
                        <li class="fragment">Converts code in text files into executable binaries</li>
                    </ul>
                    <div class="fragment">
                        <img src="/images/zig-compiler-internals.png" />
                        <div class="img-attribution" style="top: -190px; position: relative; background-color: #000; border: black 4px solid;"><p>Andrew Kelley - Practical DOD<br><a target="_blank" rel="noopener noreferrer" href="https://vimeo.com/649009599">https://vimeo.com/649009599</a></p></div>

                        <style>
                        div.visible div.img-attribution {
                            opacity: 0;
                            animation: alive-me 3s cubic-bezier(0.69, 0.02, 0.53, 1) 0s 1 forwards normal;
                        }

                        @keyframes alive-me {
                            0% { opacity: 0; transform: translateY(1in) scale(0.5) }
                            100% { opacity: 1; transform: translateY(0) scale(1) }
                        }
                        </style>
                    </div>
                </section>

                <section data-background-gradient="linear-gradient(rgb(114 0 0), rgb(0 11 98))" id="tokenization-intro" >
                    <h2>Intro to<br>tokenization</h2>
                    <div style="height: 1200px; width: 1200px; position: absolute; scale: 2;">
                        <pre class="visible" style="width: 900px; height: 120px; top: 420px; left: 120px;"><code id="columnCounts-routine" data-line-numbers="" data-fragment-index="0" class="hljs language-zig" style="font-family: 'JetBrains Mono', monospace; font-size: 11pt; margin-top: -2em; margin-left: 10px; position: absolute; padding-bottom: 40px;">export fn columnCounts(chunk: @Vector(16, u8)) @Vector(16, u8) {
    const newlines: u16 = @bitCast(@as(@Vector(16, u8), chunk) == @as(@Vector(16, u8), @splat('\n')));
    const ones = 0x1111111111111111;
    const ascending_indices = 0xFEDCBA9876543210;
    const restart_nibbles_mask = pdep(newlines, ones ^ 1) *% 0xF;
    const restart_nibbles_indices = pext(ascending_indices, restart_nibbles_mask);
    const prefix_diff = restart_nibbles_indices -% (restart_nibbles_indices << 4);
    const vec: @Vector(8, u8) = @bitCast(ascending_indices -% pdep(prefix_diff, restart_nibbles_mask) *% ones);
    return std.simd.interlace(.{ vec, vec >> @splat(4) }) & @as(@Vector(16, u8), @splat(0xF));
}</code></pre>
<pre class="my-token fragment" data-fragment-index="1" data="export" style="top: 258px; left: 257px;"><span class="hljs-keyword" style="
    font-size: 14.6667px;
    font-family: 'JetBrains Mono', monospace;
">export</span></pre>

<pre class="my-token fragment" data-fragment-index="1" data="fn" style="top: 222px;left: 318px;"><span class="hljs-keyword" style="
    font-size: 14.6667px;
    font-family: 'JetBrains Mono', monospace;
">fn</span></pre>

<pre class="my-token fragment" data-fragment-index="1" data="columnCounts" style="top: 186px;left: 344px;"><span class="hljs-title" style="
    font-size: 14.6667px;
    font-family: 'JetBrains Mono', monospace;
">columnCounts</span></pre>

<pre class="my-token fragment" data-fragment-index="1" data="(" style="top: 149px;left: 448px;"><span class="hljs-operator" style="
    font-size: 14.6667px;
    font-family: 'JetBrains Mono', monospace;
">(</span></pre>

<pre class="my-token fragment" data-fragment-index="1" data="chunk" style="top: 113px;left: 457px;"><span class="hljs-text" style="
    font-size: 14.6667px;
    font-family: 'JetBrains Mono', monospace;
">chunk</span></pre>

<pre class="my-token fragment" data-fragment-index="1" data=":" style="top: 77px;left: 501px;"><span class="hljs-operator" style="
    font-size: 14.6667px;
    font-family: 'JetBrains Mono', monospace;
">:</span></pre>

<pre class="my-token fragment" data-fragment-index="1" data="@Vector" style="top: 41px;left: 518px;"><span class="hljs-built_in" style="
    font-size: 14.6667px;
    font-family: 'JetBrains Mono', monospace;
">@Vector</span></pre>

<!-- <pre class="fragment fade-in-then-out" style="top: 619px;left: 308px; font-size: 16px; position: absolute;"><code>




</code></pre> -->
<pre class="fragment fade-in-then-out" style="top: 619px;left: 281px; font-size: 16px; position: absolute;"><code>{
    .kind = .@"export",
    .start = 0,
    .end = 6,
}</code></pre>

<pre id="fn-data" class="fragment fade-in-then-out" style="top: 619px;left: 385px; font-size: 16px; position: absolute;"><code>{
    .kind = .@"fn",
    .start = 7,
    .end = 9,
}</code></pre>

<style>
    #fn-data.visible {
        animation: fn-data 0.75s cubic-bezier(0.69, 0.02, 0.53, 1) 0s 1 forwards normal;
    }

    @keyframes fn-data {
        0% { transform: translateX(calc(-385px + 281px)) }
        100% { transform: translateX(0) }
    }
</style>

<pre id="columnCounts-data" class="fragment fade-in-then-out" style="top: 619px;left: 481px; font-size: 16px; position: absolute;"><code>{
    .kind = .@"identifier",
    .start = 10,
    .end = 22,
}</code></pre>

<style>
    #columnCounts-data.visible {
        animation: columnCounts-data 0.75s cubic-bezier(0.69, 0.02, 0.53, 1) 0s 1 forwards normal;
    }

    @keyframes columnCounts-data {
        0% { transform: translateX(calc(-481px + 385px)) }
        100% { transform: translateX(0) }
    }
</style>

<pre id="open-paren-data" class="fragment fade-in-then-out" style="top: 619px;left: 669px; font-size: 16px; position: absolute;"><code>{
    .kind = .@"(",
    .start = 22,
    .end = 23,
}</code></pre>

<style>
    #open-paren-data.visible {
        animation: open-paren-data 0.75s cubic-bezier(0.69, 0.02, 0.53, 1) 0s 1 forwards normal;
    }

    @keyframes open-paren-data {
        0% { transform: translateX(calc(-669px + 481px)) }
        100% { transform: translateX(0) }
    }
</style>

<pre id="chunk-iden-data" class="fragment fade-in-then-out" style="top: 619px;left: 705px; font-size: 16px; position: absolute;"><code>{
    .kind = .@"identifier",
    .start = 23,
    .end = 28,
}</code></pre>

<style>
    #chunk-iden-data.visible {
        animation: chunk-iden-data 0.75s cubic-bezier(0.69, 0.02, 0.53, 1) 0s 1 forwards normal;
    }

    @keyframes chunk-iden-data {
        0% { transform: translateX(calc(-705px + 669px)) }
        100% { transform: translateX(0) }
    }
</style>

<pre id="colon-data" class="fragment fade-in-then-out" style="top: 619px;left: 818px; font-size: 16px; position: absolute;"><code>{
    .kind = .@":",
    .start = 28,
    .end = 29,
}</code></pre>

<style>
    #colon-data.visible {
        animation: colon-data 0.75s cubic-bezier(0.69, 0.02, 0.53, 1) 0s 1 forwards normal;
    }

    @keyframes colon-data {
        0% { transform: translateX(calc(-818px + 705px)) }
        100% { transform: translateX(0) }
    }
</style>

<pre id="builtin-vector-data" class="fragment fade-in-then-out" style="top: 619px;left: 878px; font-size: 16px; position: absolute;"><code>{
    .kind = .@"builtin",
    .start = 30,
    .end = 37,
}</code></pre>

<style>
    #builtin-vector-data.visible {
        animation: builtin-vector-data 0.75s cubic-bezier(0.69, 0.02, 0.53, 1) 0s 1 forwards normal;
    }

    @keyframes builtin-vector-data {
        0% { transform: translateX(calc(-878px + 818px)) }
        100% { transform: translateX(0) }
    }
</style>

<style>
    .my-token span {
        border: 2px white solid !important;
    }
</style>

<script>
{
    Array.prototype.push.apply(global_animations, [
            ["export", "605"],
            ["fn", "670"],
            ["columnCounts", "700"],
            ["(", "830"],
            ["chunk", "860"],
            [":", "925"],
            ["@Vector", "948"],
        ].map(([data, offset], i) => ({
            section: "tokenization-intro",
            slide_num: 0,
            animation_delay: `${(1 + i)/2}s`,
            animation_duration: `${2 + i / 5 }s`,
            // continuous: true,
            selector: `.my-token[data="${data}"]`,
            keyframes: {
                0:   { "transform": "translate(0px, 0px)", opacity: 0 },
                20:  { opacity: 1 },
                100: { "transform": `translate(${offset}px, 189px) scale(2)`, opacity: 1 },
            }
        })));
}</script>
<!-- 189px -->
    <!-- <script>
        setTimeout(() => {
            const element = document.querySelector("#ctz-emulation-routine > table > tbody > tr:nth-child(11) > td.hljs-ln-line.hljs-ln-code");

            element.innerHTML = element.innerHTML.replaceAll("span", "pre");
        }, 100)
    </script> -->
    <!-- -183px -->
<!-- <script>
    setTimeout(() =>
document.getElementById("ctz-emulation-routine").insertAdjacentHTML("beforeend", `<span class="hljs-keyword">export</span> <span class="hljs-function"><span class="hljs-keyword">fn</span> <span class="hljs-title">columnCounts</span><span class="hljs-params"><span>(</span>chunk<span class="hljs-operator">:</span> <span class="hljs-built_in">@Vector</span><span class="hljs-operator">(</span><span class="hljs-number">16</span><span>,</span> <span class="hljs-type">u8</span><span>)</span></span>) <span class="hljs-built_in">@Vector</span>(<span class="hljs-number">16</span>, <span class="hljs-type">u8</span><span>)</span> <span class="hljs-operator">{</span>`), 1000);
</script> -->

<!-- <span class="hljs-keyword">export</span> <span class="hljs-keyword">fn</span> undefined -->
                    </div>
                </section>
<style>
    *[hidden] {
        /* visibility: hidden !important; */
        /* display: none !important; */
        animation: display-none 3s linear 3s 1 forwards normal;
    }

    @keyframes display-none {
        to {
            display: none;
        }
    }

    code.fragment.visible:not(.current-fragment) {
        visibility: hidden !important;
        /* display: none !important; */
    }
</style>
                <section data-background-gradient="linear-gradient(rgb(114 0 0), rgb(0 11 98))" id="basic-tokenizer" class="tokenizer">
                    <h2>A basic tokenizer</h2>
                    <div style="height: 1200px; width: 1200px; position: absolute; scale: 1.5">
                        <pre class="visible" style="width: 1200px; height: 400px; top: 250px; left: 220px;"><code data-line-numbers="|1|2|3|5|6|7|8|10|11|12|13|10|11|12|13|10|11|12|13|10|11|12|13|10|11|12|13|10|11|12|14|18-19|21-25|26|5|6|46|5|6|7|8|10|11|12|13|10|11|12|14|18-19|21-25|26|5|6|46|5|6|7|8|10|11|12|13|10|11|12|13|10|11|12|13|10|11|12|13|10|11|12|13|10|11|12|13|10|11|12|13|10|11|12|13|10|11|12|13|10|11|12|13|10|11|12|13|10|11|12|14|18-19|21-25|26|47" data-fragment-index="1" class="tokenize1 hljs language-zig" style="font-family: 'JetBrains Mono', monospace; font-size: 11pt; margin-top: -2em; position: absolute; box-sizing: content-box; width: 100%">pub fn tokenize(allocator: Allocator, source: []const u8) !std.ArrayListUnmanaged(Token) {
    var cur = source[0..];
    var tokens = try std.ArrayListUnmanaged(Token).initCapacity(allocator, source.len / 8);

    while (true) {
        switch (cur[0]) {
            'a'...'z', 'A'...'Z', '_' => {
                const start = cur;

                while (true) {
                    cur = cur[1..];
                    switch (cur[0]) {
                        'a'...'z', 'A'...'Z', '_', '0'...'9' => {},
                        else => break,
                    }
                }

                // our token span is start..end
                const end = cur;

                (try tokens.addOne(allocator)).* = Token{
                    .kind = if (getKeywordKind(start, end)) |kw| kw else .identifier,
                    .start = start,
                    .end = end,
                };
            },
            '0'...'9' => {
                // parse a number
            },
            '~', ':', ';', '[', ']', '?', '(', ')', '{', '}', ',' => |c| {
                const start = cur;
                cur = cur[1..];
                const end = cur;
                (try tokens.addOne(allocator)).* = Token{
                    .kind = @bitCast(c),
                    .start = start,
                    .end = end,
                };
            }
            '"' => while (true) { // parse a string
                cur = cur[1..];
                const is_escaped = cur[0] == '\\';
                cur = cur[@intFromBool(is_escaped)..];
                if (cur[0] == '"' and !is_escaped) break;
            },
            ' ', '\t', '\n', '\r' => cur = cur[1..],
            0 => return tokens,
        }
    }
}</code></pre>
                    </div>

                    <div id="basic-tokenizer-vars" style="scale: 1.5; position: relative;top: 761px;left: 490px;height: 400px;width: 905px;">
                        <style>
                        div#basic-tokenizer-vars pre {
                            font-family: 'JetBrains Mono', monospace;
                            font-size: 14pt;
                            position: absolute;
                        }
                        </style>
                        <pre class="fragment custom" data-fragment-index="1" id="" style="transform: translate(0em, 0em);">source: </pre>
                        <!-- <pre><code>export fn columnCounts(chunk: @Vector(</code></pre> -->

                        <div style="height: 1200px; width: 1200px; position: absolute;left: 78px; top: 24px;">
                            <!-- <pre style="width: 900px;"><code id="columnCounts-line" data-fragment-index="0" class="hljs language-zig" style="font-family: 'JetBrains Mono', monospace; font-size: 11pt; margin-top: -2em; margin-left: 10px; position: absolute; ">export fn columnCounts(chunk: @Vector(16, u8)) @Vector(16, u8) {</code></pre> -->
                            <!-- <pre style="width: 900px;"><code id="columnCounts-line-2" data-fragment-index="0" class="hljs language-zig" style="font-family: 'JetBrains Mono', monospace; font-size: 11pt; margin-top: -2em; margin-left: 10px; position: absolute; ">export fn columnCounts(chunk: @Vector(16, u8)) @Vector(16, u8) {
^ cur</code></pre> -->
<pre style="width: 900px; line-height: 0.9;"><code id="columnCounts-line" data-fragment-index="0" class="hljs language-zig" style="font-family: 'JetBrains Mono', monospace; font-size: 11pt; margin-top: -2em; margin-left: 10px; position: absolute; ">export fn columnCounts(chunk: @Vector(16, u8)) @Vector(16, u8) {</code></pre>

                        </div>
                        <!-- <pre class="fragment custom" data-fragment-index="1" id="" style="transform: translate(0em, 1.5em);">cur2: </pre> -->
                    </div>

                    <style>
                        section.tokenizer .cursor-space {
                            letter-spacing: -12px;
                        }

                        section.tokenizer .cursor-space.visible {
                            animation: cursor-space 0.4s cubic-bezier(0.69, 0.02, 0.53, 1) 0s 1 forwards normal;
                        }

                        section.tokenizer .cursor-space:not(.visible) {
                            animation: cursor-unspace 0.4s cubic-bezier(0.69, 0.02, 0.53, 1) 0s 1 forwards normal;
                        }

                        section.tokenizer[fragment-1] .cursor-position {
                            animation: alive 1s ease-out 0s 1 forwards normal;
                        }

                        @keyframes cursor-space {
                            0%   { letter-spacing: -12px }
                            100% { letter-spacing: 0px }
                        }

                        @keyframes cursor-unspace {
                            0%   { letter-spacing: 0px }
                            100% { letter-spacing: -12px }
                        }

                        /* .reveal section.present[data-fragment="-1"] code[data-line-numbers=""] {
                            scale: 0.7;
                            animation: scale-code 1s cubic-bezier(0.69, 0.02, 0.53, 1) 0.5s 1 forwards normal;
                        }

                        @keyframes scale-code {
                            0% { scale: 0.7 }
                            100% { scale: 1 }
                        } */
                    </style>
                </section>

                <section data-background-gradient="linear-gradient(rgb(114 0 0), rgb(0 11 98))" id="better-tokenizer" class="tokenizer">
                    <h2>A better tokenizer</h2>
                    <div style="height: 1200px; width: 1200px; position: absolute; scale: 1.5">
                        <pre class="visible" style="width: 1200px; height: 400px; top: 250px; left: 220px;"><code data-line-numbers="|1|2|3|5|6|7|8|10|11|12|14-18|20|21|24-25|27-31|32|5|6|52|5|6|7|8|10|12|14-18|20|21|25|27-31|32|5|6|52|5|6|7|8|10|12|14-18|20|21|25|27-31|" data-fragment-index="1" class="tokenize2 hljs language-zig" style="font-family: 'JetBrains Mono', monospace; font-size: 11pt; margin-top: -2em; position: absolute; box-sizing: content-box; width: 100%">pub fn tokenize(allocator: Allocator, source: []const u8) !std.ArrayListUnmanaged(Token) {
    var cur = source[0..];
    var tokens = try std.ArrayListUnmanaged(Token).initCapacity(allocator, source.len / 8);

    while (true) {
        switch (cur[0]) {
            'a'...'z', 'A'...'Z', '_' => {
                const start = cur;

                while (true) {
                    const V = @Vector(@bitSizeOf(usize), u8);
                    const vec: V = cur[0..@sizeOf(V)].*;

                    const identifier_bitstring =
                        (@as(usize, @bitCast(vec == @as(V, @splat('_'))))) |
                        (@as(usize, @bitCast(@as(V, @splat('a')) <= vec)) & @as(usize, @bitCast(vec <= @as(V, @splat('z'))))) |
                        (@as(usize, @bitCast(@as(V, @splat('A')) <= vec)) & @as(usize, @bitCast(vec <= @as(V, @splat('Z'))))) |
                        (@as(usize, @bitCast(@as(V, @splat('0')) <= vec)) & @as(usize, @bitCast(vec <= @as(V, @splat('9')))));

                    cur = cur[@ctz(~identifier_bitstring)..];
                    if (~identifier_bitstring != 0) break;
                }

                // our token span is start..end
                const end = cur;

                (try tokens.addOne(allocator)).* = Token{
                    .kind = if (getKeywordKind(start, end)) |kw| kw else .identifier,
                    .start = start,
                    .end = end,
                };
            },
            '0'...'9' => {
                // parse a number
            },
            '~', ':', ';', '[', ']', '?', '(', ')', '{', '}', ',' => |c| {
                const start = cur;
                cur = cur[1..];
                const end = cur;
                (try tokens.addOne(allocator)).* = Token{
                    .kind = @bitCast(c),
                    .start = start,
                    .end = end,
                };
            }
            '"' => while (true) { // parse a string
                cur = cur[1..];
                const is_escaped = cur[0] == '\\';
                cur = cur[@intFromBool(is_escaped)..];
                if (cur[0] == '"' and !is_escaped) break;
            },
            ' ', '\t', '\n', '\r' => cur = cur[1..],
            0 => return tokens,
        }
    }
}</code></pre>
                    </div>
<style>
.reveal .hljs-ln-code {
    width: 100%;
}

code::-webkit-scrollbar {
    width: 8px;
}

code::-webkit-scrollbar-track {
    -webkit-border-radius: 10px;
    border-radius: 10px;
    background: rgb(40, 42, 54);
}
/* rgb(40, 42, 54) */
/* rgba(115, 0, 255, 0.3) */
code::-webkit-scrollbar-thumb {
   -webkit-border-radius: 10px;
   border-radius: 10px;
   background: rgba(115, 0, 255, 0.9);
}

code::-webkit-scrollbar-thumb:window-inactive {
    background: rgba(115, 0, 255, 0.9);
}
</style>
                    <div id="advanced-tokenizer-vars" style="scale: 1.5; position: relative;top: 761px;left: 490px;height: 400px;width: 905px;">
                        <style>
                        div#advanced-tokenizer-vars pre {
                            font-family: 'JetBrains Mono', monospace;
                            font-size: 14pt;
                            position: absolute;
                        }
                        </style>
                        <pre class="fragment custom" data-fragment-index="1" id="" style="transform: translate(0em, 0em);">source: </pre>
                        <!-- <pre><code>export fn columnCounts(chunk: @Vector(</code></pre> -->

                        <div style="height: 1200px; width: 1200px; position: absolute;left: 78px; top: 24px;">
                            <!-- <pre style="width: 900px;"><code id="columnCounts-line" data-fragment-index="0" class="hljs language-zig" style="font-family: 'JetBrains Mono', monospace; font-size: 11pt; margin-top: -2em; margin-left: 10px; position: absolute; ">export fn columnCounts(chunk: @Vector(16, u8)) @Vector(16, u8) {</code></pre> -->
                            <!-- <pre style="width: 900px;"><code id="columnCounts-line-2" data-fragment-index="0" class="hljs language-zig" style="font-family: 'JetBrains Mono', monospace; font-size: 11pt; margin-top: -2em; margin-left: 10px; position: absolute; ">export fn columnCounts(chunk: @Vector(16, u8)) @Vector(16, u8) {
^ cur</code></pre> -->
<pre id="columnCountsCode" style="width: 900px; line-height: 0.9;"><code id="columnCounts-line2" data-fragment-index="0" class="hljs language-zig" style="font-family: 'JetBrains Mono', monospace; font-size: 11pt; margin-top: -2em; margin-left: 10px; position: absolute; ">export fn columnCounts(chunk: @Vector(16, u8)) @Vector(16, u8) {</code></pre>

    <script>
        const nu = document.getElementById("columnCountsCode");
        for (const [i, bitstr] of [
            '1111110110111111111111011111000111111011001100001111110110011000',
            '       110111111111111011111000111111011001100001111110110011000......',
            '          111111111111011111000111111011001100001111110110011000..........',
        ].entries()) {
            nu.insertAdjacentHTML("afterend", `<pre id="column-counts-bitsies-${i}" style="font-size: 11pt; right: 105px;">${bitify(bitstr)}</pre>`);
            Array.prototype.push.apply(global_animations, [
                {
                    section: "better-tokenizer",
                    selector: `#column-counts-bitsies-${i}`,
                    slide_num: i*15 + 10,
                    animation_delay: "0s",
                    animation_duration: "2s",
                    forward_only: true,
                    keyframes: {
                        0:   { transform: "translateY(-25px)", opacity: 0 },
                        100: { transform: `translateY(0px)`,   opacity: 1 },
                    }
                },

                {
                    section: "better-tokenizer",
                    selector: `#column-counts-bitsies-${i}`,
                    slide_num: i*15 + 13,
                    animation_delay: "0s",
                    animation_duration: "1s",
                    forward_only: true,
                    keyframes: {
                        0:   { transform: "translateY(0px)", opacity: 1 },
                        100: { transform: `translateY(-25px)`,   opacity: 0 },
                    }
                }
            ]);
        }
    </script>



                        </div>
                        <!-- <pre class="fragment custom" data-fragment-index="1" id="" style="transform: translate(0em, 1.5em);">cur2: </pre> -->
                    </div>
                </section>

                <section data-background-gradient="linear-gradient(rgb(114 0 0), rgb(0 11 98))" id="x86-alpha-asm">
                    <h2>Bitstring generation Emit</h2>
                    <iframe style="margin-top: 20px;" width="1920px" height="960px" src="https://zig.godbolt.org/e#g:!((g:!((g:!((h:codeEditor,i:(filename:'1',fontScale:14,fontUsePx:'0',j:3,lang:zig,selection:(endColumn:72,endLineNumber:7,positionColumn:72,positionLineNumber:7,selectionStartColumn:72,selectionStartLineNumber:7,startColumn:72,startLineNumber:7),source:'export+fn+maskForAlphanumericAndUnderscores(src:+%5B*%5Dalign(8)+const+u8)+u64+%7B%0A++++const+V+%3D+@Vector(64,+u8)%3B%0A++++const+vec+%3D+src%5B0..64%5D.*%3B%0A++++return%0A++++++++(@as(usize,+@bitCast(vec+%3D%3D+@as(V,+@splat(!'_!')))))+%7C%0A++++++++(@as(usize,+@bitCast(@as(V,+@splat(!'a!'))+%3C%3D+vec))+%26+@as(usize,+@bitCast(vec+%3C%3D+@as(V,+@splat(!'z!')))))+%7C%0A++++++++(@as(usize,+@bitCast(@as(V,+@splat(!'A!'))+%3C%3D+vec))+%26+@as(usize,+@bitCast(vec+%3C%3D+@as(V,+@splat(!'Z!')))))+%7C%0A++++++++(@as(usize,+@bitCast(@as(V,+@splat(!'0!'))+%3C%3D+vec))+%26+@as(usize,+@bitCast(vec+%3C%3D+@as(V,+@splat(!'9!')))))%3B%0A%7D%0A'),l:'5',n:'0',o:'Zig+source+%233',t:'0')),header:(),k:51.64749607968384,l:'4',m:100,n:'0',o:'',s:0,t:'0'),(g:!((h:compiler,i:(compiler:ztrunk,filters:(b:'0',binary:'1',binaryObject:'1',commentOnly:'0',debugCalls:'1',demangle:'0',directives:'0',execute:'1',intel:'0',libraryCode:'0',trim:'1',verboseDemangling:'0'),flagsViewOpen:'1',fontScale:14,fontUsePx:'0',j:2,lang:zig,libs:!(),options:'-O+ReleaseFast+-target+x86_64-linux+-mcpu%3Dznver4',overrides:!(),selection:(endColumn:1,endLineNumber:1,positionColumn:1,positionLineNumber:1,selectionStartColumn:1,selectionStartLineNumber:1,startColumn:1,startLineNumber:1),source:3),l:'5',n:'0',o:'+zig+trunk+(Editor+%233)',t:'0')),header:(),k:48.352503920316174,l:'4',m:100,n:'0',o:'',s:0,t:'0')),l:'2',m:100,n:'0',o:'',t:'0')),version:4"></iframe>
                </section>


                <section data-background-gradient="linear-gradient(rgb(114 0 0), rgb(0 11 98))" id="x86-tokenization-asm">
                    <h2>Basic tokenization loop emit</h2>
                    <iframe style="margin-top: 20px;" width="1920px" height="960px" src="https://zig.godbolt.org/e#g:!((g:!((g:!((h:codeEditor,i:(filename:'1',fontScale:14,fontUsePx:'0',j:3,lang:zig,selection:(endColumn:1,endLineNumber:23,positionColumn:1,positionLineNumber:23,selectionStartColumn:1,selectionStartLineNumber:23,startColumn:1,startLineNumber:23),source:'export+fn+tokenize(source:+%5B*%5Dconst+u8)+extern+struct+%7B+start:+%5B*%5Dconst+u8,+end:+%5B*%5Dconst+u8+%7D+%7B++++%0A++++var+cur+%3D+source%5B0..%5D%3B%0A++++const+start+%3D+cur%3B%0A%0A++++while+(true)+%7B%0A++++++++const+V+%3D+@Vector(@bitSizeOf(usize),+u8)%3B%0A++++++++const+vec:+V+%3D+cur%5B0..@sizeOf(V)%5D.*%3B%0A%0A++++++++const+identifier_bitstring+%3D%0A++++++++++++(@as(usize,+@bitCast(vec+!!%3D+@as(V,+@splat(!'_!')))))+%26%0A++++++++++++(@as(usize,+@bitCast(@as(V,+@splat(!'a!'))+%3E+vec))+%7C+@as(usize,+@bitCast(vec+%3E+@as(V,+@splat(!'z!')))))+%26%0A++++++++++++(@as(usize,+@bitCast(@as(V,+@splat(!'A!'))+%3E+vec))+%7C+@as(usize,+@bitCast(vec+%3E+@as(V,+@splat(!'Z!')))))+%26%0A++++++++++++(@as(usize,+@bitCast(@as(V,+@splat(!'0!'))+%3E+vec))+%7C+@as(usize,+@bitCast(vec+%3E+@as(V,+@splat(!'9!')))))%3B%0A%0A++++++++cur+%3D+cur%5B@ctz(identifier_bitstring)..%5D%3B%0A++++++++if+(~identifier_bitstring+!!%3D+0)+break%3B%0A++++%7D%0A%0A++++//+our+token+span+is+start..end%0A++++const+end+%3D+cur%3B%0A++++return+.%7B+.start+%3D+start,+.end+%3D+end+%7D%3B%0A%7D%0A'),l:'5',n:'0',o:'Zig+source+%233',t:'0')),header:(),k:47.23657189835421,l:'4',m:100,n:'0',o:'',s:0,t:'0'),(g:!((h:compiler,i:(compiler:ztrunk,filters:(b:'0',binary:'1',binaryObject:'1',commentOnly:'0',debugCalls:'1',demangle:'0',directives:'0',execute:'1',intel:'0',libraryCode:'0',trim:'1',verboseDemangling:'0'),flagsViewOpen:'1',fontScale:14,fontUsePx:'0',j:2,lang:zig,libs:!(),options:'-O+ReleaseFast+-target+x86_64-linux+-mcpu%3Dznver4',overrides:!(),selection:(endColumn:20,endLineNumber:12,positionColumn:20,positionLineNumber:12,selectionStartColumn:20,selectionStartLineNumber:12,startColumn:20,startLineNumber:12),source:3),l:'5',n:'0',o:'+zig+trunk+(Editor+%233)',t:'0')),header:(),k:52.76342810164579,l:'4',m:100,n:'0',o:'',s:0,t:'0')),l:'2',n:'0',o:'',t:'0')),version:4"></iframe>
                </section>

                <section data-background-gradient="linear-gradient(rgb(114 0 0), rgb(0 11 98))" id="swar-alphanumeric-matcher">
                    <h2>SWAR emulation</h2>
                    <div style="height: 1200px; width: 1200px; position: absolute; scale: 1.5">
                        <pre class="visible" style="width: 1200px; height: 400px; top: 250px; left: 220px;"><code data-line-numbers="|1|2-3|4|6|7|8|10|12-13|14|15|16|18-19|20|21|23|24|25|28-29|31|32|35" data-fragment-index="1" class="tokenize2 hljs language-zig" style="font-family: 'JetBrains Mono', monospace; font-size: 11pt; margin-top: -2em; position: absolute; box-sizing: content-box; width: 100%">export fn maskForAlphanumericAndUnderscoresBetterSWAR(src: [*]align(8) const u8) u64 {
    const ones: u64 = 0x0101010101010101;
    const mask = comptime ones * 0x7F;
    var result: u64 = 0;

    inline for (0..8) |i| {
        const v: u64 = @bitCast(src[i*8 ..][0..8].*);
        const low_7_bits = v & mask;

        const non_underscore = (low_7_bits ^ comptime ones * '_') + mask;

        // alpha check:
        // Upper 3 bits must be 4 or 6. Lower 5 bits must be in 1...26
        const magic_mask = ((v & comptime ones * ~@as(u7, 0x20)) ^ comptime ones * 0x40);
        const non_0x40_or_0x60 = magic_mask + mask;
        const non_alpha = magic_mask + comptime ones * (0x80 - 27);

        // digit check:
        // Upper nibble must be 3. Lower nibble must be in 0...9
        const flipped_0x30 = low_7_bits ^ comptime ones * 0x30;
        const non_digit = flipped_0x30 + comptime ones * (0x80 - 0xA);

        const final = 0x8080808080808080 &
            (~v &
                ((non_digit & non_alpha & non_underscore) ^ non_0x40_or_0x60)
            );

        comptime var mult: u64 = 0;
        comptime for (0..8) |j|  { mult |= @as(u64, 1) << (7 * j); };

        const movmask = (final *% mult) >> 56;
        result |= movmask << (8 * i);
    }

    return result;
}</code></pre>
                    </div>

<div id="swar_demonstration" style="width: 1200px; height: 400px; top: 750px; left: 130px; position: absolute;">

<pre class="fragment bitzies2-garbage" id="bitzies" data-fragment-index="5"></pre>
<pre class="fragment custom" id="bitzies2" data-fragment-index="6"></pre>
<pre class="fragment bitzies2-garbage custom" id="bitzies-mask" data-fragment-index="6" style="transform: translateY(1.2em);"></pre>
<pre class="fragment bitzies2-garbage math-underlined custom" id="swar-ampersand-op" data-fragment-index="5" style="width: 1160px;left: -20px;top: 36px;line-height: 1em;font-family: 'JetBrains Mono';padding-bottom: 10px;">&</pre>

<pre class="fragment custom" id="bitzies-underscore" data-fragment-index="6"></pre>
<pre class="fragment math-underlined custom" id="swar-xor-op" data-fragment-index="6" style="width: 1160px;left: -20px;top: 36px;line-height: 1em;font-family: 'JetBrains Mono';padding-bottom: 10px;">^</pre>
<pre class="fragment custom" id="bitzies-3" data-fragment-index="6"></pre>
<pre class="fragment math-underlined custom" id="swar-plus-op" data-fragment-index="6" style="width: 1160px;left: -20px;top: 36px;line-height: 1em;font-family: 'JetBrains Mono';padding-bottom: 10px;">+</pre>

<pre class="fragment custom" id="bitzies-mask-final" data-fragment-index="8"></pre>
<pre class="fragment custom" id="mult" data-fragment-index="18"></pre>
<pre class="fragment math-underlined custom" id="swar-mul-op" data-fragment-index="18" style="width: 1160px;left: -20px;top: 36px;line-height: 1em;font-family: 'JetBrains Mono';padding-bottom: 10px;">*</pre>

<pre class="fragment custom shifted-swar-str" id="shifted-swar-str-0" data-fragment-index="18"></pre>
<pre class="fragment custom shifted-swar-str" id="shifted-swar-str-1" data-fragment-index="18"></pre>
<pre class="fragment custom shifted-swar-str" id="shifted-swar-str-2" data-fragment-index="18"></pre>
<pre class="fragment custom shifted-swar-str" id="shifted-swar-str-3" data-fragment-index="18"></pre>
<pre class="fragment custom shifted-swar-str" id="shifted-swar-str-4" data-fragment-index="18"></pre>
<pre class="fragment custom shifted-swar-str" id="shifted-swar-str-5" data-fragment-index="18"></pre>
<pre class="fragment custom shifted-swar-str" id="shifted-swar-str-6" data-fragment-index="18"></pre>
<pre class="fragment custom shifted-swar-str" id="shifted-swar-str-7" data-fragment-index="18"></pre>
<pre class="fragment math-underlined custom" id="swar-plus-op2" data-fragment-index="18" style="width: 1160px;left: -20px;top: 295px;line-height: 1em;font-family: 'JetBrains Mono';padding-bottom: 10px;">+</pre>
</div>

<style>
    div#swar_demonstration pre {
        font-family: 'JetBrains Mono', monospace;
        font-size: 20pt;
        position: absolute;
    }

    .squished {
        letter-spacing: -16px;
    }
</style>
<script>
global_animations.push({
    section: "swar-alphanumeric-matcher",
    selector: ".bitzies2-garbage",
    slide_num: 6,
    animation_delay: "0s",
    animation_duration: "1s",
    keyframes: {
        0:   { opacity: 1 },
        100: { opacity: 0 },
    }
}, {
    section: "swar-alphanumeric-matcher",
    selector: "#bitzies2",
    slide_num: 6,
    animation_delay: "0s",
    animation_duration: "0.75s",

    keyframes: {
        0:   { opacity: 0 },
        100: { opacity: 1 },
    }
}, {
    section: "swar-alphanumeric-matcher",
    selector: "#bitzies2",
    slide_num: 7,
    animation_delay: "0s",
    animation_duration: "1s",

    keyframes: {
        0:   { opacity: 1 },
        100: { opacity: 0 },
    }
}, {
    section: "swar-alphanumeric-matcher",
    selector: "#bitzies-mask",
    slide_num: 5,
    animation_delay: "0s",
    animation_duration: "1s",

    keyframes: {
        0:   { opacity: 0, transform: "translateY(0em)" },
        100: { opacity: 1, transform: "translateY(1.2em)" },
    }
}, {
    section: "swar-alphanumeric-matcher",
    selector: "#bitzies-mask.bitzies2-garbage",
    slide_num: 7,
    animation_delay: "1s",
    animation_duration: "1s",

    keyframes: {
        0:   { opacity: 0, transform: "translateY(0em)" },
        100: { opacity: 1, transform: "translateY(1.2em)" },
    }
}, {
    section: "swar-alphanumeric-matcher",
    selector: "#bitzies-mask.bitzies2-garbage",
    slide_num: 8,
    animation_delay: "0s",
    animation_duration: "1s",

    keyframes: {
        0:   { opacity: 1 },
        100: { opacity: 0 },
    }
}, {
    section: "swar-alphanumeric-matcher",
    selector: "#swar-ampersand-op",
    slide_num: 5,
    animation_delay: "1s",
    animation_duration: "1s",
    keyframes: {
        0:   { opacity: 0, transform: "translateX(1.2em)" },
        100: { opacity: 1, transform: "translateX(0em)" },
    }
}, {
    section: "swar-alphanumeric-matcher",
    selector: "#bitzies-underscore",
    slide_num: 6,
    animation_delay: "2s",
    animation_duration: "1s",
    keyframes: {
        0:   { opacity: 0, transform: "translateY(0em)" },
        100: { opacity: 1, transform: "translateY(1.2em)" },
    }
}, {
    section: "swar-alphanumeric-matcher",
    selector: "#bitzies-underscore",
    slide_num: 7,
    animation_delay: "0s",
    animation_duration: "1s",
    keyframes: {
        0:   { opacity: 1 },
        100: { opacity: 0 },
    }
}, {
    section: "swar-alphanumeric-matcher",
    selector: "#swar-xor-op",
    slide_num: 6,
    animation_delay: "3s",
    animation_duration: "1s",
    keyframes: {
        0:   { opacity: 0, transform: "translateX(1.2em)" },
        100: { opacity: 1, transform: "translateX(0em)" },
    }
}, {
    section: "swar-alphanumeric-matcher",
    selector: "#swar-xor-op",
    slide_num: 7,
    animation_delay: "0s",
    animation_duration: "1s",
    keyframes: {
        0:   { opacity: 1 },
        100: { opacity: 0 },
    }
}, {
    section: "swar-alphanumeric-matcher",
    selector: "#bitzies-3",
    slide_num: 7,
    animation_delay: "0s",
    animation_duration: "0.75s",

    keyframes: {
        0:   { opacity: 0 },
        100: { opacity: 1 },
    }
}, {
    section: "swar-alphanumeric-matcher",
    selector: "#bitzies-3",
    slide_num: 8,
    animation_delay: "0s",
    animation_duration: "3s",

    keyframes: {
        0:   { opacity: 1 },
        100: { opacity: 0 },
    }
}, {
    section: "swar-alphanumeric-matcher",
    selector: "#swar-plus-op",
    slide_num: 7,
    animation_delay: "2s",
    animation_duration: "1s",
    keyframes: {
        0:   { opacity: 0, transform: "translateX(1.2em)" },
        100: { opacity: 1, transform: "translateX(0em)" },
    }
}, {
    section: "swar-alphanumeric-matcher",
    selector: "#swar-plus-op",
    slide_num: 8,
    animation_delay: "0s",
    animation_duration: "1s",
    keyframes: {
        0:   { opacity: 1 },
        100: { opacity: 0 },
    }
}, {
    section: "swar-alphanumeric-matcher",
    selector: "#bitzies-mask-final",
    slide_num: 8,
    animation_delay: "0s",
    animation_duration: "2.75s",

    keyframes: {
        0:   { opacity: 0 },
        100: { opacity: 1 },
    }
}, {
    section: "swar-alphanumeric-matcher",
    selector: "#mult",
    slide_num: 18,
    animation_delay: "0s",
    animation_duration: "1s",

    keyframes: {
        0:   { opacity: 0, transform: "translateY(0em)" },
        100: { opacity: 1, transform: "translateY(1.2em)" },
    }
}, {
    section: "swar-alphanumeric-matcher",
    selector: "#swar-mul-op",
    slide_num: 18,
    animation_delay: "2s",
    animation_duration: "1s",
    keyframes: {
        0:   { opacity: 0, transform: "translateX(1.2em)" },
        100: { opacity: 1, transform: "translateX(0em)" },
    }
});

const random_chars = "._______ ._______ ._______ ._______ ._______ ._______ ._______ ._______".replaceAll('_', () => Math.floor(Math.random()*2));
const random_chars2 = (function() {
    let i = 0;
    return "._______ ._______ ._______ ._______ ._______ ._______ ._______ ._______".replaceAll('_',
    () => {
        if (Math.floor(i++ / 7) % 2)
            return '0/';
        return '0';
    });
})();
document.getElementById("bitzies").innerHTML = bitify2((() => { let i = 0; return random_chars.replaceAll('.', () => (i++ % 2 ? '0' : '1')); })());
document.getElementById("bitzies-mask").innerHTML = bitify2("01111111 01111111 01111111 01111111 01111111 01111111 01111111 01111111");
document.getElementById("bitzies2").innerHTML = bitify2(random_chars);
document.getElementById("bitzies-underscore").innerHTML = bitify(new Array(8).fill('_'.charCodeAt().toString(2).padStart(8, '0')).join(" "));
document.getElementById("bitzies-3").innerHTML = bitify2(random_chars2);

const unknown_str = "a....... b....... c....... d....... e....... f....... g....... h.......";
document.getElementById("bitzies-mask-final").innerHTML = bitify2(unknown_str);
document.getElementById("mult").innerHTML = bitify("00000000 00000010 00000100 00001000 00010000 00100000 01000000 10000001");

const despaced = [...unknown_str.matchAll("[01.a-z]{8}")].join('');
function respacify(str) {
    return [...str.matchAll("[01.a-z]{8}")].join(' ');
}

new Array(8).fill(0).map((_, i) => {
    function foo(x) {
        if (i == 2) return x.replace('b.', 'b');
        if (i == 3) return x.replace('c..', 'c');
        if (i == 4) return x.replace('d...', 'd');
        if (i == 5) return x.replace('e....', 'e');
        if (i == 6) return x.replace('f.....', 'f');
        if (i == 7) return x.replace('g......', 'g');
        return x;
    }
    document.getElementById(`shifted-swar-str-${i}`).innerHTML = `<span class="fake_space">${bitify2(foo(respacify(despaced.slice(0, (i+1)*7))))}</span>` + bitify2(respacify(despaced.slice(i * 7)));


    global_animations.push({
        section: "swar-alphanumeric-matcher",
        selector: `#shifted-swar-str-${i}`,
        slide_num: 18,
        animation_delay: `${3}s`,
        animation_duration: `${2 + i / 8}s`,
        keyframes: {
            0:   { opacity: 0, transform: "translateY(0)" },
            40:  { opacity: 1 },
            100: { opacity: 1, transform: `translateY(${1.2 * (i + 2)}em)` },
        }
    })
});

global_animations.push({
    section: "swar-alphanumeric-matcher",
    selector: `.fake_space`,
    slide_num: 18,
    animation_delay: `${5}s`,
    animation_duration: `5s`,
    keyframes: {
        0:   { opacity: 1, "letter-spacing": "0px" },
        50:  { opacity: 0 },
        100: { opacity: 0, "letter-spacing": "-16px" },
    }
}, {
    section: "swar-alphanumeric-matcher",
    selector: `.shifted-swar-str .dotty`,
    slide_num: 18,
    animation_delay: `${5}s`,
    animation_duration: `5s`,
    keyframes: {
        0:   { opacity: 0 },
        100: { opacity: 1 },
    }
},
{
    section: "swar-alphanumeric-matcher",
    selector: "#swar-plus-op2",
    slide_num: 18,
    animation_delay: "9.5s",
    animation_duration: "1s",
    keyframes: {
        0:   { opacity: 0, transform: "translateX(1.2em)" },
        100: { opacity: 1, transform: "translateX(0em)" },
    }
});



// . 1....... 0....... 1....... 0....... 1....... 0....... 1.......

// document.getElementById("bitzies-mask-final").innerHTML = bitify2("0....... 1....... 0....... 1....... 0....... 1....... 0....... 1.......");
// document.getElementById("bitzies-mask-final").innerHTML = bitify2("0....... 1....... 0....... 1....... 0....... 1....... 0....... 1.......");




</script>


                </section>

                <section data-background-gradient="linear-gradient(rgb(114 0 0), rgb(0 11 98))" id="riscv-alpha-asm">
                    <h2>Bitstring generation Emit SWAR</h2>
                    <iframe style="margin-top: 20px;" width="1920px" height="960px" src="https://zig.godbolt.org/e#z:OYLghAFBqd5QCxAYwPYBMCmBRdBLAF1QCcAaPECAMzwBtMA7AQwFtMQByARg9KtQYEAysib0QXACx8BBAKoBnTAAUAHpwAMvAFYgAzKVpMGoAF55gpJfWQE8Ayo3QBhVLQCuLBiABMpJwAyeAyYAHKeAEaYxCCSAGykAA6oCoT2DK4eXr5JKWkCQSHhLFEx8VaYNnYCQgRMxASZnt5%2B1pi26bX1BIVhkdGxCQp1DU3ZrSM9wX0lA/EAlFao7sTI7BxUDADULEwKANYAYiQAgrSJCMae0XjIJwzocg/RCmjEmAoQCqsgWwCkAFYAEIAKkBABExBYGBAABzzLZoBjDLbueGouKSf4AdiBfw0Jy2RMRAhRADV/npwVsAAJk9pEYgQTGkVHwv56PEE4kk5EELYAN3alOp32QgKBGgAdFLMRCpWDOfjCcT3gQVgxlTyeRAaXsIO5UqZMKyaRFCM49gQIELkCKOdS9Z8yaaFIkjNawBwAPpe%2Bb%2B/045xa7VE3X6w14Y2m82NK3h52u91MT0cJh%2BhEc4NUwXtQN/HxxWkRo0m2mxy3DG3CrMO4uJ2luj0QL2mDMBoMh0MJg2lmMW%2BNOiAuxvJ1MnDOU7PU235wv13tRstmgdV21TutDkc0psplscABa7fz2OD3NDWx7kej5dX1q3SebXo0k9rOdnmfnQ%2Bvy4r8fXb6Ovq267qmACcx7zByXInH82LgsqyqYKoyQNFsmw7HsRynOclwMNcxC3PcjzPMQrwkB8QKYAQBDREIADqJwAEpfD8/zAmCAKQrQ0JwgiSIomiCLuJiOIwfiYECfyAgfL8IlYnWGiqBoXAqWpqkaep0GIRokmkvyuwHCKJIsIkdhsFsMkKFsIJbEp2KHNpBISQK9RbO8CjuLQBByaJilObBzm6cEPEhOhJCXtKUronBzh4LFYk6WBElSYKvkKTmK5xlWYoSngIKwlsMoQhKUWwvKIJQUqQXJbpqW0KgADu3rYt6sbWXWAr/POhn7AFSUpfpWwMAI3ruKR5HvMZEANc1rXtex2AmWZeAWVZNlbF6vocJ%2BQKYQc/U1RJAD0x1bGIFxMIiCDtPsIADbpp1bHIiSJNEWx6FsC0sIa/JRFsWIRXEUpbAETXvQCX2ENZP0ov9wRbFwMpSoWD16XymHALc3q9dNNrdUWaCmeZmCWSE1m2QAft%2B2KskpPgaPmAJLUTK1reTG1KZIjOHbV6MoiNDDelzGjeiQwuqHEGjGbsWPIDjWHdXtvW84NGOC96F2XDLTBywrRkFntrMk2THwbRASmwtLAC0Ww%2BNiVXiUdj1nfgWP8sgN3IHdaNPS9b3EMNeARBE9A7L9X2k3oINg4170MMHoek7Df2kwjUVSrVgV86lVA8a9mDoBLejS3Ws0tW10OLctJvrbZSkl6rdVDRrbuEMZed4AXRcN6XPhG6gxOraTdeRaoVtbLbSknI7OnZ2rKI0MwtDGZbGhWxv69b5vBNoxJECU11BZxHvun7xArcWO3x/DaNWtXTfGvjVgZFvJgmbM7fQsi2LxAS1LUFnZ81nkFeezch4WVcoHH63l0qrybnpCBpN%2BCBwtjKGKp5tAJTEuHbynZMoRhZIjTMehszOEvNiDa2hHY4gQtVQKYD%2BYGVQAKXGdZqDBDEDZAskMYEEBIdgDkS0AQn3oRJCSHkvL8linWFgLC2GkKzJeQqtk8AgPnvBOeEjqIanch8KR/V4I7UMJwAEvBvAcC0KQVAnADwWC2AoZYqxSYFj0HoXgPlLE7UWDdJgL9KCLDugCJGmJsSSDAlLbEETYR6FhNIWgnBJC8BYBIDQGhSAWKsTYjgvAFAgHSZ4rQiw4CwCQKzOg0RyCUHKfQGIpgCDEHGvsPgdBaJkUoBETQvBzTMGIAAT04DwUgPT6h9IAPIRG0AyQZvAiZsEEGMhgtABleNIFgCI7hgCWloLQPJ3BeBYF2CYcQqz8DvA6EKPZVjkLtHcLRGZ5BBCVC6YYYOxBRmuCwC8hpq0HlCmIBEFImBwSYCOcAUKoAvGLDzrrBQZI8CYEamMt6Fihn8EECIMQ7ApAyEEIoFQ6hVm6D8EYEwIBzCWB4hEPJkBFioBWqSTg1sxlbCYpUTAexMCHCtJPEYwBqLuTwK8AUmJrahXcKoSeLBkCJHcA6VINAhRjTCbwFh0RCJYBpRARYbQOgOAgE4MY3guD%2BAeL0YopQJC5FSNUDIbhmhWuSDa9I5r%2BgxBNbq21XRRj2uyB69leqGDeqmEUN1VrhjdCNeGyYrrZjup1U4tY%2BhFgJI4GYjJLzslbApVsBpTTLy4EIBFVxeh5geK6f6Ugvj/HatIHdSQsIpR6ABD4AEGg9BgQZnoLgcQuBhJMRwJJpAUmqXSZk1VnBcn5NIIU7xA6fDJNSWOzNk6Z0VsWP81IDhJBAA%3D%3D"></iframe>
                </section>


                <!-- <section data-background-gradient="linear-gradient(rgb(114 0 0), rgb(0 11 98))" id="" >

                    <div style="height: 1200px; width: 1200px; position: absolute; scale: 2;">
                    <pre style="width: 900px; height: 120px; top: 420px; left: 220px;"><code id="tokenize-naive" data-line-numbers="1-39|35|36" data-fragment-index="1" class="hljs language-zig" style="font-family: 'JetBrains Mono', monospace; font-size: 11pt; margin-top: -2em; position: absolute"></code></pre></div>
                </section> -->

                <section data-background-gradient="linear-gradient(rgb(114 0 0), rgb(0 11 98))" id="mask-underscores-on-arm">
                    <h2>Interleaved Movemask</h2>
                    <div style="height: 1200px; width: 1200px; position: absolute; scale: 1.5">
                        <pre class="visible" style="width: 1200px; top: 250px; left: 220px;"><code data-line-numbers="|1|2|4|5|6|7|8|9-10|12-15|17-18|19|20|22|23|24|25" data-fragment-index="1" class="tokenize2 hljs language-zig" style="font-family: 'JetBrains Mono', monospace; font-size: 11pt; margin-top: -3em; position: absolute; box-sizing: content-box; width: 100%; height: 250px">fn maskForUnderscoresBetterArm(src: [*]const u8) u64 {
    const indices = std.simd.iota(u6, 16) * @splat(4);

    var vec0 = @shuffle(u8, src[0..64].*, undefined, indices + @splat(0));
    var vec1 = @shuffle(u8, src[0..64].*, undefined, indices + @splat(1));
    var vec2 = @shuffle(u8, src[0..64].*, undefined, indices + @splat(2));
    var vec3 = @shuffle(u8, src[0..64].*, undefined, indices + @splat(3));

    const false_vec = std.mem.zeroes(@Vector(16, u8));
    const true_vec = ~false_vec;

    vec0 = @select(u8, vec0 == @as(@Vector(16, u8), @splat('_')), true_vec, false_vec);
    vec1 = @select(u8, vec1 == @as(@Vector(16, u8), @splat('_')), true_vec, false_vec);
    vec2 = @select(u8, vec2 == @as(@Vector(16, u8), @splat('_')), true_vec, false_vec);
    vec3 = @select(u8, vec3 == @as(@Vector(16, u8), @splat('_')), true_vec, false_vec);

    const t0 = (vec1 & @splat(0b10000000) | (vec0 >> @splat(1));
    const t1 = (vec3 & @splat(0b10000000) | (vec2 >> @splat(1));
    const t2 = (  t1 & @splat(0b11000000) | (t0 >> @splat(2));
    const t3 = (  t2 & @splat(0b11110000) | (t2 >> @splat(4));

    var t4: @Vector(8, u16) = @bitCast(t3);
    t4 >>= @splat(4);
    const t5: @Vector(16, u8) = @bitCast(t4);
    return @bitCast(@shuffle(u8, t5, undefined, [_]i32{ 0, 2, 4, 6, 8, 10, 12, 14 }));
}</code></pre>

<div id="interleaved-div">
<pre id="src-text" class="fragment var-name" data-fragment-index="1">src</pre>
<script>
{
    const str = [..."abcdefghijklmnopqrstuvwxyzABCDEFGHIJKLMNOPQRSTUVWXYZ0123456789!#"];
    const result = [];
    for (let i = 0; i < 64; ) {
        for (let j = 0; j < 4; j++) {
            result.push(`<span class="vec-underline-${j}">${str[i++]}</span>`);
        }
    }
    const src_text = document.getElementById("src-text");
    src_text.innerHTML = 'src: ' + result.join('');

    const vec0 = [];
    const vec1 = [];
    const vec2 = [];
    const vec3 = [];

    for (let i = 0; i < 64; ) {
        for (const vec of [vec0, vec1, vec2, vec3]) {
            vec.push(str[i++]);
        }
    }

    const continuous = true;
    const skip_auto_prev_state = true;

    const anim_len = "2s";
    const anim2_len = "2s";

    [vec0, vec1, vec2, vec3].map((vec, j) => {
        src_text.insertAdjacentHTML("afterend", vec.map((e, i) => {
            global_animations.push(
            {
                section: "mask-underscores-on-arm",
                selector: `#letter-move-${i}-${j}`,
                slide_num: j + 2,
                animation_delay: "0.15s",
                animation_duration: "2s",
                continuous,
                keyframes: {
                    0:   { transform: "translate(0, 0)", opacity: 0 },
                    50:   { opacity: 1 },
                    100: { transform: `translate(0px, ${25*(j + 1)}px)`, opacity: 1 },
                }
            },

            {
                section: "mask-underscores-on-arm",
                selector: `#letter-move-${i}-${j}`,
                slide_num: j + 2,
                animation_delay: "2.5s",
                animation_duration: "2s",
                continuous,
                skip_auto_prev_state,
                keyframes: {
                    0:   { transform: `translate(0px, ${25*(j + 1)}px)`, opacity: 1 },
                    100: { transform: `translate(${-12*j}px, ${25*(j + 1)}px)`, opacity: 1 },
                }
            },
            {
                section: "mask-underscores-on-arm",
                selector: `#letter-move-${i}-${j}`,
                slide_num: 6,
                animation_delay: "0s",
                animation_duration: "3s",
                skip_auto_prev_state: true,
                continuous,
                keyframes: {
                    0: { transform: `translate(${-12*j}px, ${25*(j + 1)}px)`, opacity: 1 },
                    100: { transform: `translate(${1160-60+30-125.425*i-12*j}px, ${25*(j + 1)}px)`, opacity: 1 },
                }
            },
            {
                section: "mask-underscores-on-arm",
                selector: `#letter-move-${i}-${j}`,
                slide_num: 8,
                animation_delay: "0s",
                animation_duration: "4s",
                continuous,
                skip_auto_prev_state,
                keyframes: {
                    0:  { transform: `translate(${1160-60+30-125.425*i-12*j}px, ${25*(j + 1)}px)`, opacity: 1 },
                    50: { opacity: 1 },
                    100: { transform: `translate(${1160-60+30-125.425*i-12*j}px, ${25*(j + 1)}px)`, opacity: 0 }
                }
            }
        );
            return `<pre id=letter-move-${i}-${j} class="fragment var-name custom" data-fragment-index="${j + 2}">${' '.repeat(str.indexOf(e) + 5) + e}</pre>`
        }).join(''));

        src_text.insertAdjacentHTML("afterend", vec.map((e, i) => {
            global_animations.push(
                {
                section: "mask-underscores-on-arm",
                selector: `#letter-move-${i}-${j}-2`,
                slide_num: 8,
                animation_delay: "0s",
                animation_duration: "3s",
                // skip_auto_prev_state: true,
                // continuous,
                keyframes: {
                    0: { transform: `translate(${1160-60+30-111.8*i-12*j+18+3.2*j+60+32.5*i+3*j}px, ${25*(j + 1)+3}px)`, opacity: 0, "letter-spacing": "-9.5px" },
                    45: { opacity: 0 },
                    90: { opacity: 1 },
                    100: { transform: `translate(${1160-60+30-111.8*i-12*j+18+3.2*j-30}px, ${25*(j + 1)+3}px)`, opacity: 1, "letter-spacing": "-1px" },
                }
            },

            {
                section: "mask-underscores-on-arm",
                selector: `#letter-move-${i}-${j}-2`,
                slide_num: 9,
                animation_delay: `${+anim_len.slice(0, -1) * 7 / 5}s`,
                animation_duration: anim_len,
                skip_auto_prev_state,
                // continuous,
                keyframes: {
                      0: { transform: `translate(${1160-60+30-111.8*i-12*j+18+3.2*j-30}px, ${25*(j + 1)+3}px)`, opacity: 1, "letter-spacing": "-1px" },
                    100: { transform: `translate(${1160-60+30-111.8*i-12*j+18+3.2*j-30}px, ${25*(Math.floor(j / 2) + 1.5)+3}px)`, opacity: 1, "letter-spacing": "-1px" },
                }
            },

            {
                section: "mask-underscores-on-arm",
                selector: `#letter-move-${i}-${j}-2`,
                slide_num: 10,
                animation_delay: `${+anim_len.slice(0, -1) * 7 / 5}s`,
                animation_duration: anim_len,
                skip_auto_prev_state,
                // continuous,
                keyframes: {
                      0: { transform: `translate(${1160-60+30-111.8*i-12*j+18+3.2*j-30}px, ${25*(Math.floor(j / 2) + 1.5)+3}px)`, opacity: 1, "letter-spacing": "-1px" },
                    100: { transform: `translate(${1160-60+30-111.8*i-12*j+18+3.2*j-30}px, ${25*(2)+3}px)`, opacity: 1, "letter-spacing": "-1px" },
                }
            },


            {
                section: "mask-underscores-on-arm",
                selector: `#letter-move-${i}-${j}-2`,
                slide_num: 10,
                animation_delay: `${+anim_len.slice(0, -1) * 7 / 5 + +anim_len.slice(0, -1)}s`,
                animation_duration: '0s',
                skip_auto_prev_state,
                // continuous,
                keyframes: {
                    0: { opacity: 1 },
                    100: { opacity: 0 },
                }
            },
        );
            return `<pre id="letter-move-${i}-${j}-2" class="fragment var-name custom smaller t2-garbage" data-fragment-index="7">${' '.repeat(str.indexOf(e) + 5)}<span class="collapsed-under">${j >= 2 ? '' : j % 2 ? '<span class="grp1-6">  </span>' : '<span class="grp1-6">..</span>'}${j % 2 ? e : '<span class="grp1-2">.</span>'}${j % 2 ? new Array(14).fill(0).map((_, k) => `<span class="grp1-${k % 2 ? '3' : '4'}">${k % 2 ? e : '.'}</span>`).join('') : e.repeat(j === 2 ? 1 : j >= 2 || j % 2 ? 7 : 5)}${j === 2 ? new Array(12).fill(0).map((_, k) => `<span class="grp1-${k % 2 ? '7' : '8'}">${k % 2 ? e : '.'}</span>`).join('')  : ''}${j >= 2 ? '' : j % 2 ? '' : `<span class="grp1-5">${e}${e}</span>`}${j % 2 ? '' : `<span class="grp1">${e}</span>`}</span></pre>`
        }).join(''));
    });

    {
    const str = [..."abcdefghijklmnopqrstuvwxyzABCDEFGHIJKLMNOPQRSTUVWXYZ0123456789!#"];

    const vec0 = [];
    const vec1 = [];
    const vec2 = [];
    const vec3 = [];

    // LD4
    for (let i = 0; i < 64; ) {
        for (const vec of [vec0, vec1, vec2, vec3]) {
            vec.push(str[i++].repeat(8));
        }
    }

    for (const vec of [vec0, vec1, vec2, vec3]) {
        vec.reverse();
    }

    // console.log({vec0, vec1, vec2, vec3});

    function sri(a, b, n) {
        return a.map((_, i) => a[i].slice(0, n) + b[i].slice(0, -n));
    }

    // @shuffle(u8, @as(Chunk, @bitCast(a >> @splat(c))), undefined, std.simd.iota(i32, @sizeOf(Chunk) / 2) << @splat(1));
    function shrn(a, c) {
        let r = [];
        for (let i = 0; i < 16; ) {
            r.push(a[i++] + a[i++]);
        }
        // console.log({r});
        const r2 = r.map(e => '.'.repeat(c) + e.slice(0, -c));
        // console.log({r2});
        return r2
            .map(e => e.slice(-8));
    }

    const t0 = sri(vec1, vec0, 1);
    const t1 = sri(vec3, vec2, 1);
    // console.log({t0, t1});
    const t2 = sri(t1, t0, 2);
    // console.log({t2});
    const t3 = sri(t2, t2, 4);
    // console.log({t3});
    const t4 = shrn(t3, 4);
    // console.log('ekki',{t4})
    // console.log([...t4.flat().join('')].reverse().join(''));
    // console.log('t3: ', t2);

    function joinSpaced(arr) {
        let result = '';
        for (let i = 0; i < arr.length - 1; i++) {
            result += arr[i];
            result += (i % 2) ? '<span class="expanded-space"> </span>' : '<span class="collapsed-space"> </span>';
        }
        result += arr[arr.length - 1];


        return result;
    }


    src_text.insertAdjacentHTML("afterend", `<pre id="letter-t2-1" class="fragment var-name custom smallest letter-t2-3-garbage" data-fragment-index="10" style="opacity: 0;top: 53px">${joinSpaced(t2.map((e, m) => `<span class="letter-t2-dots">....</span>${m >= 20 && m % 2 ? new Array(8).fill(0).map((_, i) => i % 2 ? '<span class="expandable-space"> </span>' : `<span class="compressable-char">${e[Math.floor(i / 2)]}</span>`).join('') : e.slice(0, 4)}<span class="letter-t2-chars">${e.slice(4)}</span>`))}</pre>`);
    src_text.insertAdjacentHTML("afterend", `<pre id="letter-t2-2" class="fragment var-name custom smallest letter-t2-3-garbage" data-fragment-index="10" style="opacity: 0;top: 53px">${joinSpaced(t2.map(e => e.slice(0, 4) + new Array(8).fill(0).map((_, l) => l % 2 ? `<span class="letter-t2-chars">${e[4 + Math.floor(l / 2)]}</span>` : '<span class="letter-t2-dots">.</span>').join('')))}</pre>`);
    src_text.insertAdjacentHTML("afterend", `<pre id="letter-t2-3" class="fragment var-name custom smaller" data-fragment-index="12" style="opacity: 0;top: 53px">${new Array(8).fill(0).map((_, i) => '<span class="letter-t3-dots">....</span>' + t3[i*2].slice(0, -4) + '<span class="expandable-space-3"> </span>' + t3[i*2].slice(-4) + t3[i*2+1].slice(0, -4) + `<span class="collapsable-char-2">${t3[i*2+1].slice(-4)}</span>`).join('<span class="expanded-space"> </span>')}</pre>`);

    src_text.insertAdjacentHTML("afterend", `<pre id="letter-t2-4" class="fragment var-name custom smaller" data-fragment-index="15" style="opacity: 0;top: 53px">${'<span class="mepp">         </span>' + t4.join('<span class="mepp">          </span>')}</pre>`);

    }

    global_animations.push(
        {
            section: "mask-underscores-on-arm",
            selector: `.grp1`,
            slide_num: 9,
            animation_delay: "0s",
            animation_duration: anim_len,
            // continuous,
            keyframes: {
                0:  { opacity: 1 },
                30: { opacity: 1 },
                100: { opacity: 0 }
            }
        },

        {
            section: "mask-underscores-on-arm",
            selector: `.grp1-2`,
            slide_num: 9,
            animation_delay: "0s",
            animation_duration: anim_len,
            // continuous,
            keyframes: {
                0:  { opacity: 0, "letter-spacing": "-9.5px" },
                100: { opacity: 1, "letter-spacing": "-1px"}
            }
        },

        {
            section: "mask-underscores-on-arm",
            selector: `.grp1-2`,
            slide_num: 9,
            animation_delay: `${+anim_len.slice(0, -1) * 7 / 5}s`,
            animation_duration: anim_len,
            // continuous,
            skip_auto_prev_state,
            keyframes: {
                  0: { opacity: 1, "letter-spacing": "-1px" },
                100:  { opacity: 0, "letter-spacing": "-1px" },
            }
        },

        {
            section: "mask-underscores-on-arm",
            selector: `.grp1-3`,
            slide_num: 9,
            animation_delay: "0s",
            animation_duration: anim_len,
            // continuous,
            keyframes: {
                0: { opacity: 1, "letter-spacing": "-1px"},
                100:  { opacity: 0, "letter-spacing": "-9.5px" },
            }
        },

        {
            section: "mask-underscores-on-arm",
            selector: `.grp1-4`,
            slide_num: 9,
            animation_delay: "0s",
            animation_duration: anim_len,
            // continuous,
            keyframes: {
                0:  { opacity: 0, "letter-spacing": "-9.5px" },
                100: { opacity: 1, "letter-spacing": "-1px" },
            }
        },

        {
            section: "mask-underscores-on-arm",
            selector: `.grp1-4`,
            slide_num: 9,
            animation_delay: `${+anim_len.slice(0, -1) * 7 / 5}s`,
            animation_duration: anim_len,
            skip_auto_prev_state,
            // continuous,
            keyframes: {
                  0: { opacity: 1, "letter-spacing": "-1px" },
                100: { opacity: 0, "letter-spacing": "-1px" },
            }
        },

        {
            section: "mask-underscores-on-arm",
            selector: `.grp1-5`,
            slide_num: 10,
            animation_delay: "0s",
            animation_duration: anim2_len,
            skip_auto_prev_state,
            // continuous,
            keyframes: {
                  0: { opacity: 1, "letter-spacing": "-1px" },
                100: { opacity: 0, "letter-spacing": "-9.5px" },
            }
        },

        {
            section: "mask-underscores-on-arm",
            selector: `.grp1-6`,
            slide_num: 10,
            animation_delay: "0s",
            animation_duration: anim2_len,
            // continuous,
            keyframes: {
                  0: { opacity: 0, "letter-spacing": "-9.5px" },
                100: { opacity: 1, "letter-spacing": "-1px" },
            }
        },

        {
            section: "mask-underscores-on-arm",
            selector: `.grp1-6`,
            slide_num: 10,
            animation_delay: `${+anim_len.slice(0, -1) * 7 / 5}s`,
            animation_duration: anim_len,
            skip_auto_prev_state,
            // continuous,
            keyframes: {
                  0: { opacity: 1, "letter-spacing": "-1px" },
                100: { opacity: 0, "letter-spacing": "-1px" },
            }
        },

        {
            section: "mask-underscores-on-arm",
            selector: `.grp1-7`,
            slide_num: 10,
            animation_delay: "0s",
            animation_duration: anim2_len,
            // continuous,
            keyframes: {
                  0: { opacity: 1, "letter-spacing": "-1px" },
                100: { opacity: 0, "letter-spacing": "-9.5px" },
            }
        },

        {
            section: "mask-underscores-on-arm",
            selector: `.grp1-8`,
            slide_num: 10,
            animation_delay: "0s",
            animation_duration: anim2_len,
            // continuous,
            keyframes: {
                  0: { opacity: 0, "letter-spacing": "-9.5px" },
                100: { opacity: 1, "letter-spacing": "-1px" },
            }
        },

        {
            section: "mask-underscores-on-arm",
            selector: `.grp1-8`,
            slide_num: 10,
            animation_delay: `${+anim_len.slice(0, -1) * 7 / 5}s`,
            animation_duration: anim_len,
            skip_auto_prev_state,
            // continuous,
            keyframes: {
                  0: { opacity: 1, "letter-spacing": "-1px" },
                100: { opacity: 0, "letter-spacing": "-1px" },
            }
        },

        {
            section: "mask-underscores-on-arm",
            selector: `#letter-t2-1`,
            slide_num: 10,
            animation_delay: `${+anim_len.slice(0, -1) * 7 / 5 + +anim_len.slice(0, -1)}s`,
            animation_duration: '0s',
            keyframes: {
                0: { opacity: 0 },
                100: { opacity: 1 },
            }
        },

        {
            section: "mask-underscores-on-arm",
            selector: `#letter-t2-1`,
            slide_num: 11,
            animation_delay: '0s',
            animation_duration: anim_len,
            continuous,
            keyframes: {
                0: { opacity: 1 },
                100: { opacity: 1, transform: 'translateY(-12.5px)' },
            }
        },

        {
            section: "mask-underscores-on-arm",
            selector: `#letter-t2-1`,
            slide_num: 11,
            animation_delay: `${2 * +anim_len.slice(0, -1)}s`,
            animation_duration: anim_len,
            skip_auto_prev_state,
            continuous,
            keyframes: {
                0: { opacity: 1, transform: 'translateY(-12.5px)' },
                100: { opacity: 1, transform: 'translateY(0px)' },
            }
        },

        {
            section: "mask-underscores-on-arm",
            selector: `#letter-t2-2`,
            slide_num: 11,
            animation_delay: '0s',
            animation_duration: anim_len,
            continuous,
            keyframes: {
                0: { opacity: 0 },
                100: { opacity: 1, transform: 'translateY(12.5px)' },
            }
        },

        {
            section: "mask-underscores-on-arm",
            selector: `#letter-t2-2`,
            slide_num: 11,
            animation_delay: `${2 * +anim_len.slice(0, -1)}s`,
            animation_duration: anim_len,
            skip_auto_prev_state,
            continuous,
            keyframes: {
                0: { opacity: 1, transform: 'translateY(12.5px)' },
                100: { opacity: 1, transform: 'translateY(0px)' },
            }
        },

        {
            section: "mask-underscores-on-arm",
            selector: `.letter-t2-dots`,
            slide_num: 11,
            animation_delay: anim_len,
            animation_duration: anim_len,
            // continuous,
            keyframes: {
                0:  { opacity: 0, "letter-spacing": "-9.5px" },
                100: { opacity: 1, "letter-spacing": "-1px"}
            }
        },

        {
            section: "mask-underscores-on-arm",
            selector: `.letter-t2-dots`,
            slide_num: 11,
            animation_delay: `${2 * +anim_len.slice(0, -1)}s`,
            animation_duration: anim_len,
            skip_auto_prev_state,
            continuous,
            keyframes: {
                0: { opacity: 1 },
                100: { opacity: 0 },
            }
        },

        {
            section: "mask-underscores-on-arm",
            selector: `.letter-t2-chars`,
            slide_num: 11,
            animation_delay: anim_len,
            animation_duration: anim_len,
            // continuous,
            keyframes: {
                  0: { opacity: 1, "letter-spacing": "-1px"},
                100: { opacity: 0, "letter-spacing": "-9.5px" },
            }
        },

        {
            section: "mask-underscores-on-arm",
            selector: `.collapsed-space`,
            slide_num: 12,
            animation_delay: "0.15s",
            animation_duration: `${2 * anim_len.slice(0, -1)}s`,
            continuous,
            // skip_auto_prev_state,
            keyframes: {
                  0: { opacity: 1, "letter-spacing": "-1px"},
                100: { opacity: 1, "letter-spacing": "-9.5px" },
            }
        },

        {
            section: "mask-underscores-on-arm",
            selector: `.expanded-space`,
            slide_num: 12,
            animation_delay: "0.15s",
            animation_duration: `${2 * anim_len.slice(0, -1)}s`,
            continuous,
            // skip_auto_prev_state,
            keyframes: {
                  0: { opacity: 1, "letter-spacing": "-1px"},
                100: { opacity: 1, "letter-spacing": "11px" },
            }
        },

        {
            section: "mask-underscores-on-arm",
            selector: `.expanded-space`,
            slide_num: 14,
            animation_delay: `0s`,
            animation_duration: `${2 * anim_len.slice(0, -1)}s`,
            continuous,
            skip_auto_prev_state,
            keyframes: {
                  0: { opacity: 1, "letter-spacing": "11px"},
                100: { opacity: 1, "letter-spacing": "-1px" },
            }
        },

        // expandable-space
        // compressable-char

        {
            section: "mask-underscores-on-arm",
            selector: `.letter-t2-3-garbage`,
            slide_num: 13,
            animation_delay: `0s`,
            animation_duration: `0s`,
            continuous,
            skip_auto_prev_state,
            keyframes: {
                  0: { opacity: 1 },
                100: { opacity: 0 },
            }
        },

        {
            section: "mask-underscores-on-arm",
            selector: `#letter-t2-3`,
            slide_num: 13,
            animation_delay: `0s`,
            animation_duration: `0s`,
            continuous,
            keyframes: {
                  0: { opacity: 0 },
                100: { opacity: 1 },
            }
        },

        {
            section: "mask-underscores-on-arm",
            selector: `#letter-t2-3`,
            slide_num: 15,
            animation_delay: `0s`,
            animation_duration: `${2 * anim_len.slice(0, -1)}s`,
            continuous,
            skip_auto_prev_state,
            keyframes: {
                  0: { opacity: 1 },
                100: { opacity: 0 },
            }
        },

        {
            section: "mask-underscores-on-arm",
            selector: `.letter-t3-dots`,
            slide_num: 13,
            animation_delay: `1s`,
            animation_duration: `${2 * anim_len.slice(0, -1)}s`,
            continuous,
            keyframes: {
                  0: { opacity: 0, "letter-spacing": "-9.5px"},
                100: { opacity: 1, "letter-spacing": "-1.1px" },
            }
        },

        {
            section: "mask-underscores-on-arm",
            selector: `.collapsable-char-2`,
            slide_num: 13,
            animation_delay: `1s`,
            animation_duration: `${2 * anim_len.slice(0, -1)}s`,
            continuous,
            keyframes: {
                  0: { opacity: 1, "letter-spacing": "-1.1px"},
                100: { opacity: 0, "letter-spacing": "-9.5px" },
            }
        },

        {
            section: "mask-underscores-on-arm",
            selector: `.expandable-space-3`,
            slide_num: 14,
            animation_delay: `0s`,
            animation_duration: `${2 * anim_len.slice(0, -1)}s`,
            continuous,
            keyframes: {
                  0: { opacity: 1, "letter-spacing": "-9.5px"},
                100: { opacity: 1, "letter-spacing": "-1.1px" },
            }
        },

        {
            section: "mask-underscores-on-arm",
            selector: `#letter-t2-4`,
            slide_num: 15,
            animation_delay: `0s`,
            animation_duration: `${2 * anim_len.slice(0, -1)}s`,
            continuous,
            keyframes: {
                  0: { opacity: 0 },
                75: { opacity: 1 },
                100: { opacity: 1 },
            }
        },

        {
            section: "mask-underscores-on-arm",
            selector: `.mepp`,
            slide_num: 15,
            animation_delay: `${1 + 1.5 * anim_len.slice(0, -1)}s`,
            animation_duration: `${2 * anim_len.slice(0, -1)}s`,
            continuous,
            keyframes: {
                  0: { opacity: 0, "letter-spacing": "-1px" },
                100: { opacity: 1, "letter-spacing": "-9.5px" },
            }
        },
    );
}
</script>

<!-- <pre id="vec0-underscore-mask" class="fragment var-name" style="transform: translateY(1.75em); letter-spacing: -1px; font-size: 16px;" data-fragment-index="3"><span class="invis">8888888</span>8 <span class="invis">4444444</span>4 <span class="invis">0000000</span>0 <span class="invis">WWWWWWW</span>W <span class="invis">SSSSSSS</span>S <span class="invis">OOOOOOO</span>O <span class="invis">KKKKKKK</span>K <span class="invis">GGGGGGG</span>G <span class="invis">CCCCCCC</span>C <span class="invis">yyyyyyy</span>y <span class="invis">uuuuuuu</span>u <span class="invis">qqqqqqq</span>q <span class="invis">mmmmmmm</span>m <span class="invis">iiiiiii</span>i <span class="invis">eeeeeee</span>e <span class="invis">aaaaaaa</span>a</pre> -->

<pre class="fragment fade-in-then-out var-name" data-fragment-index="2" style="font-size: 16px; transform: translate(700px, -252px);">{0,4, 8,12,16,20,24,28,32,36,40,44,48,52,56,60}</pre>
<pre class="fragment fade-in-then-out var-name" data-fragment-index="3" style="font-size: 16px; transform: translate(700px, -216px);">{0,4, 8,12,16,20,24,28,32,36,40,44,48,52,56,60}</pre>
<pre class="fragment fade-in-then-out var-name" data-fragment-index="4" style="font-size: 16px; transform: translate(700px, calc(-197.5px));">{1,5, 9,13,17,21,25,29,33,37,41,45,49,53,57,61}</pre>
<pre class="fragment fade-in-then-out var-name" data-fragment-index="5" style="font-size: 16px; transform: translate(700px, calc(-179px));">{2,6,10,14,18,22,26,30,34,38,42,46,50,54,58,62}</pre>
<pre class="fragment fade-in-then-out var-name" data-fragment-index="6" style="font-size: 16px; transform: translate(700px, calc(-161px));">{3,7,11,15,19,23,27,31,35,39,43,47,51,55,59,63}</pre>
</div>

<style>
    section#mask-underscores-on-arm div#interleaved-div pre {
        font-size: 20px;
        position: absolute
    }

    section#mask-underscores-on-arm div#interleaved-div pre.smaller {
        letter-spacing: -1px; font-size: 16px;
    }

    section#mask-underscores-on-arm div#interleaved-div pre.smallest {
        letter-spacing: -1.1px; font-size: 16px;
    }

    section#mask-underscores-on-arm[data-fragment="2"] .vec-underline-0,
    section#mask-underscores-on-arm[data-fragment="3"] .vec-underline-1,
    section#mask-underscores-on-arm[data-fragment="4"] .vec-underline-2,
    section#mask-underscores-on-arm[data-fragment="5"] .vec-underline-3 {
        text-decoration: underline;
        text-underline-offset: 4px;
    }

    #interleaved-div {
        position: absolute;
        top: 482px;
        left: 220px;
    }

    #vec0-underscore-mask > .invis {
        opacity: 1;
    }
</style>
                    </div>

                </section>

                <section data-background-gradient="linear-gradient(rgb(114 0 0), rgb(0 11 98))" id="mask-underscores-on-arm-asm">
                    <h2>Interleaved Movemask Emit</h2>
                    <iframe style="margin-top: 20px;" width="1920px" height="960px" src="https://zig.godbolt.org/e#z:OYLghAFBqd5QCxAYwPYBMCmBRdBLAF1QCcAaPECAMzwBtMA7AQwFtMQByARg9KtQYEAysib0QXAMx8BBAKoBnTAAUAHpwAMvAFYhptJg1AAvPMFJL6yAngGVG6AMKpaAVxYMJpBwBk8DTAA5dwAjTGIQABYATlIAB1QFQlsGZzcPLwSkmwE/AOCWMIiYi0wrHIYhAiZiAjT3Ty5S8pSqmoI8oNDwqNiFatr6jKb%2B9s6Cot6ASgtUV2Jkdg40Bn6Aan70NYBSSQARNYABPBYE2ohtgCZLzavLqd2AIW2NAEEV9ZDXOhsGHf2jiczgQLtcvj9/HcHpJnm8PgQ1o4EK4GABrf4HQ4ANUw1hIEEOSWMmAA8lQIK4iZgpmsAFRrS6kNauAAc0NhrxeryofxYTAUqIAYiRXrQ4ghDO5wnhkK8GOg5PLwgo0MRMAoIAoFiAdgBWR607a6vbw5ls5lUnYAdg5azta1NWIxRxxeOIBJChCEeGJZIpVJmZvZXPtDoE6wAbrjnVrkEbHhoAHSJw6e4Q%2B0nkykZh7GxOGmEh%2B1qgjzBhF0N2gn8/0ZpmpwiOfkgqPIDG7TE1rH1hRxAwgsAcAD6g6mY7H1scFcr1Y12eJ9bTTf6s4g3aOvf7EEHTFHNN2U4BrYnVwAbEca/PMIvG82IK3/ofOxr14S%2B0wBxxjHvx5Pp6HVyvG86jvQ4ux7d9P1ePdHw7NZj33S5zzAucqWA5cW2jA84JQtcIK3QcAC0fxPK0pzeSt7UAtCjiXUDwI3SDtw4DQYOwo9cRPJCL1QutaNvFcH3Y588MYgiOGiEjgzebYrT2LkuUwVRgTWHk1j5AVhWIUVxUlNhiBlOUFSVYgVRIdVHkwAgCHCTVtT1A0jRNcMEVZGlNkTNhqkTABJQQIETFEkmAAJ0B7DM/SRFFUSmWlIn3G1p1NAhiFcTAhyEgFcKitF8I/CANFUQVBTHJ4kpc1SxCUDKsKymsctRPKQUKjQNFKwsKPtCMajWNUFFcWgCAUHV40iJyGudFEsBoUKypkzq7X8Wh/EwVSSDWUFTz6gahqZJNEwSxxaQUWhUAIJk8FkxxrVtSiw1WBFMsxBRkSoKh6ApFkmVjeN9sJCLyQa2KxrzWkmSmzAZswMKNo8pIWHQRNbGqClT3C31AeRNET0kQ9rrfLd7kQx4eIJV0iHdf6MYgIHwdPQMCfyvBxzm147o2U6CHzZ17X/O6CUsXEQVZJknpw%2BqscasT8sHEcODHJkUrSmrkCZKgqvShDJx2Bb2Y2wkyiFz76wl6KmuY3d5f3XG4NbRXUs13E1Y1lXEOQwXrGN%2BDaqfUmGvNwdvyt%2B3lbtyraGqrWrr5yiBcNz2Rb9yWA44aCrdgjjVbWJXHaz9WI9zt2N3j4Wvu9tthKTs3pc/Yjg%2Bzh2VedgvXcOmOZwN8ovey5Oa%2BY1j08rsOc6b8PI84nZuM7o3E8y32e%2BrxnP0k%2BuR7D/Px%2BQdrbrtWT5Pmtniysst4JYVAIw01EAEch1ZCBtsGhRpM5OSFLeNSL/Py%2Bb7v5BJeGhyIM9hAw2AQRGXkmC%2BX8oFVYZhQro0zDTSWNJ6TxRuuVB62cNDOgjFqPAN8GC3xZBAP%2B0UFDxi4E5JkpC0TkP1BoKhawuDP1DMlLgOC8EEKISQ/%2B8ZJCMJoaiOhjxLiMOYazVhFUCCXA4QZLhd8CBNCwUye4Ej7TJUkLI/BQ5CEKMZNnfR8U1F2mSpEDhCBiCEN0VwU8HoBIggIJIQMRiOqHztCWE%2BDYQIrgIC4jke837vAqgACVeEIIcrwABKABZIcgRsAkkCDGAA7oQP%2BG1wSDX8ImZAcRXCJhqH/BKO81gFMKQgU8kQhySH0WUhYFSqlhCZHUv%2BlT2ySGwKAxGAAVGowArItIaYmKgmAPzzEwEIKywSayZN%2BDkvJwzRmlj6s0gIAgZjTgKcQFgzSahsBCM0ggyJCiHOOWEEI7TOkeV6cQfpXM9mLLGWqSZBBpkalmdk3J%2BSRlPPVKszA6zSDTjKEoS5Y9rwKVfq4rkH9OE6O4UwHU/s1ghCRb3NApwbBsDWJ4IMiJJboN1gAeiJWsHwPgsTRMqnQBQ2dUAOkMAIGUYgMxrDELQNYSlFhxAREc1aBh1j%2BFGAwRYaxUBUGzggPAtKqAomsCkNY6A0p0rWEtfw/hzCSvCJDcyaxkmrUpKtQwqrBAGVgW2ZJCBGCqoIIOWlTBup0CYCEeg04PGWNVRK7cYBQnhKibE%2BJiSHi6wAkwSeyFTa5T7oBMuhU3rW2wLsTpEAWRrAALQ4utnjDaqaM0MHHKRa6EALlJqTaTbEQt8RU0QbTZkTjzb5tKrrEFq0FCpIIOkkhqBMUnFWh8hg8z8nlOKe3QZlTqm1KYOU8dTTSlTvqW0jsZb%2BipWsIStxeslI2Q9WpQ4dxaC0AvmOyIiY1kDtwQZO4SDq7ItcDUmkDVjGVj3imfdh6WDHtPQC89eCr1MCZAczNQKQ32i2Tsud2zMCAcTEc0Ipzuglv2MupWa7ZIlPZiStYewBCDgRPydE2LLUAE9JXSpNSlIVMpVW0oUPS/VeBiCIzWAgaycRhokuAIQZEIQcndqJQei%2B/H31priMQVA2ghZEulf1dURKWQsmuFaK4khpNpQxWwQQabLgaEiKeU81xohWn4SByiW7wh/F3W%2Bo9Dyz2JlwVKqgvxyHXGvVG5FIDH2uPZi%2Bvd1wBMfps9%2BuzL08COaFX%2BgD5sAB%2BfwrjPEuLqJhCt24trBSiNUTA/7OvoMBjdAToWvwPrCixVjb42IgIil0lbKZUkisgtYpL9GuBsYGDFPLe0Oh1G5KrboBYA1czFBrDJwbmjQ9OTDAB1EgqIahzHlGtYgzHWPsaJZx2DPGMVCcE/5kTYmJPWCkwoGTCg5MKcuEpy4Kmjtqe7RpggWmdMshiBoFkGglO61NIh56r13qYApDYpk/7mRKihjDOGJxEbaFQP4TUYDEzw0RsjJgEA8A1IQXV6KNJGsMxrBW3r1aMfYyG/o1H9xzZpuYSzLzR9ll/C8RhVcHkIFQJBDA4K8CNz9ZAaghmSsRUfj%2B7hJnVlIF%2BVZ0FOB0NgLempkDBmdEVyEh%2Bx9ROuE8cUz67L%2Br9ImtsnQneRDiaOl9y3grYH00Vpg7hwjpGZ1kek/R5jTHWaDx90pwW5%2B43SXKDVCM4gaothAnoHdj8KQQBe/dXTl6rg3oq7LgvKN9O7xhtLcbpeJDxzgxB5b761uIe25Rg7znWvMfE5d7jN329IX705G8ElSkVJqX4KgCA6gLR8QoHi1k67MM088cgWgxgIBRdb/8I3nTjiCAZ8zKvdeiV73lqQWgnBdS8E8CxXgqBOCETMBsOYCxVrKckLwAgmhg5WqYFgCIEAZiohALqJM0QdNcBZFIc71xJCVKX5wSIvAWASFalIHXy0FIC3w4F4GGg0FIFPw3xmDgFgBgEQBQG7TiDoHCHIEoDazQIiGMD50ahoEGmVEoFRQ31IE9GYGICI04B4DIP8BqCIxJBCH2xgJoPU0YAIBJAYFoCoNIKwC%2BGACbAPWGm4F4CwD5CMHEF4IYyFjwCjGEJAKUlxFcBsmoN4H8BsmX1IOWhCGIHoOcCwDP2gIMn/xENICjGIBCESEwD2EwHEOAGWiMDPxmHeiYGAAUCxDwEwGSRJDiEYFUJkEEBEDEHYC4EiACPkCUDUEMN0CaAMEcNMHMG0OGkgBmFQHa3DE4DTRJDWEiUNn5EwEFGbHTQGDuTZWnUiDTQcNcFUHTRYC%2BQ7CYDiD7HSn7HVAIE33MIMiwGSJv2aBkLsAgAcCGEaG8HlHGG6AiCaCyGSAEGGMyESBmIYHGMKB6BGBLlaAGDqBcAaC8A9gqDaFqGWMmBGE2LmJOLGBWgmFWJmFo3mEWD0BmE0NXyAMMLALWASIbmig2lwEIHWiPymBPycJmAvyv0oFvyiEuETBZCtEM30w0EkCkGiFfwB00N/1IH/0f1fyQn0wS2iEkBhN1C4EZGAM304AgJACgJgK0DgMQIgCQCwPoDIAoC7VOGwJAFwNSlygIO3WGmLUMPIPoP8IFMoMYOYP8LYMEE4O4MML4NcAEPZWEJoLEMMHsKWBAPwDVHlTkMMMUOQGUKWBoPULKEMO0N0MoP0LVJP2MP8PMMsKUBsLsIcNAFgL4AMDcI8K8J8L8NMP4ECNEHEFCPCMUBUHUFIN0EZDiJMDMCXzwBCB6NSPSNWEyOyNyPoHyMKPWDTRKKsjZW2UqP8GqNqPqP2FVBslUCHCYC4GePPnCC6PVHgBuPWIGKGO2OGFGPQCONWPiAWIqDOO7OyBSE7MmL6PlQEAOK2PSBGL2I2IuPyAmN2NONbKnM2KHIkBuP33uPrSeLX1eM4HeN3zwO%2BPwApknkkCcUBNgOBNGVBN6NRL/xAGiGiETA0BfyM3xKtEiA0DhLRhJNALJIsApOgKBNIDvxiGfOiF1FfxZFPCtHOytFPE/2/w4GPxeNILAIvOpMeM4EuB3LQv/KpODnMKSDsEiCAA%3D%3D"></iframe>
                </section>

                <section class="text-only" id="betterestest-tokenizer" data-background-gradient="linear-gradient(rgb(114 0 0), rgb(0 11 98))" >
                    <div style="width: 70%; margin-left: 15%;">
                        <h2>My tokenizer design</h2>

                        <ul>
                            <li class="fragment">Observation 1: We can reuse bitstrings!</li>
                            <ul>
                                <li class="fragment">Instead of recomputing the bitstrings every time we look at the beginning of a token, let's just compute the bitstrings once for every<br>chunk of 64 characters.</li>
                                <li class="fragment">This also fits nicely with the fact that we have to do utf8-validation for each chunk.</li>
                                <li class="fragment">Unfortunately, this means we are going to speculatively produce bitstrings whether we need them or not, for every single chunk!</li>
                            </ul>

                            <li class="fragment">Bitstrings produced speculatively:</li>
                            <ul>
                                <li class="fragment">whitespace: '\n', 't', ' '</li>
                                <li class="fragment">identifier/number matcher: [A-Za-z0-9_]</li>
                                <li class="fragment">control characters: should just be '\n' (used for jumping to the end of comments or single-line strings)</li>
                            </ul>

                            <li class="fragment">Bitstrings produced on-demand:</li>
                            <ul>
                                <li class="fragment">operator-continuation characters: <span style="letter-spacing: 4px;">[!%*+./<=>?\\|]</span></li>
                                <li class="fragment">unescaped string / char_literal characters: <span style="letter-spacing: 4px;">['"]</span></li>
                                <ul>
                                    <li class="fragment">just too rare in practice to be a meaningful optimization for Zig</li>
                                </ul>
                            </ul>
                        </ul>
                    </div>
                </section>

                <section data-background-gradient="linear-gradient(rgb(114 0 0), rgb(0 11 98))" id="my-tokenizer-code" >
                    <h2>Idealized tokenizer code</h2>
                    <div style="height: 1200px; width: 1200px; position: absolute; scale: 1.5">
                        <pre class="visible" style="width: 1200px; top: 250px; left: 220px; height: 610px"><code data-line-numbers="|13-15|24-43|45-51|54|56|57|59-67|69-70|71|73-99|21|22|23|24|45-47" data-fragment-index="1" class="tokenize2 hljs language-zig" style="font-family: 'JetBrains Mono', monospace; font-size: 7pt; margin-top: -3em; position: absolute; box-sizing: content-box; width: 100%; height: 100%">pub fn tokenize(gpa: Allocator, source: [:0]align(@bitSizeOf(uword)) const u8) ![]Token {
    const end_ptr = &source.ptr[source.len];
    const extended_source_len = std.mem.alignForward(usize, source.len + EXTENDED_BACK_SENTINELS_LEN, @bitSizeOf(uword));

    const extended_source = source.ptr[0..extended_source_len];
    const tokens = try gpa.alloc(Token, extended_source_len);
    errdefer gpa.free(tokens);

    var cur_token = tokens;
    var prev: []const u8 = extended_source;
    var cur = prev[0..];

    var bitstrings: [3]uword = undefined;
    var op_type: Tag = .whitespace;
    var selected_bitmap: *uword = bitstrings[@as(u2, @truncate(@intFromEnum(op_type)))];
    var bitmap_index = @intFromPtr(source.ptr);
    var utf8_checker: Utf8Checker = .{};

    bitmap_index -%= @bitSizeOf(uword);

    while (true) : (cur = cur[1..]) {
        var aligned_ptr = @intFromPtr(cur.ptr) / @bitSizeOf(uword) * @bitSizeOf(uword);
        while (true) {
            while (bitmap_index != aligned_ptr) {
                bitmap_index +%= @bitSizeOf(uword);
                const V = @Vector(@bitSizeOf(uword), u8);
                const vec: V = @as([*]align(@bitSizeOf(uword)) const u8, @ptrFromInt(bitmap_index))[0..@bitSizeOf(uword)].*;

                try utf8_checker.validateChunk(vec);

                bitstrings[0] = @as(usize, @bitCast(vec != @as(V, @splat('\x7F')))) &
                    (@as(usize, @bitCast(vec >= @as(V, @splat(' ')))) | @as(usize, @bitCast(vec == @as(V, @splat('\t')))));

                bitstrings[1] uword =
                    @as(usize, @bitCast(vec == @as(V, @splat('\t')))) |
                    @as(usize, @bitCast(vec == @as(V, @splat('\n')))) |
                    @as(usize, @bitCast(vec == @as(V, @splat(' '))));

                bitstrings[2]: uword = (@as(usize, @bitCast(vec == @as(V, @splat('_'))))) |
                    (@as(usize, @bitCast(@as(V, @splat('a')) <= vec)) & @as(usize, @bitCast(vec <= @as(V, @splat('z'))))) |
                    (@as(usize, @bitCast(@as(V, @splat('A')) <= vec)) & @as(usize, @bitCast(vec <= @as(V, @splat('Z'))))) |
                    (@as(usize, @bitCast(@as(V, @splat('0')) <= vec)) & @as(usize, @bitCast(vec <= @as(V, @splat('9')))));
            }

            const cur_misalignment: std.math.Log2Int(uword) = @truncate(@intFromPtr(cur.ptr));
            const bitstring = selected_bitmap.* >> cur_misalignment;
            cur = cur[@ctz(~bitstring)..];

            // If we made it to the end of chunk(s), wrap around, grab more bits, and start again
            aligned_ptr = @intFromPtr(cur.ptr) / @bitSizeOf(uword) * @bitSizeOf(uword);
            if (bitmap_index == aligned_ptr) break;
        }

        if (op_type == .eof) break;

        while (true) {
            var len: u32 = @intCast(@intFromPtr(cur.ptr) - @intFromPtr(prev.ptr));

            switch (prev[0]) {
                'a'...'z' => if (Keywords.lookup(prev.ptr, len)) |op_kind| {
                    op_type = op_kind;
                    const is_space = @intFromBool(cur[0] == ' ');
                    cur = cur[is_space..];
                    len += is_space;
                },
                else => {},
            }

            cur_token[0] = .{ .len = len, .kind = op_type };
            cur_token = cur_token[1..];
            prev = cur;

            if (cur[0] == '@') {
                cur = cur[1..];
                op_type = switch (cur[0]) {
                    'a'...'z', 'A'...'Z' => .builtin,
                    '"' => .string_identifier,
                    else => return error.MissingQuoteOrLetterAfterAtSymbol,
                };

                selected_bitmap = bitstrings[@as(u2, @truncate(@intFromEnum(op_type)))];
            } else if (Operators.isSingleCharOp(cur[0])) {
                selected_bitmap = bitstrings[@as(u2, @truncate(@intFromEnum(Tag.whitespace)))];
                op_type = Operators.hashOp(Operators.getOpWord(cur.ptr, 1));
            } else {
                op_type = switch (cur[0]) {
                    'a'...'z', 'A'...'Z', '_' => .identifier,
                    '0'...'9' => .number,
                    '\'' => .char_literal,
                    '"' => .string,
                    ' ', '\t', '\n' => .whitespace,
                    0 => .eof,
                    else => .unknown,
                };

                selected_bitmap = bitstrings[@as(u2, @truncate(@intFromEnum(op_type)))];
            }

            if (cur[0] != '\'' and cur[0] != '"') break;

            while (true) {
                cur = cur[1..];
                const is_escaped = cur[0] == '\\';
                cur = cur[@intFromBool(is_escaped)..];
                if ((cur[0] == chr and !is_escaped) or cur[0] < ' ') break;
            }
        }
    }

    if (@intFromPtr(cur.ptr) < @intFromPtr(end_ptr)) return error.Found0ByteInFile;
    cur_token[0] = .{ .len = 1, .kind = .eof };
    return tokens;
}</code></pre>
</div>
</section>

                <section data-background-gradient="linear-gradient(rgb(114 0 0), rgb(0 11 98))" id="count-trailing-zeroes-asm">
                    <h2>How do we emulate<br>count-trailing-zeroes?</h2>
                    <iframe style="margin-top: 20px;" width="1920px" height="960px" src="https://zig.godbolt.org/e#g:!((g:!((g:!((h:codeEditor,i:(filename:'1',fontScale:14,fontUsePx:'0',j:3,lang:zig,selection:(endColumn:2,endLineNumber:3,positionColumn:2,positionLineNumber:3,selectionStartColumn:2,selectionStartLineNumber:3,startColumn:2,startLineNumber:3),source:'export+fn+ctz(a:+u64)+u8+%7B%0A++++return+@ctz(a)%3B%0A%7D'),l:'5',n:'0',o:'Zig+source+%233',t:'0')),header:(),k:52.47124411952576,l:'4',m:100,n:'0',o:'',s:0,t:'0'),(g:!((h:compiler,i:(compiler:ztrunk,filters:(b:'0',binary:'1',binaryObject:'1',commentOnly:'0',debugCalls:'1',demangle:'0',directives:'0',execute:'1',intel:'0',libraryCode:'0',trim:'1'),flagsViewOpen:'1',fontScale:14,fontUsePx:'0',j:2,lang:zig,libs:!(),options:'-O+ReleaseFast+-target+riscv64-linux+-mcpu%3Dsifive_u74',overrides:!(),selection:(endColumn:34,endLineNumber:7,positionColumn:34,positionLineNumber:7,selectionStartColumn:34,selectionStartLineNumber:7,startColumn:34,startLineNumber:7),source:3),l:'5',n:'0',o:'+zig+trunk+(Editor+%233)',t:'0')),header:(),k:47.52875588047426,l:'4',n:'0',o:'',s:0,t:'0')),l:'2',m:100,n:'0',o:'',t:'0')),version:4"></iframe>
                </section>

                <section data-background-gradient="linear-gradient(rgb(114 0 0), rgb(0 11 98))" id="count-trailing-zeroes" >
    <h2>How do we emulate<br>count-trailing-zeroes?</h2>
    <div style="height: 1200px; width: 1200px; position: absolute; scale: 2;">
        <pre class="visible" style="width: 900px; height: 120px; top: 420px; left: 220px;"><code id="ctz-emulation-routine" data-line-numbers="1-11|2|3|4|5|6|7|9|10" data-fragment-index="1" class="hljs language-zig" style="font-family: 'JetBrains Mono', monospace; font-size: 11pt; margin-top: -2em; position: absolute">fn ctz(a: u64) u8 {
    if (a == 0) return 64;
    const x = a & (~a +% 1); // a & -a
    const deBruijn = 0b0000001000011000101000111001001011001101001111010101110110111111;
    comptime var lookup_table: [64]u8 = undefined;
    comptime for (0..64) |i| { lookup_table[(deBruijn << i) >> 58] = i; };
    return lookup_table[(deBruijn *% x) >> 58];
}</code></pre>
    </div>
    <p class="fragment" data-fragment-index="7" style="top: 720px;  position: relative; font-size: 32pt;"><a target="_blank" rel="noopener noreferrer" href="https://github.com/llvm/llvm-project/issues/84763">llvm/llvm-project#84763</a></p>
                </section>

                <section data-background-gradient="linear-gradient(rgb(114 0 0), rgb(0 11 98))" id="count-trailing-ones-asm">
                    <h2>How do we emulate<br>count-trailing-ones?</h2>
                    <iframe style="margin-top: 20px;" width="1920px" height="960px" src="https://zig.godbolt.org/e#g:!((g:!((g:!((h:codeEditor,i:(filename:'1',fontScale:14,fontUsePx:'0',j:3,lang:zig,selection:(endColumn:18,endLineNumber:2,positionColumn:18,positionLineNumber:2,selectionStartColumn:18,selectionStartLineNumber:2,startColumn:18,startLineNumber:2),source:'export+fn+ctz(a:+u64)+u8+%7B%0A++++return+@ctz(~a)%3B%0A%7D'),l:'5',n:'0',o:'Zig+source+%233',t:'0')),header:(),k:52.47124411952576,l:'4',m:100,n:'0',o:'',s:0,t:'0'),(g:!((h:compiler,i:(compiler:ztrunk,filters:(b:'0',binary:'1',binaryObject:'1',commentOnly:'0',debugCalls:'1',demangle:'0',directives:'0',execute:'1',intel:'0',libraryCode:'0',trim:'1'),flagsViewOpen:'1',fontScale:14,fontUsePx:'0',j:2,lang:zig,libs:!(),options:'-O+ReleaseFast+-target+riscv64-linux+-mcpu%3Dsifive_u74',overrides:!(),selection:(endColumn:1,endLineNumber:1,positionColumn:1,positionLineNumber:1,selectionStartColumn:1,selectionStartLineNumber:1,startColumn:1,startLineNumber:1),source:3),l:'5',n:'0',o:'+zig+trunk+(Editor+%233)',t:'0')),header:(),k:47.52875588047426,l:'4',n:'0',o:'',s:0,t:'0')),l:'2',m:100,n:'0',o:'',t:'0')),version:4"></iframe>
                </section>

                <section data-background-gradient="linear-gradient(rgb(114 0 0), rgb(0 11 98))" id="count-trailing-ones" >
                    <h2>How do we emulate<br>count-trailing-ones?</h2>
                    <div style="height: 1200px; width: 1200px; position: absolute; scale: 2;">
                        <pre class="visible" style="width: 900px; height: 120px; top: 420px; left: 220px;"><code id="cto-emulation-routine" data-line-numbers="|2|3|4|" data-fragment-index="1" class="hljs language-zig" style="font-family: 'JetBrains Mono', monospace; font-size: 11pt; margin-top: -2em; position: absolute">fn cto(a: u64) u8 {
    if (a == -1) return 64;
    const not_a = ~a;
    const x = not_a & (~not_a +% 1); // ~a & -~a
    const deBruijn = 0b0000001000011000101000111001001011001101001111010101110110111111;
    comptime var lookup_table: [64]u8 = undefined;
    comptime for (0..64) |i| { lookup_table[(deBruijn << i) >> 58] = i; };
    return lookup_table[(deBruijn *% x) >> 58];
}</code></pre>
                    </div>
                </section>

                <section data-background-gradient="linear-gradient(rgb(114 0 0), rgb(0 11 98))" id="count-trailing-ones-llvm" >
                    <h2>How do we emulate<br>count-trailing-ones?</h2>
                    <div style="height: 1200px; width: 1200px; position: absolute; scale: 2;">
                        <pre class="visible" style="width: 900px; height: 120px; top: 420px; left: 220px;"><code id="cto-llvm" data-line-numbers="" data-fragment-index="0" class="hljs language-zig" style="font-family: 'JetBrains Mono', monospace; font-size: 11pt; margin-top: -2em; position: absolute">define dso_local noundef i64 @_Z3ct1m(i64 noundef %0) local_unnamed_addr #0 {
    %2 = xor i64 %0, -1
    %3 = tail call noundef i64 @llvm.cttz.i64(i64 %2, i1 false), !range !9
    ret i64 %3
}</code></pre>
</div>

<p style="top: 720px;  position: relative; font-size: 32pt;"><a target="_blank" rel="noopener noreferrer" href="https://github.com/llvm/llvm-project/issues/82487">llvm/llvm-project#82487</a></p>
                </section>

                <section data-background-gradient="linear-gradient(rgb(114 0 0), rgb(0 11 98))" id="count-trailing-ones-asm-risc-v">
                    <h2>Count-trailing-ones on risc-v</h2>
                    <!-- <iframe style="margin-top: 20px;" width="1920px" height="960px" src="https://zig.godbolt.org/e#g:!((g:!((g:!((h:codeEditor,i:(filename:'1',fontScale:14,fontUsePx:'0',j:3,lang:zig,selection:(endColumn:1,endLineNumber:1,positionColumn:1,positionLineNumber:1,selectionStartColumn:1,selectionStartLineNumber:1,startColumn:1,startLineNumber:1),source:'const+std+%3D+@import(%22std%22)%3B%0Aconst+builtin+%3D+@import(%22builtin%22)%3B%0Aconst+uword+%3D+u64%3B%0Aconst+assert+%3D+std.debug.assert%3B%0A%0Aexport+fn+cto(a:+u64)+u8+%7B+return+@call(.auto,+ctz,+.%7B~a%7D)%3B+%7D%0Aexport+fn+cto_with_inlined_ctz(a:+u64)+u8+%7B+return+@call(.always_inline,+ctz,+.%7B~a%7D)%3B+%7D%0A%0Afn+ctz(a:+uword)+std.meta.Int(%0A++++.unsigned,%0A++++std.math.ceilPowerOfTwoPromote(u64,+std.math.log2_int_ceil(u64,+@bitSizeOf(uword)+%2B+1)),%0A)+%7B%0A++++const+T+%3D+@TypeOf(a)%3B%0A%0A++++const+deBruijn+%3D+switch+(@bitSizeOf(T))+%7B%0A++++++++64+%3D%3E+151050438420815295,%0A++++++++32+%3D%3E+125613361,%0A++++++++else+%3D%3E+return+@ctz(a),%0A++++%7D%3B%0A%0A++++if+(a+%3D%3D+0)+return+@bitSizeOf(T)%3B%0A%0A++++//+Produce+a+mask+of+just+the+lowest+set+bit+if+one+exists,+else+0.%0A++++//+There+are+%60@bitSizeOf(T)%60+possibilities+for+%60x%60.%0A++++const+x+%3D+a+%26+(~a+%2B%25+1)%3B%0A%0A++++const+shift+%3D+@bitSizeOf(T)+-+@bitSizeOf(std.math.Log2Int(T))%3B%0A++++const+hash:+std.math.Log2Int(T)+%3D+@truncate((x+*%25+deBruijn)+%3E%3E+shift)%3B%0A++++comptime+var+lookup_table:+%5B@bitSizeOf(T)%5Dstd.meta.Int(%0A++++++++.unsigned,%0A++++++++std.math.ceilPowerOfTwoPromote(u64,+std.math.log2_int_ceil(u64,+@bitSizeOf(uword)+%2B+1)),%0A++++)+%3D+undefined%3B%0A%0A++++comptime+%7B%0A++++++++var+taken_slots:+T+%3D+0%3B%0A++++++++for+(0..@bitSizeOf(T))+%7Ci%7C+%7B%0A++++++++++++const+x_possibility+%3D+@as(T,+1)+%3C%3C+i%3B%0A++++++++++++const+x_possibility_hash:+std.math.Log2Int(T)+%3D+@truncate((x_possibility+*%25+deBruijn)+%3E%3E+shift)%3B%0A++++++++++++taken_slots+%7C%3D+@as(T,+1)+%3C%3C+x_possibility_hash%3B%0A++++++++++++lookup_table%5Bx_possibility_hash%5D+%3D+@ctz(x_possibility)%3B%0A++++++++%7D%0A++++++++assert(~taken_slots+%3D%3D+0)%3B+//+proves+it+is+a+minimal+perfect+hash+function+and+that+we+overwrote+all+the+undefined+values%0A++++%7D%0A%0A++++return+lookup_table%5Bhash%5D%3B%0A%7D%0A%0Aexport+fn+one_trailing_zero(x:+u64)+bool+%7B%0A++++return+ctz(x)+%3D%3D+1%3B%0A%7D%0A'),l:'5',n:'0',o:'Zig+source+%233',t:'0')),header:(),k:60,l:'4',m:100,n:'0',o:'',s:0,t:'0'),(g:!((h:compiler,i:(compiler:ztrunk,filters:(b:'0',binary:'1',binaryObject:'1',commentOnly:'0',debugCalls:'1',demangle:'0',directives:'0',execute:'1',intel:'0',libraryCode:'0',trim:'1',verboseDemangling:'0'),flagsViewOpen:'1',fontScale:14,fontUsePx:'0',j:1,lang:zig,libs:!(),options:'-O+ReleaseFast+-target+riscv64-linux+-mcpu%3Dsifive_u74',overrides:!(),selection:(endColumn:1,endLineNumber:1,positionColumn:1,positionLineNumber:1,selectionStartColumn:1,selectionStartLineNumber:1,startColumn:1,startLineNumber:1),source:3),l:'5',n:'0',o:'+zig+trunk+(Editor+%233)',t:'0')),header:(),k:40,l:'4',m:100,n:'0',o:'',s:0,t:'0')),l:'2',n:'0',o:'',t:'0')),version:4"></iframe> -->

                    <iframe style="margin-top: 20px;" width="1920px" height="960px" src="https://zig.godbolt.org/e#g:!((g:!((g:!((h:codeEditor,i:(filename:'1',fontScale:14,fontUsePx:'0',j:3,lang:zig,selection:(endColumn:1,endLineNumber:1,positionColumn:1,positionLineNumber:1,selectionStartColumn:1,selectionStartLineNumber:1,startColumn:1,startLineNumber:1),source:'const+std+%3D+@import(%22std%22)%3B%0Aconst+builtin+%3D+@import(%22builtin%22)%3B%0Aconst+uword+%3D+u64%3B%0Aconst+assert+%3D+std.debug.assert%3B%0A%0Aexport+fn+cto(a:+u64)+u8+%7B+return+@call(.auto,+ctz,+.%7B~a%7D)%3B+%7D%0Aexport+fn+cto_with_inlined_ctz(a:+u64)+u8+%7B+return+@call(.always_inline,+ctz,+.%7B~a%7D)%3B+%7D%0A%0Afn+ctz(a:+uword)+std.meta.Int(%0A++++.unsigned,%0A++++std.math.ceilPowerOfTwoPromote(u64,+std.math.log2_int_ceil(u64,+@bitSizeOf(uword)+%2B+1)),%0A)+%7B%0A++++const+T+%3D+@TypeOf(a)%3B%0A%0A++++const+deBruijn+%3D+switch+(@bitSizeOf(T))+%7B%0A++++++++64+%3D%3E+151050438420815295,%0A++++++++32+%3D%3E+125613361,%0A++++++++else+%3D%3E+return+@ctz(a),%0A++++%7D%3B%0A%0A++++if+(a+%3D%3D+0)+return+@bitSizeOf(T)%3B%0A%0A++++//+Produce+a+mask+of+just+the+lowest+set+bit+if+one+exists,+else+0.%0A++++//+There+are+%60@bitSizeOf(T)%60+possibilities+for+%60x%60.%0A++++const+x+%3D+a+%26+(~a+%2B%25+1)%3B%0A%0A++++const+shift+%3D+@bitSizeOf(T)+-+@bitSizeOf(std.math.Log2Int(T))%3B%0A++++const+hash:+std.math.Log2Int(T)+%3D+@truncate((x+*%25+deBruijn)+%3E%3E+shift)%3B%0A++++comptime+var+lookup_table:+%5B@bitSizeOf(T)%5Dstd.meta.Int(%0A++++++++.unsigned,%0A++++++++std.math.ceilPowerOfTwoPromote(u64,+std.math.log2_int_ceil(u64,+@bitSizeOf(uword)+%2B+1)),%0A++++)+%3D+undefined%3B%0A%0A++++comptime+%7B%0A++++++++var+taken_slots:+T+%3D+0%3B%0A++++++++for+(0..@bitSizeOf(T))+%7Ci%7C+%7B%0A++++++++++++const+x_possibility+%3D+@as(T,+1)+%3C%3C+i%3B%0A++++++++++++const+x_possibility_hash:+std.math.Log2Int(T)+%3D+@truncate((x_possibility+*%25+deBruijn)+%3E%3E+shift)%3B%0A++++++++++++taken_slots+%7C%3D+@as(T,+1)+%3C%3C+x_possibility_hash%3B%0A++++++++++++lookup_table%5Bx_possibility_hash%5D+%3D+@ctz(x_possibility)%3B%0A++++++++%7D%0A++++++++assert(~taken_slots+%3D%3D+0)%3B+//+proves+it+is+a+minimal+perfect+hash+function+and+that+we+overwrote+all+the+undefined+values%0A++++%7D%0A%0A++++return+lookup_table%5Bhash%5D%3B%0A%7D%0A%0Aexport+fn+one_trailing_zero(x:+u64)+bool+%7B%0A++++return+ctz(x)+%3D%3D+1%3B%0A%7D%0A'),l:'5',n:'0',o:'Zig+source+%233',t:'0')),header:(),k:60,l:'4',m:100,n:'0',o:'',s:0,t:'0'),(g:!((h:compiler,i:(compiler:ztrunk,filters:(b:'0',binary:'1',binaryObject:'1',commentOnly:'0',debugCalls:'1',demangle:'0',directives:'0',execute:'1',intel:'0',libraryCode:'0',trim:'1',verboseDemangling:'0'),flagsViewOpen:'1',fontScale:14,fontUsePx:'0',j:1,lang:zig,libs:!(),options:'-O+ReleaseFast+-target+riscv64-linux+-mcpu%3Dsifive_u74',overrides:!(),selection:(endColumn:1,endLineNumber:1,positionColumn:1,positionLineNumber:1,selectionStartColumn:1,selectionStartLineNumber:1,startColumn:1,startLineNumber:1),source:3),l:'5',n:'0',o:'+zig+trunk+(Editor+%233)',t:'0')),header:(),k:40,l:'4',m:100,n:'0',o:'',s:0,t:'0')),l:'2',n:'0',o:'',t:'0')),version:4"></iframe>
                </section>

                <section data-background-gradient="linear-gradient(rgb(114 0 0), rgb(0 11 98))" id="count-trailing-ones-asm-sparc">
                    <h2>Count-trailing-ones on sparc</h2>
                    <iframe style="margin-top: 20px;" width="1920px" height="960px" src="https://zig.godbolt.org/e#z:OYLghAFBqd5QCxAYwPYBMCmBRdBLAF1QCcAaPECAMzwBtMA7AQwFtMQByARg9KtQYEAysib0QXACx8BBAKoBnTAAUAHpwAMvAFYgAzKVpMGoAF55gpJfWQE8Ayo3QBhVLQCuLBhNJOAMngMmAByngBGmMQSBgAOqAqE9gyuHl4%2BcQl2AgFBoSwRUVwG1pi2SUIETMQEKZ7eXFaYNlkMFVUEOSHhkdFWldW1aQ0K/R2BXfk9RQCUVqjuxMjsHGgMIwDUI%2BjrAKR6ACLrAAJ4LHHVEDsATFdb11fTewBCOxoAgqsbYe50dgy7B2Op3OBEuN2%2Bv0C90eehe70%2BBHW7gA7iRtntDu4AGySZ6vD4CDZMBRKaoAw5bAB0WG%2BwEpxNJBDx73xVH%2BtlMECYICROOmSIAHLsAOxwt7rCXrYiYAgLf5HOIxVzuQQQAB%2BTF2Vyx6y56wAtNcAKzrLjTGFinbC/b4/GYVQg9Zs9a2VAAfTCTHQXJ52Mk/PcQqtYslUplcpdBE5Gottut%2BI4s1onCNvG8HC0pFQnAAWhZNvNFpgtXo9LwCJpE7MEJgvT0ILMANYgI0aSkATmFV0k7ckemFRp7Avbg8MnEkvBYEg0GlI6cz2Y4vAUIFnFYzidIcFgMEQKFQZzokXIlDQh/oUVMBGIKsbfF%2BkRXEDCldIYUCVQAnpweG%2BP8RPwAeTCbRSnXX8zzYQRAIYWhvw3UgaXcYBnDEWgV24XgsBYYxgHEBD8GlMoADdMAwzN7VKdwCGWX9Aho5MENoPAwmIL9XCwV9r1OH9NyoIxgAUAA1PBMGRQCYkYXiZEEEQxHYKQZPkJQ1FfXQrkMXCQHMSxmLCFdIFmVAYhaDD9UA9YACUmlrJQADFiURfV%2BmAGVNhiKpkBxfVmIYdxVANFhkBidwMQYPAmGAKomAnLNSOIYg8CwAyG0aZokkcBgXDcOofH8cY8gKdJ4kSARBnqUgMlKhhOkKqY0rA8pRnKnwSjKAQ2mqWrukKPp2ha4ZRm6yZClmBRCyWfQkxTNNX0XdYdPWa9b11XBCBIEs9GmctK3NUgazrKJUsY2Kp1bSkNAFI1u3bXt%2B3bK4HukedeEXZdV1IdctFmbc9zPGIjzICgIH%2BwHtOWhg7xoWgaOIJ8XwQ99mAA6Ska/YDQNsaTIMYAgYLg18kJQtCMN/bDcPwzNCMa0jyN4SjkGo2jeHoppXz0tiAI45ZM24qdMNmfjIuE0TxMk9Nf34WTRHERSpeUlR1AQ3QDCMExtIsQwWJSoyTKSMyLOs%2BhiUwByNmcqpXMRVQBSxN1vN8/zAuC0KDlMBh4ti1B4sS5L4DGmz2u8CAnAG3wsuGoqGiqlow5jpJI/qtqWk6mocqGBqg9TxPepGfr04qvOuoKnqJDGib2C2scOFTOc5s4Bb8whxtVvwIhiE27bPt26taywI7po4U6QB7DspAHGcjSxK4NGFWesTrhC3qsD6vqrUhm1HjQrgnqfu1bLgNAXxiy0XhdOB2jc9sYq5ZqXi/u6v2Z4oSBxJCAA"></iframe>
                </section>

                <section data-background-gradient="linear-gradient(rgb(114 0 0), rgb(0 11 98))" id="count-trailing-ones-asm-all">
                    <h2>Count-trailing-ones cross-platform</h2>
                    <iframe style="margin-top: 20px;" width="1920px" height="960px" src="https://zig.godbolt.org/e#z:OYLghAFBqd5QCxAYwPYBMCmBRdBLAF1QCcAaPECAMzwBtMA7AQwFtMQByARg9KtQYEAysib0QXACx8BBAKoBnTAAUAHpwAMvAFYgAzKVpMGoAF55gpJfWQE8Ayo3QBhVLQCuLBhNJOAMngMmAByngBGmMQgAKwA7KQADqgKhPYMrh5ePkkpdgIBQaEsEVFxVpg2eQxCBEzEBBme3lzllWk1dQQFIeGRMfEKtfWNWS2Dnd1FJf0AlFao7sTI7BxoDIMA1IPoGwCkegAiGwACeCxJ9RC7AEzX2zfXM/sAQrsaAIJrm2HudHYMe0OJzOFwIV1uPz%2BgQeTz0rw%2BXwIG3cAHcSDt9kd3AA2SQvN6fASbJgKJT1QFHbYAOiwP2AVJJZII%2BI%2BBMwqlBGyoANsqAg6mRuJmyIAHHtYvD3htpRtiJgCIsAcdRLRaBAGbQUUwAJ4KAD6gVogUwpA2tlMpqpuwlAD9VNaDrDJQ6CQTuWaCKYIEwQMi0cR0MLqWxalSAJKCK4fGUbKnudYWILoUgEmPBpgEBBU5Z0ZSoFGRADyVAAKmjlMRUCxUARMBAcdItgR0FSWBms7RUMBrgbBHqc2qG6bjmFCEI8KZMMX6/7A3trs8NlwZnMCcLrZKY4iNiWKScS9qElOqN6na7ozK8FQNhAABLvIR65wlgBawrlCuISvNp5ZUsv153g%2BerKIWyjOMEu4kBskK0P82YJO4DJLAgFKYrGTAAG7EBs0GwfByCIchyCoZi6GtgoCSSHoGhPBeMbSh%2BionEkCSuPGYI2kw87Yje3EALQ3NES4rn%2BqYytuWDPMQvzaN4O57goKKECRN4jmOE7HhAJYruKm4MdKuJoXo2BLtEXAaNEGjUSKkjXBoIpcNE1wAJzRCm9EMXo1zGaZXDXNE2JcHoehBR5/4GRUSi%2BbK8rMcqnqnuFMYunC54RRsV58cZRy0bFn5KqOwiadOOliZ5AD0FUbBWGDuMsGzcW2CgANa4de2juJsmaYBsnYFpsShIkVmXXgIvXsnggwKKaUW9RoVqVdVJYIJEvV1L1uzYho6nFZOpVPNtGw5Cko5GnYmAKFy0FbRo9rbYtGXbqoe7cTcvEQFx86vAFInlU9RJIgoCBXki6G7eO%2B0njpGz8ScRWQ1p6aZlSfhdtcEZgjpZ6eduCAkkgTYtm2KNo92mPaeuQLHAQMkMKItZQC9ABUQkbFJMl4HJVPYPspnA6DOMA%2BcdhsBsmF1H1qCoC17gJHqtRhOIezRM8EMldDTzRAcwbykw4aRuJBlxgmwBJslBlE627bZpgub5kWpblpW1aM0OVskx26O9gQ/Z24OuLDgjGszui64LiJq6eVTWIMFgNBJv9W5VgkoubRKRsMRLOG1C1jB6gonYEAovq7uhGh/pb104RAC1UurUOU%2BusTOHg1rOHpmdV89eonXgZ2ENqer48De4QBzskAvszjT5lPN81sINUMyaWeVXuf54XNZXe34MktpprLoCM96B3qi98kp10IPw8E5XVcyp2MtywrTBK5guyq%2BffcDwQQ8jwgT%2BRx0Jt1XhlFKsQDhdxlIySInEN4MALkXHehxy5Og2FVY6lZMKXUykiKajUNgsECGcMQx1IhUEwLYDYACuTxlsGkRqccNiZgzBsAsuEcHEBRJWWsjVVQsNWsiOOmAE6YB2BLDwl1M4ulZJ5JiX4pbP3loregn9ngAKAWJSB6Vtz3kfM%2BF8illIEFUhAfCgQEJITqCRZu%2BlpSYOIEVG4zxkC0FMJlK6bjkgTQYAsYAgDPIMhsQgXEepvKWiYCEsJERInRMkDFakJY6jAHlMElCuIqSUIzIsTAQh5S3n3hYhgVismYByXKGasZMIiiYFHDKyEWCROIGwMIlpMzhHaQgXoYREnNipMk4gqSCCNLKRUvJBSim/DgpYwiSFsmfkupaEeepMLYgII8cKmdWx4ASFUnZezA6xmIYcyQFRLQnOsDFKgYglAW2lFSJIBZiAJGQJaJ5kRXlHMeQ7F5yBcT0Heb8159A%2BktkGcMn5zzXljMWfkgghSFDmOmQRIiCzcn7I%2BcQFyqyqFEGIPUmMVIFB6Bcnda5tyTTbJwRS2gdztlYRwmREyXJKX3OOZRaiGhaX0qCcQKayBMIRNjPyhQgqjLMv5v0iFaTRWCthbk%2BFiLkVQhKXMhVlTLSmDCGEQlMpiUJBsZaSiNjvkmqWBUHlVKglagUCwYVVJbUsAlaglltN3DWoaaoEU2JLTeuxHqF1UCWVJJSWk/1GqJkIqmaq0p6LNWxjCMQvV0o5pWq2TosBBI9HAVAuBSCxiVKoRVTMtVREQl2IZfE8J1w4kZMkHqWJGF4lgoGWGkZUT62RqVTG0tcbymLP2UEAQKbjm7P2Zc75k6zm0AueOy1kqrYypGZc7tkykXFP7eM/ZyAGCXNHVCz5bzYxYq%2BY2Q9fyAUmhPcCtxm1XVSvBe2i9ML41RuVZu9Vb7MWoFeYIQM7LiWkvJYu0NQy0kkrJaoNd0aN0otmWigdGK51ioqEYYdXU9TslrAmIk4SD00sXe6z1RLGXpu2SwTlNFyN8oFUK2tIq6NBoXmByFcrMIwY/fBst8ykMJqpNq3VgHzXHoNaa89ImF0PqXc%2BkTnHe2ot49uoFryD1OodU65jbqZIkf1f6v1PrA0JNA9K59Ea309rg7Gr9fGlk3r/QQUdabF03LpZ61KzwOBzFoJwaIvBvAcC0KQVAnAXwWC2AsC184Qq8AIJoLzcxVpMCwFECAcwWoxAWriEU3k3I5exNiaILl4g%2BY4JIXgLAJAaA0KQALQWQscF4CXGrcXAtedIHAWAMBEAoBTnQSI5BKBoHOP1qIph3UMBanwP4kQS7mPi6QUczBiDak4DwRbgQ6jakLGEbQeK1u8GG2wQQhYGC0FW210gtJ3DAGcGIOlB2ruYDbCYcQl38BygYTgkul32RUPcLWR7gRaylaC0aMIxAtuuCwAt2mZxHtcLCD4g4z3jDACNCYeLcwqBGGAAoAAangTAKJCxHgC%2Bt/gggRBiHYFIGQghFAqHUJd3QBh0NmAsIYfuJdIBzF/VUH7/FCwbAAEoVHKUoAAYiSJE/EhjDI2P6oz/EMfuBevxFgczMSmAYFw8rwWuH8qwDztLrQ8VpEcHHEYzRfBx0mL0KILQcipAENb7IyQXcMHt8UPoYxxcMIEB0YYbgmg%2BGsObwPQwujGimL7qwUe3djCj976Yy55iLGWPobzvn/MLYaxscwwAWF0zahAXAhAbrXBCjMWLWP0sgEkCKKk0RJD%2BWiLZUKsRzLt8MJwfXlWuDYipK5QrLlJCxGuLESQlkXK1bz5wJrIAWtY4691iASBhsJFG4NiAm/RsgHGyX6bcFZuUDCAtpbW3HuX5WztvbthHtHcYAQU752FvXdu/dn762sAvfRysILD7c3b7BbP7ZAAHFYdbYHCoBbcHSHFbaHAA2LflSrbgXgRHZHVHV7QIUANrbHXHAnInEnMnR7SnYQFUWnaQMgxnNQBbXQaQdnA/TncHE3PnVONIQXYXMXegEkTAaXTYOXdtRqeJFXQINXWGTXRCTEJgBIBIegPUIwWsQYXgVAQ3PAY3eAOYcPAPbwCAJwRPW3dAFPOPZ3KoAw0wtIYwx3M3HQoPBoEPUYGwqoOwqwsPBPBwm3cYeoVwtPBQSLTPPQbPDgPzOfS7fPQvYveMUvcvfFaLQI2vPAxLcpFLSgII/vCQJvPQKfCfayara4EUYraIAwOrFQhfKwJfUgVrLQOYTrHrPfegMgCgXfPrBog/CbKbGgE/YgObc/S7G/C7dbfou/fbNA0gJ/E7M7C7QAzAOkO7VUb/XgX/NHN7QAvAT7OwEA37VQf7QHUY6A0HXgOAqHDAJAyolAhHSIJHJQFHP/DHXA6ovgAgwnYnUnRgUg2QancQOnagpQWglnHwRgwvLnMIVg4LdgokTgIXUXcXXg/g2XeXeUWUJjSQUQhgcQjXLXQ4FIGgHBPUdwKfFQtQjQ3nJwi3PQq3DwnwfwGPB3d3XINIcwj3KoHw0kyPToAw7Q5w5PGkn3awrw%2BwzITw7kwoWk3w/w9gQI3vYI3PMIzgAvcLdom8GIyvavBI6opI5LPoU3UrdI6iKkWIDQa4SQMlLgEUa4IKIrYo%2BfRrco5fPA1feAdfXrEbBonfeovoQ/KI4/Wsbos/C/TbFba/AM7bXbEY9bcYl/SY9/GYm7OYh7UYpY17U4oAr7S6UA7Y8A3YqAwQGAy7I4hAk42Hc40YjA64rA9HHAlfHHJgPHZ44gt40Ysgz4yg%2BneQX45nILXQWtQE5g7nTQsEgXSErgmEqXGXWGBEoGQ1JYXEVE9EyQ9wTEBgPAGsuoJgfXVQyII3NMkkzksk/QykloakkU3kukz3Rk%2Bk/IHk1PVk6odwwUsPf3LkiYK8uPfkjk4UnoE8sUjPCUoIkIko4LOUiIxUsvfAWIm4VUyouvUgJLFI7UvvCrEAa4LgKkbEc0rgMfbEAorCnLEUUI%2BrMo5rKCxI0gDLY0qkPQcybEA01vbEEKafSQdyUrPQGUgim0qohLKU64Vi0o9i6CrhFIBwSQIAA%3D%3D%3D"></iframe>
                </section>
                <style>
                    .text-only {
                        top: 0 !important;
                    }
                </style>

<section class="text-only" data-background-gradient="linear-gradient(rgb(114 0 0), rgb(0 11 98))" id="whitespace-match-idea">
    <h2>Optimization: Use Vector shuffles to<br>match whitespace</h2>
    <div style="width: 70%; margin-left: 15%;">
        <svg class="fragment" id="whitespace-shuffle-svg-0" width="100%" height="360" viewBox="-15 0 1615 200" xmlns="http://www.w3.org/2000/svg" style="margin-top: 40px;"></svg>
        <svg class="fragment" id="whitespace-shuffle-svg-1" width="100%" height="360" viewBox="-15 0 1615 200" xmlns="http://www.w3.org/2000/svg" style="margin-top: 40px;"></svg>
        <ul>
            <li class="fragment">Idea from: <a href="https://www.youtube.com/watch?v=R_yX0XjdSBY&t=2058s">https://www.youtube.com/watch?v=R_yX0XjdSBY&t=2058s</a></li>
        </ul>
    </div>
    <script>
        {
        let id = 0;
        const boxes = new Array(32).fill(0).map((_, i) => [0+100*(i%16), Math.floor(i / 16) * 220]);

        for (const [svg_i, [color]] of Object.entries([["purple"], ["zig"]])) {
        let box_fills = [
            ...new Array(16).fill("0"),
            ...new Array(16).fill("_")
        ];

        box_fills[16] = '\\n';
        box_fills[21] = 'j';
        box_fills[22] = 'e';
        box_fills[23] = 'l';
        box_fills[24] = 'l';
        box_fills[25] = 'y';
        box_fills[27] = '=';
        box_fills[29] = '1';
        box_fills[30] = '9';
        box_fills[31] = '\\n';


        const replace_chars = [[' ', '_'], ['\t', '\\t'], ['\n', '\\n']];
        replace_chars.forEach(([e, f]) => (box_fills[e.charCodeAt() & 0xF] = f));
        const map = new Map(replace_chars.map(([a, b]) => [b, a.charCodeAt().toString(16).padStart(2, '0')]));

        const targets = box_fills.slice(16).map(e => 0xF & (`0x${map.get(e) ?? e.charCodeAt().toString(16).padStart(2, '0')}`));

        if (svg_i === '0') {
            box_fills = box_fills.map((e, i) => e === '0' ? '.' : map.get(e) ?? e.charCodeAt().toString(16).padStart(2, '0'));
        }

        const whitespace_shuffle_svg_innerHTML = `<defs>
            <marker
                id="arrow"
                viewBox="0 0 10 10"
                refX="5"
                refY="5"
                markerWidth="3"
                markerHeight="3"
                orient="auto-start-reverse"
                fill="#fff">
                <path d="M 0 0 L 10 5 L 0 10 z" />
            </marker>

            <filter id="blurMe" x="-250%" y="-250%" width="600%" height="600">
                <feGaussianBlur in="SourceGraphic" stdDeviation="10" result="blurred" />
            </filter>

            <filter id="blurMe3" x="-250%" y="-250%" width="600%" height="600">
                <feGaussianBlur in="SourceGraphic" stdDeviation="2" result="blurred" />
            </filter>

            <filter id="blurMe2" x="-250%" y="-250%" width="600%" height="600">
                <feGaussianBlur in="SourceGraphic" stdDeviation="4" result="blurred" />
            </filter>

            <filter id="blurMe6" x="-250%" y="-250%" width="600%" height="600">
                <feGaussianBlur in="SourceGraphic" stdDeviation="2" result="blurred" />
            </filter>

            <filter id="blurMe1" x="-250%" y="-250%" width="600%" height="600">
                <feGaussianBlur in="SourceGraphic" stdDeviation="1" result="blurred" />
            </filter>

            <g id="deer70" stroke-linecap="round">
                <rect width="70" height="70" x="8" y="8" fill="none" />
            </g>

            <style>
                .flicker, .neon-text text {
                    font-family: 'JetBrains Mono', monospace;
                    font-size: 40px;
                }
            </style>
        </defs>`.concat(
        Array.prototype.concat(
            boxes.map(([i, j]) => `<g class="flicker deer" data-color="${color}" transform="translate(${i}, ${j})">
                <use xlink:href="#deer70" stroke-width="6"/>
                <use class="glow" stroke="#fff" xlink:href="#deer70" filter="url(#blurMe1)" stroke-width="1"/>
                <use class="glow" xlink:href="#deer70" filter="url(#blurMe)" stroke-width="10"/>
                <use xlink:href="#deer70" filter="url(#blurMe2)" stroke-width="6"/>
            </g>`),

            boxes.map(([i, j]) => `<g class="flicker deer" data-color="${color}" transform="translate(${i}, ${j})">
                <use class="white" xlink:href="#deer70" stroke-width="4" stroke="#fff"/>
                <use filter="url(#blurMe3)" class="white2" xlink:href="#deer70" stroke-width="5" stroke="#fff"/>
                <use class="white3" xlink:href="#deer70" stroke-width="5" stroke="#fff"/>
            </g>`),

            // mids
            boxes.slice(16).map(([i, j]) => `<g class="flicker deer whitespace-box-${svg_i}" data-color="${"red"}" transform="translate(${i}, ${j / 2})">
                <use xlink:href="#deer70" stroke-width="6"/>
                <use class="glow" stroke="#fff" xlink:href="#deer70" filter="url(#blurMe1)" stroke-width="1"/>
                <use class="glow" xlink:href="#deer70" filter="url(#blurMe)" stroke-width="10"/>
                <use xlink:href="#deer70" filter="url(#blurMe2)" stroke-width="6"/>
            </g>`),
            boxes.slice(16).map(([i, j]) => `<g class="flicker deer whitespace-box-${svg_i}" data-color="${"red"}" transform="translate(${i}, ${j / 2})">
                <use class="white" xlink:href="#deer70" stroke-width="4" stroke="#fff"/>
                <use filter="url(#blurMe3)" class="white2" xlink:href="#deer70" stroke-width="5" stroke="#fff"/>
                <use class="white3" xlink:href="#deer70" stroke-width="5" stroke="#fff"/>
            </g>`),

            boxes.map(([i, j], iter) => {
                const n = box_fills[iter];

                return `<g class="flicker neon-text${iter >= 16 ? ` svg-slide-garbage-${svg_i}` : ''}" data-content="${n}" data-color="${color}" transform="translate(${i + 30.5 - (n.length === 2 ? 10 : 0)}, ${j + 56})">
                    <text class="white" stroke-width="3"> ${n} </text>
                    <text filter="url(#blurMe6)"> ${n} </text>
                    <text filter="url(#blurMe)"> ${n} </text>
                    <text class="white" stroke-width="1" stroke="#fff" fill="#fff"> ${n} </text>
                    <text class="white2" stroke-width="2" stroke="#fff" fill="#fff" filter="url(#blurMe1)"> ${n} </text>
                    <text class="white3" stroke-width="2" stroke="#fff" fill="#fff" filter="url(#blurMe3)"> ${n} </text>
                </g>`;
            }),

            boxes.slice(16).map(([i, j], iter) => {
                const n = box_fills[targets[iter]];
                const [i_og, j_og] = boxes[targets[iter]];

                const colors = ["#ff00ff", "var(--neon-zig-color)"]

                global_animations.push({
                    section: "whitespace-match-idea",
                    selector: `#whitespace-matcher-svg-${id}`,
                    slide_num: svg_i,
                    animation_delay: "2s",
                    animation_duration: "5s",
                    continuous: true,

                    keyframes: {
                        0:   { opacity: 0, transform: `translate(${i_og + 30.5 - (n.length === 2 ? 10 : 0)}px, ${j_og + 56}px)`, fill: colors[svg_i], stroke: colors[svg_i] },
                        10: { opacity: 1 },
                        80: {stroke: colors[svg_i]},
                        // 30:   { opacity: 1, transform: `translate(${i_og + 30.5 - (n.length === 2 ? 10 : 0)}px, ${j_og + (j - j_og) / 2 + 56}px)` },
                        100:   { opacity: 1, transform: `translate(${i + 30.5 - (n.length === 2 ? 10 : 0)}px, ${j_og + (j - j_og) / 2 + 56}px)`, fill: "var(--neon-orange-color)", stroke: "var(--neon-orange-color)" },
                        // 100: { opacity: 1, transform: `translate(${i + 30.5 - (n.length === 2 ? 10 : 0)}px, ${j + 56}px)` },
                    }
                });

                return `<g class="flicker neon-text" id="whitespace-matcher-svg-${id++}" data-content="${n}"">
                    <text class="white" stroke-width="3"> ${n} </text>
                    <text filter="url(#blurMe6)"> ${n} </text>
                    <text filter="url(#blurMe)"> ${n} </text>
                    <text class="white" stroke-width="1" stroke="#fff" fill="#fff"> ${n} </text>
                    <text class="white2" stroke-width="2" stroke="#fff" fill="#fff" filter="url(#blurMe1)"> ${n} </text>
                    <text class="white3" stroke-width="2" stroke="#fff" fill="#fff" filter="url(#blurMe3)"> ${n} </text>
                </g>`;
            })
            ).join("\n")
        );


        global_animations.push({
            section: "whitespace-match-idea",
            selector: `.whitespace-box-${svg_i}`,
            slide_num: svg_i,
            animation_delay: "6s",
            animation_duration: "1s",
            continuous: true,

            keyframes: {
                0:   { opacity: 0 },
                100: { opacity: 1 },
            }
        });

        let resize_event_id = 0;
        addEventListener("resize", event => {
            const cur_event_id = ++resize_event_id;
            setTimeout(() => {
                if (cur_event_id === resize_event_id)
                    document.getElementById(`whitespace-shuffle-svg-${svg_i}`).innerHTML = whitespace_shuffle_svg_innerHTML;
            }, 30);
        });
        document.getElementById(`whitespace-shuffle-svg-${svg_i}`).innerHTML = whitespace_shuffle_svg_innerHTML;
        }
        }
        </script>
</section>

<section data-background-gradient="linear-gradient(rgb(114 0 0), rgb(0 11 98))" id="whitespace-shuffle-emit">
    <h2>Mask Whitespace with shuffle emit</h2>
    <iframe style="margin-top: 20px;" width="1920px" height="960px" src="https://zig.godbolt.org/e#z:OYLghAFBqd5QCxAYwPYBMCmBRdBLAF1QCcAaPECAMzwBtMA7AQwFtMQByARg9KtQYEAysib0QXACx8BBAKoBnTAAUAHpwAMvAFYgAzKVpMGoAF55gpJfWQE8Ayo3QBhVLQCuLBiABMpJwAyeAyYAHKeAEaYxCAAHBqkAA6oCoT2DK4eXr5JKWkCQSHhLFEx8VaYNnYCQgRMxASZnt5%2B1pi26bX1BIVhkdFxCQp1DU3ZrSM9wX0lA/EAlFao7sTI7BxoDMMA1MPo2wCkegAi2wACeCzJDRAHPj57dz7zRwBCBxoAgps7Ee50dgYhxO50u1wIt3ufwBwSeLz07y%2BPwI2yYCiUDWBpz2ADosH9gDi0RiCG8Pt8BDtnAh3AwANZY84ANXaRGIEFxqRY6BxCncwGAmGGLNsJACjGABAQADESM5Eu4IO5YqRttDaICccgFfMcUdparlfDERStiiCMR3JgAPoAN3ajLOaIg1NpdNVZwUiSMEI0qml0vmxvJyO2VDESjtDqOpydChdNPpHq9PogGiDZK%2B5MwqnBYaBLDRdIA6ghCELEkw1hBbSBtq76fN64mGQcAOwm7Zd7a2%2Bqo5DITzuH0kOsN1sgz3epi%2B4NfbvbYK0aZhkjbSE%2BQ4AVmcpJ3DDhhzbzmQ7ecR87C%2B7VcHLGHM7XZ5j5zatiVKp7WOfcYTbuT04hZAg1VC0rSjZBVXDWhI3tIDM0%2BBd22OckF2ITACBWIEbyHEdiHgpDyXJKgCyLUtyy9KtMGLQgECEGkqCoegIGQFsxxbJtxwvFDuzQK47DYHs%2Bz%2BBjokZXE2BYHFTGiVAhVuLdXi4AA2A4t2OI14IXYSqGiVTXg0VTTmfMAOG2EzNO7bTdIU8ydwIWyjJBWzd3MhFuK7Ky8JsjhVOcBgHMZZz/J8tz527NCMOIIFPUqVl31VWhUFQOl3ESa0WLdCBPNVDLGy/EFcvdbZQJtWDIIjUr2jnT4CKzL5iJ7RIFHoiIIDqCJxFRBgAE8CG6xJMFVYJ8DWBQ6zOAAVfrMAAeSoNqmA6zAg3OKaBrmhalqbdtLy7UM2ClDAFDE0DbC4sKr22HMCGiIEGrOJ5aFoW1JNUWIlKJW1VC3LgfBxJr6JxCIcR%2BnwnggM4RTZCAlOkbYjQ9KGSBhuGjSbSHWWR2HDViarLq7a7bvzc5Hue173s%2B1Q/oB9wqCB8GMdFdk9D8eHccRzHmdZtHmU5iAWZxvH8cJqLiYe%2B4npenE3o%2B9ElD0f7mtpoGcV%2B2IGaR9llMFjmmYgbW2ZWxnoYNjTQoQ7sCPN9ztgizDdgAd0IFj10m6aNva%2BgVp2m2F2NrHUdx/LsEXKh114xJ%2BMwXYCB5Cb6kFAhpYpnSZxWTAhHQgAJZ11U1bV3BxVPIqFVVKdBiIHZWg6ECOnFxZ8SXyY%2BpgvtBxXAeB0Hwc9wbFwYEahSbSolHOCO6BwYhiGRp5nGUORioT9DtiMZA6WOvlEjzfhiEapWqAibv7kWX3u39rnBeD0Pw9QPjLmj3F4%2BIRPk4%2B4v08zggc/jPPgi1BUi6YDTmhBQZdW5U2ruhWu6AFD11JlLGWlNqb73pvcTa9AhoDzwKNYe0Fo5nHHvQbAU8Z73DngvEYicV5VnXrsVK281y2hpgfHwW4VLH1IKfLs599ZKUvjGI4Ic8Bh2YrfSO98Y5xyXknRB780Kf2/llf4Go/4F0AcA0u2xeTokwHoSBh0YFwIlmTV%2B2j5Yd2VsDNWPdFoYP7oPBQuDR4ELERPYh092Sz3novZ%2By9V60M3gw3eTD94RGsRwrhV08FXxcVcNxJD2S4ioCwJOEco7KGIMECETwACSDBezLn2AnTwjBzTTW2JWHR%2BwiB7xanWH2bZkL7ieGXHabt1rzV7i8RpwEbZWxNLVGq9UgQEA6lwdB7BeZ61Nuzex2ChR1mML1aa6M1qzXmsNeZjjzoWy7AoJ2BAXYQzWRtTZODtodkiTwmZiwpnQw/AjO5yMDZ4FmTwj8rztonEEVxRpnCLpXneUNZStygXwxBTEwhk8PEbj0kweoLFYY4hCAIHEozaBcEMk89kDyIV4GOoOKepTaDdW2AwVAKJAkkBuvsHexUEAP3aAIfYqABrEGMDyOE/zdlXhHtHARegQ6xMSPEmFTw4UIoQEilFDA0VjKxXkgpeB9hKE2CytlHKcTbDossWg%2BwojYt4ZfNcYKNIRIBYM1C6F7bDEtGdH2AKFwizutFeBkl4WrClZIZFmBUXosxWg9p6yJmgpORsrB5zVru3DQ4oWXYkJGMbiYj1iLvUyrlRimxS1MGxvwo0wiwyezop8BM60lYGjWi4ONTWEAHmzN7mW7o1ofDVr5nW25ZyFmGvbejGt7adkLjSRI4k0QIS/1lWoyV%2BVThEmICwLqKrY44ifi/eokk5EZ2zrnZR%2BcAEbtAVomVGZrYArtqLW17h7WXMdd2Z1Ys3Wzskum20xaGZhtLeWgglbQ3Ro/U254Hp32dscas39DbP3fosvGxpiam6Pp9ail9HUwZoPA02rgIFbE2gg6zYD1VBnkgAPSEe2McTA4ZhwoiiAgVu9hd50v3oxIU/Zp7olRJ68sth04KCIyRmW1pYZ1hyWHCIhBthtkXMdDDuxl41ISNsClDLiBO1Hu4UeiUHaiUkGqQgx06WJWSqlLVxZo6iCBFQqU0c12EcyQoZAABaW0hGHZonndR2ja4IikqYOgfAJhth%2BjbBoNU5GSDR3QKgYIwB6XRwMylRIeovjEe2J8AASgAWTrMI%2BxOZJMKfcCiVAYd2UmGjmmezXAty3KUOaVAAXePbGUMoZwgn4bqdQJp3e2nRMED02uOLqUGvpZycoIQWWRNiaUgp3ePXxN5ekzV4qdWDIIgU5Z5T%2BLo5qdix1rTOneurl3gNxI641zsvW21nbnXthbn231o7SV4v9xqUwReS16Uzm2DR46LMomYDYIIAllJTo0rDNPedm5ggKhRLBNkB6/gomyxERTPZObHXqNHSzuxWCY4ZUCMT5GdIdHtCS7YbBjDHR68daQt2MeLmAOStC6AXhJZI6lnJQhnBMnGzl1QeXliFeK8YQU64NAVaq6qRbcnEufGS8WT4QhMvX2Grl/F%2BXBe22F2VsXlXquyeWzLhqx30otlEXfASvd6kKWUoZZUOatmLJ6n1AaoGOkQDwwO7s%2BznYIHXOO/%2BhdJUXN2leV%2BAntMCpDmeoEISWoQ2dEG05Eah4eh684NEEJe7bAAFTZ9dqkaSG1E8xq2StEjILgJzJwdy/GWiU1erAZK2G1ooiN89c337kfbbWtFv6iZ9vq%2BRMfWAudmAIhX2j47H3rsgPJ5A572v3Ca03KvpyS4PJtCRYYDWYtEy9IaBxDidWakcTZ8w0tPSsRD%2BGX34f4/xxT%2BS6XVyHk112VvmA6qeTuNblIdoCW3uW/I/QyR/N7egS/a/NSIA%2B/UAtfbkHEN/KsCET/bYD8H/E%2BG9S6U1IOLvP/AArDaAkAs/MAzACAvUKAhSA/YAk/YgvDGvRfAmaJLvYVUVUhHwRVMQZVVHJmXYPAaSCpEdapOrY3QqLlSJJCegy6PlK%2BB1HlWvXsXeGIKNN3D3b8FMGcNMONRfOlNMQ/T0Pg4NYvd3OfIMC5ZwPAM8W2PSCwtSRkQAhSYDawm/KA82BgrsSfPCVw/GCQvpfNLMRpDgRYWgTgLcXgbwDgLQUgVATgAALQsF2GWFWH5R8D0D0F4AIE0ECMWAZR8wGAgEWDpBAC3G9V%2BgAE5Ui2w2xSjJB7glINADBgiOBJBeAWAJANAEhwjIjoiOBeAxoEgMiIjAjSA4BYAYBEAUBXF6AyAKAzcRUpiQBTBQIkwaANRogxospMjSBRNmBiBupOAeAtjgh6huoZoIhtBWR9jeBeIAcCAZoGASVNj8R%2BR08noxpuBeAsBCwTBxBBjSB8A0JicFlficx2gCt1gDislKhNjlwIh2VdjXAsBNiLRLhLjSB7RiBkclAyMvjgBlwTBMjFhGImBgAFAmQ8BMAHYZoBpwiDj%2BBBARAxB2ApAZBBBFAVB1BfjdAGjhcFiLBDA8AIgxpIBFhWVqgthOB7MZpthUtYo0RMBpQM9th7NKFl5%2BNYZ7M8T3A%2Bd7MWAC4YxTB8log9AlTaBkBeBUB0TMksAhT8iKgqh0hHAB4xhvAMNAhphihSgJBchUgxTnSvTkgfT0hegPSBgMNXwxSuhRg3BmgvTwzOhJhgz%2BgYgwzJg/SUzuhEzZhkzFgFBEi1h9AgiQiwjNjujthzBosliGQIBcBCBHwUi9F0iCSCiQBJAtwj8gslIlJ7gNAtxKi9BSiVRGjmjSBWjJA2wQZYhSifBYheypBpzZzSBOjzTOBeiQB%2BiCThixiIAkAoVpjKBdyFjKy%2BAAQ1jKAIhNjtjjjUTLzdjTjzjbBUTrjSk7iHjfinjgAXjoJUTPjhcfjIj/jWQ8B7Q3jIiQTBwbpUTITGjIiYS4TuoET1hIjkTWj3i0TohMTMBsTfyosNyiSSSySKSqTGBUS6ThBRBxBmTSK2S1BNjdAMMjB8Tyz%2BTBT4ARTxFKQJSpSZT6A5SFSdhlTpFUQm9JANTggtSlTdSFQYwmAt56BrQfQhQUQNSzSojLTlUFlhS7TAKHAIAnA0z/AB5MzPSMMAz8gMhozsgTK8gxSjLQytKOgahUyLKXT7KIyEz3SkzYynKsgXLhgMyPKsyJAcy8z2A9FDAizFySzOAyz4jKz1way2RDh6z5hGzBjgIcisAYhbShyWiii/pJAuANA2w5yZziqajSjIrfjujVz1y0rmzWz2yNBOzuzey2x%2BzBzOA0jKquiVzSABitBgJGifBiyqrer%2Bqsi0LiBUgHBJAgA%3D%3D"></iframe>
</section>

<section data-background-gradient="linear-gradient(rgb(114 0 0), rgb(0 11 98))" id="keyword-lookups" >
    <h2>Keyword Lookups</h2>
    <div style="height: 1200px; width: 1200px; position: absolute; scale: 2">
        <pre class="visible" style="width: 1200px; top: 320px; left: 330px; height: 250px"><code data-line-numbers="|1|2|4|22|23|24|25|4|5|28|29-30,33-36|29-30,33-36|29-30,33-36|29-30,33-36|5|7|9|10|77|10|11|12-13|15|16" data-fragment-index="1" class="tokenize2 hljs language-zig" style="font-family: 'JetBrains Mono', monospace; font-size: 7pt; margin-top: -3em; position: absolute; box-sizing: content-box; width: 100%; height: 100%">pub fn lookup(kw: [*]const u8, len: u32) ?Tag {
    assert(len != 0);

    const raw_hash = hashKw(kw, len);
    const hash = mapToIndex(raw_hash);

    comptime assert(max_kw_len < '0' and '0' > 16 - 1);

    const KW_VEC = @Vector(16, u8);
    const vec1: KW_VEC = sorted_padded_kws[hash];
    const vec2: KW_VEC = kw[0..16].*; // the safety of this operation is validated at the top of this function
    const len_vec: KW_VEC = @splat(@as(u8, @truncate(len)));
    const cd = @select(u8, len_vec > std.simd.iota(u8, 16), vec2, len_vec);

    if (std.simd.countTrues(cd != vec1) == 0) {
        return @enumFromInt(~hash);
    } else {
        return null;
    }
}

pub fn hashKw(kw: [*]const u8, len: u32) u7 {
    const a = std.mem.readInt(u16, kw[0..2], .little);
    const b = std.mem.readInt(u16, (kw - 2 + @as(usize, @intCast(len)))[0..2], .little);
    return @truncate(((a ^ (len << 14)) *% b) >> 8);
}

fn mapToIndex(raw_hash: u7) u8 {
    const mask = (@as(u64, 1) << @truncate(raw_hash)) -% 1;
    return (if (raw_hash >= 64) @popCount(masks[0]) else 0) + @popCount(mask & masks[raw_hash / 64]);
}

const masks = [2]u64{
    0b0000001000000110001011010011101000001000010010001011011000100100,
    0b0001011010100000000001100000111101100010110011111001100110011100,
};

const sorted_padded_kws = [50][16]u8{
    ("extern"         ++ "\x06" ** 10).*,
    ("while"          ++ "\x05" ** 11).*,
    ("align"          ++ "\x05" ** 11).*,
    ("else"           ++ "\x04" ** 12).*,
    ("or"             ++ "\x02" ** 14).*,
    ("break"          ++ "\x05" ** 11).*,
    ("anytype"        ++ "\x07" **  9).*,
    ("volatile"       ++ "\x08" **  8).*,
    ("async"          ++ "\x05" ** 11).*,
    ("errdefer"       ++ "\x08" **  8).*,
    ("catch"          ++ "\x05" ** 11).*,
    ("test"           ++ "\x04" ** 12).*,
    ("struct"         ++ "\x06" ** 10).*,
    ("const"          ++ "\x05" ** 11).*,
    ("return"         ++ "\x06" ** 10).*,
    ("await"          ++ "\x05" ** 11).*,
    ("resume"         ++ "\x06" ** 10).*,
    ("opaque"         ++ "\x06" ** 10).*,
    ("packed"         ++ "\x06" ** 10).*,
    ("orelse"         ++ "\x06" ** 10).*,
    ("var"            ++ "\x03" ** 13).*,
    ("unreachable"    ++ "\x0b" **  5).*,
    ("threadlocal"    ++ "\x0b" **  5).*,
    ("anyframe"       ++ "\x08" **  8).*,
    ("noinline"       ++ "\x08" **  8).*,
    ("defer"          ++ "\x05" ** 11).*,
    ("try"            ++ "\x03" ** 13).*,
    ("pub"            ++ "\x03" ** 13).*,
    ("usingnamespace" ++ "\x0e" **  2).*,
    ("fn"             ++ "\x02" ** 14).*,
    ("and"            ++ "\x03" ** 13).*,
    ("allowzero"      ++ "\x09" **  7).*,
    ("error"          ++ "\x05" ** 11).*,
    ("addrspace"      ++ "\x09" **  7).*,
    ("if"             ++ "\x02" ** 14).*,
    ("nosuspend"      ++ "\x09" **  7).*,
    ("linksection"    ++ "\x0b" **  5).*,
    ("inline"         ++ "\x06" ** 10).*,
    ("export"         ++ "\x06" ** 10).*,
    ("asm"            ++ "\x03" ** 13).*,
    ("noalias"        ++ "\x07" **  9).*,
    ("suspend"        ++ "\x07" **  9).*,
    ("switch"         ++ "\x06" ** 10).*,
    ("union"          ++ "\x05" ** 11).*,
    ("enum"           ++ "\x04" ** 12).*,
    ("continue"       ++ "\x08" **  8).*,
    ("for"            ++ "\x03" ** 13).*,
    ("callconv"       ++ "\x08" **  8).*,
    ("comptime"       ++ "\x08" **  8).*,
    .{ 255, 255, 255, 255, 255, 255, 255, 255, 255, 255, 255, 255, 255, 255, 255, 255 },
};
</code></pre>
    </div>
    <style>
        #lookup_demonstration > * {
            position: absolute;
        }
    </style>
    <div id="lookup_demonstration" style="width: 1200px; height: 400px; top: 620px; left: 130px; position: absolute; font-size: 34pt;">
        <pre class="fragment var-name" style="transform: translateY(1.2em);" id="" data-fragment-index="1">kw = "export", len = 6</pre>

        <pre class="fragment var-name" style="transform: translateY(2.4em);" id="" data-fragment-index="15">hash = 38</pre>

        <pre class="fragment var-name lookup-garbage-1" style="transform: translateY(2.4em);" id="" data-fragment-index="8">raw_hash = 96</pre>
        <pre class="fragment var-name lookup-garbage-1" style="transform: translateY(3.6em);" id="" data-fragment-index="11">raw_hash = 96 & 63 => 32</pre>
        <pre class="fragment var-name lookup-garbage-1" style="transform: translateY(4.8em);" id="" data-fragment-index="12">const mask = (1 << 32) -% 1</pre>
        <pre class="fragment var-name lookup-garbage-1" id="shifu" style="transform: translateY(6em);" data-fragment-index="12"></pre>
        <pre class="fragment var-name lookup-garbage-1 custom" id="shifu2" style="transform: translateY(6em);" data-fragment-index="12"></pre>
        <pre class="fragment var-name lookup-garbage-1" id="deded1" style="transform: translateY(7.2em);" data-fragment-index="12"></pre>
        <pre class="fragment var-name lookup-garbage-1" id="deded2" style="transform: translateY(7.2em);" data-fragment-index="13"></pre>
        <pre class="fragment var-name lookup-garbage-1" id="deded2" style="transform: translateY(8.4em);" data-fragment-index="14">add that 17 to @popCount(masks[0]), known at compile-time to be 21</pre>

        <svg class="fragment" data-fragment-index="20" id="lookup-svg-0" width="100%" height="360" viewBox="-15 0 1615 200" xmlns="http://www.w3.org/2000/svg" style="margin-top: 40px; margin-left: -400px"></svg>

    <script>
        {
        let id = 0;
        const boxes = new Array(32).fill(0).map((_, i) => [0+100*(i%16), Math.floor(i / 16) * 220]);

        for (const [svg_i, [color]] of Object.entries([["blue"]])) {
        let box_fills = [
            ..."export", ... new Array(10).fill(6),
            ..."export", ... new Array(10).fill('.'),
        ];

        const innerHTML = `<defs>
            <marker
                id="arrow"
                viewBox="0 0 10 10"
                refX="5"
                refY="5"
                markerWidth="3"
                markerHeight="3"
                orient="auto-start-reverse"
                fill="#fff">
                <path d="M 0 0 L 10 5 L 0 10 z" />
            </marker>

            <filter id="blurMe" x="-250%" y="-250%" width="600%" height="600">
                <feGaussianBlur in="SourceGraphic" stdDeviation="10" result="blurred" />
            </filter>

            <filter id="blurMe3" x="-250%" y="-250%" width="600%" height="600">
                <feGaussianBlur in="SourceGraphic" stdDeviation="2" result="blurred" />
            </filter>

            <filter id="blurMe2" x="-250%" y="-250%" width="600%" height="600">
                <feGaussianBlur in="SourceGraphic" stdDeviation="4" result="blurred" />
            </filter>

            <filter id="blurMe6" x="-250%" y="-250%" width="600%" height="600">
                <feGaussianBlur in="SourceGraphic" stdDeviation="2" result="blurred" />
            </filter>

            <filter id="blurMe1" x="-250%" y="-250%" width="600%" height="600">
                <feGaussianBlur in="SourceGraphic" stdDeviation="1" result="blurred" />
            </filter>

            <g id="deer70" stroke-linecap="round">
                <rect width="70" height="70" x="8" y="8" fill="none" />
            </g>

            <style>
                .flicker, .neon-text text {
                    font-family: 'JetBrains Mono', monospace;
                    font-size: 40px;
                }
            </style>
        </defs>`.concat(
        Array.prototype.concat(
            boxes.map(([i, j], iter) => `<g class="flicker deer lookup-late-appear-${+(iter >= 16)}" data-color="${color}" transform="translate(${i}, ${j})">
                <use xlink:href="#deer70" stroke-width="6"/>
                <use class="glow" stroke="#fff" xlink:href="#deer70" filter="url(#blurMe1)" stroke-width="1"/>
                <use class="glow" xlink:href="#deer70" filter="url(#blurMe)" stroke-width="10"/>
                <use xlink:href="#deer70" filter="url(#blurMe2)" stroke-width="6"/>
            </g>`),

            boxes.map(([i, j], iter) => `<g class="flicker deer lookup-late-appear-${+(iter >= 16)}" data-color="${color}" transform="translate(${i}, ${j})">
                <use class="white" xlink:href="#deer70" stroke-width="4" stroke="#fff"/>
                <use filter="url(#blurMe3)" class="white2" xlink:href="#deer70" stroke-width="5" stroke="#fff"/>
                <use class="white3" xlink:href="#deer70" stroke-width="5" stroke="#fff"/>
            </g>`),

            boxes.map(([i, j], iter) => {
                const n = box_fills[iter];

                return `<g class="flicker neon-text lookup-late-appear-${+(iter >= 16)}${iter >= "22" ? ' lookup-disappear' : ''}" data-content="${n}" data-color="${color}" transform="translate(${i + 30.5 - (n.length === 2 ? 10 : 0)}, ${j + 56})">
                    <text class="white" stroke-width="3"> ${n} </text>
                    <text filter="url(#blurMe6)"> ${n} </text>
                    <text filter="url(#blurMe)"> ${n} </text>
                    <text class="white" stroke-width="1" stroke="#fff" fill="#fff"> ${n} </text>
                    <text class="white2" stroke-width="2" stroke="#fff" fill="#fff" filter="url(#blurMe1)"> ${n} </text>
                    <text class="white3" stroke-width="2" stroke="#fff" fill="#fff" filter="url(#blurMe3)"> ${n} </text>
                </g>`;
            }),

            boxes.slice(box_fills.indexOf('.')).map(([i, j], iter) => {
                const n = '6';

                return `<g class="flicker neon-text lookup-late-arriver" data-content="${n}" data-color="${color}" transform="translate(${i + 30.5 - (n.length === 2 ? 10 : 0)}, ${j + 56})">
                    <text class="white" stroke-width="3"> ${n} </text>
                    <text filter="url(#blurMe6)"> ${n} </text>
                    <text filter="url(#blurMe)"> ${n} </text>
                    <text class="white" stroke-width="1" stroke="#fff" fill="#fff"> ${n} </text>
                    <text class="white2" stroke-width="2" stroke="#fff" fill="#fff" filter="url(#blurMe1)"> ${n} </text>
                    <text class="white3" stroke-width="2" stroke="#fff" fill="#fff" filter="url(#blurMe3)"> ${n} </text>
                </g>`;
            }),

            boxes.slice(16).map(([i, j], iter) => {
                const n = '6';

                return `<g class="flicker neon-text lookup-late-appear" data-content="${n}" data-color="${iter < 6 ? "green" : "red"}" transform="translate(${i + 30.5 - (n.length === 2 ? 10 : 0)}, ${(j) / 4 * 2.5 + 56})">
                    <text class="white" stroke-width="3"> ${n} </text>
                    <text filter="url(#blurMe6)"> ${n} </text>
                    <text filter="url(#blurMe)"> ${n} </text>
                    <text class="white" stroke-width="1" stroke="#fff" fill="#fff"> ${n} </text>
                    <text class="white2" stroke-width="2" stroke="#fff" fill="#fff" filter="url(#blurMe1)"> ${n} </text>
                    <text class="white3" stroke-width="2" stroke="#fff" fill="#fff" filter="url(#blurMe3)"> ${n} </text>
                </g>`;
            }),

            boxes.slice(16).map(([i, j], iter) => {
                const n = iter.toString(16);

                return `<g class="flicker neon-text lookup-late-appear" data-content="${n}" data-color="${"white"}" transform="translate(${i + 30.5 - (n.length === 2 ? 10 : 0)}, ${(j) / 4 * 1.25 + 56})">
                    <text class="white" stroke-width="3"> ${n} </text>
                    <text filter="url(#blurMe6)"> ${n} </text>
                    <text filter="url(#blurMe)"> ${n} </text>
                    <text class="white" stroke-width="1" stroke="#fff" fill="#fff"> ${n} </text>
                    <text class="white2" stroke-width="2" stroke="#fff" fill="#fff" filter="url(#blurMe1)"> ${n} </text>
                    <text class="white3" stroke-width="2" stroke="#fff" fill="#fff" filter="url(#blurMe3)"> ${n} </text>
                </g>`;
            }),
            ).join("\n")
        );


        // global_animations.push({
        //     section: "keyword-lookups",
        //     selector: `.whitespace-box-${svg_i}`,
        //     slide_num: svg_i,
        //     animation_delay: "6s",
        //     animation_duration: "1s",
        //     continuous: true,

        //     keyframes: {
        //         0:   { opacity: 0 },
        //         100: { opacity: 1 },
        //     }
        // });

        let resize_event_id = 0;
        addEventListener("resize", event => {
            const cur_event_id = ++resize_event_id;
            setTimeout(() => {
                if (cur_event_id === resize_event_id)
                    document.getElementById(`lookup-svg-${svg_i}`).innerHTML = innerHTML;
            }, 30);
        });
        document.getElementById(`lookup-svg-${svg_i}`).innerHTML = innerHTML;
        }
        }
        </script>

        <script>
            document.getElementById("shifu").innerHTML = '<span id="shift-out-lookup">' + bitify("00000000000000000000000000000000") + "</span>" + bitify("00000000000000000000000000000001") + '<span id="shift-in-lookup">' + bitify("00000000000000000000000000000000") + "</span>";
            document.getElementById("shifu2").innerHTML = bitify("0000000000000000000000000000000011111111111111111111111111111111");
            document.getElementById("deded1").innerHTML = bitify("0001011010100000000001100000111101100010110011111001100110011100");
            document.getElementById("deded2").innerHTML = bitify("0000000000000000000000000000000001100010110011111001100110011100") + " => popCount is 17";


            global_animations.push({
                section: "keyword-lookups",
                slide_num: 11,
                animation_delay: "2s",
                animation_duration: "5s",

                selector: `#shift-in-lookup`,
                keyframes: {
                    0:   { "letter-spacing": "-14.95px", opacity: 0, },
                    50:  { opacity: 1 },
                    100: { "letter-spacing": "0px", opacity: 1, },
                }
            }, {
                section: "keyword-lookups",
                slide_num: 11,
                animation_delay: "2s",
                animation_duration: "5s",

                selector: `#shift-out-lookup`,
                keyframes: {
                    0:   { "letter-spacing": "0px", opacity: 1, },
                    50:  { opacity: 0 },
                    100: { "letter-spacing": "-14.95px", opacity: 0, },
                }
            }, {
                section: "keyword-lookups",
                selector: `#shifu2`,
                slide_num: 11,
                animation_delay: "8.5s",
                animation_duration: "0.5s",

                keyframes: {
                    0:   { opacity: 0, },
                    100: { opacity: 1, },
                }
            }, {
                section: "keyword-lookups",
                selector: `#shifu`,
                slide_num: 11,
                animation_delay: "8.5s",
                animation_duration: "1s",
                skip_auto_prev_state: true,

                keyframes: {
                    0:   { opacity: 1, },
                    100: { opacity: 0, },
                }
            }, {
                section: "keyword-lookups",
                selector: `#deded2`,
                slide_num: 12,
                animation_delay: "0.5s",
                animation_duration: "1.5s",

                keyframes: {
                    0:   { opacity: 0, },
                    100: { opacity: 1, },
                }
            }, {
                section: "keyword-lookups",
                selector: `#deded1`,
                slide_num: 12,
                animation_delay: "0.5s",
                animation_duration: "2s",
                skip_auto_prev_state: true,

                keyframes: {
                    0:   { opacity: 1, },
                    100: { opacity: 0, },
                }
            }, {
                section: "keyword-lookups",
                selector: `.lookup-garbage-1`,
                slide_num: 14,
                animation_delay: "0s",
                animation_duration: "0.5s",
                skip_auto_prev_state: true,

                keyframes: {
                    0:   { opacity: 1, },
                    100: { opacity: 0, },
                }
            }, {
                section: "keyword-lookups",
                selector: `.lookup-late-appear-0`,
                slide_num: 19,
                animation_delay: "0s",
                animation_duration: "0.5s",

                keyframes: {
                    0:   { opacity: 0, },
                    100: { opacity: 1, },
                }
            }, {
                section: "keyword-lookups",
                selector: `.lookup-late-appear-1`,
                slide_num: 20,
                animation_delay: "0s",
                animation_duration: "0.5s",

                keyframes: {
                    0:   { opacity: 0, },
                    100: { opacity: 1, },
                }
            }, {
                section: "keyword-lookups",
                selector: `.lookup-late-appear`,
                slide_num: 21,
                animation_delay: "0s",
                animation_duration: "0.5s",

                keyframes: {
                    0:   { opacity: 0, },
                    100: { opacity: 1, },
                }
            }, {
                section: "keyword-lookups",
                selector: `.lookup-late-appear`,
                slide_num: 22,
                animation_delay: "0s",
                animation_duration: "0.5s",
                skip_auto_prev_state: true,

                keyframes: {
                    0:   { opacity: 1, },
                    100: { opacity: 0, },
                }
            }, {
                section: "keyword-lookups",
                selector: `.lookup-disappear`,
                slide_num: 22,
                animation_delay: "0s",
                animation_duration: "0.5s",
                skip_auto_prev_state: true,

                keyframes: {
                    0:   { opacity: 1, },
                    100: { opacity: 0, },
                }
            }, {
                section: "keyword-lookups",
                selector: `.lookup-late-arriver`,
                slide_num: 22,
                animation_delay: "0s",
                animation_duration: "0.5s",

                keyframes: {
                    0:   { opacity: 0, },
                    100: { opacity: 1, },
                }
            }

        );
        </script>

<!-- 0000001000000110001011010011101000001000010010001011011000100100
0001011010100000000001100000111101100010110011111001100110011100
0000000000000000000000000000000011111111111111111111111111111111
0000000000000000000000000000000100000000000000000000000000000000
0000000000000000000000000000000001100010110011111001100110011100 -->
    </div>
    <!--   -->

</section>

<section data-background-gradient="linear-gradient(rgb(114 0 0), rgb(0 11 98))" id="lookup-x86-emit">
    <h2>Lookup emit</h2>
    <iframe style="margin-top: 20px;" width="1920px" height="960px" src="https://zig.godbolt.org/e#z:OYLghAFBqd5QCxAYwPYBMCmBRdBLAF1QCcAaPECAMzwBtMA7AQwFtMQByARg9KtQYEAysib0QXACx8BBAKoBnTAAUAHpwAMvAFYgAzKVpMGoAF55gpJfWQE8Ayo3QBhVLQCuLBiABMXUk4AMngMmAByngBGmMQSAOykAA6oCoT2DK4eXr7%2Byal2AsGhESzRsVwJ1pi26UIETMQEmZ7eflaYNgUMdQ0EReFRMfFW9Y3N2W0Ko30hA6VDFQCUVqjuxMjsHGgMUwDUU%2Bi7AKR6ACK7AAJ4LMmNEEc%2BPgcPPosnAEJHGgCC23tMCiUjWOZ32BHQADosJF3MAIQCgQQPl9vijMKpbgRdlQGLtaKhUABrdyJCCEgDuIGOAFZ3gAqI7U05/LHuAAcpDxjCp7j0r127OOcU%2BP12Yt2CJiBAg9FxYDAJ3OGjeehF32OovFLN2xCY5IA%2BggAQgQecjQoEABpclk8mc2UqtXi3ba80mxW7FhMRIAFVQAEkGFhVBBdQa3Y6URr1VqBHtLQB1fUANWwzlNl2T1SIxAgXAAbJz2ZHNWLtQA3apcKmJlNpjMKEgETDofWJJjoLCtikKRnvN2M07I0suuNYyvIHw1pOp9Meil9jQQiEFwcQhmq3YAei3uwICEw%2ByYVEwBAAnrtUFQ9wg8ApL4kYkwurs77ty2I8Ohny2JVj94eRCJJe177m%2BVDuAwNQCFGsY7Fisr6hO051nOoIXAoiRGNKFwAhA7KchcBDEJBojNjKjCLFRw4xmWY4uocHoYR02b4RyXIMEh1QgtgYKQqkLCQvY9RsZyBbLO%2B1Q%2BPajBccgJbqrBYp4NeEAHBCAmQmgkEED6JGYAoEDIIc8oehOXCLKaHrKkKTrOuKxCnmsuIAH4DqqSlCucHRKLZnnOo5BDObsGg0c6RxxEOPwRVFik/Ik7iRNiuJutatpUn2DJMtqBEcTyfKWe4cR%2BSO2pMA24IQmwLAQo5HaBtK7gFpyC60kuEI%2BIOnIQrQhAEPQCnOtqSUeup1W1Zg9WCPhzW7LauwALS7D4xw%2BO8lx4e4qSmJghEhE0ALSg61FtcunVMt1vUEP1mCDQ5TnELiREkVBP5QBA5WMrxFG4iczh/bsUhUbsDI%2BNSuyRJZJzYNDuxsgpMVRiiOKet6fqBsGoZ6oaxo8nEhVsiVtGjvBqMKISGYQLhhnuPm0iA1Dej/UzlzEaRb1hjjFrAwtDzg1wYX3UFj1zSpc2c26PEenTlkXMkiSuDpEBeuTvZtYOlk%2BYeNkPOtcuoArqzTSrFMPPmZOEmr7wS8a267HTGs0YjoootqJv3h6fbnactOSBFapfAAnBokQaGH4dcOHEeR2HkdcHHsfxxoMcR1HMcp3Hmep8nYekCiQch6nScJ1HpdJ2n8dZ7Hyfp5XteJ4nMd59FkVha79GNo0LZth2Xb6j2GZ9tSoVMn2q5Muy/uefcjzos2j0vPZ4Vrbrq3nc4qgaPmi90nSgPKuuzfEzPPjkre9CL0v4q66vLyMhvGjUjve/x4sh/Ty8n7AAwl9X6tnxrTXvfTeT9HggxfhZd%2BI4T5a1/n/G%2BgC77Ugfn7MBu9AavCgcfF4JA4F/3/rfR4wCNCdTQS/SQb86RH2dCfSIdVCR4Psgg9aSCH6gJWug1%2BWCaGfwYGec8j5GFimYUA5Bm84jPzFIHSh1DxQn3LG4Z8dBMBCJEawzebJJFwxkR/R4AIzxQSEdfFeiCiFiMfpIrhVDdE%2BBiMQLAJ5iCqJMSwsxD9NFkLFPDbhciXhkWQAgIxwiXGiLYZYyB1joEvGbFMIJwSAGuPXpvVBHCX6YMidgx4UwSK2CCWotxm9t6eMjjoqJjwWRxPyUkixxSImyLFCfQKzk8khPUVvSxB8Mk8L0eSJghBKmtIKTU1JgM6k2McgoTwKiwHwMGdUopIySk%2BIaTg9sABHdw0yVqzISaEwpHTSmZJ8O2ZAhIWwtN2W0hZ4D96HO6T4EgsCZlXyqcQ65nDOn1Lmi8D8Tjnn4NeeYvQli9B3N8Y8SCdUAlMEiBff5gKH6RC0dSMFKzHj7jqugfEohaBwIRZvJFnjdgouWd8vRfCqC6jYM4y5QyPEjO0aSk%2BDBUAhF6qEGlhDqn0puYyrp4KfAOJiAM2l1T2E3KsV8k%2BxEzxxPiVy4hwLimgqZS8BKhLtn4IIaY6pSrFkqv5WinwW0Qjf1YAZE5WztWJOIVa9By1UVkp8DiOV8qdXENIYsihqryXoFdfijQeqJUGqlZ/Wg%2BJyQ7WIKgRhAbA5aPxj62xxBo1/M1S8uZxDxWcLGWUnwvdiCYSYBsWNmbzHxqJYmw1TqVKuutXskhljvXVuZSkLaj4gyltFcQitDKq2hseOyy22Z0h4rLYi5FjqT5stmBchV5j3kv0%2BTY9EmI53uoXQcpNAIWD%2BvHZvINnCQ02JZZ%2BAERiA0SKJdIpNkzMJOAvfujQV6GU3pbS8BQ5JCABPXTazdxTl15sgqO/5S8A3ZogVOl4jBPByoDSkiV6SB0%2BG2HYBgmzOUbvcVo7x77Hj8DTVqt1f6H6HpfsevNOLaDbHLJhkjGicNQfKagG4dhqWgeIw2nl9rcNfIhP7Za1JqScjBsJwTYnRMiaE1JiT0nxMyYU/JpTknlNydE15I%2BiNVQcGWLQTg1JeDeA4FoUgqBOAAC0LD7FWOsQ8Dw9B6F4AQTQOnlgHg7EMCAyxCQgGpD4CEcQ/NskDlwNk%2BYfBsgqHoQsemOCSF4CwCQucjMmbMxwXgCgQAaFIM54zOnSBwFgEgNANxlFkAoEZFjiQysgFMGzBghI%2BB0HnpliAkQXOkEiCEBoZ5OA8E6914gZ4ADykRtDZj67wErbBBDDYYLQXreXSDQlhM4MQtBMvcF4FgL0JhxBLfwI5GolZNsmfRNUdwzZJvkEEB0DrvU6E9dcFgDrxFrjXcrMQSIKRMCnEwLt4A7LQB5eWFQIwwAFDJjwJgckw2O3Xf4IIEQYh2BSBkIIRQKh1BLd0AYIwJhasWEMHgSImXIDLANl0TbC1hu7AAEosQBJgAAYodRaoxgCnl2KoML%2Bo6YLXZe4VQi0WDIASoqUwDBPuOdM594gX4DLwGWFUaC3gIBOHGN4fwQRZglDKBIJIKQ0gCE1wbvIxuGD9D1wsdonRajTFN/4FXXQeiNCt4McoIxeiO69273XHuJDK5sxsfQun9OGY62l3Y5hgB7hehTCAuBCAkFWg5xYTmXNUVID5yQcQOq58jpFvQcRQs%2BHzDFzg8XSCJabil3gaWMtZZy5nsPHAfAR6Ww35vIPlifdSA4SQQA%3D%3D"></iframe>
</section>


<section data-background-gradient="linear-gradient(rgb(114 0 0), rgb(0 11 98))" id="lookup-riscv-emit">
    <h2>RISC-V SWAR emit</h2>
    <iframe style="margin-top: 20px;" width="1920px" height="960px" src="https://zig.godbolt.org/e#z:OYLghAFBqd5QCxAYwPYBMCmBRdBLAF1QCcAaPECAMzwBtMA7AQwFtMQByARg9KtQYEAysib0QXACx8BBAKoBnTAAUAHpwAMvAFYgAzKVpMGoAF55gpJfWQE8Ayo3QBhVLQCuLBiAAcpJwAyeAyYAHKeAEaYxCAArKQADqgKhPYMrh5evonJqQJBIeEsUTHx1pi2aUIETMQEGZ7eXFaYNnYC1bUEBWGR0XFWNXUNWc0KQ93BvcX9sQCUVqjuxMjsHGgM4wDU4%2BhbAKR6ACJbAAJ4LEl1EPsATLe7d7dzhwBC%2BxoAghvbEe50dgYB2OZwuVwIN3ufwBwSeLz07y%2BPwIWyYCiUdWBJ12ADosH9gDi0RiCG8Pp9yZhVOCtlQgbRUKgANbuBIQJkAdxAB1irwAVPtYkdkVt3H4tvRvKK9M9RT4DgB2RGfLaq1Ho6IQyVbMBgQ4nDTw5UHL5qrYi4hMDkAfQQaIQWK2doUCAA0hz2RzSBLGEbyWaRc6HfqtiwmAkACqoACSDCwqgglptQb9pv9apFroA6taAGrYZyO065ipEYgQLgANm9YtTKozAm2ADcKlxudm8wXHQoSARMOhrQkmOgsAPOQpBa8g4KjmTTQ3NiiW8hbu2c/nCyHOZONDicVWZziBQitgB6U9bAgITA7JhUTAEACeW1QVEvCDwChfCWiTHaQM/LYmzEPB0D/ftURRK8byIBIXzfK9AKodwGEqAR01VEVJWtZc107TcQVOBQEiMCFTjRCAxW9U4CGIFDRD7CBJTmFi53rTDGxRZA9hDIjWlLSjxWw5dgWwHYCHQHEUhYST7BqQTvSrBYgIqW5vWEio6xNditjwN8IFxaTJLQFCCAjOjMAUCBuJ1PUQWXLg5ixENDUVY0zTVYgH2WIEAD9pwRDDFROVolDcoKzS8ggfK2DQ2LNfYFVnL5EuSikvjpCVGRZBIhCzT4ACVPW5ScBSFEUqJ9KV3BlJyxXC%2BdVWJTUmMYWyXK0hdtiTW17UdIN3U9dTfXirqUSDR0w0jGM4ypRMrV6l1Oo4xcgLEa1tRDHs6n7Qdh1Ha1x1uSdpyFScqy2ABaLYuBnN4zwvScWGCQ6bUlb0w1UV6NsYO7Gt0/TtV1ENgNoH6GCcqKYriwKUv%2BkUAEVHXcStJFGlbtmYOwW2tJw8GMR00EuOw2C2aFaEBHFkASdwiRWBAcTx4wIGW81OKy4BrWCAhrRRLaJJxMMrxxAJUGAW5YwhXE2BqHFJYgHEUJSYAQnQaiUlMTAAHkqAgBGWNZkVnoUECVbYQRDuiEJaCLCiGU57neeo2j6PAiBzkEAAxYhUBYZRaM9A30bZ1bjdNhhzb5wiKOlh8mDlwQFaVixVeoiJCCEPBNZ1pixa5i2CCcu5Xi2PRlLD2gU8jy3iGtpy%2BS2Hxg5FZAEBQpk2x5fkZ3D92Ne13X9acir5V4hJaO9335djlgiUrlXXiYZBOVqdBKP76jucnv2A85ZSiKzge9aD2GdJFbmuG7AW2Fnrzh3lhHvVb9vbt5XccQP7PB5eIVvSxvAcZMwhmxIKIoaDMFoJfLaHJCCty2BAf%2BgC4z4whg1HSZocSVwIAQegzk9BiQvqJQ4YkK5V0YAQUgEU1Q4nTsAPBBDBBQL0M4Q4hZSFm3IZQ/6qVm7s2fgwJkq4u5lSOL3T%2BR8h4h22PVEM/CO4HFuCXcROd9a8NWtzW4V9JI3xxHfdAD8n5twEcdN%2Be5lHfxnH/P8ADMC42QcYOsoD2aoGgsQR0vl2ER3IQo94txYg3TUdscotgSC2yso/UEXsfYsFeIyWgEBPGRzwQaFiV07j%2BNuqfJxq1wFiE0dA2BDoEHWKQfgBxaCPLUKwTgm8%2BpiG6UEPk5hrCXyuK4eg6htD6ENIIE07A9SXHXjIEFHhWT4bs1ybQPQ3YYEEDgcU7GtigFFyVFQ1UmDCA1O6Rooh%2BDQyfnDpHdplT1ldLqXsnZrCWmJM4SMpKIDxmrTkZIEqvIRFiP7io1JI9CZGMET4s4nyLGnwDOzbmkgtGC0wLfTA99E4ROeTuMxQLj6WK2IgpZ9jgFjLPhM4IYgIUFLmUUjFdiymoMSu5SpGzsG4POQwgghLmnMNaUM45JyaEWG2YIJl/S9mDOiOy1UozlRBWAm4jkJB0CdyRiGSZUCFSFmoPi2g%2BTbiVh2PxEJxBWbiq2JK4g6AhGypBJM6ZiUlWTMJeqzVbQSCOMeb8R8fZwaOm1A3JuOKzR6XgREZ1tjNostRisqlHlmrXD9S6oGdkUnB1BatF0ekCCdxRkWbmzg0QQlRldMm/rwaszNAa6Vjoi1MJYSyxNVBk27LEpW5NwceFw1xQmj8VamknC4LceU11I0Bt%2Biec8WwIxayOFrbkoggQchvO4MKHJLRDh9ihPYQzMCHE9kFIt7aAbwLrX0kMwbYpbFCjeTdwJy2Fg9vUTNBlW29KLvg%2Bpl6M3jBvUm54DydIKFmfM0lyyKkcuqXS449TT0Wt4hRU4EZHw/hzpu5SzEz0tPdunYQh8c6Qeg0fODTlro%2BAWGsrYnK6H0v1VK/JirwNWQwzB3WcHhoQyFcFck2SglLBWLY0tYSIB8l7nhqRKIUbSDOOHZ9ZFx7EFEwZXsu0hwjl2kdE69o7qmJxE3IUOJxMGyPIElEPZlirGtKB6OVkePzwYBAPjFVUbURE9e044nJPbT7AOWTB0FO8lOrOXkPg9wHnU5pli2mB2PWZYWUeD69metFf9H1EBOPnOxGxgznHjB7CM7OEEen2OGbIyGgjUNa5bH8kpkFapUpHtoGFSl%2BXvKFZhqGxtFJ7lpi%2BDTCItIgQDQ9JyV53dyrs0qpKbkNVZTuAVP%2BjGKImCQp0Xo%2BW7gqzem3CpkxRxvQ0pqYbdm7X%2BbaOhbo2F%2BjE4LerPAzkOa1VKIojOw%2Bm9BCSeYqxFbaKNv0FZgVoENE6KoTdlAabgoxKtSBFcllUhUkCj8WTe9fKxJ4ZAc1lU5JMpTSjLGeM81kz2mGwqOqo9VmOpRGGBQTJHTu2u9Zm697z1nBdj9xiPUUw4fSQE0rqoPvwNiwzvqxD92SCcvZ1ACRXCmQSWiJkE434zicse2KRdFFnCSELpYicick7uBq1XEvXhc5dGeLYqMpfw7StpI2YuvwhknKtwT1W4YAE4NARA0E753XBncu9d0713XAvee%2B9xoD3Lu3ce4D170Pgf/dO/aR8e3jvPf%2B59wHt37uk/e7937uP6fU%2BZ%2BDznj3Uf7kgvJCKJzMn9ryY5ObkEk5YhxTOryPzRwxQ250pCW4VI%2By1yeCc4Viji4KJMc4VQGhKxd75A3V3cwjyMdbxyD89Au/d58X3p4gpB8aFiKP8fjkp9BVb%2BHBf3fi7L/uKvofG/7hbDHzdbffJp9PGPQfw/vf5cr9iGvtGF%2Br%2Bdsn7f3fTwSCP6L5H4v4n5v5D7HSf7j58477/St4RB3xMiAEeTAElyv5r7n6aJf435373DGDOqYZIE96%2BKoGgFr4Kib6qi24/44G3BNhuDWLz4X6VIoH96n4aBNyQGqh4YwEt5PBoiPioSEFlbP4kED5n4UHe7UF/73DRCGqYD3jECEEsFoFD4cGYENyNxSGwFPAMStxCFEHH5iHr4SHYHSG3B9jjD6EGEgFGEf7qE3TPA8Fmit7jB0S2D6HKGkFD4j6cET5OFqit7IhWGeFGEYGX5b5aG8H3AfYeEiGsFgHD4SGGj%2BGqh74chMCEDBFxEqHGG%2BGmHaHRGWSeCrpMEnIhFsE%2BH2F%2BG/4FG3CC5MAACO7gJRmiT%2BxB8Ra%2BlR4RN0yRNRURtwQ4y8/YsR7RORXRX%2BvRNBJAD%2BpRzB2RXhiRvhkxZh4qVh1hohbBegEhZcKR8CTwKEd8rcTAEQjBrR6xHRQ%2BEQFBWw8wuxreV4eiDIogtAj%2B5RCRVxnBNxkRzhfBDAj4VAlobASh8xRhah3RmhdxTwDAqAwQlcIQwJoxCxYJV%2BEJfRPx9wWAChWRiJoRJh3xARTwtEj4axS%2BNhmx2x%2BJqRTwbWJJbxa%2BWxvhOxaJBJ9wN2JgzAbAxES8LRpJGxCRPJKJjhzJVJ9wdIJJvJFxGgEBVR0BwpexuBcYtJIJ5JjJlJ8ptwYgDIHImsPsSBdJQ%2Btu1xOOkJMhxAPsihsxcxOJbBYRWBape%2BI4xAXJqwepypCRhpnxxpcpreek4p%2BpUpEhspNB0JCgM6P4iplpEpORHp9hWwXpNBcJ4upYaQrxbpa%2BHxsZtx3pTwsJUwIxhhFRSR9p9%2B1IvY%2BZZJCR4x4%2ByxtRaILASp1pCRDJVRTJwZqAIEaIQh/p5BnxVBJpDwYZTgXZaZQ%2BPZsZfZ2Z9wX6hS5ZfJnRRZ/ZKEKZkZCUI5uRVR%2BR/RjAngax/pdh3R3%2B/ZGwgIzRCJBZCRyJGh3Bk5tw/AFpZxQBa5zZB5rZZhzxtAGwTYZ5FZa%2Bl5XBxZ9wRM48FwPJVp55v51x15jGOIlKWwfi8QcFsQCF8F3oKFiFyFSFqFmF6FWFGFeFuFBFOFRF8FwU%2BeGW0W3w7MJeLmZeY4FeW61eteXmrwDeTe%2BOW5qgHeDAs5kpcUSxAFtws%2BdAoFbR4FQ%2BfFG5Al%2B%2BK5whjZa%2BElB5m56JbelWIlolP54lEhQpUx95i%2Bq5clmlvhQZZh8BsKiBMl5xORCldp/ZeBT4P4w5BlTu1xE5NBdBpEwl35c5hlsZUFZh/BghFlUZCx1lER/ZshmJ0QXlvFkFAluhCA2JYlzleRAlFhpIQVwVRhoVDhAlrh7g7hFl/p2V1RNBQRQVRVeJ/ZMRhVa5xVNZ/RVoGR6VD5YFGlyVklVVRRQJNVTldVAl9RTRalyBtVC5N5gxTIwxPVSVfV/Z0xqlPFVlo1bltQDZ01FJi5DAhxdoJxalFVnxWZNBDxh2TxYgqZvV1xB1/lfxAJrAQ1llIVsV/Z0JuZ8JK5e1vlAlkVulj551KV/ZRJq1bVxVr5tRNJGVmVbBwNAlbJKst1zpPJ714J2lZhYp4NENCRxVxltZEZLVZRI1qptltAWpOpqArpv1sZ8ZZhshAB5V%2BNHVN5%2B0Tpgxd1iNKJlNtRvpaNrNUBAlIZg5ONrV3l7V4J7N/RiZSgaE3Fsx3Nqol1HNDAcJd1sla1/F4VpZdQC1D1qtDNCg9Z4NMtXAIN/R0JHZE4MlMtWwrlZhoZxEQ55tdN4JVttR05xKmtWVS1ZhS56EtN5NilAl25etuNw1vtX%2ByNtRx5wQp5b1DtKJfltRd5gNQtUNR5mpn50Vi1nxcd/RQFJMStFtWdGCsFaFxd2FJd%2BFxFpdld5dZdhFZdpFzGBerwHACwtAnAsQvA3gHAWgpAqAnAAAWlyllqsAonoHoLwAQJoM3QsNeMOP0CzKQEyHEFwDiPcHoDXgqJILbpILED4Jha3RwJILwCwBIJHp3d3b3RwLwAoCABoKQBPV3c3aQHALAEgEBcJWQBQNZL7AkO/SAKYLTkyHwACNENfRABEJPaQOnMwMQI%2BJwDwJA/ijA1rBENoKWHA7wETJHFrArbAw/aQPiO4MABmkTdfdwLwFgGGCYOIHg/gF5JUC2KQ93VSBUO4H2Og%2BQIIK0BA5XPAbUI%2BK4FgBA7RBcOwy2MQBEMkJgEcNCsYMAHCaAA/QsFQEYMAAoLmHgJgByFrOGew/wIICIGIOwFIDIIIIoCoOoHg7oAYEYCYH/RYIYHgBENfZAAsILv%2BKQ5dFrFsAVPxGiJgJ7JmldEMMAA%2BFsMQJ%2BMgE2KjJdHCe4KoFdCwNTO4PqCkDQDjGNofT3WI%2BE1gM4/PcEv%2BI4HGCME0P4HGD0EUCUBIDkCkP%2BCU9U0kLU2kBU30DEGMFqv%2BJ0MMG4I0NUwU1UBMC0zMG04MF0PU2MIM1MJU/0I5IsPpuwGXIYG3R3RAxfVsOYHQgA/ArgIQKEncKPXMOPZPSxAvSAJID5gqAqKjLbn4uvpIFILEGpPvZk8fXnmfbwBfVfTfXfccy3ZwLcCs3g58z84owsGIykA4JIEAA%3D%3D"></iframe>
</section>

<section class="text-only" data-background-gradient="linear-gradient(rgb(114 0 0), rgb(0 11 98))" id="passive-newline-bitstring-production">
    <h2>Passive production of<br>newline bitstrings</h2>
    <div style="width: 70%; margin-left: 15%; margin-top: 40px">
        <ul>
            <ul>
                <li class="fragment" style="width: unset;">I noticed the following code in Zig's AstGen.zig:</li>
            </ul>
        </ul>
        <div class="" style="height: 1200px; width: 400px; position: absolute; scale: 2">
            <pre class="fragment visible" style="width: 400px; top: 340px; left: 220px; height: 210px"><code data-line-numbers="|" data-fragment-index="1" class="tokenize2 hljs language-zig" style="font-family: 'JetBrains Mono', monospace; font-size: 7pt; margin-top: -3em; position: absolute; box-sizing: content-box; width: 100%; height: 100%">fn advanceSourceCursor(astgen: *AstGen, end: usize) void {
    const source = astgen.tree.source;
    var i = astgen.source_offset;
    var line = astgen.source_line;
    var column = astgen.source_column;
    assert(i <= end);
    while (i < end) : (i += 1) {
        if (source[i] == '\n') {
            line += 1;
            column = 0;
        } else {
            column += 1;
        }
    }
    astgen.source_offset = i;
    astgen.source_line = line;
    astgen.source_column = column;
}</code></pre>
        </div>

        <svg class="fragment" id="stagger-svg" width="100%" height="550" viewBox="-15 -5 3615 1505" xmlns="http://www.w3.org/2000/svg" style="margin-top: 360px; margin-left: -500px"></svg>

        <script>
            {
            let id = 0;
            const boxes = new Array(3*24).fill(0).map((_, i) => [0+70*(i%3), Math.floor(i / 3) * 70]);

            for (const [svg_i, [color]] of Object.entries([["blue"]])) {
            let box_fills = [
                ..."abc".repeat(24)
            ];

            const innerHTML = `<defs>
                <marker
                    id="arrow"
                    viewBox="0 0 10 10"
                    refX="5"
                    refY="5"
                    markerWidth="3"
                    markerHeight="3"
                    orient="auto-start-reverse"
                    fill="#fff">
                    <path d="M 0 0 L 10 5 L 0 10 z" />
                </marker>

                <filter id="blurMe" x="-250%" y="-250%" width="600%" height="600">
                    <feGaussianBlur in="SourceGraphic" stdDeviation="10" result="blurred" />
                </filter>

                <filter id="blurMe3" x="-250%" y="-250%" width="600%" height="600">
                    <feGaussianBlur in="SourceGraphic" stdDeviation="2" result="blurred" />
                </filter>

                <filter id="blurMe2" x="-250%" y="-250%" width="600%" height="600">
                    <feGaussianBlur in="SourceGraphic" stdDeviation="4" result="blurred" />
                </filter>

                <filter id="blurMe6" x="-250%" y="-250%" width="600%" height="600">
                    <feGaussianBlur in="SourceGraphic" stdDeviation="2" result="blurred" />
                </filter>

                <filter id="blurMe1" x="-250%" y="-250%" width="600%" height="600">
                    <feGaussianBlur in="SourceGraphic" stdDeviation="1" result="blurred" />
                </filter>

                <g id="deer_me" stroke-linecap="round">
                    <rect width="50" height="50" x="8" y="8" fill="none" />
                </g>

                <style>
                    .flicker, .neon-text text {
                        font-family: 'JetBrains Mono', monospace;
                        font-size: 40px;
                    }
                </style>
            </defs>`.concat(
            Array.prototype.concat(
                (() => { id = 0; return []; })(),
                boxes.map(([i, j], iter) => `<g class="flicker-${id++} flicker deer" data-color="${color}" transform="translate(${i}, ${j})">
                    <use xlink:href="#deer_me" stroke-width="6"/>
                    <use class="glow" stroke="#fff" xlink:href="#deer_me" filter="url(#blurMe1)" stroke-width="1"/>
                    <use class="glow" xlink:href="#deer_me" filter="url(#blurMe)" stroke-width="10"/>
                    <use xlink:href="#deer_me" filter="url(#blurMe2)" stroke-width="6"/>
                </g>`),
                (() => { id = 0; return []; })(),
                boxes.map(([i, j], iter) => `<g class="flicker-${id++} flicker deer" data-color="${color}" transform="translate(${i}, ${j})">
                    <use class="white" xlink:href="#deer_me" stroke-width="4" stroke="#fff"/>
                    <use filter="url(#blurMe3)" class="white2" xlink:href="#deer_me" stroke-width="5" stroke="#fff"/>
                    <use class="white3" xlink:href="#deer_me" stroke-width="5" stroke="#fff"/>
                </g>`),
                (() => { id = 0; return []; })(),
                boxes.map(([i, j], iter) => {
                    const n = box_fills[iter];

                    global_animations.push({
                        section: "passive-newline-bitstring-production",
                        selector: `.flicker-${id}`,
                        slide_num: 3,
                        animation_delay: "1s",
                        animation_duration: "5s",

                        keyframes: {
                            0:   { transform: `translate(${i}px, ${j}px)` },
                            100: { transform: `translate(${i + Math.floor(iter / 3) * 70}px, ${j}px)` },
                        }
                    }, {
                        section: "passive-newline-bitstring-production",
                        selector: `#flicker-2-${id}`,
                        slide_num: 3,
                        animation_delay: "1s",
                        animation_duration: "5s",

                        keyframes: {
                            0:   { transform: `translate(${i + 30.5 - 10}px, ${j + 56 - 10}px)` },
                            100: { transform: `translate(${i + 30.5 - 10 + Math.floor(iter / 3) * 70}px, ${j + 56 - 10}px)` },
                        }
                    });

                    return `<g id="flicker-2-${id++}" class="flicker neon-text" data-content="${n}" data-color="${color}" transform="translate(${i + 30.5 - 10}, ${j + 56 - 10})">
                        <text class="white" stroke-width="3"> ${n} </text>
                        <text filter="url(#blurMe6)"> ${n} </text>
                        <text filter="url(#blurMe)"> ${n} </text>
                        <text class="white" stroke-width="1" stroke="#fff" fill="#fff"> ${n} </text>
                        <text class="white2" stroke-width="2" stroke="#fff" fill="#fff" filter="url(#blurMe1)"> ${n} </text>
                        <text class="white3" stroke-width="2" stroke="#fff" fill="#fff" filter="url(#blurMe3)"> ${n} </text>
                    </g>`;
                }),
                ).join("\n")
            );


            // global_animations.push({
            //     section: "keyword-lookups",
            //     selector: `.whitespace-box-${svg_i}`,
            //     slide_num: svg_i,
            //     animation_delay: "6s",
            //     animation_duration: "1s",
            //     continuous: true,

            //     keyframes: {
            //         0:   { opacity: 0 },
            //         100: { opacity: 1 },
            //     }
            // });

            let resize_event_id = 0;
            addEventListener("resize", event => {
                const cur_event_id = ++resize_event_id;
                setTimeout(() => {
                    if (cur_event_id === resize_event_id)
                        document.getElementById(`stagger-svg`).innerHTML = innerHTML;
                }, 30);
            });
            document.getElementById(`stagger-svg`).innerHTML = innerHTML;
            }
            }
            </script>

    </div>
</section>

<section class="text-only" id="more-tokenizer-info" data-auto-animate data-background-gradient="linear-gradient(#400, #000)" data-background-transition="none">
    <h2 style="color: #fff">Want to learn more<br>about the tokenizer?</h2>
    <div>
        <ul style="margin-top: 1em">
            <ul>
                <li class="fragment">Our SIMD on-demand unescaped-quote matcher was designed by the creators of <a href="https://github.com/simdjson/simdjson">simdjson</a>.</li>
                <li class="fragment">The utf8-validator was ported from <a href="https://github.com/simdjson/simdjson">simdjson</a> / <a href="https://github.com/simdutf/simdutf">simdutf</a> by <a href="https://github.com/travisstaloch/">travisstaloch</a> and myself.</li>
                <ul>
                    <li class="fragment">I wrote equivalent SWAR routines so machines without proper vectors can exploit data-level parallelism too!</li>
                </ul>
            </ul>
        </ul>
    </div>
    <div class="fragment">
        <img src="/images/lemire-simdjson.png" />
        <div class="img-attribution" style="top: -350px; position: relative; background-color: #000; border: black 4px solid"><p>Daniel Lemire - Parsing JSON Really Quickly: Lessons Learned<br><a target="_blank" rel="noopener noreferrer" href="https://www.youtube.com/watch?v=wlvKAT7SZIQ">https://www.youtube.com/watch?v=wlvKAT7SZIQ</a></p></div>
    </div>
</section>

<section data-background-gradient="linear-gradient(rgb(114 0 0), rgb(0 11 98))" id="term-sesh">
    <script async id="asciicast-IIHiYbEzjH16HZKj2P1miehao" src="https://asciinema.org/a/IIHiYbEzjH16HZKj2P1miehao.js"></script>
</section>

<section class="text-only" id="zig-compiler-intro-deux" data-auto-animate data-background-gradient="linear-gradient(#400, #000)" data-background-transition="none">
    <div class="fragment">
        <img src="/images/zig-compiler-internals.png" />
        <div class="img-attribution" style="top: -190px; position: relative; background-color: #000; border: black 4px solid;"><p>Andrew Kelley - Practical DOD<br><a target="_blank" rel="noopener noreferrer" href="https://vimeo.com/649009599">https://vimeo.com/649009599</a></p></div>
    </div>
</section>

<section class="text-only" id="zig-compiler-intro-deux" data-auto-animate data-background-gradient="linear-gradient(#400, #000)" data-background-transition="none">
    <h2 style="color: #fff">Part II: The Parser</h2>
    <ul style="margin-top: 1em">
        <li class="fragment">Converts tokens into a tree-like represenation called the Abstract Syntax Tree</li>
        <ul>
            <li class="fragment">This is the stage where we validate that the source code fits the <a href="https://ziglang.org/documentation/0.12.0/#Grammar">"language grammar"</a></li>
            <li class="fragment">We also figure out the order in which operations are supposed to be performed.</li>
            <ul>
                <li class="fragment">We need to deal with every operator in the language, including `try`, `catch`, the comparison operators, `.*`, `&`, etc.</li>
                <li class="fragment">We also disambiguate between the multiple ways an operator can be interpreted.</li>
                <ul>
                    <li class="fragment">For instance, `-` can be a binary subtraction or a unary negative based on context.</li>
                </ul>
            </ul>
        </ul>
    </ul>
</section>

<section class="text-only" id="ast-demo" data-auto-animate data-background-gradient="linear-gradient(#400, #000)" data-background-transition="none">
    <h2 style="color: #fff">AST Demo</h2>
    <ul style="margin-top: 1em">
        <li class="fragment"><a href="https://ts-ast-viewer.com/#code/GYVwdgxgLglg9mABMOcAUBDAXIsIC2ARgKYBOANIoTnkWZRDQSRYgCZN2vGcsCUiAN4AoRGMQxgiTIgBksqgJHiViDIgC8iANQz5VTVog72iAFSJifANyjxAXztjSxKCFJJit+0A">ts-ast-viewer</a></li>
    </ul>

    <div class="fragment">
        <img src="/images/lsbasi_part7_genastdot_01.png" height="1000px" />
        <div class="img-attribution" style="top: -340px; position: relative; background-color: #000; left: -100px; width: 500px;"><p>Let’s Build A Simple Interpreter. Part 7: Abstract Syntax Trees<br><a target="_blank" rel="noopener noreferrer" href="https://ruslanspivak.com/lsbasi-part7/">https://ruslanspivak.com/lsbasi-part7/</a></p></div>
    </div>
</section>

<!-- // -(-b * -c - -d.*.?) / (e + f) * g + h - -i.*.? * j * (k * (l - m) + n / o);
// ; - + * / unary - ( - * unary - b unary - c unary - .? .* d ) ( + e f ) g h * * unary - .? .* i j ( + * k ( - l m ) / n o ) -->

<section class="text-only" data-background-gradient="linear-gradient(rgb(114 0 0), rgb(0 11 98))" id="ast-traversal">
    <h2>Pre-order vs<br>in-order vs<br>post-order in code</h2>
    <div style="width: 70%; margin-left: 15%; margin-top: 40px">
        <div class="" style="height: 1200px; width: 500px; position: absolute; scale: 2">
<pre class="visible" style="width: 500px; top: 300px; left: 190px; height: 105px"><code data-line-numbers="|" data-fragment-index="1" class="tokenize2 hljs language-zig" style="font-family: 'JetBrains Mono', monospace; font-size: 7pt; margin-top: -3em; position: absolute; box-sizing: content-box; width: 100%; height: 100%">fn parse(node: ?*Node) {
    if (node == null) return;

    // Operate on the Nodes in pre-order
    parse(node.left);
    // Operate on the Nodes in in-order
    parse(node.right);
    // Operate on the Nodes in post-order
}</code></pre>
        </div>
    </div>
</section>

<section class="text-only" data-background-gradient="linear-gradient(rgb(114 0 0), rgb(0 11 98))" id="mainline_parser">
    <h2>Zig's current Parser</h2>
    <div style="width: 70%; margin-left: 15%; margin-top: 40px">
        <div class="" style="height: 1200px; width: 900px; position: absolute; scale: 2">
            <pre class="visible" style="width: 900px; top: 300px; left: 90px; height: 500px"><code id="zig_mainline_parser" data-line-numbers="|" data-fragment-index="1" class="tokenize2 hljs language-zig" style="font-family: 'JetBrains Mono', monospace; font-size: 7pt; margin-top: -3em; position: absolute; box-sizing: content-box; width: 100%; height: 100%">asdasdasd</code></pre>

            <script src="./zig_mainline_parser.js"></script>
        </div>
    </div>
</section>

<section class="text-only" id="alternate-strategy1" data-auto-animate data-background-gradient="linear-gradient(#400, #000)" data-background-transition="none">
    <h2 style="color: #fff">Chandler Carruth's strategy</h2>
    <div>
        <ul style="margin-top: 1em">
            <ul>
                <li class="fragment"><a href="https://www.youtube.com/watch?v=ZI198eFghJk&t=3469s">Modernizing Compiler Design for Carbon Toolchain - Chandler Carruth - CppNow 2023</a></li>
            </ul>
        </ul>
    </div>
</section>

<section class="text-only" id="Shunting-yard" data-auto-animate data-background-gradient="linear-gradient(#400, #000)" data-background-transition="none">
    <h2 style="color: #fff">Shunting yard</h2>
    <div>
        <ul style="margin-top: 1em">
            <ul>
                <li class="fragment"><a href="https://en.wikipedia.org/wiki/Shunting_yard_algorithm">https://en.wikipedia.org/wiki/Shunting_yard_algorithm</a></li>
            </ul>
        </ul>
    </div>
</section>

<section class="text-only" id="alternate-strategy2" data-auto-animate data-background-gradient="linear-gradient(#400, #000)" data-background-transition="none">
    <h2 style="color: #fff">More memory efficient strategies</h2>
    <div>
        <ul style="margin-top: 1em">
            <li class="fragment">We make the Tokenizer emit 2 bytes per token. 1 byte for a kind enum, 1 byte for a length</li>
            <ul>
                <li class="fragment">If the length is >255, we store a 0 as the length, and let the next 4 bytes be the true length.</li>
                <li class="fragment">This makes the worst case memory consumption scenario a lot better. Now our 1 byte tokens will be mapped to 2 bytes, and our 256+ byte tokens will be mapped to 6 bytes.</li>
                <li class="fragment">Drawbacks:</li>
                <ul>
                    <li class="fragment">All bytes in our source file have to map to a token, even whitespace and comments.</li>
                    <ul>
                        <li class="fragment">Luckily, for most of our tokens, the length is irrelevant to later passes. We only care about the length of identifiers, strings, numbers, and data that we actually need to look at later.<br>A `return` is a `return`, and we do not need any further information beyond that.</li>
                    </ul>
                    <li class="fragment">We have to visit all tokens so that we can properly add their length to our cursor.</li>
                    <ul>
                        <li class="fragment">We don't really want to skip over anyone's hard-fought, artisan-crafted code anyway</li>
                    </ul>
                </ul>

                <li class="fragment">Benefits:</li>
                <ul>
                    <li class="fragment">We can dramatically reduce memory usage!</li>
                    <li class="fragment">We can dramatically reduce memory usage!</li>
                    <li class="fragment">Did I mention we can dramatically reduce memory usage, like by a lot?!</li>
                </ul>
            </ul>
        </ul>
    </div>
</section>


<section class="text-only" id="succinct-vs-implicit" data-auto-animate data-background-gradient="linear-gradient(#400, #000)" data-background-transition="none">
    <h2 style="color: #fff">Succinct vs implicit</h2>
    <div>
        <ul style="margin-top: 1em">
            <ul>
                <li class="fragment">We want to store our trees without pointers to avoid O(n log n) bits being used.</li>
                <li class="fragment">There are two classes of data structures which allow us to escape that regime, succinct and implicit.</li>
            </ul>
            <div class="fragment">
                <img style="background-color: white;" src="https://simongog.github.io/assets/data/sdsl-slides/images/bps.png" />
                <div class="img-attribution" style="top: -890px; width: 220px; left: 0px; position: relative; background-color: #000; border: black 4px solid"><p>Simon Gog - Blog<br><a target="_blank" rel="noopener noreferrer" href="simongog.github.io">simongog.github.io</a></p></div>
            </div>
        </ul>
    </div>
</section>


<section class="text-only" id="implicit" data-auto-animate data-background-gradient="linear-gradient(#400, #000)" data-background-transition="none">
    <h2 style="color: #fff">Choosing implicit</h2>
    <div>
        <ul style="margin-top: 1em">
            <ul>
                <li class="fragment">Disambiguation makes it so all tokens have a known arity, and are known to be a prefix/infix/suffix operator</li>
                <li class="fragment">Therefore, an implicit representation can be modeled as a simple re-ordering of the tokens that gives us sufficient information to check syntactic correctness and get the correct order of operations out.</li>
            </ul>
        </ul>
    </div>
</section>

<section class="text-only" id="alternate-strategy2" data-auto-animate data-background-gradient="linear-gradient(#400, #000)" data-background-transition="none">
    <h2 style="color: #fff">Analysis of direct postfix consumption</h2>
    <div>
        <ul style="margin-top: 1em">
            <li class="fragment">Inherently, using an algorithm that rearranges data solely by pushing to and popping from a stack, we can only move data to occur later than it did originally.</li>
            <ul>
                <li class="fragment">Prefix operators can be moved to in-order, Infix operators can be moved to post-order, and Postfix operators are going to stay in post-order.</li>
                <li class="fragment">In order to use the `length` trick I want, we cannot use a Post-ordering of the AST/Parse Tree, because we have to know the pre-order, in-order, and post-order to pull it off.</li>
            </ul>
        </ul>
    </div>
</section>

<section class="text-only" id="my-idea-for-ast" data-auto-animate data-background-gradient="linear-gradient(#400, #000)" data-background-transition="none">
    <h2 style="color: #fff">My Design</h2>
    <div>
        <ul style="margin-top: 1em">
            <li class="fragment">We model all tokens as either an operator or and operand, and shove it into a specialized version of the Shunting Yard algorithm.</li>
            <li class="fragment">Sometimes, there are some oddities in well-formed Zig code.</li>
            <ul>
                <li class="fragment">E.g. `break: blk thing` has two identifiers next to each other, so the whitespace in between them will get its own token.</li>
            </ul>


            <li class="fragment">Example transformation:</li>
            <ul>
                <li class="fragment">-(-b * -c - -d.*.?) / (e + f) * g + h - -i.*.? * j * (k * (l - m) + n / o);</li>
                <li class="fragment">; - + * / unary - ( - * unary - b unary - c unary - .? .* d ) ( + e f ) g h * * unary - .? .* i j ( + * k ( - l m ) / n o )</li>
            </ul>

            <li class="fragment">Everyone pays the cost of producing in post-order and then iterating over it in pre-order, we want to reduce that cost.</li>
            <li class="fragment">Observation:</li>
            <ul>
                <li class="fragment">Operands never change order with respect to each other. Operators are the ones we are shuffling around.</li>
                <li class="fragment">We can omit operands from the algorithm and decrease the amount of data our algorithm has to deal with by roughly a factor of 2.</li>
            </ul>
        </ul>
    </div>
</section>

<section class="text-only" id="opstring" data-auto-animate data-background-gradient="linear-gradient(#400, #000)" data-background-transition="none">
    <h2 style="color: #fff">The OpString</h2>
    <div style="width: 70%; margin-left: 15%; margin-top: 40px">
        <div class="" style="height: 1200px; width: 500px; position: absolute; scale: 2">
<pre class="visible" style="width: 500px; top: 300px; left: 190px; height: 155px"><code data-line-numbers="|" data-fragment-index="1" class="tokenize2 hljs language-zig" style="font-family: 'JetBrains Mono', monospace; font-size: 7pt; margin-top: -3em; position: absolute; box-sizing: content-box; width: 100%; height: 100%">struct {
    operators: [BUF_SIZE]Token,
    merge_bitstring: u64,
    next: u32,
    operators_len: u8,
    bitstr_len: u8,
}
// Example:
// .operators = .{ +, *, -, /, +, undefined, undefined, undefined }
// .merge_bitstring = 1010101010;
</code></pre>
        </div>
    </div>
</section>

<section class="text-only" id="merging-opstrings" data-auto-animate data-background-gradient="linear-gradient(#400, #000)" data-background-transition="none">
    <h2 style="color: #fff">Merging OpStrings</h2>
    <div style="width: 70%; margin-left: 15%; margin-top: 40px">
        <li class="fragment">Given a bitstring and two buffers, how do we combine them efficiently?</li>
        <div class="" style="height: 1200px; width: 500px; position: absolute; scale: 2">
        <pre class="visible" style="width: 500px; top: 350px; left: 190px; height: 205px"><code data-line-numbers="|" data-fragment-index="1" class="tokenize2 hljs language-zig" style="font-family: 'JetBrains Mono', monospace; font-size: 7pt; margin-top: -3em; position: absolute; box-sizing: content-box; width: 100%; height: 100%">struct {
    operators: [BUF_SIZE]Token,
    merge_bitstring: u64,
    next: u32,
    operators_len: u8,
    bitstr_len: u8,
}
// Example:
// .operators = .{ +, *, -, /, +, undefined, undefined, undefined }
// .merge_bitstring = 1010101010;
// .operands = .{  a, b, c, d, e, f, g, h, i ... }

// Output: a + b * c - d / e + f ...
</code></pre>
    </div>
    </div>
</section>

<section class="text-only" id="vpexpandw" data-auto-animate data-background-gradient="linear-gradient(#400, #000)" data-background-transition="none">
    <h2 style="color: #fff">There's an instruction for that!</h2>
    <div style="width: 70%; margin-left: 15%; margin-top: 40px">
        <ul>
            <ul>
                <li class="fragment"><a href="https://www.officedaytime.com/simd512e/simdimg/expand.php?f=vpexpandw">VPEXPANDW</a></li>
            </ul>
        </ul>
    </div>
</section>

<section class="text-only" data-background-gradient="linear-gradient(rgb(114 0 0), rgb(0 11 98))" id="expand-word-support">
                    <h2>Can we emulate VPEXPANDW?</h2>
                    <div style="width: 70%; margin-left: 15%;">
                        <ul>
                            <li class="fragment" style="width: unset;">Use vector shuffle/permute/swizzle instructions!</li>
                        </ul>

                        <style>
* {
    margin: 0;
    padding: 0;
    box-sizing: inherit;
}

/* html, body {
    box-sizing: border-box;
    height: 100%;

    background-color: #111;
} */

.glow {
    opacity: 1;
}

.deer[data-color="white"] { stroke: var(--neon-white-color) }
.neon-text[data-color="white"] {
    fill: var(--neon-white-color);
    stroke: var(--neon-white-color);
}

.deer[data-color="blue"] { stroke: var(--neon-blue-color) }
.neon-text[data-color="blue"] {
    fill: var(--neon-blue-color);
    stroke: var(--neon-blue-color);
}

.deer[data-color="green"] { stroke: var(--neon-green-color) }
.neon-text[data-color="green"] {
    fill: var(--neon-green-color);
    stroke: var(--neon-green-color);
}


.deer[data-color="red"] { stroke: var(--neon-orange-color) }
.neon-text[data-color="red"] {
    fill: var(--neon-orange-color);
    stroke: var(--neon-orange-color);
}


.deer[data-color="purple"] { stroke: #ff00ff }
.deer[data-color="zig"]    { stroke: var(--neon-zig-color) }

.red {
    stroke: #ff0000;
}

.text {
    font-size: 50px;
}

.neon-text[data-color="purple"] {
    fill: #ff00ff;
    stroke: #ff00ff;
}

.neon-text[data-color="zig"] {
    fill: var(--neon-zig-color);
    stroke: var(--neon-zig-color);
}

.white {
    opacity: .7;
}

.white2 {
    opacity: .6;
}

.white3 {
    opacity: .5;
}
/* <g class="flicker deer" data-color="zig" transform="translate(1320, 0)"> */
    /* <g class="flicker neon-text" data-content="p" id="g_48" data-color="zig" transform="translate(1340.5, 46)"> */

section#expand-word-support[data-fragment="3"] .neon-text[transform$=", 46)"],
section#expand-word-support[data-fragment="3"] .deer[transform$=", 0)"] {
    animation: dead 0.5s ease-out 0s 1 forwards normal;
}


                        </style>

<svg class="fragment" id="vpexpand-emulation-svg-0" width="100%" height="200" viewBox="0 0 1600 200" xmlns="http://www.w3.org/2000/svg" style="margin-top: 40px;"></svg>
<svg class="fragment" id="vpexpand-emulation-svg-1" width="100%" height="200" viewBox="0 0 1600 200" xmlns="http://www.w3.org/2000/svg"></svg>
<div class="fragment"></div>
<script>
{
let id = 0;

global_animations.push({
    section: "expand-word-support",
    slide_num: 3,
    animation_delay: "0.4s",
    animation_duration: "2s",

    selector: `#vpexpand-emulation-svg-1`,
    keyframes: {
        0:   { "margin-top": "40px" },
        100: { "margin-top": "-100px" },
    }
});


const boxes = new Array(32).fill(0).map((_, i) => [120+80*(i%16), Math.floor(i / 16) * 120]);

for (const [svg_i, [whitelist, color, starter_char, outer_offset]] of Object.entries([[new Set([0, 1, 2, 4, 6]), "purple", 'a', 0], [new Set([3, 5, 7]), "zig", 'A', 320]])) {
    const expand_animation_duration = 6;
    const expand_animation_delay = 1;

    const animation_props = {
        section: "expand-word-support",
        slide_num: 1 + +svg_i,
        animation_delay: `${expand_animation_delay}s`,
        animation_duration: `${expand_animation_duration}s`,
    };

    global_animations.push({
        ...animation_props,
        selector: `svg#vpexpand-emulation-svg-${svg_i}.visible.current-fragment .deer[transform$="120)"]`,
        keyframes: {
            0:   { opacity: 1 },
            35:  { opacity: 0.2 },
            85:  { opacity: 0.2 },
            100: { opacity: 1 },
        }
    });

    const box_row2 = (() => {
        let counter = 0;
        return new Array(16).fill(0).map((_, iter) => whitelist.has((iter / 2) | 0) ? "" + counter++ : '-' );
    })();

const box_fills = [
    ...new Array(16).fill(0).map((_, iter) => String.fromCharCode(iter + starter_char.charCodeAt())),
    ...box_row2
]
const arrows = new Map();
let lastOverwritten;
let last_true_i;
{
    let i = 0;
    let j = 16;

    while (i < 16) {
        while (box_fills[j] === '-') j++
        if (j >= box_fills.length) break;
        arrows.set(i, boxes[j]);
        lastOverwritten = j;
        i++; j++;
    }

    last_true_i = i;
    for (; i < 16; i++)  {
        arrows.set(i, [160+1260.5 + (i - last_true_i) * 80 - 20.5, boxes[16][1]])
    }
}

const vpexpand_emulation_svg_innerHTML = `<defs>
    <marker
        id="arrow"
        viewBox="0 0 10 10"
        refX="5"
        refY="5"
        markerWidth="3"
        markerHeight="3"
        orient="auto-start-reverse"
        fill="#fff">
        <path d="M 0 0 L 10 5 L 0 10 z" />
    </marker>

    <filter id="blurMe" x="-250%" y="-250%" width="600%" height="600">
        <feGaussianBlur in="SourceGraphic" stdDeviation="10" result="blurred" />
    </filter>

    <filter id="blurMe3" x="-250%" y="-250%" width="600%" height="600">
        <feGaussianBlur in="SourceGraphic" stdDeviation="2" result="blurred" />
    </filter>

    <filter id="blurMe2" x="-250%" y="-250%" width="600%" height="600">
        <feGaussianBlur in="SourceGraphic" stdDeviation="4" result="blurred" />
    </filter>

    <filter id="blurMe6" x="-250%" y="-250%" width="600%" height="600">
        <feGaussianBlur in="SourceGraphic" stdDeviation="2" result="blurred" />
    </filter>

    <filter id="blurMe1" x="-250%" y="-250%" width="600%" height="600">
        <feGaussianBlur in="SourceGraphic" stdDeviation="1" result="blurred" />
    </filter>

    <g id="deer" stroke-linecap="round">
        <rect width="50" height="50" x="8" y="8" fill="none" />
    </g>

    <style>
        .flicker, .neon-text text {
            font-family: 'JetBrains Mono', monospace;
            font-size: 40px;
        }

        svg#vpexpand-emulation-svg-${svg_i}.visible.current-fragment g.neon-text[data-content='-'] {
            opacity: 0;
            animation: alive 0.5s cubic-bezier(0.69, 0.02, 0.53, 1) ${expand_animation_duration + expand_animation_delay - 0.5}s 1 forwards normal;
        }
    </style>
</defs>`.concat(
Array.prototype.concat(
    boxes.map(([i, j]) => `<g class="flicker deer" data-color="${color}" transform="translate(${i}, ${j})">
        <use xlink:href="#deer" stroke-width="6"/>
        <use class="glow" stroke="#fff" xlink:href="#deer" filter="url(#blurMe1)" stroke-width="1"/>
        <use class="glow" xlink:href="#deer" filter="url(#blurMe)" stroke-width="10"/>
        <use xlink:href="#deer" filter="url(#blurMe2)" stroke-width="6"/>
    </g>`),

    boxes.map(([i, j]) => `<g class="flicker deer" data-color="${color}" transform="translate(${i}, ${j})">
        <use class="white" xlink:href="#deer" stroke-width="4" stroke="#fff"/>
        <use filter="url(#blurMe3)" class="white2" xlink:href="#deer" stroke-width="5" stroke="#fff"/>
        <use class="white3" xlink:href="#deer" stroke-width="5" stroke="#fff"/>
    </g>`),

    boxes.map(([i, j], iter) => {
        const n = box_fills[iter];
        const p2 = arrows.get(iter) ?? "";
        const orig_iter = +n + 16;
        const bop = (iter - 16).toString(16).toUpperCase();
        id++;

        if (iter - 16 >= last_true_i)
            global_animations.push({
                ...animation_props,
                selector: `svg#vpexpand-emulation-svg-${svg_i} #g_${id}_bad_${bop}`,
                keyframes: {
                    0:  { transform: `translate(${i + 20.5}px, ${j + 46}px)`, opacity: 1 },
                    30: { transform: `translate(${i + 20.5}px, ${j + 46}px)`, opacity: 1 },
                    55: { opacity: 0 },
                    100: { transform: `translate(${160+1260.5 + outer_offset + (iter - 26) * 80}px, ${j + 46}px)`, opacity: 0 },
                }
            });

        if (orig_iter && orig_iter !== iter)
            global_animations.push({
                ...animation_props,
                selector: `svg#vpexpand-emulation-svg-${svg_i} #g_${id}`,
                keyframes: {
                    0:  { transform: `translate(${boxes[orig_iter][0] + 20.5}px, ${boxes[orig_iter][1] + 46}px)` },
                    30: { transform: `translate(${boxes[orig_iter][0] + 20.5}px, ${boxes[orig_iter][1] + 46}px)` },
                    100: { transform: `translate(${i + 20.5}px, ${j + 46}px)` },
                }
            });

        if (p2)
            global_animations.push({
                ...animation_props,
                selector: `svg#vpexpand-emulation-svg-${svg_i} #g_${id}_mover`,
                keyframes: {
                    0: { transform: `translate(${i + 20.5}px, ${j + 46}px)`, opacity: 0 },
                    30: { opacity: 1 },
                    30: { transform: `translate(${i + 20.5}px, ${p2[1] - 12}px)`, opacity: 1 },
                    55: { opacity: +!(last_true_i <= iter && iter < 16) },
                    100: { transform: `translate(${p2[0] + 20.5}px, ${p2[1] - 12}px)`, opacity: +!(last_true_i <= iter && iter < 16) },
                }
            });

        return `
        <g class="flicker neon-text" data-content="${n}" id="g_${id}" data-color="${color}" transform="translate(${i + 20.5}, ${j + 46})">
            <text class="white" stroke-width="3"> ${n} </text>
            <text filter="url(#blurMe6)"> ${n} </text>
            <text filter="url(#blurMe)"> ${n} </text>
            <text class="white" stroke-width="1" stroke="#fff" fill="#fff"> ${n} </text>
            <text class="white2" stroke-width="2" stroke="#fff" fill="#fff" filter="url(#blurMe1)"> ${n} </text>
            <text class="white3" stroke-width="2" stroke="#fff" fill="#fff" filter="url(#blurMe3)"> ${n} </text>
        </g>

        ${iter - 16 >= last_true_i ? `<g class="flicker neon-text" id="g_${id}_bad_${bop}" data-color="${color}">
            <text class="white" stroke-width="3"> ${bop} </text>
            <text filter="url(#blurMe6)"> ${bop} </text>
            <text filter="url(#blurMe)"> ${bop} </text>
            <text class="white" stroke-width="1" stroke="#fff" fill="#fff"> ${bop} </text>
            <text class="white2" stroke-width="2" stroke="#fff" fill="#fff" filter="url(#blurMe1)"> ${bop} </text>
            <text class="white3" stroke-width="2" stroke="#fff" fill="#fff" filter="url(#blurMe3)"> ${bop} </text>
        </g>` : ""}

        ${p2 && `
        <g class="flicker neon-text" id="g_${id}_mover" data-color="${color}">
            <text class="white" stroke-width="3"> ${n} </text>
            <text filter="url(#blurMe6)"> ${n} </text>
            <text filter="url(#blurMe)"> ${n} </text>
            <text class="white" stroke-width="1" stroke="#fff" fill="#fff"> ${n} </text>
            <text class="white2" stroke-width="2" stroke="#fff" fill="#fff" filter="url(#blurMe1)"> ${n} </text>
            <text class="white3" stroke-width="2" stroke="#fff" fill="#fff" filter="url(#blurMe3)"> ${n} </text>
        </g>`}
`;
    }),

    [...arrows]
        .map(([i, y]) => [boxes[i], y])
        .map(([[x1, y1], [x2, y2]]) => [[x1+33, y1+62], [x2+33, y2+5]])
        .map(([[x1, y1], [x2, y2]], iter) => {
            return `<line x1="${x1}" y1="${y1}" x2="${x2}" y2="${y2-4}" stroke="white" stroke-width="4" stroke-linecap="round" marker-end="url(#arrow)" />`;
        }) && []
).join("\n")
    );

let resize_event_id = 0;
addEventListener("resize", event => {
    const cur_event_id = ++resize_event_id;
    setTimeout(() => {
        if (cur_event_id === resize_event_id)
            document.getElementById(`vpexpand-emulation-svg-${svg_i}`).innerHTML = vpexpand_emulation_svg_innerHTML;
    }, 30);
});
document.getElementById(`vpexpand-emulation-svg-${svg_i}`).innerHTML = vpexpand_emulation_svg_innerHTML;
}
}
</script>
                    </div>
                </section>
<!--

    arrows
        .map(([[x1, y1], [x2, y2]]) => [[x1+33, y1+62], [x2+33, y2+5]])
        .map(([[x1, y1], [x2, y2]], iter) => {
            const n = "&gt;";
            var angleDeg = Math.atan2(y2 - y1, x2 - x1) * 180 / Math.PI;
            return `<line x1="${x1}" y1="${y1}" x2="${x2}" y2="${y2}" stroke="white" stroke-width="4" stroke-linecap="round" />`;


    // <g class="flicker neon-text" data-color="purple" transform="translate(${x2-14}, ${y2+10}) rotate(${angleDeg})">
    //     <text class="white" stroke-width="3"> ${n} </text>
    //     <text filter="url(#blurMe6)"> ${n} </text>
    //     <text filter="url(#blurMe)"> ${n} </text>
    //     <text class="white" stroke-width="1" stroke="#fff" fill="#fff"> ${n} </text>
    //     <text class="white2" stroke-width="2" stroke="#fff" fill="#fff" filter="url(#blurMe1)"> ${n} </text>
    //     <text class="white3" stroke-width="2" stroke="#fff" fill="#fff" filter="url(#blurMe3)"> ${n} </text>
    // </g>
    //     var p1 = {
    //         x: 20,
    //         y: 20
    //     };

    //     var p2 = {
    //         x: 40,
    //         y: 40
    //     };

    //     // angle in degrees

    //     return `<g class="flicker neon-text" data-color="purple" transform="translate(${i + 20.5}, ${j - 26}) rotate(${angleDeg})">
    //     <text class="white" stroke-width="3"> ${n} </text>
    //     <text filter="url(#blurMe6)"> ${n} </text>
    //     <text filter="url(#blurMe)"> ${n} </text>
    //     <text class="white" stroke-width="1" stroke="#fff" fill="#fff"> ${n} </text>
    //     <text class="white2" stroke-width="2" stroke="#fff" fill="#fff" filter="url(#blurMe1)"> ${n} </text>
    //     <text class="white3" stroke-width="2" stroke="#fff" fill="#fff" filter="url(#blurMe3)"> ${n} </text>
    // </g>`;
    }).map(_ => "").join("\n")
 -->
                <!-- <li class="fragment">PowerPC:</li>
                            <ul>
                                <li class="fragment">Power10 => <a target="_blank" rel="noopener noreferrer" href="https://www.ibm.com/docs/en/openxl-c-and-cpp-lop/17.1.1?topic=functions-vec-genpcvm">XXGENPCVHM</a> + <a target="_blank" rel="noopener noreferrer" href="https://www.ibm.com/docs/en/openxl-c-and-cpp-lop/17.1.1?topic=functions-vec-permx">VPERM</a></li>
                                <ul>
                                    <li class="fragment fade-in-then-out">Generate-Permute-Control-Vector-Halfword-according-to-Mask can produce a vector for expansion or compaction, which is fed into VPERM, a vector shuffling instruction</li>
                                </ul>
                            </ul> -->

                <section class="text-only" id="expansion-and-compaction-overview">
                    <div style="width: 70%; margin-left: 15%;">
                        <h2>Expansion & Compaction</h2>

                        <ul>
                            <li class="fragment">BESM Soviet mainframes:</li>
                            <ul>
                                <li class="fragment">BESM-6 (Designed in 1965. Produced 1968-1987) => <a target="_blank" rel="noopener noreferrer" href="https://www.mailcom.com/besm6/instset.shtml#unpack">AUX</a> & <a target="_blank" rel="noopener noreferrer" href="https://www.mailcom.com/besm6/instset.shtml#pack">APX</a></li>
                            </ul>

                            <li class="fragment">x86-64:</li>
                            <ul>
                                <li class="fragment">BMI2 (Intel Haswell 2013+, AMD Excavator 2015+, Fast on AMD since Zen 3 2020+) => <a target="_blank" rel="noopener noreferrer" href="https://en.wikipedia.org/wiki/X86_Bit_manipulation_instruction_set#Parallel_bit_deposit_and_extract">PDEP</a> & <a target="_blank" rel="noopener noreferrer" href="https://en.wikipedia.org/wiki/X86_Bit_manipulation_instruction_set#Parallel_bit_deposit_and_extract">PEXT</a></li>

                                <li class="fragment">AVX-512F (first mainstream support was Intel Cannon Lake 2018+) => <a target="_blank" rel="noopener noreferrer" href="https://en.wikipedia.org/wiki/AVX-512#Compress_and_expand">VPEXPAND{D, Q}</a> & <a target="_blank" rel="noopener noreferrer" href="https://en.wikipedia.org/wiki/AVX-512#Compress_and_expand">VPCOMPRESS{D, Q}</a></li>

                                <li class="fragment">AVX512_VBMI2 (Intel Ice Lake 2019+, AMD Zen 4 2022+) => <a target="_blank" rel="noopener noreferrer" href="https://en.wikipedia.org/wiki/AVX-512#Compress_and_expand">VPEXPAND{B, W}</a> & <a target="_blank" rel="noopener noreferrer" href="https://en.wikipedia.org/wiki/AVX-512#Compress_and_expand">VPCOMPRESS{B, W}</a></li>
                            </ul>

                            <li class="fragment">arm64 / aarch64:</li>
                            <ul>
                                <li class="fragment">SVE2 (optional, not required) => <a target="_blank" rel="noopener noreferrer" href="https://developer.arm.com/documentation/ddi0602/latest/SVE-Instructions/BDEP--Scatter-lower-bits-into-positions-selected-by-bitmask-">BDEP</a> & <a target="_blank" rel="noopener noreferrer" href="https://developer.arm.com/documentation/ddi0602/latest/SVE-Instructions/BEXT--Gather-lower-bits-from-positions-selected-by-bitmask-">BEXT</a> & <a target="_blank" rel="noopener noreferrer" href="https://developer.arm.com/documentation/ddi0602/latest/SVE-Instructions/BGRP--Group-bits-to-right-or-left-as-selected-by-bitmask-">BGRP</a></li>
                                <ul>
                                    <li class="fragment">
                                        <a target="_blank" rel="noopener noreferrer" href="https://developer.arm.com/documentation/ddi0602/latest/SVE-Instructions/BGRP--Group-bits-to-right-or-left-as-selected-by-bitmask-">BGRP</a> = <a target="_blank" rel="noopener noreferrer" href="https://developer.arm.com/documentation/ddi0602/latest/SVE-Instructions/BEXT--Gather-lower-bits-from-positions-selected-by-bitmask-">BEXT</a>(a, b) | (<a target="_blank" rel="noopener noreferrer" href="https://developer.arm.com/documentation/ddi0602/latest/SVE-Instructions/BEXT--Gather-lower-bits-from-positions-selected-by-bitmask-">BEXT</a>(a, ~b) &lt;&lt; @popCount(b))
                                    </li>
                                </ul>
                                <li class="fragment">SVE => ??? & <a target="_blank" rel="noopener noreferrer" href="https://developer.arm.com/documentation/ddi0602/latest/SVE-Instructions/COMPACT--Shuffle-active-elements-of-vector-to-the-right-and-fill-with-zero-">COMPACT</a> & <a target="_blank" rel="noopener noreferrer" href="https://developer.arm.com/documentation/ddi0602/latest/SVE-Instructions/SPLICE--Splice-two-vectors-under-predicate-control-">SPLICE</a></li>
                            </ul>

                            <li class="fragment">PowerPC:</li>
                            <ul>
                                <li class="fragment">Power10 => <a target="_blank" rel="noopener noreferrer" href="https://www.ibm.com/docs/en/openxl-c-and-cpp-lop/17.1.1?topic=functions-vec-pdep">PDEP</a> & <a target="_blank" rel="noopener noreferrer" href="https://www.ibm.com/docs/en/openxl-c-and-cpp-lop/17.1.1?topic=functions-vec-pext">PEXT</a></li>
                                <li class="fragment">Power10 => <a target="_blank" rel="noopener noreferrer" href="https://www.ibm.com/docs/en/openxl-c-and-cpp-lop/17.1.1?topic=functions-vec-genpcvm">XXGENPCVBM</a> + <a target="_blank" rel="noopener noreferrer" href="https://www.ibm.com/docs/en/openxl-c-and-cpp-lop/17.1.1?topic=functions-vec-permx">VPERM</a> (can do vector expansion or compaction, into/from the top or bottom of a vector)</li>
                            </ul>

                            <li class="fragment">RISC-V:</li>
                            <ul>
                                <li class="fragment">Zbe => BDEP & BEXT, but did not make it into ratified B instruction set</li>
                                <li class="fragment">V => <a target="_blank" rel="noopener noreferrer" href="https://github.com/riscv/riscv-v-spec/blob/master/v-spec.adoc#1651-synthesizing-vdecompress">VIOTA+VRGATHER</a> & <a target="_blank" rel="noopener noreferrer" href="https://github.com/riscv/riscv-v-spec/blob/master/v-spec.adoc#165-vector-compress-instruction">VCOMPRESS</a></li>
                            </ul>
                        </ul>
                    </div>
                </section>

                <section class="text-only" id="shuffle-support">
                    <div style="width: 70%; margin-left: 15%;">
                        <h2>Where do we have vector<br>shuffle instructions?</h2>
<!-- x86_64: If bit 7 is 1, set to 0, otherwise use lower 4 bits for lookup
ARM: if index is out of range (0-15), set to 0
PPC64: use lower 4 bits for lookup (no out of range handling)
MIPS: if bit 6 or bit 7 is 1, set to 0; otherwise use lower 4 bits for lookup (or rather use lower 5 bits for lookup into a table that has 32 elements constructed from 2 input vectors, but if both vectors are the same then it effectively means bits 4,5 are ignored)
RISCV: if index is out of range (0-15), set to 0. -->
                        <ul>
                            <li class="fragment">x86-64:</li>
                            <ul>
                                <li class="fragment">SSSE3 (2006+) => <a href="https://www.intel.com/content/www/us/en/docs/intrinsics-guide/index.html#text=pshufb&ig_expand=6003,6056,6043,5157,6003&ssetechs=SSSE3">PSHUFB</a> (16 byte-lookups) (Steam hardware survey found 99.73% support)</li>
                                <li class="fragment">XOP (AMD 2011-2017, Intel never) => <a href="https://en.wikipedia.org/wiki/XOP_instruction_set#Vector_permute">VPPERM</a> (effectively 32 byte-lookups due 2 source<br>vectors)</li>
                                <li class="fragment">AVX2 (2011+) => <a href="https://www.intel.com/content/www/us/en/docs/intrinsics-guide/index.html#text=vpshuf&ig_expand=6003,6056,6043,5157,6003,5071&techs=AVX_ALL">VPSHUFB</a> (16 byte-lookups, optionally on both halfs of a 32-byte vector<br>simultaneously but cross-lane shuffling is disallowed)</li>
                                <li class="fragment">AVX-512 (Intel 2016+/2018+, AMD Zen 4 2022+) => <a href="https://www.intel.com/content/www/us/en/docs/intrinsics-guide/index.html#text=vpshuf&ig_expand=6003,6056,6043,5157,6003,5071">VPSHUF</a>/<a href="https://www.intel.com/content/www/us/en/docs/intrinsics-guide/index.html#text=vpermb&ig_expand=6003,6056,6043,5157,6003,5071">VPERM</a> (all your wildest dreams)</li>
                                <ul>
                                    <li class="fragment">for <a href="https://www.intel.com/content/www/us/en/docs/intrinsics-guide/index.html#text=vpshuf&ig_expand=6003,6056,6043,5157,6003,5071">(V)PSHUF{B,W,D,Q}</a>, if bit 7 is set, the corresponding output will be 0, otherwise only the lower 4 bits are used for the lookup</li>
                                </ul>
                            </ul>
                            <li class="fragment">arm64 / aarch64:</li>
                            <ul>
                                <li class="fragment">NEON => <a href="https://developer.arm.com/documentation/ddi0596/2021-03/SIMD-FP-Instructions/TBL--Table-vector-Lookup-?lang=en">TBL</a> & <a href="https://developer.arm.com/documentation/ddi0596/2021-03/SIMD-FP-Instructions/TBX--Table-vector-lookup-extension-?lang=en">TBX</a> (at least 16 byte-lookups, but can take up to 4 source vectors, so effectively we can<br>do 16 lookups in a 64 byte table)</li>
                                <ul>
                                    <li class="fragment fade-in-then-out">if out of range, the corresponding output will be zeroed (<a href="https://developer.arm.com/documentation/ddi0596/2021-03/SIMD-FP-Instructions/TBL--Table-vector-Lookup-?lang=en">TBL</a>) or the original value preserved (<a href="https://developer.arm.com/documentation/ddi0596/2021-03/SIMD-FP-Instructions/TBX--Table-vector-lookup-extension-?lang=en">TBX</a>)</li>
                                    <li class="fragment fade-in-then-out">arm32 has the same instructions, but the vector sizes are 8 bytes instead of 16.</li>
                                </ul>
                            </ul>
                            <li class="fragment">PowerPC:</li>
                            <ul>
                                <li class="fragment">VSX => XXPERMX</li>
                                <li class="fragment">AltiVec => <a href="https://www.ibm.com/docs/en/openxl-c-and-cpp-lop/17.1.1?topic=functions-vec-permx">VPERM</a> (32 byte-lookups)</li>
                            </ul>
                            <li class="fragment">RISC-V:</li>
                            <ul>
                                <li class="fragment">V => <a href="https://github.com/riscv/riscv-v-spec/blob/master/v-spec.adoc#164-vector-register-gather-instructions">VRGATHER</a> (at least 16 byte-lookups)</li>
                                <ul>
                                    <li id="personal-riscv-machine" class="fragment fade-in-then-out">My single-board RISC-V machine, the Star 64 (Sifive U74 CPU) does not have vectors,<br>and therefore no vector shuffles.</li>
                                </ul>
                            </ul>
                            <li class="fragment">MIPS:</li>
                            <ul>
                                <li class="fragment">MSA => VSHF (16 byte-lookups)</li>
                            </ul>

                            <li class="fragment">SPARC:</li>
                            <ul>
                                <li class="fragment">VIS 2.0 => BSHUFFLE (16 byte-lookups), but you can only keep the first 8 indices</li>
                            </ul>
                            <li class="fragment">WASM:</li>
                            <ul>
                                <li class="fragment">SWIZZLE (16 byte-lookups)</li>
                            </ul>
                        </ul>
                    </div>
                </section>


                <section class="text-only" id="intersperse-bitstrings">
                    <div style="width: 70%; margin-left: 15%;">
                        <style>
                            li {
                                margin-top: 0.25em;
                            }
                        </style>
                        <h2>How do we produce the<br>shuffle vector?</h2>
                        <ul>
                            <li class="fragment">Generic:</li>
                            <ul>
                                <li class="fragment">Could use a lookup table</li>
                                <ul>
                                    <li class="fragment">Problem: lookup tables for expand/compress instructions are often prohibitively large</li>
                                    <li class="fragment">For 32 byte shuffles, mapping <span class="info">16 bits => 32 bytes</span> takes <span class="bad">2MiB</span></li>
                                    <ul>
                                        <li class="fragment">Can be worth it in tight loops, but adds bloat to the stack and the executable file</li>
                                    </ul>
                                    <li class="fragment">For 16 byte shuffles, mapping <span class="info">8 bits => 16 bytes</span> takes <span class="good">4KiB</span></li>
                                    <ul>
                                        <li class="fragment">Could reduce <span style="background-color: rgba(0, 0, 0, 0.5); border: 2pt solid rgba(0, 0, 0, 0.5);"><span class="hljs-built_in">@Vector</span>(<span class="hljs-number">16</span>, <span class="hljs-type">u8</span>) => <span class="hljs-built_in">@Vector</span>(<span class="hljs-number">16</span>, <span class="hljs-type">u4</span>)</span>, cutting size to <span class="good">2KiB</span><br>at the cost of extra instructions to decode it</li>
                                        <!-- <li class="fragment">Could map 8 bits => 8 nibbles, then <span style="background-color: rgba(0, 0, 0, 0.5); border: 2pt solid rgba(0, 0, 0, 0.5);"><span class="hljs-built_in">@Vector</span>(<span class="hljs-number">16</span>, <span class="hljs-type">u8</span>) => <span class="hljs-built_in">@Vector</span>(<span class="hljs-number">16</span>, <span class="hljs-type">u4</span>)</span>, cutting size to <span class="good">2KiB</span><br>at the cost of extra instructions to decode it</li> -->
                                    </ul>
                                </ul>
                            </ul>
                            <li class="fragment">PowerPC:</li>
                            <ul>
                                <li class="fragment">Power10 => <a target="_blank" rel="noopener noreferrer" href="https://www.ibm.com/docs/en/openxl-c-and-cpp-lop/17.1.1?topic=functions-vec-genpcvm">XXGENPCVHM</a></li>
                                <ul>
                                    <li class="fragment">Generate-Permute-Control-Vector-Halfword-according-to-Mask can produce<br>a vector for expansion or compaction</li>
                                </ul>
                            </ul>

                            <li class="fragment">RISC-V:</li>
                            <ul>
                                <li class="fragment">V => <a target="_blank" rel="noopener noreferrer" href="https://github.com/riscv/riscv-v-spec/blob/master/v-spec.adoc#1651-synthesizing-vdecompress">VIOTA</a></li>
                                <ul>
                                    <li class="fragment">Predicated prefix-sum instruction</li>
                                    <li class="fragment">This strategy is applicable across hardware!</li>
                                </ul>
                            </ul>
                        </ul>
                    </div>
                </section>

                <section id="prefix-shuffle" style="transform: translateX(480px);" data-background-gradient="linear-gradient(#292A35, #040945)">
                    <div style="height: 1200px; width: 1200px; position: absolute;">
                        <pre class="visible" style="width: 900px; height: 120px; top: 0px; left: 30px;"><code id="prefix-sum-algo" data-line-numbers="|2|2|3|4|5|6|6|7|8|8|9|9|10|10|1,11" data-fragment-index="1" class="hljs language-zig" style="font-family: 'JetBrains Mono', monospace; font-size: 11pt; margin-top: -2em;">fn produceShuffleVectorForByte(x: u8) @Vector(16, u8) {
    const splatted = @as(u64, x) * 0x0101010101010101;
    const bit_positions: u64 = @bitCast(@as(@Vector(8, u8), @splat(1)) << std.simd.iota(u3, 8));
    const splatted_msbs = (splatted & bit_positions) + (0x8080808080808080 - bit_positions);
    const splatted_lsbs = (splatted_msbs >> 7) & 0x0101010101010101;
    const prefix_sums1 = ((splatted_lsbs << 4) | splatted_lsbs) *% 0x1111111111111110;
    const splatted_lsbs_inv = splatted_lsbs ^ 0x0101010101010101;
    const prefix_sums2 = ((splatted_lsbs_inv << 4) | splatted_lsbs_inv) *% 0x1111111111111110;
    const selector = splatted_lsbs * 255;
    const interleaved_shuffle_vector = (selector & (prefix_sums1 ^ prefix_sums2)) ^ prefix_sums2;
    return @as(@Vector(16, u4), @bitCast(interleaved_shuffle_vector));
}</code></pre>
<!-- const interleaved_shuffle_vector = (prefix_sums1 & selector) | (prefix_sums2 & ~selector); -->



<pre id="x-bits" class="fragment" data-fragment-index="1"><span style="opacity: 0;">[0]00000000000000000000000000000000000000000000000000000000</span><span class="var-name">x = </span><span class="toggle-bit bit-0">0</span><span class="toggle-bit bit-1">1</span><span class="toggle-bit bit-0">0</span><span class="toggle-bit bit-1">1</span><span class="toggle-bit bit-0">0</span><span class="toggle-bit bit-1">1</span><span class="toggle-bit bit-1">1</span><span class="toggle-bit bit-1">1</span></pre>

<pre class="fragment broadcasted-garbage" id="prefix-shuffle-ones-constant" data-fragment-index="1" style="transform: translateY(1em);"><span class="bit-0">0000000</span><span class="bit-1">1</span> <span class="bit-0">0000000</span><span class="bit-1">1</span> <span class="bit-0">0000000</span><span class="bit-1">1</span> <span class="bit-0">0000000</span><span class="bit-1">1</span> <span class="bit-0">0000000</span><span class="bit-1">1</span> <span class="bit-0">0000000</span><span class="bit-1">1</span> <span class="bit-0">0000000</span><span class="bit-1">1</span> <span class="bit-0">0000000</span><span class="bit-1">1</span></pre>

<pre class="fragment math-underlined broadcasted-garbage star" data-fragment-index="1" style="width: 873px; left: -4px; top: 270px; font-size: 30px; line-height: 0.5em">*</pre>

<pre class="fragment broadcasted-bits custom" id="broadcast-1" data-fragment-index="1" style="transform: translateY(2.5em);"></pre>
<pre class="fragment broadcasted-bits custom" id="broadcast-2" data-fragment-index="1" style="transform: translateY(3.5em);"></pre>
<pre class="fragment broadcasted-bits custom" id="broadcast-3" data-fragment-index="1" style="transform: translateY(4.5em);"></pre>
<pre class="fragment broadcasted-bits custom" id="broadcast-4" data-fragment-index="1" style="transform: translateY(5.5em);"></pre>
<pre class="fragment broadcasted-bits custom" id="broadcast-5" data-fragment-index="1" style="transform: translateY(6.5em);"></pre>
<pre class="fragment broadcasted-bits custom" id="broadcast-6" data-fragment-index="1" style="transform: translateY(7.5em);"></pre>
<pre class="fragment broadcasted-bits custom" id="broadcast-7" data-fragment-index="1" style="transform: translateY(8.5em);"></pre>
<pre class="fragment broadcasted-bits custom" id="broadcast-8" data-fragment-index="1" style="transform: translateY(9.5em);"></pre>

<pre id="broadcast-plus" class="fragment custom math-underlined broadcasted-garbage" data-fragment-index="1" style="width: 873px;left: -5px;top: 427px;font-size: 24px;text-indent: 2px;line-height: 1.2em;">+</pre>

<pre class="fragment splatted-msb-garbage" id="broadcast-result" data-fragment-index="1" style="transform: translateY(1em);"></pre>

<pre class="fragment splatted-msb-garbage" id="bit-positions" data-fragment-index="3" style="transform: translateY(2em);"><span class="bit-1">1</span><span class="bit-0">....... .</span><span class="bit-1">1</span><span class="bit-0">...... ..</span><span class="bit-1">1</span><span class="bit-0">..... ...</span><span class="bit-1">1</span><span class="bit-0">.... ....</span><span class="bit-1">1</span><span class="bit-0">... .....</span><span class="bit-1">1</span><span class="bit-0">.. ......</span><span class="bit-1">1</span><span class="bit-0">. .......</span><span class="bit-1">1</span></pre>

<pre class="fragment math-underlined splatted-msb-garbage custom" id="ampersand-op" data-fragment-index="4" style="width: 873px;left: -4px;top: 285px;font-size: 20px;line-height: 0.5em;font-family: 'JetBrains Mono';padding-bottom: 10px;">&</pre>

<pre class="fragment splatted-msb-garbage" id="broadcast-isolate" data-fragment-index="4" style="transform: translateY(4em);"></pre>

<pre class="fragment splatted-msb-garbage" id="msbs-bit_positions" data-fragment-index="4" style="transform: translateY(5em);"><span class="bit-0">0....... 0</span><span class="bit-1">1</span><span class="bit-0">...... 0</span><span class="bit-1">11</span><span class="bit-0">..... 0</span><span class="bit-1">111</span><span class="bit-0">.... 0</span><span class="bit-1">1111</span><span class="bit-0">... 0</span><span class="bit-1">11111</span><span class="bit-0">.. 0</span><span class="bit-1">111111</span><span class="bit-0">. 0</span><span class="bit-1">1111111</span></pre>


<pre class="fragment custom" id="splatted-msbs-prelim" data-fragment-index="4" style="transform: translateY(6.5em);"></pre>

<pre id="splatted-msbs-plus" class="fragment custom math-underlined splatted-msb-garbage" data-fragment-index="4" style="width: 873px;left: -5px;top: calc(326px + 0.5em);font-size: 24px;text-indent: 2px;line-height: 1.2em;">+</pre>


<pre class="fragment custom selector-garbage" id="splatted-msbs" data-fragment-index="5" style="transform: translate(0em, 1em);"></pre>
<pre class="fragment custom prefix-sum-1-garbage" id="splatted_lsbs-shl4" data-fragment-index="6" style="transform: translate(0em, 2em);"></pre>
<pre class="fragment custom math-underlined prefix-sum-1-garbage" id="prefix-sum-1-or" data-fragment-index="6" style="width: 873px;left: -6px;top: 279px;font-size: 18px;text-indent: 3.8px;line-height: 1.2em;"><span style="vertical-align: 4px;">&verbar;</span></pre>
<pre class="fragment custom" id="prefix-sum-1-prelim" data-fragment-index="6"></pre>

<pre class="fragment custom prefix-sum-1-garbage" id="prefix-sum-1-multiplier" data-fragment-index="6" style="transform: translate(-2em, 5em);"></pre>

<pre class="fragment math-underlined prefix-sum-1-garbage" id="prefix-sum-1-asterisk" data-fragment-index="6" style="width: 968px; left: -44px; top: 350px; font-size: 30px; line-height: 0.5em">*</pre>

<pre class="fragment custom prefix-sum-1-mul prefix-sum-1-garbage" id="prefix-sum-1-mul-1"  data-fragment-index="6" style="transform: translate(-2em, 6.5em);"></pre>
<pre class="fragment custom prefix-sum-1-mul prefix-sum-1-garbage" id="prefix-sum-1-mul-2"  data-fragment-index="6" style="transform: translate(-2em, 7.5em);"></pre>
<pre class="fragment custom prefix-sum-1-mul prefix-sum-1-garbage" id="prefix-sum-1-mul-3"  data-fragment-index="6" style="transform: translate(-2em, 8.5em);"></pre>
<pre class="fragment custom prefix-sum-1-mul prefix-sum-1-garbage" id="prefix-sum-1-mul-4"  data-fragment-index="6" style="transform: translate(-2em, 9.5em);"></pre>
<pre class="fragment custom prefix-sum-1-mul prefix-sum-1-garbage" id="prefix-sum-1-mul-5"  data-fragment-index="6" style="transform: translate(-2em, 10.5em);"></pre>
<pre class="fragment custom prefix-sum-1-mul prefix-sum-1-garbage" id="prefix-sum-1-mul-6"  data-fragment-index="6" style="transform: translate(-2em, 11.5em);"></pre>
<pre class="fragment custom prefix-sum-1-mul prefix-sum-1-garbage" id="prefix-sum-1-mul-7"  data-fragment-index="6" style="transform: translate(-2em, 12.5em);"></pre>
<pre class="fragment custom prefix-sum-1-mul prefix-sum-1-garbage" id="prefix-sum-1-mul-8"  data-fragment-index="6" style="transform: translate(-2em, 13.5em);"></pre>
<pre class="fragment custom prefix-sum-1-mul prefix-sum-1-garbage" id="prefix-sum-1-mul-9"  data-fragment-index="6" style="transform: translate(-2em, 14.5em);"></pre>
<pre class="fragment custom prefix-sum-1-mul prefix-sum-1-garbage" id="prefix-sum-1-mul-10" data-fragment-index="6" style="transform: translate(-2em, 15.5em);"></pre>
<pre class="fragment custom prefix-sum-1-mul prefix-sum-1-garbage" id="prefix-sum-1-mul-11" data-fragment-index="6" style="transform: translate(-2em, 16.5em);"></pre>
<pre class="fragment custom prefix-sum-1-mul prefix-sum-1-garbage" id="prefix-sum-1-mul-12" data-fragment-index="6" style="transform: translate(-2em, 17.5em);"></pre>
<pre class="fragment custom prefix-sum-1-mul prefix-sum-1-garbage" id="prefix-sum-1-mul-13" data-fragment-index="6" style="transform: translate(-2em, 18.5em);"></pre>
<pre class="fragment custom prefix-sum-1-mul prefix-sum-1-garbage" id="prefix-sum-1-mul-14" data-fragment-index="6" style="transform: translate(-2em, 19.5em);"></pre>
<pre class="fragment custom prefix-sum-1-mul prefix-sum-1-garbage" id="prefix-sum-1-mul-15" data-fragment-index="6" style="transform: translate(-2em, 20.5em);"></pre>

<pre class="fragment custom" id="prefix-sum-1-ans" data-fragment-index="6"></pre>
<pre class="fragment custom hex-translation" id="prefix-sum-1-translation" data-fragment-index="6"></pre>

<pre id="prefix-sum-plus" class="fragment custom math-underlined prefix-sum-1-garbage" data-fragment-index="6" style="width: 968px; left: -44px; top: 655px; font-size: 24px; line-height: 0.5em; padding-bottom: 8px;">+</pre>

<pre id="splatted_lsbs_label" class="fragment custom var-name selector-garbage" data-fragment-index="6" style="transform: translate(-11.5em, 1em);">splatted_lsbs = </pre>
<pre id="selector_label"      class="fragment custom var-name" data-fragment-index="10" style="transform: translate(-11.5em, 1em);">     selector = </pre>
<pre id="prefix_sums1_label"  class="fragment custom var-name" data-fragment-index="6" style="transform: translate(-11.5em, -1em);"> prefix_sums1 = </pre>
<pre id="prefix_sums2_label"  class="fragment custom var-name" data-fragment-index="10" style="transform: translate(-11.5em, 0em);"> prefix_sums2 = </pre>


<pre id="selector-explainer-1"  class="fragment custom var-name selector-explain-garbage" data-fragment-index="12" style="left: 376px; top: 143px; font-size: 11pt; font-family: 'JetBrains Mono';"> (       1 & (prefix_sums1 ^ prefix_sums2)) ^ prefix_sums2</pre>
<pre id="selector-explainer-0"  class="fragment custom var-name selector-explain-garbage" data-fragment-index="12" style="left: 376px; top: 143px; font-size: 11pt; font-family: 'JetBrains Mono';"> (       0 & (prefix_sums1 ^ prefix_sums2)) ^ prefix_sums2</pre>
<pre id="selector-explainer-squiggles"  class="fragment custom var-name selector-explain-garbage" data-fragment-index="12" style="left: 502px; top: 143px; font-size: 11pt; font-family: 'JetBrains Mono';">&TildeTilde;&TildeTilde;&TildeTilde;&TildeTilde;&TildeTilde;&TildeTilde;&TildeTilde;&TildeTilde;&TildeTilde;&TildeTilde;&TildeTilde;&TildeTilde;&TildeTilde;&TildeTilde;&TildeTilde;&TildeTilde;&TildeTilde;&TildeTilde;&TildeTilde;&TildeTilde;&TildeTilde;&TildeTilde;&TildeTilde;&TildeTilde;&TildeTilde;&TildeTilde;&TildeTilde;</pre>

<pre class="fragment prefix-sum-2-garbage" id="prefix-shuffle-ones-constant-again" data-fragment-index="1" style="transform: translateY(2em);"><span class="bit-0">0000000</span><span class="bit-1">1</span> <span class="bit-0">0000000</span><span class="bit-1">1</span> <span class="bit-0">0000000</span><span class="bit-1">1</span> <span class="bit-0">0000000</span><span class="bit-1">1</span> <span class="bit-0">0000000</span><span class="bit-1">1</span> <span class="bit-0">0000000</span><span class="bit-1">1</span> <span class="bit-0">0000000</span><span class="bit-1">1</span> <span class="bit-0">0000000</span><span class="bit-1">1</span></pre>

<pre class="fragment custom math-underlined prefix-sum-2-garbage" id="prefix-sum-2-xor" data-fragment-index="7" style="width: 873px;left: -6px;top: 279px;font-size: 18px;text-indent: 3.8px;line-height: 1.2em;"><span style="vertical-align: 4px;">^</span></pre>

<pre class="fragment custom prefix-sum-2-garbage" id="splatted-lsbs-inverse" data-fragment-index="7" style="transform: translateY(3.5em)"></pre>
<pre class="fragment custom prefix-sum-2-garbage" id="splatted-lsbs-inverse-shl4" data-fragment-index="8"></pre>
<pre class="fragment custom math-underlined prefix-sum-2-garbage" id="prefix-sum-2-or" data-fragment-index="8" style="width: 873px;left: -6px;top: 329px;font-size: 18px;text-indent: 3.8px;line-height: 1.2em;"><span style="vertical-align: 4px;">&verbar;</span></pre>
<pre class="fragment custom prefix-sum-2-garbage-final" id="splatted_lsbs_inv" data-fragment-index="8"></pre>
<pre class="fragment custom prefix-sum-2-garbage" id="prefix-sum-2-multiplier" data-fragment-index="8"></pre>
<pre class="fragment math-underlined prefix-sum-2-garbage" id="prefix-sum-2-asterisk" data-fragment-index="8" style="width: 968px; left: -44px; top: 390px; font-size: 30px; line-height: 0.5em">*</pre>

<pre class="fragment custom prefix-sum-2-mul prefix-sum-2-garbage" id="prefix-sum-2-mul-1"  data-fragment-index="8"></pre>
<pre class="fragment custom prefix-sum-2-mul prefix-sum-2-garbage" id="prefix-sum-2-mul-2"  data-fragment-index="8"></pre>
<pre class="fragment custom prefix-sum-2-mul prefix-sum-2-garbage" id="prefix-sum-2-mul-3"  data-fragment-index="8"></pre>
<pre class="fragment custom prefix-sum-2-mul prefix-sum-2-garbage" id="prefix-sum-2-mul-4"  data-fragment-index="8"></pre>
<pre class="fragment custom prefix-sum-2-mul prefix-sum-2-garbage" id="prefix-sum-2-mul-5"  data-fragment-index="8"></pre>
<pre class="fragment custom prefix-sum-2-mul prefix-sum-2-garbage" id="prefix-sum-2-mul-6"  data-fragment-index="8"></pre>
<pre class="fragment custom prefix-sum-2-mul prefix-sum-2-garbage" id="prefix-sum-2-mul-7"  data-fragment-index="8"></pre>
<pre class="fragment custom prefix-sum-2-mul prefix-sum-2-garbage" id="prefix-sum-2-mul-8"  data-fragment-index="8"></pre>
<pre class="fragment custom prefix-sum-2-mul prefix-sum-2-garbage" id="prefix-sum-2-mul-9"  data-fragment-index="8"></pre>
<pre class="fragment custom prefix-sum-2-mul prefix-sum-2-garbage" id="prefix-sum-2-mul-10" data-fragment-index="8"></pre>
<pre class="fragment custom prefix-sum-2-mul prefix-sum-2-garbage" id="prefix-sum-2-mul-11" data-fragment-index="8"></pre>
<pre class="fragment custom prefix-sum-2-mul prefix-sum-2-garbage" id="prefix-sum-2-mul-12" data-fragment-index="8"></pre>
<pre class="fragment custom prefix-sum-2-mul prefix-sum-2-garbage" id="prefix-sum-2-mul-13" data-fragment-index="8"></pre>
<pre class="fragment custom prefix-sum-2-mul prefix-sum-2-garbage" id="prefix-sum-2-mul-14" data-fragment-index="8"></pre>
<pre class="fragment custom prefix-sum-2-mul prefix-sum-2-garbage" id="prefix-sum-2-mul-15" data-fragment-index="8"></pre>
<pre id="prefix-sum-2-plus" class="fragment custom math-underlined prefix-sum-2-garbage" data-fragment-index="8" style="width: 968px; left: -44px; top: 685px; font-size: 24px; line-height: 30px;">+</pre>

<pre class="fragment custom" id="prefix-sum-2-ans" data-fragment-index="8"></pre>
<pre class="fragment custom hex-translation prefix-sum-2-garbage-final" id="prefix-sum-2-translation" data-fragment-index="8"></pre>
<pre class="fragment custom selector-garbage" id="splatted-msbs-255" data-fragment-index="10" style="transform: translate(0em, 2em);"></pre>
<pre class="fragment custom math-underlined star selector-garbage" id="selector_star" data-fragment-index="10" style="width: 873px;left: -4px;top: 290px;font-size: 30px;line-height: 0.5em;">*</pre>

<pre class="fragment custom splatted-msbs-255-intermediate-value selector-garbage" id="splatted-msbs-255-intermediate-value-0" data-fragment-index="10"></pre>
<pre class="fragment custom splatted-msbs-255-intermediate-value selector-garbage" id="splatted-msbs-255-intermediate-value-1" data-fragment-index="10"></pre>
<pre class="fragment custom splatted-msbs-255-intermediate-value selector-garbage" id="splatted-msbs-255-intermediate-value-2" data-fragment-index="10"></pre>
<pre class="fragment custom splatted-msbs-255-intermediate-value selector-garbage" id="splatted-msbs-255-intermediate-value-3" data-fragment-index="10"></pre>
<pre class="fragment custom splatted-msbs-255-intermediate-value selector-garbage" id="splatted-msbs-255-intermediate-value-4" data-fragment-index="10"></pre>
<pre class="fragment custom splatted-msbs-255-intermediate-value selector-garbage" id="splatted-msbs-255-intermediate-value-5" data-fragment-index="10"></pre>
<pre class="fragment custom splatted-msbs-255-intermediate-value selector-garbage" id="splatted-msbs-255-intermediate-value-6" data-fragment-index="10"></pre>
<pre class="fragment custom splatted-msbs-255-intermediate-value selector-garbage" id="splatted-msbs-255-intermediate-value-7" data-fragment-index="10"></pre>

<pre id="splatted-msbs-255-plus" class="fragment custom math-underlined selector-garbage" data-fragment-index="10" style="width: 873px; left: -5px; top: 446px; font-size: 24px; text-indent: 2px;line-height: 1.2em;">+</pre>

<pre class="fragment custom" id="selector-value" data-fragment-index="10"></pre>

<script>
{
    const forward_only = true;
    const skip_auto_prev_state = true;
    const ease = true;
    Array.prototype.push.apply(global_animations, [{
            selector: "#splatted-lsbs-inverse-shl4",
            slide_num: 8,
            animation_delay: "0s",
            animation_duration: "4s",
            keyframes: {
                0:   { transform: "translate(2.4em, 3.5em)", opacity: 0 },
                20:  { opacity: 1 },
                50:  { transform: "translate(2.4em, 4.5em)" },
                100: { transform: "translate(0, 4.5em)", opacity: 1 },
            }
        },

        {
            selector: "#prefix-sum-2-or",
            slide_num: 8,
            animation_delay: "3.25s",
            animation_duration: "1s",
            keyframes: {
                0:   { opacity: 0, transform: "translateX(1em)" },
                20:  { opacity: 0 },
                100: { opacity: 1, transform: "translateX(0)" }
            }
        },

        {
            selector: "#splatted_lsbs_inv",
            slide_num: 8,
            animation_delay: "4.25s",
            animation_duration: "1s",
            keyframes: {
                0:   { opacity: 0, transform: "translate(0, 5em)" },
                20:  { opacity: 0 },
                100: { opacity: 1, transform: "translate(0, 6em)" }
            }
        },

        {
            selector: "#splatted_lsbs_inv",
            slide_num: 8,
            animation_delay: "6s",
            animation_duration: "2s",
            keyframes: {
                0:   { transform: "translate(0em, 6em)" },
                100: { transform: "translate(-2em, 6em)" }
            }
        },

        {
            selector: ".splatted_lsbs_inv_space",
            slide_num: 8,
            animation_delay: "6s",
            animation_duration: "2s",
            keyframes: {
                0:   { "letter-spacing": "-12px", opacity: 0 },
                90:  { opacity: 1 },
                100: { opacity: 1, "letter-spacing": "0px" }
            }
        },

        {
            selector: "#prefix-sum-2-multiplier",
            slide_num: 8,
            animation_delay: "8s",
            animation_duration: "1s",
            keyframes: {
                0:   { transform: "translate(-2em, 6em)", opacity: 0 },
                20:  { opacity: 0 },
                100: { transform: "translate(-2em, 7em)", opacity: 1 },
            }
        },

        {
            selector: "#prefix-sum-2-asterisk",
            slide_num: 8,
            animation_delay: "8.5s",
            animation_duration: "1s",
            keyframes: {
                0:   { opacity: 0, transform: "translateX(1em)" },
                20:  { opacity: 0 },
                100: { opacity: 1, transform: "translateX(0)" }
            }
        },

        ...new Array(15).fill(0).map((_, i) => ({
            selector: `#prefix-sum-2-mul-${i + 1}`,
            slide_num: 8,
            animation_delay: "9.5s",
            animation_duration: `${4 + (i + 1) / 12}s`,
            keyframes: {
                0:   { transform: "translate(-2em, 6em)", opacity: 0 },
                80:  { opacity: 1 },
                100: { transform: `translate(-2em, ${8.5 + i}em)`, opacity: 1 },
            }
        })),

        ...new Array(15).fill(0).map((_, i) => ({
            selector: `#prefix-sum-2-mul-${i + 1} .old-bits`,
            slide_num: 8,
            animation_delay: "15s",
            animation_duration: `${3 + (i + 1) / 8}s`,
            keyframes: {
                0:   { "letter-spacing":   "0px", opacity: 1  },
                85:  { opacity: 0, },
                100: { "letter-spacing": "-12px", opacity: 0  }
            }
        })),

        ...new Array(15).fill(0).map((_, i) => ({
            selector: `#prefix-sum-2-mul-${i + 1} .new-bits`,
            slide_num: 8,
            animation_delay: "15s",
            animation_duration: `${3 + (i + 1) / 8}s`,
            keyframes: {
                0:   { "letter-spacing":   "-12px", opacity: 0  },
                90:  { opacity: 1, },
                100: { "letter-spacing": "0px", opacity: 1  }
            }
        })),

        {
            selector: "#prefix-sum-2-plus",
            slide_num: 8,
            animation_delay: "19s",
            animation_duration: "1s",
            keyframes: {
                0:   { opacity: 0, transform: "translateX(1em)" },
                20:  { opacity: 0 },
                100: { opacity: 1, transform: "translateX(0)" }
            }
        },

        {
            selector: "#prefix-sum-2-ans",
            slide_num: 8,
            animation_delay: "20s",
            animation_duration: "1s",
            keyframes: {
                0:   { opacity: 0, transform: "translate(-2em, 23em)" },
                20:  { opacity: 0 },
                100: { opacity: 1, transform: "translate(-2em, 24em)" }
            }
        },

        {
            selector: "#prefix-sum-2-ans",
            slide_num: 9,
            animation_delay: "0s",
            animation_duration: "3s",
            keyframes: {
                0:   { transform: `translate(-2em, ${24}em)` },
                100: { transform: `translate(-2em, ${0}em)` }
            },
            forward_only
        },

        {
            selector: "#prefix-sum-2-translation",
            slide_num: 8,
            animation_delay: "21s",
            animation_duration: "1s",
            keyframes: {
                0:   { opacity: 0, transform: "translate(-2em, 24em)" },
                20:  { opacity: 0 },
                100: { opacity: 1, transform: "translate(-2em, 25em)" }
            }
        },

        {
            selector: "#prefix-sum-2-translation",
            slide_num: 9,
            animation_delay: "0s",
            animation_duration: "3s",
            keyframes: {
                0:   { transform: `translate(-2em, ${25}em)` },
                100: { transform: `translate(-2em, ${7}em)` }
            },
            forward_only,
        },

        ...[".prefix-sum-2-garbage", ".prefix-sum-2-garbage-final"].map((selector, i) => ({
            selector,
            slide_num: 9 + i,
            animation_delay: "0s",
            animation_duration: "3s",
            keyframes: {
                0:   { opacity: 1 },
                100: { opacity: 0 }
            },
            skip_auto_prev_state,
            forward_only,
        })),

        {
            selector: "#splatted-msbs-255",
            slide_num: 10,
            animation_delay: "2s",
            animation_duration: "1s",
            keyframes: {
                0:   { opacity: 0, transform: "translate(0em, 1em)" },
                20:  { opacity: 0 },
                100: { opacity: 1, transform: "translate(0em, 2em)" }
            },
            forward_only,
        },

        {
            selector: "#selector_star",
            slide_num: 10,
            animation_delay: "3s",
            animation_duration: "1s",
            keyframes: {
                0:   { opacity: 0, transform: "translateX(1em)" },
                20:  { opacity: 0 },
                100: { opacity: 1, transform: "translateX(0)" }
            },
            forward_only
        },

        ...new Array(8).fill(0).map((_, i) => ({
            selector: `#splatted-msbs-255-intermediate-value-${i}`,
            slide_num: 10,
            animation_delay: "4s",
            animation_duration: `${4 + (i + 1) / 12}s`,
            keyframes: {
                0:   { transform: "translate(0em, 1em)", opacity: 0 },
                80:  { opacity: 1 },
                100: { transform: `translate(0em, ${3.5 + i}em)`, opacity: 1 },
            }
        })),

        ...new Array(8).fill(0).map((_, i) => ({
            selector: `#splatted-msbs-255-intermediate-value-${i} .old-bits`,
            slide_num: 10,
            animation_delay: "6s",
            animation_duration: `${2.5 + (i + 1) / 8}s`,
            keyframes: {
                0:   { "letter-spacing":   "0px", opacity: 1  },
                85:  { opacity: 0, },
                100: { "letter-spacing": "-12px", opacity: 0  }
            }
        })),

        ...new Array(8).fill(0).map((_, i) => ({
            selector: `#splatted-msbs-255-intermediate-value-${i} .new-bits`,
            slide_num: 10,
            animation_delay: "6s",
            animation_duration: `${2.5 + (i + 1) / 8}s`,
            keyframes: {
                0:   { "letter-spacing":   "-12px", opacity: 0  },
                90:  { opacity: 1, },
                100: { "letter-spacing": "0px", opacity: 1  }
            }
        })),

        {
            selector: "#splatted-msbs-255-plus",
            slide_num: 10,
            animation_delay: "9s",
            animation_duration: "1s",
            keyframes: {
                0:   { opacity: 0, transform: "translateX(1em)" },
                20:  { opacity: 0 },
                100: { opacity: 1, transform: "translateX(0)" }
            }
        },

        {
            selector: "#selector-value",
            slide_num: 10,
            animation_delay: "10s",
            animation_duration: "1s",
            keyframes: {
                0:   { opacity: 0, transform: "translateY(11em)" },
                20:  { opacity: 0 },
                100: { opacity: 1, transform: "translateY(12em)" }
            }
        },

        {
            selector: "#selector-value",
            slide_num: 11,
            animation_delay: "0s",
            animation_duration: "3s",
            keyframes: {
                0:   { transform: "translate(0em, 12em)" },
                100: { transform: "translate(0em, 1em)" }
            }
        },

        {
            selector: "#selector-value",
            slide_num: 11,
            animation_delay: "3s",
            animation_duration: "2s",
            keyframes: {
                0:   { transform: "translate(0em,  1em)" },
                100: { transform: "translate(-2em, 1em)" }
            }
        },

        {
            selector: "#selector-value .invis",
            slide_num: 11,
            animation_delay: "3s",
            animation_duration: "2s",
            keyframes: {
                0:   { "letter-spacing": "-12px" },
                100: { "letter-spacing": "0px" }
            }
        },

        {
            selector: "#splatted_lsbs_label",
            slide_num: 5,
            animation_delay: "7s",
            animation_duration: "2s",
            keyframes: {
                0:   { opacity: 0 },
                100: { opacity: 1 },
            }
        },


        {
            selector: "#prefix_sums1_label",
            slide_num: 6,
            animation_delay: "2s",
            animation_duration: "1s",
            keyframes: {
                0:   { opacity: 0 },
                100: { opacity: 1 },
            }
        },

        {
            selector: "#selector_label",
            slide_num: 11,
            animation_delay: "0s",
            animation_duration: "3s",
            keyframes: {
                0:   { opacity: 0 },
                100: { opacity: 1 },
            }
        },

        {
            selector: ".selector-garbage",
            slide_num: 11,
            animation_delay: "0s",
            animation_duration: "3s",
            keyframes: {
                0:   { opacity: 1 },
                100: { opacity: 0 }
            },
            skip_auto_prev_state,
            forward_only,
        },

        ...["#selector-explainer-1", "#selector-explainer-0"].map((selector, i) => ({
            selector,
            slide_num: 12,
            animation_delay: "0.5s",
            animation_duration: "1s",
            keyframes: {
                0:   { opacity: 0, transform: `translateY(${(i) * 1.2}em)` },
                20:  { opacity: 0 },
                100: { opacity: 1, transform: `translateY(${(i + 1) * 1.2}em)` },
            }
        })),

        {
            selector: "#selector-explainer-squiggles",
            slide_num: 12,
            animation_delay: "1.5s",
            animation_duration: "1s",
            keyframes: {
                0:   { opacity: 0, transform: `translateY(1.6em)` },
                20:  { opacity: 0 },
                100: { opacity: 1, transform: `translateY(2.6em)` },
            }
        },

        {
            selector: ".selector-explain-garbage",
            slide_num: 13,
            animation_delay: "0s",
            animation_duration: "1s",
            keyframes: {
                0:   { opacity: 1 },
                100: { opacity: 0 }
            },
            skip_auto_prev_state,
            forward_only,
        },

        ...["#prefix-sum-1-ans .fade-out-unselected", "#prefix-sum-2-ans .fade-out-unselected"].map((selector, i) => ({
            selector,
            slide_num: 13,
            animation_delay: "0s",
            animation_duration: '5s',
            keyframes: {
                0:   { opacity: 1 },
                100: { opacity: 0.2 }
            },
            ease,
            skip_auto_prev_state,
            forward_only,
        })),

        {
            selector: "#prefix_sums2_label",
            slide_num: 9,
            animation_delay: "2s",
            animation_duration: "1s",
            keyframes: {
                0:   { opacity: 0 },
                100: { opacity: 1 }
            },
            forward_only,
        },


    ].map(o => { o.section = "prefix-shuffle"; return o; }))
}
</script>
<style>
#selector-explainer-1, #selector-explainer-0 {
    background-color: #000;
    border: 2px solid #000;
}

/*
section#prefix-shuffle[data-fragment="5"] #prefix-sum-1-mul-1 .old-bits, section#prefix-shuffle[data-fragment="5"] #prefix-sum-1-mul-1 .new-bits { animation-duration:   2.3666666666666667s; }
section#prefix-shuffle[data-fragment="5"] #prefix-sum-1-mul-2 .old-bits, section#prefix-shuffle[data-fragment="5"] #prefix-sum-1-mul-2 .new-bits { animation-duration:   2.4999999999999996s; }
section#prefix-shuffle[data-fragment="5"] #prefix-sum-1-mul-3 .old-bits, section#prefix-shuffle[data-fragment="5"] #prefix-sum-1-mul-3 .new-bits { animation-duration:   2.6333333333333337s; }
section#prefix-shuffle[data-fragment="5"] #prefix-sum-1-mul-4 .old-bits, section#prefix-shuffle[data-fragment="5"] #prefix-sum-1-mul-4 .new-bits { animation-duration:   2.7666666666666666s; }
section#prefix-shuffle[data-fragment="5"] #prefix-sum-1-mul-5 .old-bits, section#prefix-shuffle[data-fragment="5"] #prefix-sum-1-mul-5 .new-bits { animation-duration:   2.9000000000000004s; }
section#prefix-shuffle[data-fragment="5"] #prefix-sum-1-mul-6 .old-bits, section#prefix-shuffle[data-fragment="5"] #prefix-sum-1-mul-6 .new-bits { animation-duration:   3.033333333333333s; }
section#prefix-shuffle[data-fragment="5"] #prefix-sum-1-mul-7 .old-bits, section#prefix-shuffle[data-fragment="5"] #prefix-sum-1-mul-7 .new-bits { animation-duration:   3.166666666666666s; }
section#prefix-shuffle[data-fragment="5"] #prefix-sum-1-mul-8 .old-bits, section#prefix-shuffle[data-fragment="5"] #prefix-sum-1-mul-8 .new-bits { animation-duration:   3.3000000000000003s; }
section#prefix-shuffle[data-fragment="5"] #prefix-sum-1-mul-9 .old-bits, section#prefix-shuffle[data-fragment="5"] #prefix-sum-1-mul-9 .new-bits { animation-duration:   3.433333333333333s; }
section#prefix-shuffle[data-fragment="5"] #prefix-sum-1-mul-10 .old-bits, section#prefix-shuffle[data-fragment="5"] #prefix-sum-1-mul-10 .new-bits { animation-duration: 3.5666666666666673s; }
section#prefix-shuffle[data-fragment="5"] #prefix-sum-1-mul-11 .old-bits, section#prefix-shuffle[data-fragment="5"] #prefix-sum-1-mul-11 .new-bits { animation-duration: 3.7s; }
section#prefix-shuffle[data-fragment="5"] #prefix-sum-1-mul-12 .old-bits, section#prefix-shuffle[data-fragment="5"] #prefix-sum-1-mul-12 .new-bits { animation-duration: 3.833333333333333s; }
section#prefix-shuffle[data-fragment="5"] #prefix-sum-1-mul-13 .old-bits, section#prefix-shuffle[data-fragment="5"] #prefix-sum-1-mul-13 .new-bits { animation-duration: 3.966666666666667s; }
section#prefix-shuffle[data-fragment="5"] #prefix-sum-1-mul-14 .old-bits, section#prefix-shuffle[data-fragment="5"] #prefix-sum-1-mul-14 .new-bits { animation-duration: 4.1s; }
section#prefix-shuffle[data-fragment="5"] #prefix-sum-1-mul-15 .old-bits, section#prefix-shuffle[data-fragment="5"] #prefix-sum-1-mul-15 .new-bits { animation-duration: 4.233333333333333s; } */

/* section#prefix-shuffle #splatted-lsbs-inverse-shl4 {
    transform: translate(2.4em, 3.5em); opacity: 0;
}

section#prefix-shuffle[data-fragment="8"] #splatted-lsbs-inverse-shl4 {
    animation: splatted-lsbs-inverse-shl4-1 4s cubic-bezier(0.69, 0.02, 0.53, 1) 0s 1 forwards normal;
}

section#prefix-shuffle[fragment-9] #splatted-lsbs-inverse-shl4 {
    transform: translate(0, 4.5em); opacity: 1;
} */

section#prefix-shuffle[data-fragment="8"] #splatted-lsbs-inverse-shl4 .invis {
    animation: alive 1s cubic-bezier(0.69, 0.02, 0.53, 1) 3s 1 forwards normal;
}

section#prefix-shuffle[fragment-9] #splatted-lsbs-inverse-shl4 .invis {
    opacity: 1;
}

/* @keyframes splatted-lsbs-inverse-shl4-1 {
    0%   { transform: translate(2.4em, 3.5em); opacity: 0; }
    20% { opacity: 1; }
    50% { transform: translate(2.4em, 4.5em); }
    100% { transform: translate(0, 4.5em); opacity: 1; }
} */

@keyframes splatted-lsbs-inverse-shl4-2 {
    0%   { transform: translate(2.4em, 4.5em); }
    100% { transform: translate(0, 4.5em); }
}

#splatted-lsbs-inverse {
    opacity: 0;
    transform: translateY(2.5em);
}

section#prefix-shuffle[data-fragment="7"] #splatted-lsbs-inverse {
    animation: splatted-lsbs-inverse 1s cubic-bezier(0.69, 0.02, 0.53, 1) 2s 1 forwards normal;
}

@keyframes splatted-lsbs-inverse {
    0%   { transform: translateY(2.5em); opacity: 0 }
    100% { transform: translateY(3.5em); opacity: 1 }
}

section#prefix-shuffle[fragment-8] #splatted-lsbs-inverse {
    transform: translateY(3.5em); opacity: 1;
}

#prefix-shuffle-ones-constant-again {
    opacity: 0;
}

section#prefix-shuffle[data-fragment="7"] #prefix-shuffle-ones-constant-again {
    animation: prefix-shuffle-ones-constant-again 1s cubic-bezier(0.69, 0.02, 0.53, 1) 0s 1 forwards normal;
}

section#prefix-shuffle[fragment-8] #prefix-shuffle-ones-constant-again {
    transform: translateY(2em); opacity: 1
}

@keyframes prefix-shuffle-ones-constant-again {
    0%   { transform: translateY(1em); opacity: 0 }
    100% { transform: translateY(2em); opacity: 1 }
}

#prefix-sum-2-xor {
    opacity: 0;
}

section#prefix-shuffle[data-fragment="7"] #prefix-sum-2-xor {
    animation: prefix-sum-1-asterisk 1s cubic-bezier(0.69, 0.02, 0.53, 1) 1s 1 forwards normal;
}

section#prefix-shuffle[fragment-8] #prefix-sum-2-xor {
    opacity: 1;
}


section#prefix-shuffle[data-fragment="5"] #prefix-sum-1-or {
    opacity: 0;
    animation: prefix-sum-1-asterisk 1s cubic-bezier(0.69, 0.02, 0.53, 1) 4s 1 forwards normal;
}

section#prefix-shuffle[data-fragment="6"][present-went-forward] .prefix-sum-1-garbage {
    opacity: 1;
    animation: dead 3s ease-out 0s 1 forwards normal;
}

section#prefix-shuffle[fragment-6] .prefix-sum-1-garbage {
    opacity: 0;
}

#prefix-sum-1-translation {
    opacity: 0;
    transform: translate(-2em, 23em);
}

section#prefix-shuffle[fragment-6] #prefix-sum-1-translation {
    transform: translate(-2em, 5em);
}

section#prefix-shuffle[data-fragment="6"][present-went-forward] #prefix-sum-1-translation {
    opacity: 1;
    animation: prefix-sum-1-translation-up 3s cubic-bezier(0.69, 0.02, 0.53, 1) 0s 1 forwards normal;
}

section#prefix-shuffle[data-fragment="6"][present-went-backward] #prefix-sum-1-translation {
    opacity: 1;
    transform: translate(-2em, 5em);
}

section#prefix-shuffle[data-fragment="7"][present-went-forward] #prefix-sum-1-translation {
    animation: dead 2s ease-out 0s 1 forwards normal;
}

section#prefix-shuffle[fragment-7] #prefix-sum-1-translation {
    opacity: 0;
}

@keyframes prefix-sum-1-translation-up {
    0%   { transform: translate(-2em, 23em); }
    100% { transform: translate(-2em, 5em); }
}

section#prefix-shuffle[data-fragment="5"] #prefix-sum-1-translation {
    animation: prefix-sum-1-translation 1s cubic-bezier(0.69, 0.02, 0.53, 1) 20.5s 1 forwards normal;
}

@keyframes prefix-sum-1-translation {
    0%   { transform: translate(-2em, 22em); opacity: 0; }
    100% { transform: translate(-2em, 23em); opacity: 1; }
}

section#prefix-shuffle[data-fragment="5"] #prefix-sum-plus {
    opacity: 0;
    animation: prefix-sum-1-asterisk 1s cubic-bezier(0.69, 0.02, 0.53, 1) 17.5s 1 forwards normal;
}

section#prefix-shuffle[data-fragment="5"] #prefix-sum-1-ans {
    opacity: 0;
    animation: prefix-sum-1-ans 1s cubic-bezier(0.69, 0.02, 0.53, 1) 18.5s 1 forwards normal;
}

@keyframes prefix-sum-1-ans {
    0%   { transform: translate(-2em, 21em); opacity: 0; }
    100% { transform: translate(-2em, 22em); opacity: 1; }
}

section#prefix-shuffle[data-fragment="6"][present-went-forward] #prefix-sum-1-ans {
    opacity: 1;
    animation: prefix-sum-1-ans2 3s cubic-bezier(0.69, 0.02, 0.53, 1) 0s 1 forwards normal;
}

@keyframes prefix-sum-1-ans2 {
    0%   { transform: translate(-2em, 22em); opacity: 1; }
    100% { transform: translate(-2em, -1em); opacity: 1; }
}


section#prefix-shuffle[fragment-6] #prefix-sum-1-ans {
    transform: translate(-2em, -1em); opacity: 1;
}

section#prefix-shuffle[data-fragment="5"] #prefix-sum-1-mul-1,
section#prefix-shuffle[data-fragment="5"] #prefix-sum-1-mul-2,
section#prefix-shuffle[data-fragment="5"] #prefix-sum-1-mul-3,
section#prefix-shuffle[data-fragment="5"] #prefix-sum-1-mul-4,
section#prefix-shuffle[data-fragment="5"] #prefix-sum-1-mul-5,
section#prefix-shuffle[data-fragment="5"] #prefix-sum-1-mul-6,
section#prefix-shuffle[data-fragment="5"] #prefix-sum-1-mul-7,
section#prefix-shuffle[data-fragment="5"] #prefix-sum-1-mul-8,
section#prefix-shuffle[data-fragment="5"] #prefix-sum-1-mul-9,
section#prefix-shuffle[data-fragment="5"] #prefix-sum-1-mul-10,
section#prefix-shuffle[data-fragment="5"] #prefix-sum-1-mul-11,
section#prefix-shuffle[data-fragment="5"] #prefix-sum-1-mul-12,
section#prefix-shuffle[data-fragment="5"] #prefix-sum-1-mul-13,
section#prefix-shuffle[data-fragment="5"] #prefix-sum-1-mul-14,
section#prefix-shuffle[data-fragment="5"] #prefix-sum-1-mul-15 {
    opacity: 0;
    animation: 6s cubic-bezier(0.69, 0.02, 0.53, 1) 9.5s 1 forwards normal;
}

section#prefix-shuffle[data-fragment="5"] #prefix-sum-1-mul-1 { animation-name: prefix-sum-1-mul-1; }
@keyframes prefix-sum-1-mul-1    { 0% { opacity: 0; transform: translate(-2em, 3.5em) } 20% { opacity: 0 } 80% { opacity: 1 } 100% { opacity: 1; transform: translate(-2em, 6.5em) }  }

section#prefix-shuffle[data-fragment="5"] #prefix-sum-1-mul-2 { animation-name: prefix-sum-1-mul-2; }
@keyframes prefix-sum-1-mul-2    { 0% { opacity: 0; transform: translate(-2em, 3.5em) } 20% { opacity: 0 } 80% { opacity: 1 } 100% { opacity: 1; transform: translate(-2em, 7.5em) }  }

section#prefix-shuffle[data-fragment="5"] #prefix-sum-1-mul-3 { animation-name: prefix-sum-1-mul-3; }
@keyframes prefix-sum-1-mul-3    { 0% { opacity: 0; transform: translate(-2em, 3.5em) } 20% { opacity: 0 } 80% { opacity: 1 } 100% { opacity: 1; transform: translate(-2em, 8.5em) }  }

section#prefix-shuffle[data-fragment="5"] #prefix-sum-1-mul-4 { animation-name: prefix-sum-1-mul-4; }
@keyframes prefix-sum-1-mul-4    { 0% { opacity: 0; transform: translate(-2em, 3.5em) } 20% { opacity: 0 } 80% { opacity: 1 } 100% { opacity: 1; transform: translate(-2em, 9.5em) }  }

section#prefix-shuffle[data-fragment="5"] #prefix-sum-1-mul-5 { animation-name: prefix-sum-1-mul-5; }
@keyframes prefix-sum-1-mul-5    { 0% { opacity: 0; transform: translate(-2em, 3.5em) } 20% { opacity: 0 } 80% { opacity: 1 } 100% { opacity: 1; transform: translate(-2em, 10.5em) }  }

section#prefix-shuffle[data-fragment="5"] #prefix-sum-1-mul-6 { animation-name: prefix-sum-1-mul-6; }
@keyframes prefix-sum-1-mul-6    { 0% { opacity: 0; transform: translate(-2em, 3.5em) } 20% { opacity: 0 } 80% { opacity: 1 } 100% { opacity: 1; transform: translate(-2em, 11.5em) }  }

section#prefix-shuffle[data-fragment="5"] #prefix-sum-1-mul-7 { animation-name: prefix-sum-1-mul-7; }
@keyframes prefix-sum-1-mul-7    { 0% { opacity: 0; transform: translate(-2em, 3.5em) } 20% { opacity: 0 } 80% { opacity: 1 } 100% { opacity: 1; transform: translate(-2em, 12.5em) }  }

section#prefix-shuffle[data-fragment="5"] #prefix-sum-1-mul-8 { animation-name: prefix-sum-1-mul-8; }
@keyframes prefix-sum-1-mul-8    { 0% { opacity: 0; transform: translate(-2em, 3.5em) } 20% { opacity: 0 } 80% { opacity: 1 } 100% { opacity: 1; transform: translate(-2em, 13.5em) }  }

section#prefix-shuffle[data-fragment="5"] #prefix-sum-1-mul-9 { animation-name: prefix-sum-1-mul-9; }
@keyframes prefix-sum-1-mul-9    { 0% { opacity: 0; transform: translate(-2em, 3.5em) } 20% { opacity: 0 } 80% { opacity: 1 } 100% { opacity: 1; transform: translate(-2em, 14.5em) }  }

section#prefix-shuffle[data-fragment="5"] #prefix-sum-1-mul-10 { animation-name: prefix-sum-1-mul-10; }
@keyframes prefix-sum-1-mul-10 { 0% { opacity: 0; transform: translate(-2em, 3.5em) } 20% { opacity: 0 } 80% { opacity: 1 } 100% { opacity: 1; transform: translate(-2em, 15.5em) }  }

section#prefix-shuffle[data-fragment="5"] #prefix-sum-1-mul-11 { animation-name: prefix-sum-1-mul-11; }
@keyframes prefix-sum-1-mul-11 { 0% { opacity: 0; transform: translate(-2em, 3.5em) } 20% { opacity: 0 } 80% { opacity: 1 } 100% { opacity: 1; transform: translate(-2em, 16.5em) }  }

section#prefix-shuffle[data-fragment="5"] #prefix-sum-1-mul-12 { animation-name: prefix-sum-1-mul-12; }
@keyframes prefix-sum-1-mul-12 { 0% { opacity: 0; transform: translate(-2em, 3.5em) } 20% { opacity: 0 } 80% { opacity: 1 } 100% { opacity: 1; transform: translate(-2em, 17.5em) }  }

section#prefix-shuffle[data-fragment="5"] #prefix-sum-1-mul-13 { animation-name: prefix-sum-1-mul-13; }
@keyframes prefix-sum-1-mul-13 { 0% { opacity: 0; transform: translate(-2em, 3.5em) } 20% { opacity: 0 } 80% { opacity: 1 } 100% { opacity: 1; transform: translate(-2em, 18.5em) }  }

section#prefix-shuffle[data-fragment="5"] #prefix-sum-1-mul-14 { animation-name: prefix-sum-1-mul-14; }
@keyframes prefix-sum-1-mul-14 { 0% { opacity: 0; transform: translate(-2em, 3.5em) } 20% { opacity: 0 } 80% { opacity: 1 } 100% { opacity: 1; transform: translate(-2em, 19.5em) }  }

section#prefix-shuffle[data-fragment="5"] #prefix-sum-1-mul-15 { animation-name: prefix-sum-1-mul-15; }
@keyframes prefix-sum-1-mul-15 { 0% { opacity: 0; transform: translate(-2em, 3.5em) } 20% { opacity: 0 } 80% { opacity: 1 } 100% { opacity: 1; transform: translate(-2em, 20.5em) }  }


@keyframes prefix-sum-1-mul-nums {
    0%   { opacity: 0; }
    100% { opacity: 1; }
}

section#prefix-shuffle[data-fragment="5"] #prefix-sum-1-asterisk {
    opacity: 0;
    animation: prefix-sum-1-asterisk 1s cubic-bezier(0.69, 0.02, 0.53, 1) 9.5s 1 forwards normal;
}

@keyframes prefix-sum-1-asterisk {
    0% { opacity: 0; transform: translateX(1em); }
    20% { opacity: 0 }
    100% { opacity: 1; transform: translateX(0); }
}

section#prefix-shuffle[data-fragment="5"] #prefix-sum-1-multiplier {
    opacity: 0;
    animation: prefix-sum-1-multiplier 1s cubic-bezier(0.69, 0.02, 0.53, 1) 9s 1 forwards normal;
}

@keyframes prefix-sum-1-multiplier {
    0%   { transform: translate(-2em, 4em); opacity: 0; }
    100% { transform: translate(-2em, 5em); opacity: 1; }
}

section#prefix-shuffle[data-fragment="5"] .prefix-sum-1-mul .old-bits {
    letter-spacing: 0px;
    opacity: 1;
    animation: prefix-sum-1-prelim-space-rev 8s cubic-bezier(0.69, 0.02, 0.53, 1) 14s 1 forwards normal;
}

@keyframes prefix-sum-1-prelim-space-rev {
    0%   { letter-spacing:   0px; opacity: 1  }
    85%  { opacity: 0; }
    100% { letter-spacing: -12px; opacity: 0  }
}

section#prefix-shuffle[data-fragment="5"] .prefix-sum-1-mul .new-bits {
    letter-spacing: -12px;
    opacity: 0;
    animation: prefix-sum-1-prelim-space 8s cubic-bezier(0.69, 0.02, 0.53, 1) 14s 1 forwards normal;
}

section#prefix-shuffle[data-fragment="5"] .prefix-sum-1-prelim-space {
    animation: prefix-sum-1-prelim-space 2s cubic-bezier(0.69, 0.02, 0.53, 1) 7s 1 forwards normal;
    letter-spacing: -12px;
}

section#prefix-shuffle[fragment-6] .prefix-sum-1-prelim-space,
section#prefix-shuffle[fragment-6] .prefix-sum-1-mul .new-bits {
    letter-spacing: 0px;
    opacity: 1;
}

section#prefix-shuffle[fragment-6] .prefix-sum-1-mul .old-bits {
    letter-spacing: -12px; opacity: 0
}

@keyframes prefix-sum-1-prelim-space {
    0%   { letter-spacing: -12px; opacity: 0  }
    90%  { opacity: 1; }
    100% { letter-spacing:   0px; opacity: 1  }
}

section#prefix-shuffle[data-fragment="5"] #prefix-sum-1-mul-1 .old-bits, section#prefix-shuffle[data-fragment="5"] #prefix-sum-1-mul-1 .new-bits { animation-duration:   2.3666666666666667s; }
section#prefix-shuffle[data-fragment="5"] #prefix-sum-1-mul-2 .old-bits, section#prefix-shuffle[data-fragment="5"] #prefix-sum-1-mul-2 .new-bits { animation-duration:   2.4999999999999996s; }
section#prefix-shuffle[data-fragment="5"] #prefix-sum-1-mul-3 .old-bits, section#prefix-shuffle[data-fragment="5"] #prefix-sum-1-mul-3 .new-bits { animation-duration:   2.6333333333333337s; }
section#prefix-shuffle[data-fragment="5"] #prefix-sum-1-mul-4 .old-bits, section#prefix-shuffle[data-fragment="5"] #prefix-sum-1-mul-4 .new-bits { animation-duration:   2.7666666666666666s; }
section#prefix-shuffle[data-fragment="5"] #prefix-sum-1-mul-5 .old-bits, section#prefix-shuffle[data-fragment="5"] #prefix-sum-1-mul-5 .new-bits { animation-duration:   2.9000000000000004s; }
section#prefix-shuffle[data-fragment="5"] #prefix-sum-1-mul-6 .old-bits, section#prefix-shuffle[data-fragment="5"] #prefix-sum-1-mul-6 .new-bits { animation-duration:   3.033333333333333s; }
section#prefix-shuffle[data-fragment="5"] #prefix-sum-1-mul-7 .old-bits, section#prefix-shuffle[data-fragment="5"] #prefix-sum-1-mul-7 .new-bits { animation-duration:   3.166666666666666s; }
section#prefix-shuffle[data-fragment="5"] #prefix-sum-1-mul-8 .old-bits, section#prefix-shuffle[data-fragment="5"] #prefix-sum-1-mul-8 .new-bits { animation-duration:   3.3000000000000003s; }
section#prefix-shuffle[data-fragment="5"] #prefix-sum-1-mul-9 .old-bits, section#prefix-shuffle[data-fragment="5"] #prefix-sum-1-mul-9 .new-bits { animation-duration:   3.433333333333333s; }
section#prefix-shuffle[data-fragment="5"] #prefix-sum-1-mul-10 .old-bits, section#prefix-shuffle[data-fragment="5"] #prefix-sum-1-mul-10 .new-bits { animation-duration: 3.5666666666666673s; }
section#prefix-shuffle[data-fragment="5"] #prefix-sum-1-mul-11 .old-bits, section#prefix-shuffle[data-fragment="5"] #prefix-sum-1-mul-11 .new-bits { animation-duration: 3.7s; }
section#prefix-shuffle[data-fragment="5"] #prefix-sum-1-mul-12 .old-bits, section#prefix-shuffle[data-fragment="5"] #prefix-sum-1-mul-12 .new-bits { animation-duration: 3.833333333333333s; }
section#prefix-shuffle[data-fragment="5"] #prefix-sum-1-mul-13 .old-bits, section#prefix-shuffle[data-fragment="5"] #prefix-sum-1-mul-13 .new-bits { animation-duration: 3.966666666666667s; }
section#prefix-shuffle[data-fragment="5"] #prefix-sum-1-mul-14 .old-bits, section#prefix-shuffle[data-fragment="5"] #prefix-sum-1-mul-14 .new-bits { animation-duration: 4.1s; }
section#prefix-shuffle[data-fragment="5"] #prefix-sum-1-mul-15 .old-bits, section#prefix-shuffle[data-fragment="5"] #prefix-sum-1-mul-15 .new-bits { animation-duration: 4.233333333333333s; }

section#prefix-shuffle {
    scale: 2
}

section#prefix-shuffle[data-fragment="5"] {
    animation: zoomy 2s cubic-bezier(0.69, 0.02, 0.53, 1) 7s 1 forwards normal;
}

@keyframes zoomy {
    0% { scale: 2 }
    100% { scale: 1.4 }
}

section#prefix-shuffle[fragment-6] {
    scale: 1.4;
}

section.present iframe {
    animation: unzoomy 1.5s cubic-bezier(0.69, 0.02, 0.53, 1) 0s 1 forwards normal;
}

@keyframes unzoomy {
    0% { scale: 0.75 }
    100% { scale: 1 }
}

section#prefix-shuffle[data-fragment="5"] #prefix-sum-1-prelim {
    opacity: 0;
    animation: prefix-sum-1-prelim-alive 0.5s cubic-bezier(0.69, 0.02, 0.53, 1) 5.5s 1 forwards normal,
               prefix-sum-1-prelim 2s cubic-bezier(0.69, 0.02, 0.53, 1) 7s 1 forwards normal;
}

@keyframes prefix-sum-1-prelim-alive {
    0%   { transform: translate(0, 2.5em); opacity: 0 }
    100% { transform: translate(0, 3.5em); opacity: 1 }
}

@keyframes prefix-sum-1-prelim {
    0%   { transform: translate(   0, 3.5em) }
    100% { transform: translate(-2em, 4em) }
}

section#prefix-shuffle #prefix-sum-1-prelim {
    transform: translate(-2em, 4em);
}

section#prefix-shuffle[data-fragment="7"][present-went-forward] #prefix-sum-1-prelim {
    animation: dead 2s ease-out 0s 1 forwards normal;
}

section#prefix-shuffle[fragment-7] #prefix-sum-1-prelim {
    opacity: 0;
}

section#prefix-shuffle[fragment-5] #splatted_lsbs-shl4 .invis {
    animation: alive 1s cubic-bezier(0.69, 0.02, 0.53, 1) 4s 1 forwards normal;
}

section#prefix-shuffle[data-fragment="5"] #splatted_lsbs-shl4 {
    animation: splatted_lsbs-shl4 5s cubic-bezier(0.69, 0.02, 0.53, 1) 0s 1 forwards normal;
}

section#prefix-shuffle[fragment-6] #splatted_lsbs-shl4 {
    transform: translate(0, 3em);
}

/* @keyframes splatted_lsbs-shl4_2 {
    0%   { transform: translate(0, 2em); }
    100% { transform: translate(0, 1em); }
} */

@keyframes splatted_lsbs-shl4 {
    0% { opacity: 0; transform: translate(2.4em, 1em); }
    20% { opacity: 1 }
    50% { transform: translate(2.4em, 2em) }
    100% { opacity: 1; transform: translate(0, 2em); }
}

section#prefix-shuffle[data-fragment="4"] #splatted-msbs-prelim {
    animation: bits8-plus9 5s cubic-bezier(0.69, 0.02, 0.53, 1) 0s 1 forwards normal,
                    dead 6s cubic-bezier(0.69, 0.02, 0.53, 1) 0s 1 forwards normal;
}

@keyframes bits8-plus9 {
    0% { transform: translate(0, 6.5em); }
    50% { transform: translate(0, 1em) }
    100% { transform: translate(4.22em, 1em); }
}

section#prefix-shuffle[data-fragment="4"] .splatted-msb-garbage,
section#prefix-shuffle[data-fragment="4"] .splatted-msb-garbage#broadcast-result,
section#prefix-shuffle[data-fragment="4"] .splatted-msb-garbage#ampersand-op,
section#prefix-shuffle[data-fragment="4"] .splatted-msb-garbage#bit-positions {
    animation: dead 1s ease-out 0s 1 forwards normal;
}

section#prefix-shuffle[fragment-5] .splatted-msb-garbage,
section#prefix-shuffle[fragment-5] .splatted-msb-garbage#broadcast-result,
section#prefix-shuffle[fragment-5] .splatted-msb-garbage#ampersand-op,
section#prefix-shuffle[fragment-5] .splatted-msb-garbage#bit-positions,
section#prefix-shuffle[fragment-5] #splatted-msbs-prelim,
section#shuffle-vector[fragment-5] .bits8-multiply.visible {
    opacity: 0;
    animation: none;
    visibility: hidden;
}

section#prefix-shuffle > div > :not(.visible) {
    opacity: 0;
}

section#prefix-shuffle[data-fragment="4"] #splatted-msbs {
    opacity: 0;
    animation: bits8-plus8 5s cubic-bezier(0.69, 0.02, 0.53, 1) 0s 1 forwards normal;
}

section#prefix-shuffle[fragment-5] #splatted-msbs {
    opacity: 1; transform: translate(0em, 1em);
    animation: none;
}

section#prefix-shuffle[fragment-4] #splatted-msbs .invis {
    animation: alive 2s cubic-bezier(0.69, 0.02, 0.53, 1) 3s 1 forwards normal;
}

section#prefix-shuffle[fragment-4] #splatted-msbs .invis {
    animation: none;
    opacity: 1;
}

@keyframes bits8-plus8 {
    0% { opacity: 0; transform: translate(-4.22em, 6.5em); }
    20% { opacity: 0 }
    50% { transform: translate(-4.22em, 1em) }
    100% { opacity: 1; transform: translate(0em, 1em); }
}

section#prefix-shuffle #splatted-msbs-prelim.visible.current-fragment {
    opacity: 0;
    animation: bits8-plus5 1s cubic-bezier(0.69, 0.02, 0.53, 1) 10s 1 forwards normal;
}

@keyframes bits8-plus5 {
    0% { opacity: 0; transform: translateY(4.5em); }
    20% { opacity: 0 }
    100% { opacity: 1; transform: translateY(6.5em); }
}

section#prefix-shuffle #msbs-bit_positions.visible.current-fragment {
    opacity: 0;
    animation: bits8-plus4 1s cubic-bezier(0.69, 0.02, 0.53, 1) 5.5s 1 forwards normal;
}

@keyframes bits8-plus4 {
    0% { opacity: 0; transform: translateY(4em); }
    20% { opacity: 0 }
    100% { opacity: 1; transform: translateY(5em); }
}

section#prefix-shuffle #splatted-msbs-plus.visible.current-fragment {
    opacity: 0;
    animation: bits8-plus2_2 1s cubic-bezier(0.69, 0.02, 0.53, 1) 5.5s 1 forwards normal;
}

@keyframes bits8-plus2_2 {
    0% { opacity: 0; transform: translateX(1em); }
    20% { opacity: 0 }
    100% { opacity: 1; transform: translateX(0); }
}

section#prefix-shuffle #broadcast-isolate.visible.current-fragment {
    opacity: 0;
    animation: bits8-plus3 1s cubic-bezier(0.69, 0.02, 0.53, 1) 1s 1 forwards normal,
                bits8-plus3_2 1s cubic-bezier(0.69, 0.02, 0.53, 1) 3.5s 1 forwards normal;
}

@keyframes bits8-plus3_2 {
    0% { opacity: 1; transform: translateY(3.5em); }
    20% { opacity: 1; }
    100% { opacity: 1; transform: translateY(4em); }
}

@keyframes bits8-plus3 {
    0% { opacity: 0; transform: translateY(2.5em); }
    20% { opacity: 0 }
    100% { opacity: 1; transform: translateY(3.5em); }
}

section#prefix-shuffle #ampersand-op:not(.visible) {
    opacity: 0;
}

@keyframes bits8-plus2 {
    0% { opacity: 0; transform: translateX(1em); }
    20% { opacity: 0 }
    100% { opacity: 1; transform: translateX(0); }
}

section#prefix-shuffle #ampersand-op.visible.current-fragment {
    animation: bits8-plus2 1s cubic-bezier(0.69, 0.02, 0.53, 1) 0s 1 forwards normal;
}

section#prefix-shuffle[fragment-3] #x-bits {
    animation: x-bits-up 1s cubic-bezier(0.69, 0.02, 0.53, 1) 0s 1 forwards normal;
}

@keyframes x-bits-up {
    0%   { transform: translateY(0) }
    100% { transform: translateY(-2em) }
}

section#prefix-shuffle[fragment-1] #broadcast-result {
    animation: broadcast-result-up 3s cubic-bezier(0.69, 0.02, 0.53, 1) 0s 1 forwards normal;
}

@keyframes broadcast-result-up {
    0%   { transform: translateY(11em); }
    100% { transform: translateY(1em); }
}

section#prefix-shuffle[fragment-1] .broadcasted-garbage,
section#prefix-shuffle[fragment-1] .broadcasted-bits,
section#prefix-shuffle[fragment-1] #broadcast-plus {
    animation: dead 1s ease-out 0s 1 forwards normal;
}

section#prefix-shuffle #broadcast-result.visible.current-fragment {
    opacity: 0;
    animation: broadcast-result 1s cubic-bezier(0.69, 0.02, 0.53, 1) 9s 1 forwards normal;
}

@keyframes broadcast-result {
    0%   { transform: translateY(10em); opacity: 0; }
    100% { transform: translateY(11em); opacity: 1; }
}

section#prefix-shuffle #broadcast-plus.visible.current-fragment,
section#prefix-shuffle .broadcasted-bits.visible.current-fragment {
    opacity: 0;
    animation: 8s cubic-bezier(0.69, 0.02, 0.53, 1) 1s 1 forwards normal;
}

section#prefix-shuffle .broadcasted-bits:not(.visible),
section#prefix-shuffle #broadcast-plus:not(.visible) {
    opacity: 0;
}
section#prefix-shuffle #broadcast-plus.visible.current-fragment { animation-name: bits8-plus; animation-delay: 1.25s; }

section#prefix-shuffle .broadcasted-bits.visible.current-fragment .invis {
    opacity: 0;
    animation: alive 2s cubic-bezier(0.69, 0.02, 0.53, 1) 7s 1 forwards normal;
}

section#prefix-shuffle .broadcasted-bits.visible .invis {
    opacity: 1;
}

section#prefix-shuffle #broadcast-1.visible.current-fragment { animation-name: broadcast-1 }
@keyframes broadcast-1 {
    0%   { transform: translate(0, 0); opacity: 0; }
    15%, 100%   { opacity: 1 }
    35% {  transform: translate(0px, 2.5em) }
    100% { transform: translate(0, 2.5em) }
}
section#prefix-shuffle #broadcast-2.visible.current-fragment { animation-name: broadcast-2 }
@keyframes broadcast-2 {
    0%   { transform: translate(108.07142857142857px, 0); opacity: 0; }
    15%, 100%   { opacity: 1 }
    35% { transform: translate(108.07142857142857px, 3.5em); }
    100% { transform: translate(0, 3.5em); }
}
section#prefix-shuffle #broadcast-3.visible.current-fragment { animation-name: broadcast-3 }
@keyframes broadcast-3 {
    0%   { transform: translate(216.14285714285714px, 0); opacity: 0; }
    15%, 100%   { opacity: 1 }
    35% { transform: translate(216.14285714285714px, 4.5em) }
    100% { transform: translate(0, 4.5em) }
}
section#prefix-shuffle #broadcast-4.visible.current-fragment { animation-name: broadcast-4 }
@keyframes broadcast-4 {
    0%   { transform: translate(324.2142857142857px, 0); opacity: 0; }
     20%, 100%   { opacity: 1 }
    35% { transform: translate(324.2142857142857px, 5.5em) }
    100% { transform: translate(0, 5.5em) }
}
section#prefix-shuffle #broadcast-5.visible.current-fragment { animation-name: broadcast-5 }
@keyframes broadcast-5 {
    0%   { transform: translate(432.2857142857143px, 0); opacity: 0; }
     25%, 100%   { opacity: 1 }
    35% { transform: translate(432.2857142857143px, 6.5em) }
    100% { transform: translate(0, 6.5em) }
}
section#prefix-shuffle #broadcast-6.visible.current-fragment { animation-name: broadcast-6 }
@keyframes broadcast-6 {
    0%   { transform: translate(540.3571428571429px, 0); opacity: 0; }
     30%, 100%   { opacity: 1 }
    35% { transform: translate(540.3571428571429px, 7.5em) }
    100% { transform: translate(0, 7.5em) }
}
section#prefix-shuffle #broadcast-7.visible.current-fragment { animation-name: broadcast-7 }
@keyframes broadcast-7 {
    0%   { transform: translate(648.4285714285714px, 0); opacity: 0; }
     35%, 100%   { opacity: 1 }
    35% { transform: translate(648.4285714285714px, 8.5em) }
    100% { transform: translate(0, 8.5em) }
}
section#prefix-shuffle #broadcast-8.visible.current-fragment { animation-name: broadcast-8 }
@keyframes broadcast-8 {
    0%   { transform: translate(756.5px, 0); opacity: 0; }
     40%, 100%   { opacity: 1 }
    35% { transform: translate(756.5px, 9.5em) }
    100% { transform: translate(0, 9.5em) }
}


</style>

<script>
{
const bits = [...document.getElementById("x-bits").getElementsByClassName("toggle-bit")];
const bitsInnerText = bits.map(e => e.innerText);

{
    let i = 7;
    const bitsies = bitsInnerText.map(b => `<span class="bit-${b}">${b}</span>`).join("");
    const source = new Array(8).fill('').map(_ => '<span class="bit-0 invis">........</span>');

    for (const bitstring of document.querySelectorAll("section#prefix-shuffle .broadcasted-bits")) {
        bitstring.innerHTML = source.map((c, j) => i === j
                ? bitsies
                : c)
        .join("&nbsp;");

        i -= 1;
    }
    document.querySelector("section#prefix-shuffle #broadcast-result").innerHTML = new Array(8).fill('').map(c => bitsies).join("&nbsp;");
    document.querySelector("section#prefix-shuffle #broadcast-isolate").innerHTML = new Array(8).fill('').map((c, i) => bitsInnerText.map((b, j) => i === j ? `<span class="bit-${b}">${b}</span>` : `<span
    class="bit-0">.</span>`).join("")).join("&nbsp;");

    document.querySelector("section#prefix-shuffle #splatted-msbs-prelim").innerHTML = bitsInnerText.map((b, i) => `<span class="bit-${b}">${b}</span>${+b ? '' : `<span class="bit-1">${'1'.repeat(i)}</span>`}<span class="bit-0">${'.'.repeat(+b ? 7 : 7 - i)}</span>`).join("&nbsp;");

    document.querySelector("section#prefix-shuffle #splatted-msbs").innerHTML = bitsInnerText.map((b, i) => `<span class="bit-0 invis">.......</span><span class="bit-${b}">${b}</span>`).join("&nbsp;");

    document.querySelector("section#prefix-shuffle #splatted-msbs-255").innerHTML = `<span class="bit-0">${new Array(7).fill('.'.repeat(8)).join("&nbsp;")} </span><span class="bit-1">11111111</span>`;

    document.querySelector("section#prefix-shuffle #splatted_lsbs-shl4").innerHTML = bitsInnerText.map((b, i) => `<span class="bit-0 invis">...</span><span class="bit-${b}">${b}</span><span class="bit-0 invis">....</span>`).join("&nbsp;");

    document.querySelector("section#prefix-shuffle #prefix-sum-1-prelim").innerHTML = bitsInnerText.map((b, i) => `<span class="bit-0">...</span><span class="bit-${b}">${b}</span><span class="prefix-sum-1-prelim-space"> </span><span class="bit-0">...</span><span class="bit-${b}">${b}</span>`).join("&nbsp;");

    {
        const arr = new Array(64).fill(0).map((n, i) => (i + 1) % 4 ? '.' : bitsInnerText[Math.floor(i / 8)]);
        let j = 0;
        for (const prefix_sum_mul of document.querySelectorAll("section#prefix-shuffle .prefix-sum-1-mul")) {
            for (let i = 0; i < 4; i++) { arr.push('.'); }

            const str = arr.join("").replace(/[.01]{4}(?!$)/g, x => x + " ")


            prefix_sum_mul.innerHTML =
                `<span class="old-bits">${bitify(str.slice(0, 5 * ++j))}</span>${bitify(str.slice(5 * j, j*-5))}<span class="new-bits">${bitify(str.slice(j*-5))}</span>`;
        }
    }

    {
        const arr = new Array(64).fill(0).map((n, i) => (i + 1) % 4 ? '.' : +!+bitsInnerText[Math.floor(i / 8)]);
        // console.log(arr);
        let j = 0;
        for (const prefix_sum_mul of document.querySelectorAll("section#prefix-shuffle .prefix-sum-2-mul")) {
            for (let i = 0; i < 4; i++) { arr.push('.'); }

            const str = arr.join("").replace(/[.01]{4}(?!$)/g, x => x + " ")


            prefix_sum_mul.innerHTML =
                `<span class="old-bits">${bitify(str.slice(0, 5 * ++j))}</span>${bitify(str.slice(5 * j, j*-5))}<span class="new-bits">${bitify(str.slice(j*-5))}</span>`;
        }
    }


    document.querySelector("section#prefix-shuffle #prefix-sum-1-multiplier").innerHTML = bitify("1111111111111110"
        .replaceAll('0', '0000')
        .replaceAll('1', '0001')
        .replace(/[01]{4}(?!$)/g, c => c + " "))


    const interleaved_bits = bitsInnerText.map(e => [+e, +e]).flat(1);
    const nums = interleaved_bits.map((v, i, a) => a.slice(i + 1).reduce((a, c) => a + c, 0));
    const nums2 = interleaved_bits.map(b => +!b).map((v, i, a) => a.slice(i + 1).reduce((a, c) => a + c, 0));

    const turned_on_off = [...bitsInnerText.join("").replaceAll('0', '00').replaceAll('1', '11')];


    document.querySelector("section#prefix-shuffle #prefix-sum-1-ans").innerHTML = nums.map((c, m) => (turned_on_off[m] === "0" ? '<span class="fade-out-unselected">' : '') + bitify(c.toString(2).padStart(4, '0')) + (turned_on_off[m] === "0" ? '</span>' : '')).join(" ");

    document.querySelector("section#prefix-shuffle #prefix-sum-1-translation").innerHTML = nums.map((c, i) => interleaved_bits[i] ? c.toString(16).padStart(4, '-') : "----").join("").replace(/[-0-9a-fA-F]{4}(?!$)/g, c => c + " ").replace(/[0-9a-fA-F]/g, c => `<span class="num-emphasized">${c}</span>`);


    document.querySelector("section#prefix-shuffle #splatted-lsbs-inverse").innerHTML      = bitsInnerText.map((b, i) => `<span class="bit-0">.......</span><span class="bit-${+!+b}">${+!+b}</span>`).join("&nbsp;");
    document.querySelector("section#prefix-shuffle #splatted-lsbs-inverse-shl4").innerHTML = bitsInnerText.map((b, i) => `<span class="bit-0 invis">...</span><span class="bit-${+!+b}">${+!+b}</span><span class="bit-0 invis">....</span>`).join("&nbsp;");
    document.querySelector("section#prefix-shuffle #splatted_lsbs_inv").innerHTML = bitsInnerText.map((b, i) => `<span class="bit-0">...</span><span class="bit-${+!+b}">${+!+b}</span><span class="splatted_lsbs_inv_space"> </span><span class="bit-0">...</span><span class="bit-${+!+b}">${+!+b}</span>`).join("&nbsp;");


    document.querySelector("section#prefix-shuffle #prefix-sum-2-multiplier").innerHTML = bitify("1111111111111110"
        .replaceAll('0', '0000')
        .replaceAll('1', '0001')
        .replace(/[01]{4}(?!$)/g, c => c + " "))

    document.querySelector("section#prefix-shuffle #prefix-sum-2-ans").innerHTML = nums2.map((c, m) => (turned_on_off[m] === "1" ? '<span class="fade-out-unselected">' : '') + bitify(c.toString(2).padStart(4, '0')) + (turned_on_off[m] === "1" ? '</span>' : '')).join(" ");
    document.querySelector("section#prefix-shuffle #prefix-sum-2-translation").innerHTML = nums2.map((c, i) => !interleaved_bits[i] ? c.toString(16).padStart(4, '-') : "----").join("").replace(/[-0-9a-fA-F]{4}(?!$)/g, c => c + " ").replace(/[0-9a-fA-F]/g, c => `<span class="num-emphasized">${c}</span>`);

    document.querySelectorAll("section#prefix-shuffle .splatted-msbs-255-intermediate-value").forEach((item, i) => {
        item.innerHTML = bitsInnerText.map(b => `<span class="bit-0 old-bits">${'.'.repeat(7)}</span><span class="bit-0 new-bits">${'.'.repeat(7 - i)}</span><span class="bit-${b}">${b}</span><span class="bit-0 new-bits">${'.'.repeat(i)}</span>`).join("&nbsp;");
    });

    document.querySelector("section#prefix-shuffle #selector-value").innerHTML = bitsInnerText.map(b => `<span class="bit-${b}">${b.repeat(4)}</span><span class="invis"> </span><span class="bit-${b}">${b.repeat(4)}</span>`).join('&nbsp;');
    // document.querySelector("section#prefix-shuffle #splatted-msbs").innerHTML = bitsInnerText.map((b, i) => `<span class="bit-0 invis">.......</span><span class="bit-${b}">${b}</span>`).join("&nbsp;");

    // document.querySelector("section#prefix-shuffle").appendChild();
}
}

// var styles = `
//     .qwebirc-qui .ircwindow div {
//         font-family: Georgia,Cambria,"Times New Roman",Times,serif;
//         margin: 26px auto 0 auto;
//         max-width: 650px;
//     }
//     .qwebirc-qui .lines {
//         font-size: 18px;
//         line-height: 1.58;
//         letter-spacing: -.004em;
//     }

//     .qwebirc-qui .nicklist a {
//         margin: 6px;
//     }
// `

// var styleSheet = document.createElement("style")
// styleSheet.innerText = styles
// document.head.appendChild(styleSheet)
</script>

</div></section>

<section id="nibbles-to-bytes-asm-bad">
    <iframe width="1920px" height="1080px" src="https://zig.godbolt.org/e#g:!((g:!((g:!((h:codeEditor,i:(filename:'1',fontScale:18,fontUsePx:'0',j:3,lang:zig,selection:(endColumn:1,endLineNumber:6,positionColumn:1,positionLineNumber:6,selectionStartColumn:1,selectionStartLineNumber:6,startColumn:1,startLineNumber:6),source:'const+std+%3D+@import(%22std%22)%3B%0A%0Aexport+fn+_1(x:+u64)+@Vector(16,+u8)+%7B%0A++++return+@as(@Vector(16,+u4),+@bitCast(x))%3B%0A%7D%0A'),l:'5',n:'0',o:'Zig+source+%233',t:'0')),header:(),k:58.25314581791266,l:'4',m:100,n:'0',o:'',s:0,t:'0'),(g:!((g:!((h:compiler,i:(compiler:ztrunk,filters:(b:'0',binary:'1',binaryObject:'1',commentOnly:'0',debugCalls:'1',demangle:'0',directives:'0',execute:'1',intel:'0',libraryCode:'0',trim:'1'),flagsViewOpen:'1',fontScale:16,fontUsePx:'0',j:1,lang:zig,libs:!(),options:'-O+ReleaseFast+-target+x86_64-linux+-mcpu%3Dznver3',overrides:!(),selection:(endColumn:1,endLineNumber:1,positionColumn:1,positionLineNumber:1,selectionStartColumn:1,selectionStartLineNumber:1,startColumn:1,startLineNumber:1),source:3),l:'5',n:'0',o:'+zig+trunk+(Editor+%233)',t:'0')),header:(),k:49.31693020019293,l:'4',m:49.684542586750794,n:'0',o:'',s:0,t:'0'),(g:!((h:compiler,i:(compiler:ztrunk,filters:(b:'0',binary:'1',binaryObject:'1',commentOnly:'0',debugCalls:'1',demangle:'0',directives:'0',execute:'1',intel:'0',libraryCode:'0',trim:'1'),flagsViewOpen:'1',fontScale:16,fontUsePx:'0',j:2,lang:zig,libs:!(),options:'-O+ReleaseFast+-target+aarch64-linux+-mcpu%3Dapple_latest',overrides:!(),selection:(endColumn:1,endLineNumber:1,positionColumn:1,positionLineNumber:1,selectionStartColumn:1,selectionStartLineNumber:1,startColumn:1,startLineNumber:1),source:3),l:'5',n:'0',o:'+zig+trunk+(Editor+%233)',t:'0')),header:(),l:'4',m:50.315457413249206,n:'0',o:'',s:0,t:'0')),k:41.746854182087354,l:'3',n:'0',o:'',t:'0')),l:'2',m:100,n:'0',o:'',t:'0')),version:4"></iframe>
</section>

<section id="nibbles-to-bytes-asm-good">
    <iframe width="1920px" height="1080px" src="https://zig.godbolt.org/e#g:!((g:!((g:!((h:codeEditor,i:(filename:'1',fontScale:18,fontUsePx:'0',j:3,lang:zig,selection:(endColumn:2,endLineNumber:11,positionColumn:2,positionLineNumber:11,selectionStartColumn:2,selectionStartLineNumber:11,startColumn:2,startLineNumber:11),source:'const+std+%3D+@import(%22std%22)%3B%0A%0Aexport+fn+_2(x:+u64)+@Vector(16,+u8)+%7B%0A++++const+vec:+@Vector(8,+u8)+%3D+@bitCast(x)%3B%0A++++return+std.simd.interlace(.%7B+vec,+vec+%3E%3E+@splat(4)+%7D)+%26+@as(@Vector(16,+u8),+@splat(0xF))%3B%0A%7D%0A%0Aexport+fn+_3(x:+u64)+@Vector(16,+u8)+%7B%0A++++const+vec:+@Vector(8,+u8)+%3D+@bitCast(x)%3B%0A++++return+std.simd.interlace(.%7B+vec+%26+@as(@Vector(8,+u8),+@splat(0xF)),+vec+%3E%3E+@splat(4)+%7D)%3B%0A%7D'),l:'5',n:'0',o:'Zig+source+%233',t:'0')),header:(),k:58.25314581791266,l:'4',m:100,n:'0',o:'',s:0,t:'0'),(g:!((g:!((h:compiler,i:(compiler:ztrunk,filters:(b:'0',binary:'1',binaryObject:'1',commentOnly:'0',debugCalls:'1',demangle:'0',directives:'0',execute:'1',intel:'0',libraryCode:'0',trim:'1'),flagsViewOpen:'1',fontScale:16,fontUsePx:'0',j:1,lang:zig,libs:!(),options:'-O+ReleaseFast+-target+x86_64-linux+-mcpu%3Dznver3',overrides:!(),selection:(endColumn:1,endLineNumber:1,positionColumn:1,positionLineNumber:1,selectionStartColumn:1,selectionStartLineNumber:1,startColumn:1,startLineNumber:1),source:3),l:'5',n:'0',o:'+zig+trunk+(Editor+%233)',t:'0')),header:(),k:49.31693020019293,l:'4',m:49.684542586750794,n:'0',o:'',s:0,t:'0'),(g:!((h:compiler,i:(compiler:ztrunk,filters:(b:'0',binary:'1',binaryObject:'1',commentOnly:'0',debugCalls:'1',demangle:'0',directives:'0',execute:'1',intel:'0',libraryCode:'0',trim:'1'),flagsViewOpen:'1',fontScale:16,fontUsePx:'0',j:2,lang:zig,libs:!(),options:'-O+ReleaseFast+-target+aarch64-linux+-mcpu%3Dapple_latest',overrides:!(),selection:(endColumn:1,endLineNumber:1,positionColumn:1,positionLineNumber:1,selectionStartColumn:1,selectionStartLineNumber:1,startColumn:1,startLineNumber:1),source:3),l:'5',n:'0',o:'+zig+trunk+(Editor+%233)',t:'0')),header:(),l:'4',m:50.315457413249206,n:'0',o:'',s:0,t:'0')),k:41.746854182087354,l:'3',n:'0',o:'',t:'0')),l:'2',m:100,n:'0',o:'',t:'0')),version:4"></iframe>
</section>
                <!-- <style>
                    .bg {
                        background: repeating-linear-gradient(
                            to top,
                            rgba(255, 255, 255, 0.03) 0px 2px,
                            transparent 2px 4px
                        ),
                        linear-gradient(to bottom, #200933 75%, #3d0b43);
                    }
                    .bg::after{
                        content:'';
                        height:50%;
                        width:100%;
                        display:block;
                        background-image:linear-gradient(90deg, rgba(252,25,154,.9) 1px, rgba(0,0,0,0) 1px), linear-gradient(0deg, rgba(252,25,154,.9) 1px, rgba(0,0,0,0) 1px);
                        background-position:bottom;
                        background-repeat:repeat;
                        background-size:20px 20px;
                        left: -25px;
                        position: absolute;
                        pointer-events: none;
                        bottom: 0;
                        transform: perspective(100px) rotateX(60deg);
                        z-index: 0;
                    }

                    body {
                        padding: 20px;
                    }

                    .container {
                    font-family: arial;
                    position: relative;
                    width: 768px;
                    border-radius: 6px;
                    border: 1px solid #91d9fb;
                    }

                    .container::before {
                    content: "";
                    border: 15px solid #91d9fb;
                    position: absolute;
                    border-color: transparent transparent #91d9fb transparent;
                    top: -26px;
                    left: 10px;
                    }

                    .header {
                    padding: 10px 15px;
                    background: rgb(246, 248, 250);
                    display: flex;
                    justify-content: space-between;
                    border-bottom: 1px solid #91d9fb;
                    position: relative;
                    }
                    .header .user {
                    font-weight: bold;
                    }

                    .header::before {
                    content: "";
                    border: 10px solid rgb(246, 248, 250);
                    position: absolute;
                    border-color: transparent transparent rgb(246, 248, 250) transparent;
                    top: -20px;
                    }

                    .body {
                    padding: 15px;
                    }
                </style> -->

                <!-- Vector support -->
                <!-- <div> -->

                    <!-- <script src="https://github.com/WebAssembly/simd/issues/24#issue-271257625.js"></script> -->
                <!-- </div> -->

                <!-- <embed src="https://github.com/WebAssembly/simd/issues/24#issue-271257625" style="width:500px; height: 300px;"> -->

                <!-- <iframe src="https://github.com/WebAssembly/simd/issues/24#issue-271257625" width="100%" height="300"> <p>Your browser does not support iframes.</p> </iframe> -->
                    <!-- <h1 id="title" style="font-size: 36pt;">The Tokenizer</h1> -->

                        <!-- ----------------------
                        |Speculative|On-demand|
                        |:-:|:-:|
                        |identifiers/keywords/numbers|strings|
                        |control characters|char literals|
                        |spaces||
                        ---------------------- -->

                        <!-- left: 480px; top: 273px; height: auto; -->


                        <!-- linear-gradient(rgb(114 0 0), rgb(0 11 98)) -->
                <section class="text-only" data-background-gradient="linear-gradient(#292A35, #040945)" id="expand-word-support2">
                    <div style="width: 70%; margin-left: 15%;">
                        <h2>More VPEXPANDW emulation?</h2>
                        <ul>
                            <li class="fragment">x86-64:</li>
                            <ul>
                                <li class="fragment">AVX-512F (first mainstream support was Intel Cannon Lake 2018+) => <a target="_blank" rel="noopener noreferrer" href="https://en.wikipedia.org/wiki/AVX-512#Compress_and_expand">VPEXPAND{D, Q}</a></li>
                                <ul>
                                    <li class="fragment fade-in-then-out">Intel machines before Ice Lake (2019) lack AVX512_VBMI2, which introduced <a target="_blank" rel="noopener noreferrer" href="https://en.wikipedia.org/wiki/AVX-512#Compress_and_expand">VPEXPAND{B, W}</a></li>
                                    <li class="fragment"><span style="background-color: rgba(0, 0, 0, 0.5); border: 2pt solid rgba(0, 0, 0, 0.5);"><span class="hljs-built_in">@Vector</span>(<span class="hljs-number">N</span>,&nbsp;<span class="hljs-type">u16</span>)&nbsp;=>&nbsp;<span class="hljs-built_in">@Vector</span>(<span class="hljs-number">N</span>,&nbsp;<span class="hljs-type">u32</span>)</span>, do our operation, then <span style="background-color: rgba(0, 0, 0, 0.5); border: 2pt solid rgba(0, 0, 0, 0.5);"><span class="hljs-built_in">@Vector</span>(<span class="hljs-number">N</span>,&nbsp;<span class="hljs-type">u32</span>)&nbsp;=>&nbsp;<span class="hljs-built_in">@Vector</span>(<span class="hljs-number">N</span>,&nbsp;<span class="hljs-type">u16</span>)</span></li>
                                </ul>
                            </ul>

                            <li class="fragment">BESM Soviet mainframes:</li>
                            <ul>
                                <li class="fragment">BESM-6 (Designed in 1965. Produced 1968-1987) => <a target="_blank" rel="noopener noreferrer" href="https://www.mailcom.com/besm6/instset.shtml#unpack">AUX</a> & <a target="_blank" rel="noopener noreferrer" href="https://www.mailcom.com/besm6/instset.shtml#pack">APX</a></li>
                            </ul>

                            <li class="fragment">x86-64:</li>
                            <ul>
                                <li class="fragment">BMI2 (Intel Haswell 2013+, AMD Excavator 2015+, Fast on AMD since Zen 3 2020+) => <a target="_blank" rel="noopener noreferrer" href="https://en.wikipedia.org/wiki/X86_Bit_manipulation_instruction_set#Parallel_bit_deposit_and_extract">PDEP</a> & <a target="_blank" rel="noopener noreferrer" href="https://en.wikipedia.org/wiki/X86_Bit_manipulation_instruction_set#Parallel_bit_deposit_and_extract">PEXT</a></li>
                            </ul>

                            <li class="fragment">arm64 / aarch64:</li>
                            <ul>
                                <li class="fragment">SVE2 (optional, not required) => <a target="_blank" rel="noopener noreferrer" href="https://developer.arm.com/documentation/ddi0602/latest/SVE-Instructions/BDEP--Scatter-lower-bits-into-positions-selected-by-bitmask-">BDEP</a> & <a target="_blank" rel="noopener noreferrer" href="https://developer.arm.com/documentation/ddi0602/latest/SVE-Instructions/BEXT--Gather-lower-bits-from-positions-selected-by-bitmask-">BEXT</a> & <a target="_blank" rel="noopener noreferrer" href="https://developer.arm.com/documentation/ddi0602/latest/SVE-Instructions/BGRP--Group-bits-to-right-or-left-as-selected-by-bitmask-">BGRP</a></li>
                                <ul>
                                    <li class="fragment">
                                        <a target="_blank" rel="noopener noreferrer" href="https://developer.arm.com/documentation/ddi0602/latest/SVE-Instructions/BGRP--Group-bits-to-right-or-left-as-selected-by-bitmask-">BGRP</a> = <a target="_blank" rel="noopener noreferrer" href="https://developer.arm.com/documentation/ddi0602/latest/SVE-Instructions/BEXT--Gather-lower-bits-from-positions-selected-by-bitmask-">BEXT</a>(a, b) | (<a target="_blank" rel="noopener noreferrer" href="https://developer.arm.com/documentation/ddi0602/latest/SVE-Instructions/BEXT--Gather-lower-bits-from-positions-selected-by-bitmask-">BEXT</a>(a, ~b) &lt;&lt; @popCount(b))
                                    </li>
                                </ul>
                            </ul>

                            <li class="fragment">PowerPC:</li>
                            <ul>
                                <li class="fragment">Power10 => <a target="_blank" rel="noopener noreferrer" href="https://www.ibm.com/docs/en/openxl-c-and-cpp-lop/17.1.1?topic=functions-vec-pdep">PDEP</a> & <a target="_blank" rel="noopener noreferrer" href="https://www.ibm.com/docs/en/openxl-c-and-cpp-lop/17.1.1?topic=functions-vec-pext">PEXT</a></li>
                            </ul>

                            <li class="fragment">RISC-V:</li>
                            <ul>
                                <li class="fragment">Zbe => BDEP & BEXT, but did not make it into ratified B instruction set</li>
                            </ul>
                        </ul>
                    </div>
                </section>

                <section id="shuffle-vector" style="zoom: 2" data-background-gradient="linear-gradient(#292A35, #040945)">

<div style="height: 1200px; width: 1200px; position: absolute;">
<pre style="width: 900px; height: 120px; top: 0px; left: 30px;"><code id="pdep-algo" data-line-numbers="|2|2|3|3|3|4|4|5|5|5|1,6" data-fragment-index="1" class="hljs language-zig">fn produceShuffleVectorForByte(x: u8) @Vector(16, u8) {
    const splatted = pdep(x, 0x0101010101010101);
    const vec = splatted * 255;
    const nibble_indices: u64 = @bitCast(std.simd.iota(u4, 16));
    const interleaved_shuffle_vector = pdep(nibble_indices, vec) | pdep(nibble_indices, ~vec);
    return @as(@Vector(16, u4), @bitCast(interleaved_shuffle_vector));
}</code></pre>
<div id="bits-pdep-animated">

<pre id="bits8-stay" class="fragment custom" data-fragment-index="1"><span style="opacity: 0;">00000000000000000000000000000000000000000000000000000000000</span><span class="var-name">x = </span><span class="toggle-bit bit-0">0</span><span class="toggle-bit bit-1">1</span><span class="toggle-bit bit-0">0</span><span class="toggle-bit bit-1">1</span><span class="toggle-bit bit-0">0</span><span class="toggle-bit bit-1">1</span><span class="toggle-bit bit-1">1</span><span class="toggle-bit bit-1">1</span></pre>

<pre class="fragment custom" id="bits8" data-fragment-index="2"><span class="bit-0">0</span><span class="bit-1">1</span><span class="bit-0">0</span><span class="bit-1">1</span><span class="bit-0">0</span><span class="bit-1">111</span></pre>

<pre class="fragment custom" data-fragment-index="1" id="bits8-255" style="transform: translateY(2em);"></pre>
<pre class="fragment bits8-multiply" data-fragment-index="3" id="bits255" style="transform: translateY(2em);"></pre>
<pre class="fragment math-underlined bits8-multiply" data-fragment-index="3" style="width: 873px; left: 15px; top: 200px; font-size: 30px; line-height: 0.5em;">*</pre>
<pre class="fragment custom bits8-255-2 bits8-multiply-out" data-fragment-index="4" id="bits8-255-2" style="transform: translateY(3.5em);">uh-we-encountered-a-problem</pre>
<pre class="fragment custom bits8-255-3 bits8-multiply-out" data-fragment-index="4" id="bits8-255-3" style="transform: translateY(4.5em);">uh-we-encountered-a-problem</pre>
<pre class="fragment custom bits8-255-4 bits8-multiply-out" data-fragment-index="4" id="bits8-255-4" style="transform: translateY(5.5em);">uh-we-encountered-a-problem</pre>
<pre class="fragment custom bits8-255-5 bits8-multiply-out" data-fragment-index="4" id="bits8-255-5" style="transform: translateY(6.5em);">uh-we-encountered-a-problem</pre>
<pre class="fragment custom bits8-255-6 bits8-multiply-out" data-fragment-index="4" id="bits8-255-6" style="transform: translateY(7.5em);">uh-we-encountered-a-problem</pre>
<pre class="fragment custom bits8-255-7 bits8-multiply-out" data-fragment-index="4" id="bits8-255-7" style="transform: translateY(8.5em);">uh-we-encountered-a-problem</pre>
<pre class="fragment custom bits8-255-8 bits8-multiply-out" data-fragment-index="4" id="bits8-255-8" style="transform: translateY(9.5em);">uh-we-encountered-a-problem</pre>
<pre class="fragment custom bits8-255-9 bits8-multiply-out" data-fragment-index="4" id="bits8-255-9" style="transform: translateY(10.5em);">uh-we-encountered-a-problem</pre>
<pre id="bits8-plus" class="fragment custom math-underlined bits8-multiply-out" data-fragment-index="4" style="width: 873px;left: 15px;top: 357px;font-size: 24px;text-indent: 2px;line-height: 1.2em;">+</pre>
<pre class="fragment custom" data-fragment-index="4" id="bits8-255-final">uh-we-encountered-a-problem</pre>
<pre class="fragment custom nibble-isolate" data-fragment-index="6" style="transform: translateY(3em);"><span class="rescinded-bits"><span class="bit-1">1111111</span><span class="bit-0">0 </span><span class="bit-1">11</span><span class="bit-0">0</span><span class="bit-1">111</span><span class="bit-0">00 </span><span class="bit-1">1</span><span class="bit-0">0</span><span class="bit-1">111</span><span class="bit-0">0</span><span class="bit-1">1</span><span class="bit-0">0 </span></span><span class="mo-zeros">........ </span><span class="bit-1">1</span><span class="bit-0">00</span><span class="bit-1">11</span><span class="bit-0">000</span><span class="mo-zeros"> ........</span> <span class="bit-0">0</span><span class="bit-1">111</span><span class="bit-0">0</span><span class="bit-1">11</span><span class="bit-0">0</span><span class="mo-zeros"> ........</span> <span class="bit-0">0</span><span class="bit-1">1</span><span class="bit-0">0</span><span class="bit-1">1</span><span class="bit-0">0</span><span class="bit-1">1</span><span class="bit-0">00 00</span><span class="bit-1">11</span><span class="bit-0">00</span><span class="bit-1">1</span><span class="bit-0">0 000</span><span class="bit-1">1</span><span class="bit-0">0000</span></pre>

<pre class="fragment custom fade-in-then-out hex-translation" data-fragment-index="7" style="transform: translateY(4em)">---<span class="num-emphasized">F</span>---<span class="num-emphasized">E</span> ---<span class="num-emphasized">D</span>---<span class="num-emphasized">C</span> ---<span class="num-emphasized">B</span>---<span class="num-emphasized">A</span> ---<span class="num-emphasized">9</span>---<span class="num-emphasized">8</span> ---<span class="num-emphasized">7</span>---<span class="num-emphasized">6</span> ---<span class="num-emphasized">5</span>---<span class="num-emphasized">4</span> ---<span class="num-emphasized">3</span>---<span class="num-emphasized">2</span> ---<span class="num-emphasized">1</span>---<span class="num-emphasized">0</span></pre>

<pre class="fragment custom nibble-isolate" data-fragment-index="8" style="transform: translateY(4em)"><span class="rescinded-bits"><span class="bit-1">1111111</span><span class="bit-0">0 </span><span class="bit-1">11</span><span class="bit-0">0</span><span class="bit-1">111</span><span class="bit-0">00 </span><span class="bit-1">1</span><span class="bit-0">0</span><span class="bit-1">111</span><span class="bit-0">0</span><span class="bit-1">1</span><span class="bit-0">0 </span><span class="bit-1">1</span><span class="bit-0">00</span><span class="bit-1">11</span><span class="bit-0">000 0</span><span class="bit-1">111</span><span class="bit-0">0</span><span class="bit-1">11</span><span class="bit-0">0 </span></span><span class="bit-0">0</span><span class="bit-1">1</span><span class="bit-0">0</span><span class="bit-1">1</span><span class="bit-0">0</span><span class="bit-1">1</span><span class="bit-0">00</span><span class="mo-zeros"> ........</span> <span class="bit-0">00</span><span class="bit-1">11</span><span class="bit-0">00</span><span class="bit-1">1</span><span class="bit-0">0 </span><span class="mo-zeros">........ </span><span class="bit-0">000</span><span class="bit-1">1</span><span class="bit-0">0000</span><span class="mo-zeros"> ........ ........ ........</span></pre>

<pre id="bits8-or" class="fragment custom math-underlined" data-fragment-index="9" style="width: 873px;left: 15px;top: calc(220px + 0.5em);font-size: 18px;text-indent: 3.8px;line-height: 1.2em;"><span style="vertical-align: 4px;">&verbar;</span></pre>

<pre class="fragment custom" data-fragment-index="9" id="bits8-result" style="transform: translate(0, 5.5em);"><span class="bit-0">0</span><span class="bit-1">1</span><span class="bit-0">0</span><span class="bit-1">1</span><span class="bit-0">0</span><span class="bit-1">1</span><span class="bit-0">00 </span><span class="bit-1">1</span><span class="bit-0">00</span><span class="bit-1">11</span><span class="bit-0">000 00</span><span class="bit-1">11</span><span class="bit-0">00</span><span class="bit-1">1</span><span class="bit-0">0 0</span><span class="bit-1">111</span><span class="bit-0">0</span><span class="bit-1">11</span><span class="bit-0">0 000</span><span class="bit-1">1</span><span class="bit-0">0000 0</span><span class="bit-1">1</span><span class="bit-0">0</span><span class="bit-1">1</span><span class="bit-0">0</span><span class="bit-1">1</span><span class="bit-0">00 00</span><span class="bit-1">11</span><span class="bit-0">00</span><span class="bit-1">1</span><span class="bit-0">0 000</span><span class="bit-1">1</span><span class="bit-0">0000</span></pre>

<pre class="fragment hex-translation" data-fragment-index="10" style="transform: translateY(6.5em)">---<span class="num-emphasized">5</span>---<span class="num-emphasized">4</span> ---<span class="num-emphasized">9</span>---<span class="num-emphasized">8</span> ---<span class="num-emphasized">3</span>---<span class="num-emphasized">2</span> ---<span class="num-emphasized">7</span>---<span class="num-emphasized">6</span> ---<span class="num-emphasized">1</span>---<span class="num-emphasized">0</span> ---<span class="num-emphasized">5</span>---<span class="num-emphasized">4</span> ---<span class="num-emphasized">3</span>---<span class="num-emphasized">2</span> ---<span class="num-emphasized">1</span>---<span class="num-emphasized">0</span></pre>
        <!--  -->
    <!-- </div>
</div> -->
</div>
<script>
{
const bits = [...document.getElementById("bits8-stay").getElementsByClassName("toggle-bit")];
const bitsInnerText = bits.map(e => e.innerText);

document.getElementById("bits8-255-final").innerHTML = bitsInnerText
    .map(b => `<span class="bit-${b}">${b.repeat(8)}</span>`)
    .join("&nbsp;");

document.getElementById("bits8-255").innerHTML = bitsInnerText
    .map(e => 1)
    .map(b => `<span class="bit-0">${'0'.repeat(7)}</span><span class="bit-${b}">${b}</span>`)
    .join("&nbsp;");

for (let i = 2; i <= 9; i++) {
    const o = i - 2;
    document.getElementById(`bits8-255-${i}`).innerHTML = bitsInnerText
    .map(b => `<span class="fade-in-bits bit-0">${'.'.repeat(7 - o)}</span><span class="bit-${b}">${b}</span><span class="fade-in-bits bit-0">${'.'.repeat(o)}</span>`)
    .join("&nbsp;");
}

document.getElementById("bits255").innerHTML = [...('.'.repeat(7) + "1")]
    .map(b => `<span class="bit-${b}">${b.repeat(8)}</span>`)
    .join("&nbsp;");

document.getElementById("bits8").innerHTML = bitsInnerText
    .map(b => `<span class="bit-0 widen_num">${'.'.repeat(7)}</span><span class="bit-${b}">${b}</span>`)
    .join("&nbsp;");
}
</script>
<style>
section#shuffle-vector div,
section#shuffle-vector pre,
section#prefix-shuffle div,
section#prefix-shuffle pre {
    position: absolute !important;
    display: block !important;
}

section#shuffle-vector pre,
section#prefix-shuffle pre {
    font-size: 20px;
    height: auto;
    width: auto;
    left: 35px;
    top: 150px;
}

section#prefix-shuffle pre {
    top: 240px;
    left: 16px;
}

span.invis {
    opacity: 0;
}

.hex-translation {
    color: #808080;
}
.math-underlined {
    /* border-bottom: 1px solid white; */
}
/* 0 0 20px 10px #E800FF; */
.math-underlined::after {
    content: "";
    background-color: white;
    display: block;
    position: absolute;
    /* top: 1.5em; */
    width: 100%;
    height: 1px;
    box-shadow: 0 1px 6px 1px #ffffff6f !important
        /* 0 1px 0 0 #fffffff0 */
     /* Border bottom */
    /* 0 0 0.033em #fff, 0 0 0.08em #fff, 0 0 0.1em #ff79c6, 0 0 0.2em #ff79c6, 0 0 0.3em #ff79c6, 0 0 1em #ff79c6, 0 0 1.5em #ff79c6; */
}

#bits8-or::after,
#prefix-sum-1-or::after {
    top: 26px;
}

.math-underlined.star::after {
    top: 15px;
}

#broadcast-plus::after,
#splatted-msbs-plus::after {
    top: 28px;
}

#prefix-sum-plus::after {
    top: 20px;
}

#ampersand-op::after {
    top: 20px;
}

/* 15px for star */

section#shuffle-vector .mo-zeros {
    letter-spacing: -12px;
    opacity: 0;
}

.bit-1 {
    color: greenyellow;
}

.bit-0, .num-emphasized {
    color: white;
}

section#shuffle-vector .nibble-isolate {
    opacity: 0;
}

/* > td.hljs-ln-code */
tr.highlight-line:not(section#shuffle-vector[data-fragment="10"] table.hljs-ln > tbody > tr:first-child):not(section#prefix-shuffle[data-fragment="9"] table.hljs-ln > tbody > tr:first-child):not(section#shuffle-vector[data-fragment="9"][present-went-backward] table.hljs-ln > tbody > tr:first-child):not(section[data-fragment="-1"] pre code[all-highlighted] table.hljs-ln > tbody > tr.highlight-line) {
    background-color: rgb(115, 0, 255, 0.3);
    /* color: white !important;
    text-shadow: 0 0 0.033em #fff, 0 0 0.08em #fff, 0 0 0.1em #ff79c6, 0 0 0.2em #ff79c6, 0 0 0.3em #ff79c6, 0 0 1em #ff79c6, 0 0 1.5em #ff79c6; */
}

section#shuffle-vector[data-fragment="9"][present-went-backward] table.hljs-ln > tbody > tr:first-child {
    animation: nothing3 0.25s ease-out 0s 1 forwards normal;
}

@keyframes nothing3 {
    0%   { opacity: 0.4; }
    100% { opacity: 0.4; }
}

section#shuffle-vector[data-fragment="10"] table.hljs-ln > tbody > tr:first-child {
    animation: nothing 0.25s ease-out 0s 1 forwards normal;
}

@keyframes nothing {
    0%   { opacity: 1; }
    100% { opacity: 1; }
}

section#shuffle-vector[data-fragment="10"] table.hljs-ln > tbody > tr:first-child span.return-type,
section#prefix-shuffle[data-fragment="9"] table.hljs-ln > tbody > tr:first-child span.return-type {
    /* background-color: rgba(115, 0, 255, 0.3) !important; */
    /* background-color: rgb(255, 0, 195, 0.3); */
}

section#shuffle-vector[data-fragment="10"] table.hljs-ln > tbody > tr:first-child > td.hljs-ln-code > span.hljs-function,
section#shuffle-vector[data-fragment="10"] table.hljs-ln > tbody > tr:first-child > td.hljs-ln-code > span.hljs-operator,
section#prefix-shuffle[data-fragment="14"] table.hljs-ln > tbody > tr:first-child > td.hljs-ln-code > span.hljs-function,
section#prefix-shuffle[data-fragment="14"] table.hljs-ln > tbody > tr:first-child > td.hljs-ln-code > span.hljs-operator {
    opacity: 0.4;
}

section#shuffle-vector .nibble-isolate.visible {
    animation: alive 0.5s ease-out 0s 1 forwards normal;
}

/* section#shuffle-vector .nibble-isolate.visible {
    opacity: 1;
} */

section#shuffle-vector #bits8-or:not(.visible) {
    opacity: 0;
    visibility: none;
    animation: none;
}

section#shuffle-vector #bits8-or.visible.current-fragment {
    animation: bits8-or 3.5s cubic-bezier(0.69, 0.02, 0.53, 1) 0s 1 forwards normal;
}

section#shuffle-vector #bits8-or.visible {
    opacity: 1;
}

@keyframes bits8-or {
    0% { opacity: 0; transform: translate(150px, 0); }
    70% { opacity: 0; }
    100% { opacity: 1; transform: translate(0, 0); }
}

section#shuffle-vector #bits8-result:not(.visible) {
    opacity: 0;
    visibility: none;
    animation: none;
}

section#shuffle-vector #bits8-result.visible.current-fragment {
    opacity: 0;
    animation: bits8-result 1s cubic-bezier(0.69, 0.02, 0.53, 1) 3.5s 1 forwards normal;
}

section#shuffle-vector #bits8-result.visible {
    opacity: 1; transform: translate(0, 5em);
}

@keyframes bits8-result {
    0%   { opacity: 0; transform: translate(0, 4.5em); }
    100% { opacity: 1; transform: translate(0, 5.5em); }
}

section#shuffle-vector[data-fragment="8"] .nibble-isolate.visible .rescinded-bits,
section#shuffle-vector[data-fragment="8"] .nibble-isolate.visible .mo-zeros {
    animation: 3s cubic-bezier(0.78, 0.03, 0.33, 0.99) 0s 1 forwards normal;
}

section#shuffle-vector[data-fragment="8"] .nibble-isolate.visible .rescinded-bits { animation-name: rescinded-bits; }
@keyframes rescinded-bits {
    0% {
        letter-spacing: 0;
        opacity: 1;
    }

    25% {
        opacity: 0;
    }

    100% {
        letter-spacing: -12px;
        opacity: 0;
    }

    100% {
        letter-spacing: -12px;
        opacity: 0;
    }
}
section#shuffle-vector[data-fragment="8"] .nibble-isolate.visible .mo-zeros  { animation-name: mo-zeros; }

section#shuffle-vector[fragment-9] .nibble-isolate.visible .rescinded-bits {
    letter-spacing: -12px;
    opacity: 0;
}
section#shuffle-vector[fragment-9] .nibble-isolate.visible .mo-zeros {
    letter-spacing: 0;
    opacity: 1;
}
@keyframes mo-zeros {
    0% {
        letter-spacing: -12px;
        opacity: 0;
    }

    15% {
        opacity: 0;
    }

    50% {
        opacity: 1;
    }

    100% {
        letter-spacing: 0;
        opacity: 1;
    }
}

section#shuffle-vector pre#bits8-stay:not(.visible) {
    opacity: 0;
}

section#shuffle-vector pre#bits8-stay.visible {
    animation: alive 0.5s ease-out 0s 1 forwards normal;
}

/* section#shuffle-vector[data-fragment="2"] pre#bits8-255 {
    animation: dead 0.5s ease-out 0s 1 forwards normal;
} */
/*
bits8-255-2
bits8-255-3
bits8-255-4
bits8-255-5
bits8-255-6
bits8-255-7
bits8-255-8
bits8-255-9
 */

section#shuffle-vector pre#bits8-255 {
    opacity: 0;
}

section#shuffle-vector[data-fragment="0"] pre#bits8-255,
section#shuffle-vector[data-fragment="1"] pre#bits8-255 {
    opacity: 1;
}

@keyframes alive {
    0%   { opacity: 0; }
    100% { opacity: 1; }
}

@keyframes dead {
    0%   { opacity: 1; }
    100% { opacity: 0; }
}

section#shuffle-vector[data-fragment="2"] .bits8-multiply {
    animation: alive 1s ease-out 0s 1 forwards normal;
}

section#shuffle-vector[data-fragment="3"] .bits8-multiply {
    opacity: 1;
}

section#shuffle-vector[data-fragment="4"] .bits8-multiply {
    animation: dead 1s ease-out 0s 1 forwards normal;
}



/* .bits8-multiply:not(.visible.current-fragment), */
/* .bits8-multiply-out.visible:not(.visible.current-fragment) {
    animation: dead 1s ease-out 0s 1 forwards normal;
} */

/* .bits8-255-final.visible:not(.visible.current-fragment) {} */



/* .toggle-bit {
    cursor: pointer;
} */

section#shuffle-vector #bits8.visible.current-fragment,
section#shuffle-vector #bits8.visible.current-fragment .widen_num {
    animation: 5s cubic-bezier(0.69, 0.02, 0.53, 1) 0s 1 forwards normal;
}

section#shuffle-vector #bits8.visible.current-fragment .widen_num {
    opacity: 0;
    animation-name: widen_num;
}

@keyframes widen_num {
    0% {
        opacity: 0;
    }

    25% {
        opacity: 0;
    }

    100% {
        opacity: 1;
    }
}
/* -1.8, -2 */

section#shuffle-vector #bits8:not(.visible) {
    opacity: 0;
}

section#shuffle-vector #bits8.visible.current-fragment {
    transform: translate(746.75px, 0);
    letter-spacing: -0.533em;
    animation-name: bits8;
}

section#shuffle-vector #bits8.visible {
    transform: translate(0px, 1em);
    letter-spacing: 0;
}

section#shuffle-vector[data-fragment="4"] #bits8.visible {
    animation: dead 1s ease-out 0s 1 forwards normal;
    transform: translate(0, 1em);
    letter-spacing: 0;
}

section#shuffle-vector[fragment-5] #bits8.visible {
    visibility: hidden;
    opacity: 0;
    animation: none;
    transform: translate(0, 1em);
    letter-spacing: 0;
}

section#shuffle-vector[data-fragment="0"][present-went-backward] #bits8 {
    visibility: hidden;
    opacity: 0;
    animation: dead 0s ease-out 0s 1 forwards normal;
    transform: translate(0, 1em);
    letter-spacing: 0;
}

/* .reveal section[present-went-backward] * {
    animation-duration: 0s;
} */

section#shuffle-vector[data-fragment="4"] #bits8-plus.visible,
section#shuffle-vector[data-fragment="4"] #bits8-255-2.visible,
section#shuffle-vector[data-fragment="4"] #bits8-255-3.visible,
section#shuffle-vector[data-fragment="4"] #bits8-255-4.visible,
section#shuffle-vector[data-fragment="4"] #bits8-255-5.visible,
section#shuffle-vector[data-fragment="4"] #bits8-255-6.visible,
section#shuffle-vector[data-fragment="4"] #bits8-255-7.visible,
section#shuffle-vector[data-fragment="4"] #bits8-255-8.visible,
section#shuffle-vector[data-fragment="4"] #bits8-255-9.visible {
    animation: dead 1s ease-out 0s 1 forwards normal;
}

section#shuffle-vector[fragment-5] #bits8-plus.visible,
section#shuffle-vector[fragment-5] #bits8-255-2.visible,
section#shuffle-vector[fragment-5] #bits8-255-3.visible,
section#shuffle-vector[fragment-5] #bits8-255-4.visible,
section#shuffle-vector[fragment-5] #bits8-255-5.visible,
section#shuffle-vector[fragment-5] #bits8-255-6.visible,
section#shuffle-vector[fragment-5] #bits8-255-7.visible,
section#shuffle-vector[fragment-5] #bits8-255-8.visible,
section#shuffle-vector[fragment-5] #bits8-255-9.visible
section#shuffle-vector[fragment-5] #bits8.visible {
    visibility: hidden;
}

@keyframes bits8 {
    0% {
        transform: translate(746.75px, 0);
        letter-spacing: -0.533em;
    }

    15% {
        transform: translate(746.75px, 1em);
        letter-spacing: -0.533em;
    }

    100% {
        transform: translate(0px, 1em);
        letter-spacing: 0;
    }
}

section#shuffle-vector #bits8-plus,
section#shuffle-vector #bits8-255-2,
section#shuffle-vector #bits8-255-3,
section#shuffle-vector #bits8-255-4,
section#shuffle-vector #bits8-255-5,
section#shuffle-vector #bits8-255-6,
section#shuffle-vector #bits8-255-7,
section#shuffle-vector #bits8-255-8,
section#shuffle-vector #bits8-255-9,
section#shuffle-vector #bits8-255-final {
    opacity: 0;
}

section#shuffle-vector #bits8-plus.visible.current-fragment,
section#shuffle-vector #bits8-255-2.visible.current-fragment,
section#shuffle-vector #bits8-255-3.visible.current-fragment,
section#shuffle-vector #bits8-255-4.visible.current-fragment,
section#shuffle-vector #bits8-255-5.visible.current-fragment,
section#shuffle-vector #bits8-255-6.visible.current-fragment,
section#shuffle-vector #bits8-255-7.visible.current-fragment,
section#shuffle-vector #bits8-255-8.visible.current-fragment,
section#shuffle-vector #bits8-255-9.visible.current-fragment,
section#shuffle-vector #bits8-255-2.visible.current-fragment span.fade-in-bits,
section#shuffle-vector #bits8-255-3.visible.current-fragment span.fade-in-bits,
section#shuffle-vector #bits8-255-4.visible.current-fragment span.fade-in-bits,
section#shuffle-vector #bits8-255-5.visible.current-fragment span.fade-in-bits,
section#shuffle-vector #bits8-255-6.visible.current-fragment span.fade-in-bits,
section#shuffle-vector #bits8-255-7.visible.current-fragment span.fade-in-bits,
section#shuffle-vector #bits8-255-8.visible.current-fragment span.fade-in-bits,
section#shuffle-vector #bits8-255-9.visible.current-fragment span.fade-in-bits {
    animation: 5s cubic-bezier(0.69, 0.02, 0.53, 1) 0s 1 forwards normal;
}

section#shuffle-vector #bits8-255-final.visible { top: calc(150px + 12em); }
section#shuffle-vector #bits8-255-final.visible.current-fragment { animation: bits8-255-final 0.5s ease-out 5s 1 forwards normal; }

section#shuffle-vector[data-fragment="4"] #bits8-255-final.visible {
    animation: bits8-255-final-upwards 3s cubic-bezier(0.69, 0.02, 0.53, 1) 0s 1 forwards normal;
    opacity: 1;
}

section#shuffle-vector[fragment-5] #bits8-255-final.visible { top: calc(150px + 1.5em); }


@keyframes bits8-255-final-upwards {
    0%   { top: calc(150px + 12em); }
    100% { top: calc(150px + 1.5em); }
}

section#shuffle-vector[fragment-5] #bits8-255-final.visible {
    top: calc(150px + 1.5em);
    transform: none;
    opacity: 1;
    animation: none;
}

section#shuffle-vector #bits8-plus.visible.current-fragment { animation-name: bits8-plus; }
section#shuffle-vector #bits8-255-2.visible.current-fragment { animation-name: bits8-255-2; }
section#shuffle-vector #bits8-255-3.visible.current-fragment { animation-name: bits8-255-3; }
section#shuffle-vector #bits8-255-4.visible.current-fragment { animation-name: bits8-255-4; }
section#shuffle-vector #bits8-255-5.visible.current-fragment { animation-name: bits8-255-5; }
section#shuffle-vector #bits8-255-6.visible.current-fragment { animation-name: bits8-255-6; }
section#shuffle-vector #bits8-255-7.visible.current-fragment { animation-name: bits8-255-7; }
section#shuffle-vector #bits8-255-8.visible.current-fragment { animation-name: bits8-255-8; }
section#shuffle-vector #bits8-255-9.visible.current-fragment { animation-name: bits8-255-9; }

section#shuffle-vector #bits8-255-2.visible.current-fragment span.fade-in-bits,
section#shuffle-vector #bits8-255-3.visible.current-fragment span.fade-in-bits,
section#shuffle-vector #bits8-255-4.visible.current-fragment span.fade-in-bits,
section#shuffle-vector #bits8-255-5.visible.current-fragment span.fade-in-bits,
section#shuffle-vector #bits8-255-6.visible.current-fragment span.fade-in-bits,
section#shuffle-vector #bits8-255-7.visible.current-fragment span.fade-in-bits,
section#shuffle-vector #bits8-255-8.visible.current-fragment span.fade-in-bits,
section#shuffle-vector #bits8-255-9.visible.current-fragment span.fade-in-bits {
    animation-name: fade-in-bits-255;
}

@keyframes fade-in-bits-255 {
    0%   { opacity: 0; }
    60%   { opacity: 0; }
    100% { opacity: 1; }
}

@keyframes bits8-255-final {
    0%   { opacity: 0; transform: translate(0, -1em); }
    100% { opacity: 1; transform: translate(0, 0); }
}

@keyframes bits8-plus {
    0% { opacity: 0; transform: translate(30em, 0); }
    80% { opacity: 0 }
    100% { opacity: 1; transform: translate(0, 0); }
}

@keyframes bits8-255-2 {
    0%   { opacity: 1; transform: translate(calc(0*12px), 1em); }
    50%  { opacity: 1; transform: translate(calc(0*12px), 3.5em); }
    100% { opacity: 1; transform: translate(0, 3.5em); }
}
@keyframes bits8-255-3 {
    0%   { opacity: 1; transform: translate(calc(1*12px), 1em); }
    50%  { opacity: 1; transform: translate(calc(1*12px), 4.5em); }
    100% { opacity: 1; transform: translate(0, 4.5em); }
}
@keyframes bits8-255-4 {
    0%   { opacity: 1; transform: translate(calc(2*12px), 1em); }
    50%  { opacity: 1; transform: translate(calc(2*12px), 5.5em); }
    100% { opacity: 1; transform: translate(0, 5.5em); }
}
@keyframes bits8-255-5 {
    0%   { opacity: 1; transform: translate(calc(3*12px), 1em); }
    50%  { opacity: 1; transform: translate(calc(3*12px), 6.5em); }
    100% { opacity: 1; transform: translate(0, 6.5em); }
}
@keyframes bits8-255-6 {
    0%   { opacity: 1; transform: translate(calc(4*12px), 1em); }
    50%  { opacity: 1; transform: translate(calc(4*12px), 7.5em); }
    100% { opacity: 1; transform: translate(0, 7.5em); }
}
@keyframes bits8-255-7 {
    0%   { opacity: 1; transform: translate(calc(5*12px), 1em); }
    50%  { opacity: 1; transform: translate(calc(5*12px), 8.5em); }
    100% { opacity: 1; transform: translate(0, 8.5em); }
}
@keyframes bits8-255-8 {
    0%   { opacity: 1; transform: translate(calc(6*12px), 1em); }
    50%  { opacity: 1; transform: translate(calc(6*12px), 9.5em); }
    100% { opacity: 1; transform: translate(0, 9.5em); }
}
@keyframes bits8-255-9 {
    0%   { opacity: 1; transform: translate(calc(7*12px), 1em); }
    50%  { opacity: 1; transform: translate(calc(7*12px), 10.5em); }
    100% { opacity: 1; transform: translate(0, 10.5em); }
}
</style>

<script>
const styles = [];

for (let [code_kind, color] of [
    ["*", "ffffff"],
    [" ", "ffffff"],
    [".hljs-keyword", "ff79c6"],
    [".hljs-built_in", "f1fa8c"],
    [".hljs-function-call", "f1fa8c"],
    [".hljs-literal", "bd93f9"],
    [".hljs-number",  "bd93f9"],
    [".hljs-type",  "50fa7b"],
    [".hljs-meta-event", "fffffff"],
    [".hljs-string", "ffb86c"],
    [".hljs-comment, .hljs-quote, .hljs-deletion", "6272a4"],
    [".hljs-params",  "ffffff"],
    [".hljs-identifier",  "ffffff"],
    [".hljs-ln-n:before",  "c6c6c6"],

]) {
    // code ${code_kind} {
    //     color: #${color}6f;
    //     text-shadow: 0 0 0.033em #ffffff6f, 0 0 0.08em #ffffff6f, 0 0 0.1em #${color}2f, 0 0 0.2em #${color}2f, 0 0 0.3em #${color}2f, 0 0 1em #${color}2f, 0 0 1.5em #${color}2f;
    // }
//     styles.push(`

// section:not([data-fragment="-1"]) tr.highlight-line:not(section#shuffle-vector[data-fragment="10"] table.hljs-ln > tbody > tr:first-child):not(section#prefix-shuffle[data-fragment="14"] table.hljs-ln > tbody > tr:first-child):not(section#shuffle-vector[data-fragment="9"][present-went-backward] table.hljs-ln > tbody > tr:first-child):not(section[data-fragment="-1"] pre code[all-highlighted] table.hljs-ln > tbody > tr.highlight-line) ${code_kind} {
//     color: #${color}20;
//     text-shadow: 0 0 0.033em #fff, 0 0 0.08em #fff, 0 0 0.1em #${color}6f, 0 0 0.2em #${color}6f, 0 0 0.3em #${color}6f, 0 0 1em #${color}6f, 0 0 1.5em #${color}6f;
// }

// section#shuffle-vector[data-fragment="10"] table.hljs-ln > tbody > tr:first-child span.return-type ${code_kind},
// section#prefix-shuffle[data-fragment="14"] table.hljs-ln > tbody > tr:first-child span.return-type ${code_kind} {
//     color: #${color}20 !important;
//     text-shadow: 0 0 0.033em #fff, 0 0 0.08em #fff, 0 0 0.1em #${color}6f, 0 0 0.2em #${color}6f, 0 0 0.3em #${color}6f, 0 0 1em #${color}6f, 0 0 1.5em #${color}6f;
// }
// `);

// tr.highlight-line:not(section#shuffle-vector[data-fragment="10"] table.hljs-ln > tbody > tr:first-child):not(section#prefix-shuffle[data-fragment="14"] table.hljs-ln > tbody > tr:first-child):not(section#shuffle-vector[data-fragment="9"][present-went-backward] table.hljs-ln > tbody > tr:first-child):not(section[data-fragment="-1"] pre code[all-highlighted] table.hljs-ln > tbody > tr.highlight-line)


}

for (let [code_kind, color, transparency1 = "00", transparency2 = "ff"] of [
    [".bit-1",                  "af0000", "20", "6f"],
    [".bit-0",                  "afaf00", "20", "6f"],
    [".squished, .bit-unknown", "00afaf", "20", "6f"],
    [".hex-translation",        "afaf80", "a0", "6f"],
    [".mo-zeros",               "ffffff", "20", "6f"],
    [".math-underlined",        "ffffff", "ff", "30"],
    ["li",                      "ffffff", "ff", "30"],
    ["h2",                      "BD93F9", "20", "6f"],
    [".var-name",               "ffffff", "ff", "30"],
    [".bad",                    "ff0000", "20", "6f"],
    [".good",                   "00ff00", "20", "6f"],
    // [".info",             "00ffff", "20", "6f"],
]) {
    styles.push(`${code_kind} {
        color: #${color}${transparency1} !important;
        text-shadow: 0 0 0.033em #fff, 0 0 0.08em #fff, 0 0 0.1em #${color}${transparency2}, 0 0 0.2em #${color}${transparency2}, 0 0 0.3em #${color}${transparency2}, 0 0 1em #${color}${transparency2}, 0 0 1.5em #${color}${transparency2} !important;
    }`);
}
// 0 0 0.033em #fff, 0 0 0.08em #fff, 0 0 0.1em var(--neon-orange-color), 0 0 0.2em var(--neon-orange-color), 0 0 0.3em var(--neon-orange-color), 0 0 1em var(--neon-orange-color), 0 0 1.5em var(--neon-orange-color), inset 0 0 0.1em var(--neon-orange-color), inset 0 0 0.2em var(--neon-orange-color), inset 0 0 0.3em var(--neon-orange-color), inset 0 0 1em var(--neon-orange-color), inset 0 0 1.5em var(--neon-orange-color)




var styleSheet = document.createElement("style")
styleSheet.innerText = styles.join("\n");
document.head.appendChild(styleSheet)
</script>
<style>
    .bad {
        text-decoration: underline;
        text-decoration-thickness: 2px;
        text-decoration-color: #ffafafff;
    }

    .reveal h2 {
        margin-bottom: 0;
    }
</style>
</div>
                </section>


                <section class="text-only" id="conclusion" data-auto-animate data-background-gradient="linear-gradient(#004, #400)" data-background-transition="none">
                    <h2>Conclusion</h2>
                    <div>
                        <ul>
                        <ul>
                            <li class="fragment">We discussed ways to optimize modern hardware across ISA's, and what compilers could do in the future to help.</li>
                            <li class="fragment">We decreased the memory usage and thereby increased the density of the data with regards to the second pass of the compiler.</li>
                            <li class="fragment">We made it feasible to combine the next two passes of the compiler, and have it do all the validation we need.</li>
                            <ul>
                                <li class="fragment fade-in-then-out">(aside from ensuring that the transformation of the second pass is actually correct)</li>
                            </ul>

                            <li class="fragment">We hopefully got somebody interested in this stuff!</li>
                        </ul>
                        </ul>
                    </div>
                </section>

                <section>
                    <h1>Fin</h1>
                </section>

            </div>
        </div>
        <script src="dist/reveal.js"></script>
        <script src="plugin/notes/notes.js"></script>
        <script src="plugin/markdown/markdown.js"></script>
        <script src="plugin/highlight/highlight.js"></script>
        <script src="plugin/math/math.js"></script>
        <script src="main.mjs" type="module"></script>

        <style>
/* .main-wrapper {
  background:
    repeating-radial-gradient(#000 0 0.0001%,#fff 0 0.0002%) 50% 0/2500px 2500px,
    repeating-conic-gradient(#000 0 0.0001%,#fff 0 0.0002%) 60% 60%/2500px 2500px;
  background-blend-mode: difference;
  animation: b .2s infinite alternate;
}
@keyframes b{
  100% {background-position: 50% 0, 60% 50%}
} */
.main-wrapper {
  opacity: 0.8;
  filter: brightness(1.1) contrast(2);
  position: relative;
  padding: 0;
  min-height: 100%;
  display: flex;
  justify-content: center;
  align-items: center;
}
.loader {
  position: relative;
  font-size: 60px;
  text-align: center;
  margin: 0;
  padding: 0;
  z-index: 1;
}
.noise-wrapper {
  position: absolute;
  left: 0;
  top: 0;
  width: 100%;
  height: 100%;
  opacity: 1;
  overflow: hidden;
  z-index: 10;
}
.noise-wrapper:after {
  content: '';
  position: absolute;
  top: 0;
  right: 0;
  bottom: 0;
  left: 0;
  background: radial-gradient(ellipse at center, rgba(0, 0, 0, 0) 0%, rgba(0, 0, 0, 0.75) 100%);
}
.noise {
  position: absolute;
  top: -500px;
  right: -500px;
  bottom: -500px;
  left: -500px;
  background: transparent url(https://www.dropbox.com/s/h7ab1c82ctzy83n/noise.png?raw=1) 0 0;
  background-size: 320px 320px;
  opacity: 0.35;
  -webkit-animation: noise 1s steps(8, end) infinite both;
          animation: noise 1s steps(8, end) infinite both;
}
@-webkit-keyframes noise {
  0% {
    transform: translateX(0px, 0px);
  }
  10% {
    transform: translate(-100px, 100px);
  }
  20% {
    transform: translate(150px, -100px);
  }
  30% {
    transform: translate(-100px, 100px);
  }
  40% {
    transform: translate(100px, -150px);
  }
  50% {
    transform: translate(-100px, 200px);
  }
  60% {
    transform: translate(-200px, -100px);
  }
  70% {
    transform: translateY(50px, 100px);
  }
  80% {
    transform: translate(100px, -150px);
  }
  90% {
    transform: translate(0px, 200px);
  }
  100% {
    transform: translate(-100px, 100px);
  }
}
@keyframes noise {
  0% {
    transform: translateX(0px, 0px);
  }
  10% {
    transform: translate(-100px, 100px);
  }
  20% {
    transform: translate(150px, -100px);
  }
  30% {
    transform: translate(-100px, 100px);
  }
  40% {
    transform: translate(100px, -150px);
  }
  50% {
    transform: translate(-100px, 200px);
  }
  60% {
    transform: translate(-200px, -100px);
  }
  70% {
    transform: translateY(50px, 100px);
  }
  80% {
    transform: translate(100px, -150px);
  }
  90% {
    transform: translate(0px, 200px);
  }
  100% {
    transform: translate(-100px, 100px);
  }
}


@keyframes animStar {
  from {
    transform: translateY(0px);
  }
  to {
    transform: translateY(-2000px);
  }
}

          </style>
          <script>
const all_styles = new Map();

{
let i = 0;
let styles = new Array();
let prev_selector;
let prev_slide_num;
let prev_section;
const animations = new Array();

//
for (const { section = (() => { throw "Invalid section" })(), selector, slide_num, keyframes, animation_delay, animation_duration, skip_auto_prev_state = section === prev_section && selector === prev_selector, forward_only = false, ease = false, linear = false, continuous = false } of global_animations) {
    if (section !== (prev_section ?? section)) {
        all_styles.set(prev_section, styles.join("\n"));
        styles = new Array();
    }
    i += 1;
    const keyframe_entries = Object.entries(keyframes).map(([a, b]) => [+a, b]).sort((a, b) => a[0] - b[0]);
    if (keyframe_entries[0]?.[0] !== 0) throw "Missing keyframe 0";
    if (keyframe_entries[keyframe_entries.length - 1]?.[0] !== 100) throw "Missing keyframe 100";

    if (selector !== prev_selector || slide_num !== prev_slide_num) {
        animations.length = 0;
    }

    const animation = `animation${i} ${animation_duration} ${linear ? "linear" : ease ? "ease" : "cubic-bezier(0.69, 0.02, 0.53, 1)"} ${animation_delay} 1 forwards normal`;
    animations.push(animation)

    if (!skip_auto_prev_state) {
        styles.push(`section#${section} ${selector} {
    ${Object.entries(keyframe_entries[0][1]).map(([a, b]) => `${a}: ${b};`).join("\n\t")}
}`);
    }

    let selectors = [selector];

    if (selector.startsWith('.')) {
        Array.prototype.push.apply(selectors, [...document.querySelectorAll(selector)].filter(x => x.id).map(x => `${selector}#${x.id}`));
    }

    styles.push(`${selectors.map(selector => `section#${section}[${continuous ? 'fragment-' : 'data-fragment="'}${slide_num}${continuous ? '' : '"'}]${forward_only ? "[present-went-forward]" : ""} ${selector}`).join(',\n')} {
    animation: ${animations.join(",\n\t")};
}`);

    if (!continuous) styles.push(`${selectors.map(selector => `section#${section}[fragment-${slide_num + 1}] ${selector}`).join(',\n')} {
    ${Object.entries(keyframe_entries[keyframe_entries.length - 1][1]).map(([a, b]) => `${a}: ${b};`).join("\n\t")}
}`);

    if (forward_only) styles.push(`${`${selectors.map(selector => `section#${section}[data-fragment="${slide_num}"][present-went-backward] ${selector}`).join(',\n')} {
    ${Object.entries(keyframe_entries[keyframe_entries.length - 1][1]).map(([a, b]) => `${a}: ${b};`).join("\n\t")}
}`}`);

    styles.push(`@keyframes animation${i} {
    ${keyframe_entries.map(([a, b]) => `${a}% { ${Object.entries(b).map(([a, b]) => `${a}: ${b};`).join(" ")} }`).join("\n\t")}
}`);

    if (forward_only) {
        // console.log(styles[styles.length - 1]);
    }

    prev_selector = selector;
    prev_slide_num = slide_num;
    prev_section = section;
}

all_styles.set(prev_section, styles.join("\n"));

var styleSheet = document.createElement("style");
styleSheet.id = "slide-animations";
styleSheet.innerHTML = [...all_styles.values()].join('\n');
document.head.appendChild(styleSheet);
}
          </script>
    </body>
</html>
